<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose v6.13.8: API docs</title><link rel="apple-touch-icon" sizes="57x57" href="/docs/6.x/docs/images/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/docs/6.x/docs/images/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/docs/6.x/docs/images/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/docs/6.x/docs/images/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/docs/6.x/docs/images/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/docs/6.x/docs/images/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/docs/6.x/docs/images/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/docs/6.x/docs/images/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/docs/6.x/docs/images/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/docs/6.x/docs/images/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/docs/6.x/docs/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/docs/6.x/docs/images/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/docs/6.x/docs/images/favicon/favicon-16x16.png"><link rel="manifest" href="/docs/6.x/docs/images/favicon/manifest.json"><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel="stylesheet" href="/docs/6.x/docs/css/github.css"><link rel="stylesheet" href="/docs/6.x/docs/css/mongoose5.css"><link rel="apple-touch-icon" sizes="57x57" href="images/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="images/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="images/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="images/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="images/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="images/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="images/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="images/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="images/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="images/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png"><link rel="manifest" href="images/favicon/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/docs/6.x/docs/images/favicon/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/docs/css/api.css"><script src="/docs/js/api-bold-current-nav.js"></script><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/6.x/docs/css/inlinecpc.css"></head><body><div id="layout"><div id="mobile-menu"><a class="menu-link" id="menuLink" href="#menu"><span></span></a><div id="mobile-logo-container"><a href="/"><img id="logo" src="/docs/6.x/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div></div><div id="menu"><div class="pure-menu"><div class="pure-menu-heading" id="logo-container"><a href="/"><img id="logo" src="/docs/6.x/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div><ul class="pure-menu-list" id="navbar"><li class="pure-menu-horizontal pure-menu-item pure-menu-has-children pure-menu-allow-hover version"><a class="pure-menu-link" href="/docs/6.x/docs/index.html">Version 6.13.8</a><ul class="pure-menu-children"><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/index.html">Version 8.15.0</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/index.html">Version 6.13.8</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/5.x/index.html">Version 5.13.22</a></li></ul></li><li class="pure-menu-item search"><input id="search-input-nav" type="text" placeholder="Search"><button id="search-button-nav"><img src="/docs/6.x/docs/images/search.svg"></button></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/index.html">Quick Start</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/guides.html">Guides</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/guide.html">Schemas</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/schematypes.html">SchemaTypes</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/connections.html">Connections</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/models.html">Models</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/documents.html">Documents</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/subdocs.html">Subdocuments</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/queries.html">Queries</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/validation.html">Validation</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/middleware.html">Middleware</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/populate.html">Populate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/discriminators.html">Discriminators</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/plugins.html">Plugins</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/timestamps.html">Timestamps</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/transactions.html">Transactions</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/typescript.html">TypeScript</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/mongoose.html">API</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/mongoose.html">Mongoose</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/schema.html">Schema</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/connection.html">Connection</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/document.html">Document</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/model.html">Model</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/query.html">Query</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/aggregate.html">Aggregate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/schematype.html">SchemaType</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/6.x/docs/api/virtualtype.html">VirtualType</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/migrating_to_6.html">Migration Guide</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/compatibility.html">Version Compatibility</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/faq.html">FAQ</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/version-support.html">Version Support</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/further_reading.html">Further Reading</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/enterprise.html">For Enterprise</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/docs/sponsors.html" >Sponsors</a></li></ul><div class="cpc-ad"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=mongoosejscom" id="_carbonads_js"></script></div></div></div><div class="container"><div id="content"><h1>API Docs</h1><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/6.x/docs/css/inlinecpc.css"><div id="native-direct"></div><script>(function() {
if (typeof _bsa !== 'undefined' && _bsa) {
_bsa.init('custom', 'CK7DT53U', 'placement:mongoosejscom',
{
target: '#native-direct',
template: `
<div class="native-inline">
<a rel="sponsored noopener" target="_blank" href="##statlink##" title="##company## — ##tagline##"><span class="sponsor">Sponsor</span> ##company## — ##description##</a>
</div>
</a>
`
}
);
}
})();</script><div class="api-nav"><div class="api-nav-content"><div class="nav-item" id="nav-Mongoose"><div class="nav-item-title"><a href="./api/mongoose.html">Mongoose</a></div><ul class="nav-item-sub"><li><a href="./api/mongoose.html#mongoose_Mongoose">Mongoose()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Aggregate">Mongoose.prototype.Aggregate()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-CastError">Mongoose.prototype.CastError()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Collection">Mongoose.prototype.Collection()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Connection">Mongoose.prototype.Connection()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-ConnectionStates">Mongoose.prototype.ConnectionStates</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Date">Mongoose.prototype.Date</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Decimal128">Mongoose.prototype.Decimal128</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Document">Mongoose.prototype.Document()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-DocumentProvider">Mongoose.prototype.DocumentProvider()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Error">Mongoose.prototype.Error()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Mixed">Mongoose.prototype.Mixed</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Model">Mongoose.prototype.Model()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Mongoose">Mongoose.prototype.Mongoose()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Number">Mongoose.prototype.Number</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-ObjectId">Mongoose.prototype.ObjectId</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Promise">Mongoose.prototype.Promise</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-PromiseProvider">Mongoose.prototype.PromiseProvider()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Query">Mongoose.prototype.Query()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-STATES">Mongoose.prototype.STATES</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Schema">Mongoose.prototype.Schema()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-SchemaType">Mongoose.prototype.SchemaType()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-SchemaTypeOptions">Mongoose.prototype.SchemaTypeOptions()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-SchemaTypes">Mongoose.prototype.SchemaTypes</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-Types">Mongoose.prototype.Types</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-VirtualType">Mongoose.prototype.VirtualType()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-connect">Mongoose.prototype.connect()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-connection">Mongoose.prototype.connection</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-connections">Mongoose.prototype.connections</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-createConnection">Mongoose.prototype.createConnection()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-deleteModel">Mongoose.prototype.deleteModel()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-disconnect">Mongoose.prototype.disconnect()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-driver">Mongoose.prototype.driver</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-get">Mongoose.prototype.get()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-isObjectIdOrHexString">Mongoose.prototype.isObjectIdOrHexString()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-isValidObjectId">Mongoose.prototype.isValidObjectId()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-model">Mongoose.prototype.model()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-modelNames">Mongoose.prototype.modelNames()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-mongo">Mongoose.prototype.mongo</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-mquery">Mongoose.prototype.mquery</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-now">Mongoose.prototype.now()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-overwriteMiddlewareResult">Mongoose.prototype.overwriteMiddlewareResult()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-plugin">Mongoose.prototype.plugin()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-pluralize">Mongoose.prototype.pluralize()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-sanitizeFilter">Mongoose.prototype.sanitizeFilter()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-set">Mongoose.prototype.set()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-setDriver">Mongoose.prototype.setDriver()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-skipMiddlewareFunction">Mongoose.prototype.skipMiddlewareFunction()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-startSession">Mongoose.prototype.startSession()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-syncIndexes">Mongoose.prototype.syncIndexes()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-trusted">Mongoose.prototype.trusted()</a></li><li><a href="./api/mongoose.html#mongoose_Mongoose-version">Mongoose.prototype.version</a></li></ul></div><div class="nav-item" id="nav-Schema"><div class="nav-item-title"><a href="./api/schema.html">Schema</a></div><ul class="nav-item-sub"><li><a href="./api/schema.html#schema_Schema">Schema()</a></li><li><a href="./api/schema.html#schema_Schema-Types">Schema.Types</a></li><li><a href="./api/schema.html#schema_Schema-indexTypes">Schema.indexTypes</a></li><li><a href="./api/schema.html#schema_Schema-add">Schema.prototype.add()</a></li><li><a href="./api/schema.html#schema_Schema-alias">Schema.prototype.alias()</a></li><li><a href="./api/schema.html#schema_Schema-childSchemas">Schema.prototype.childSchemas</a></li><li><a href="./api/schema.html#schema_Schema-clearIndexes">Schema.prototype.clearIndexes()</a></li><li><a href="./api/schema.html#schema_Schema-clone">Schema.prototype.clone()</a></li><li><a href="./api/schema.html#schema_Schema-discriminator">Schema.prototype.discriminator()</a></li><li><a href="./api/schema.html#schema_Schema-eachPath">Schema.prototype.eachPath()</a></li><li><a href="./api/schema.html#schema_Schema-get">Schema.prototype.get()</a></li><li><a href="./api/schema.html#schema_Schema-index">Schema.prototype.index()</a></li><li><a href="./api/schema.html#schema_Schema-indexes">Schema.prototype.indexes()</a></li><li><a href="./api/schema.html#schema_Schema-loadClass">Schema.prototype.loadClass()</a></li><li><a href="./api/schema.html#schema_Schema-method">Schema.prototype.method()</a></li><li><a href="./api/schema.html#schema_Schema-obj">Schema.prototype.obj</a></li><li><a href="./api/schema.html#schema_Schema-omit">Schema.prototype.omit()</a></li><li><a href="./api/schema.html#schema_Schema-path">Schema.prototype.path()</a></li><li><a href="./api/schema.html#schema_Schema-pathType">Schema.prototype.pathType()</a></li><li><a href="./api/schema.html#schema_Schema-paths">Schema.prototype.paths</a></li><li><a href="./api/schema.html#schema_Schema-pick">Schema.prototype.pick()</a></li><li><a href="./api/schema.html#schema_Schema-plugin">Schema.prototype.plugin()</a></li><li><a href="./api/schema.html#schema_Schema-post">Schema.prototype.post()</a></li><li><a href="./api/schema.html#schema_Schema-pre">Schema.prototype.pre()</a></li><li><a href="./api/schema.html#schema_Schema-queue">Schema.prototype.queue()</a></li><li><a href="./api/schema.html#schema_Schema-remove">Schema.prototype.remove()</a></li><li><a href="./api/schema.html#schema_Schema-removeIndex">Schema.prototype.removeIndex()</a></li><li><a href="./api/schema.html#schema_Schema-removeVirtual">Schema.prototype.removeVirtual()</a></li><li><a href="./api/schema.html#schema_Schema-requiredPaths">Schema.prototype.requiredPaths()</a></li><li><a href="./api/schema.html#schema_Schema-set">Schema.prototype.set()</a></li><li><a href="./api/schema.html#schema_Schema-static">Schema.prototype.static()</a></li><li><a href="./api/schema.html#schema_Schema-virtual">Schema.prototype.virtual()</a></li><li><a href="./api/schema.html#schema_Schema-virtualpath">Schema.prototype.virtualpath()</a></li><li><a href="./api/schema.html#schema_Schema-virtuals">Schema.prototype.virtuals</a></li><li><a href="./api/schema.html#schema_Schema-reserved">Schema.reserved</a></li></ul></div><div class="nav-item" id="nav-Connection"><div class="nav-item-title"><a href="./api/connection.html">Connection</a></div><ul class="nav-item-sub"><li><a href="./api/connection.html#connection_Connection">Connection()</a></li><li><a href="./api/connection.html#connection_Connection-asPromise">Connection.prototype.asPromise()</a></li><li><a href="./api/connection.html#connection_Connection-client">Connection.prototype.client</a></li><li><a href="./api/connection.html#connection_Connection-close">Connection.prototype.close()</a></li><li><a href="./api/connection.html#connection_Connection-collection">Connection.prototype.collection()</a></li><li><a href="./api/connection.html#connection_Connection-collections">Connection.prototype.collections</a></li><li><a href="./api/connection.html#connection_Connection-config">Connection.prototype.config</a></li><li><a href="./api/connection.html#connection_Connection-createCollection">Connection.prototype.createCollection()</a></li><li><a href="./api/connection.html#connection_Connection-db">Connection.prototype.db</a></li><li><a href="./api/connection.html#connection_Connection-deleteModel">Connection.prototype.deleteModel()</a></li><li><a href="./api/connection.html#connection_Connection-destroy">Connection.prototype.destroy()</a></li><li><a href="./api/connection.html#connection_Connection-dropCollection">Connection.prototype.dropCollection()</a></li><li><a href="./api/connection.html#connection_Connection-dropDatabase">Connection.prototype.dropDatabase()</a></li><li><a href="./api/connection.html#connection_Connection-get">Connection.prototype.get()</a></li><li><a href="./api/connection.html#connection_Connection-getClient">Connection.prototype.getClient()</a></li><li><a href="./api/connection.html#connection_Connection-host">Connection.prototype.host</a></li><li><a href="./api/connection.html#connection_Connection-id">Connection.prototype.id</a></li><li><a href="./api/connection.html#connection_Connection-model">Connection.prototype.model()</a></li><li><a href="./api/connection.html#connection_Connection-modelNames">Connection.prototype.modelNames()</a></li><li><a href="./api/connection.html#connection_Connection-models">Connection.prototype.models</a></li><li><a href="./api/connection.html#connection_Connection-name">Connection.prototype.name</a></li><li><a href="./api/connection.html#connection_Connection-openUri">Connection.prototype.openUri()</a></li><li><a href="./api/connection.html#connection_Connection-pass">Connection.prototype.pass</a></li><li><a href="./api/connection.html#connection_Connection-plugin">Connection.prototype.plugin()</a></li><li><a href="./api/connection.html#connection_Connection-plugins">Connection.prototype.plugins</a></li><li><a href="./api/connection.html#connection_Connection-port">Connection.prototype.port</a></li><li><a href="./api/connection.html#connection_Connection-readyState">Connection.prototype.readyState</a></li><li><a href="./api/connection.html#connection_Connection-set">Connection.prototype.set()</a></li><li><a href="./api/connection.html#connection_Connection-setClient">Connection.prototype.setClient()</a></li><li><a href="./api/connection.html#connection_Connection-startSession">Connection.prototype.startSession()</a></li><li><a href="./api/connection.html#connection_Connection-syncIndexes">Connection.prototype.syncIndexes</a></li><li><a href="./api/connection.html#connection_Connection-transaction">Connection.prototype.transaction()</a></li><li><a href="./api/connection.html#connection_Connection-useDb">Connection.prototype.useDb()</a></li><li><a href="./api/connection.html#connection_Connection-user">Connection.prototype.user</a></li><li><a href="./api/connection.html#connection_Connection-watch">Connection.prototype.watch()</a></li></ul></div><div class="nav-item" id="nav-Document"><div class="nav-item-title"><a href="./api/document.html">Document</a></div><ul class="nav-item-sub"><li><a href="./api/document.html#document_Document-$assertPopulated">Document.prototype.$assertPopulated()</a></li><li><a href="./api/document.html#document_Document-$clone">Document.prototype.$clone()</a></li><li><a href="./api/document.html#document_Document-$errors">Document.prototype.$errors</a></li><li><a href="./api/document.html#document_Document-$getAllSubdocs">Document.prototype.$getAllSubdocs()</a></li><li><a href="./api/document.html#document_Document-$getPopulatedDocs">Document.prototype.$getPopulatedDocs()</a></li><li><a href="./api/document.html#document_Document-$ignore">Document.prototype.$ignore()</a></li><li><a href="./api/document.html#document_Document-$inc">Document.prototype.$inc()</a></li><li><a href="./api/document.html#document_Document-$init">Document.prototype.$init()</a></li><li><a href="./api/document.html#document_Document-$isDefault">Document.prototype.$isDefault()</a></li><li><a href="./api/document.html#document_Document-$isDeleted">Document.prototype.$isDeleted()</a></li><li><a href="./api/document.html#document_Document-$isEmpty">Document.prototype.$isEmpty()</a></li><li><a href="./api/document.html#document_Document-$isModified">Document.prototype.$isModified()</a></li><li><a href="./api/document.html#document_Document-$isNew">Document.prototype.$isNew</a></li><li><a href="./api/document.html#document_Document-$locals">Document.prototype.$locals</a></li><li><a href="./api/document.html#document_Document-$markValid">Document.prototype.$markValid()</a></li><li><a href="./api/document.html#document_Document-$op">Document.prototype.$op</a></li><li><a href="./api/document.html#document_Document-$parent">Document.prototype.$parent()</a></li><li><a href="./api/document.html#document_Document-$populated">Document.prototype.$populated()</a></li><li><a href="./api/document.html#document_Document-$session">Document.prototype.$session()</a></li><li><a href="./api/document.html#document_Document-$set">Document.prototype.$set()</a></li><li><a href="./api/document.html#document_Document-$timestamps">Document.prototype.$timestamps()</a></li><li><a href="./api/document.html#document_Document-$validate">Document.prototype.$validate()</a></li><li><a href="./api/document.html#document_Document-$where">Document.prototype.$where</a></li><li><a href="./api/document.html#document_Document-depopulate">Document.prototype.depopulate()</a></li><li><a href="./api/document.html#document_Document-directModifiedPaths">Document.prototype.directModifiedPaths()</a></li><li><a href="./api/document.html#document_Document-equals">Document.prototype.equals()</a></li><li><a href="./api/document.html#document_Document-errors">Document.prototype.errors</a></li><li><a href="./api/document.html#document_Document-get">Document.prototype.get()</a></li><li><a href="./api/document.html#document_Document-getChanges">Document.prototype.getChanges()</a></li><li><a href="./api/document.html#document_Document-id">Document.prototype.id</a></li><li><a href="./api/document.html#document_Document-init">Document.prototype.init()</a></li><li><a href="./api/document.html#document_Document-inspect">Document.prototype.inspect()</a></li><li><a href="./api/document.html#document_Document-invalidate">Document.prototype.invalidate()</a></li><li><a href="./api/document.html#document_Document-isDirectModified">Document.prototype.isDirectModified()</a></li><li><a href="./api/document.html#document_Document-isDirectSelected">Document.prototype.isDirectSelected()</a></li><li><a href="./api/document.html#document_Document-isInit">Document.prototype.isInit()</a></li><li><a href="./api/document.html#document_Document-isModified">Document.prototype.isModified()</a></li><li><a href="./api/document.html#document_Document-isNew">Document.prototype.isNew</a></li><li><a href="./api/document.html#document_Document-isSelected">Document.prototype.isSelected()</a></li><li><a href="./api/document.html#document_Document-markModified">Document.prototype.markModified()</a></li><li><a href="./api/document.html#document_Document-modifiedPaths">Document.prototype.modifiedPaths()</a></li><li><a href="./api/document.html#document_Document-overwrite">Document.prototype.overwrite()</a></li><li><a href="./api/document.html#document_Document-parent">Document.prototype.parent()</a></li><li><a href="./api/document.html#document_Document-populate">Document.prototype.populate()</a></li><li><a href="./api/document.html#document_Document-populated">Document.prototype.populated()</a></li><li><a href="./api/document.html#document_Document-replaceOne">Document.prototype.replaceOne()</a></li><li><a href="./api/document.html#document_Document-save">Document.prototype.save()</a></li><li><a href="./api/document.html#document_Document-schema">Document.prototype.schema</a></li><li><a href="./api/document.html#document_Document-set">Document.prototype.set()</a></li><li><a href="./api/document.html#document_Document-toJSON">Document.prototype.toJSON()</a></li><li><a href="./api/document.html#document_Document-toObject">Document.prototype.toObject()</a></li><li><a href="./api/document.html#document_Document-toString">Document.prototype.toString()</a></li><li><a href="./api/document.html#document_Document-unmarkModified">Document.prototype.unmarkModified()</a></li><li><a href="./api/document.html#document_Document-update">Document.prototype.update()</a></li><li><a href="./api/document.html#document_Document-updateOne">Document.prototype.updateOne()</a></li><li><a href="./api/document.html#document_Document-validate">Document.prototype.validate()</a></li><li><a href="./api/document.html#document_Document-validateSync">Document.prototype.validateSync()</a></li></ul></div><div class="nav-item" id="nav-Model"><div class="nav-item-title"><a href="./api/model.html">Model</a></div><ul class="nav-item-sub"><li><a href="./api/model.html#model_Model">Model()</a></li><li><a href="./api/model.html#model_Model-$where">Model.$where()</a></li><li><a href="./api/model.html#model_Model-aggregate">Model.aggregate()</a></li><li><a href="./api/model.html#model_Model-applyDefaults">Model.applyDefaults()</a></li><li><a href="./api/model.html#model_Model-bulkSave">Model.bulkSave</a></li><li><a href="./api/model.html#model_Model-bulkWrite">Model.bulkWrite()</a></li><li><a href="./api/model.html#model_Model-castObject">Model.castObject()</a></li><li><a href="./api/model.html#model_Model-cleanIndexes">Model.cleanIndexes()</a></li><li><a href="./api/model.html#model_Model-count">Model.count()</a></li><li><a href="./api/model.html#model_Model-countDocuments">Model.countDocuments()</a></li><li><a href="./api/model.html#model_Model-create">Model.create()</a></li><li><a href="./api/model.html#model_Model-createCollection">Model.createCollection()</a></li><li><a href="./api/model.html#model_Model-createIndexes">Model.createIndexes()</a></li><li><a href="./api/model.html#model_Model-db">Model.db</a></li><li><a href="./api/model.html#model_Model-deleteMany">Model.deleteMany()</a></li><li><a href="./api/model.html#model_Model-deleteOne">Model.deleteOne()</a></li><li><a href="./api/model.html#model_Model-diffIndexes">Model.diffIndexes()</a></li><li><a href="./api/model.html#model_Model-discriminator">Model.discriminator()</a></li><li><a href="./api/model.html#model_Model-distinct">Model.distinct()</a></li><li><a href="./api/model.html#model_Model-ensureIndexes">Model.ensureIndexes()</a></li><li><a href="./api/model.html#model_Model-estimatedDocumentCount">Model.estimatedDocumentCount()</a></li><li><a href="./api/model.html#model_Model-events">Model.events</a></li><li><a href="./api/model.html#model_Model-exists">Model.exists()</a></li><li><a href="./api/model.html#model_Model-find">Model.find()</a></li><li><a href="./api/model.html#model_Model-findById">Model.findById()</a></li><li><a href="./api/model.html#model_Model-findByIdAndDelete">Model.findByIdAndDelete()</a></li><li><a href="./api/model.html#model_Model-findByIdAndRemove">Model.findByIdAndRemove()</a></li><li><a href="./api/model.html#model_Model-findByIdAndUpdate">Model.findByIdAndUpdate()</a></li><li><a href="./api/model.html#model_Model-findOne">Model.findOne()</a></li><li><a href="./api/model.html#model_Model-findOneAndDelete">Model.findOneAndDelete()</a></li><li><a href="./api/model.html#model_Model-findOneAndRemove">Model.findOneAndRemove()</a></li><li><a href="./api/model.html#model_Model-findOneAndReplace">Model.findOneAndReplace()</a></li><li><a href="./api/model.html#model_Model-findOneAndUpdate">Model.findOneAndUpdate()</a></li><li><a href="./api/model.html#model_Model-hydrate">Model.hydrate()</a></li><li><a href="./api/model.html#model_Model-init">Model.init()</a></li><li><a href="./api/model.html#model_Model-insertMany">Model.insertMany()</a></li><li><a href="./api/model.html#model_Model-inspect">Model.inspect()</a></li><li><a href="./api/model.html#model_Model-listIndexes">Model.listIndexes()</a></li><li><a href="./api/model.html#model_Model-mapReduce">Model.mapReduce()</a></li><li><a href="./api/model.html#model_Model-populate">Model.populate()</a></li><li><a href="./api/model.html#model_Model-$model">Model.prototype.$model()</a></li><li><a href="./api/model.html#model_Model-$remove">Model.prototype.$remove()</a></li><li><a href="./api/model.html#model_Model-$where">Model.prototype.$where</a></li><li><a href="./api/model.html#model_Model-base">Model.prototype.base</a></li><li><a href="./api/model.html#model_Model-baseModelName">Model.prototype.baseModelName</a></li><li><a href="./api/model.html#model_Model-collection">Model.prototype.collection</a></li><li><a href="./api/model.html#model_Model-collection">Model.prototype.collection</a></li><li><a href="./api/model.html#model_Model-db">Model.prototype.db</a></li><li><a href="./api/model.html#model_Model-deleteOne">Model.prototype.deleteOne()</a></li><li><a href="./api/model.html#model_Model-discriminators">Model.prototype.discriminators</a></li><li><a href="./api/model.html#model_Model-increment">Model.prototype.increment()</a></li><li><a href="./api/model.html#model_Model-model">Model.prototype.model()</a></li><li><a href="./api/model.html#model_Model-modelName">Model.prototype.modelName</a></li><li><a href="./api/model.html#model_Model-remove">Model.prototype.remove()</a></li><li><a href="./api/model.html#model_Model-save">Model.prototype.save()</a></li><li><a href="./api/model.html#model_Model-remove">Model.remove()</a></li><li><a href="./api/model.html#model_Model-replaceOne">Model.replaceOne()</a></li><li><a href="./api/model.html#model_Model-schema">Model.schema</a></li><li><a href="./api/model.html#model_Model-startSession">Model.startSession()</a></li><li><a href="./api/model.html#model_Model-syncIndexes">Model.syncIndexes()</a></li><li><a href="./api/model.html#model_Model-translateAliases">Model.translateAliases()</a></li><li><a href="./api/model.html#model_Model-update">Model.update()</a></li><li><a href="./api/model.html#model_Model-updateMany">Model.updateMany()</a></li><li><a href="./api/model.html#model_Model-updateOne">Model.updateOne()</a></li><li><a href="./api/model.html#model_Model-validate">Model.validate()</a></li><li><a href="./api/model.html#model_Model-watch">Model.watch()</a></li><li><a href="./api/model.html#model_Model-where">Model.where()</a></li></ul></div><div class="nav-item" id="nav-Query"><div class="nav-item-title"><a href="./api/query.html">Query</a></div><ul class="nav-item-sub"><li><a href="./api/query.html#query_Query">Query()</a></li><li><a href="./api/query.html#query_Query-$where">Query.prototype.$where()</a></li><li><a href="./api/query.html#query_Query-all">Query.prototype.all()</a></li><li><a href="./api/query.html#query_Query-allowDiskUse">Query.prototype.allowDiskUse()</a></li><li><a href="./api/query.html#query_Query-and">Query.prototype.and()</a></li><li><a href="./api/query.html#query_Query-batchSize">Query.prototype.batchSize()</a></li><li><a href="./api/query.html#query_Query-box">Query.prototype.box()</a></li><li><a href="./api/query.html#query_Query-cast">Query.prototype.cast()</a></li><li><a href="./api/query.html#query_Query-catch">Query.prototype.catch()</a></li><li><a href="./api/query.html#query_Query-center">Query.prototype.center()</a></li><li><a href="./api/query.html#query_Query-centerSphere">Query.prototype.centerSphere()</a></li><li><a href="./api/query.html#query_Query-circle">Query.prototype.circle()</a></li><li><a href="./api/query.html#query_Query-clone">Query.prototype.clone()</a></li><li><a href="./api/query.html#query_Query-collation">Query.prototype.collation()</a></li><li><a href="./api/query.html#query_Query-comment">Query.prototype.comment()</a></li><li><a href="./api/query.html#query_Query-count">Query.prototype.count()</a></li><li><a href="./api/query.html#query_Query-countDocuments">Query.prototype.countDocuments()</a></li><li><a href="./api/query.html#query_Query-cursor">Query.prototype.cursor()</a></li><li><a href="./api/query.html#query_Query-deleteMany">Query.prototype.deleteMany()</a></li><li><a href="./api/query.html#query_Query-deleteOne">Query.prototype.deleteOne()</a></li><li><a href="./api/query.html#query_Query-distinct">Query.prototype.distinct()</a></li><li><a href="./api/query.html#query_Query-elemMatch">Query.prototype.elemMatch()</a></li><li><a href="./api/query.html#query_Query-equals">Query.prototype.equals()</a></li><li><a href="./api/query.html#query_Query-error">Query.prototype.error()</a></li><li><a href="./api/query.html#query_Query-estimatedDocumentCount">Query.prototype.estimatedDocumentCount()</a></li><li><a href="./api/query.html#query_Query-exec">Query.prototype.exec()</a></li><li><a href="./api/query.html#query_Query-exists">Query.prototype.exists()</a></li><li><a href="./api/query.html#query_Query-explain">Query.prototype.explain()</a></li><li><a href="./api/query.html#query_Query-find">Query.prototype.find()</a></li><li><a href="./api/query.html#query_Query-findOne">Query.prototype.findOne()</a></li><li><a href="./api/query.html#query_Query-findOneAndDelete">Query.prototype.findOneAndDelete()</a></li><li><a href="./api/query.html#query_Query-findOneAndRemove">Query.prototype.findOneAndRemove()</a></li><li><a href="./api/query.html#query_Query-findOneAndReplace">Query.prototype.findOneAndReplace()</a></li><li><a href="./api/query.html#query_Query-findOneAndUpdate">Query.prototype.findOneAndUpdate()</a></li><li><a href="./api/query.html#query_Query-geometry">Query.prototype.geometry()</a></li><li><a href="./api/query.html#query_Query-get">Query.prototype.get()</a></li><li><a href="./api/query.html#query_Query-getFilter">Query.prototype.getFilter()</a></li><li><a href="./api/query.html#query_Query-getOptions">Query.prototype.getOptions()</a></li><li><a href="./api/query.html#query_Query-getPopulatedPaths">Query.prototype.getPopulatedPaths()</a></li><li><a href="./api/query.html#query_Query-getQuery">Query.prototype.getQuery()</a></li><li><a href="./api/query.html#query_Query-getUpdate">Query.prototype.getUpdate()</a></li><li><a href="./api/query.html#query_Query-gt">Query.prototype.gt()</a></li><li><a href="./api/query.html#query_Query-gte">Query.prototype.gte()</a></li><li><a href="./api/query.html#query_Query-hint">Query.prototype.hint()</a></li><li><a href="./api/query.html#query_Query-in">Query.prototype.in()</a></li><li><a href="./api/query.html#query_Query-intersects">Query.prototype.intersects()</a></li><li><a href="./api/query.html#query_Query-j">Query.prototype.j()</a></li><li><a href="./api/query.html#query_Query-lean">Query.prototype.lean()</a></li><li><a href="./api/query.html#query_Query-limit">Query.prototype.limit()</a></li><li><a href="./api/query.html#query_Query-lt">Query.prototype.lt()</a></li><li><a href="./api/query.html#query_Query-lte">Query.prototype.lte()</a></li><li><a href="./api/query.html#query_Query-maxDistance">Query.prototype.maxDistance()</a></li><li><a href="./api/query.html#query_Query-maxScan">Query.prototype.maxScan()</a></li><li><a href="./api/query.html#query_Query-maxTimeMS">Query.prototype.maxTimeMS()</a></li><li><a href="./api/query.html#query_Query-maxscan">Query.prototype.maxscan()</a></li><li><a href="./api/query.html#query_Query-merge">Query.prototype.merge()</a></li><li><a href="./api/query.html#query_Query-mod">Query.prototype.mod()</a></li><li><a href="./api/query.html#query_Query-model">Query.prototype.model</a></li><li><a href="./api/query.html#query_Query-mongooseOptions">Query.prototype.mongooseOptions()</a></li><li><a href="./api/query.html#query_Query-ne">Query.prototype.ne()</a></li><li><a href="./api/query.html#query_Query-near">Query.prototype.near()</a></li><li><a href="./api/query.html#query_Query-nearSphere">Query.prototype.nearSphere()</a></li><li><a href="./api/query.html#query_Query-nin">Query.prototype.nin()</a></li><li><a href="./api/query.html#query_Query-nor">Query.prototype.nor()</a></li><li><a href="./api/query.html#query_Query-or">Query.prototype.or()</a></li><li><a href="./api/query.html#query_Query-orFail">Query.prototype.orFail()</a></li><li><a href="./api/query.html#query_Query-polygon">Query.prototype.polygon()</a></li><li><a href="./api/query.html#query_Query-populate">Query.prototype.populate()</a></li><li><a href="./api/query.html#query_Query-post">Query.prototype.post()</a></li><li><a href="./api/query.html#query_Query-pre">Query.prototype.pre()</a></li><li><a href="./api/query.html#query_Query-projection">Query.prototype.projection()</a></li><li><a href="./api/query.html#query_Query-read">Query.prototype.read()</a></li><li><a href="./api/query.html#query_Query-readConcern">Query.prototype.readConcern()</a></li><li><a href="./api/query.html#query_Query-regex">Query.prototype.regex()</a></li><li><a href="./api/query.html#query_Query-remove">Query.prototype.remove()</a></li><li><a href="./api/query.html#query_Query-replaceOne">Query.prototype.replaceOne()</a></li><li><a href="./api/query.html#query_Query-select">Query.prototype.select()</a></li><li><a href="./api/query.html#query_Query-selected">Query.prototype.selected()</a></li><li><a href="./api/query.html#query_Query-selectedExclusively">Query.prototype.selectedExclusively()</a></li><li><a href="./api/query.html#query_Query-selectedInclusively">Query.prototype.selectedInclusively()</a></li><li><a href="./api/query.html#query_Query-session">Query.prototype.session()</a></li><li><a href="./api/query.html#query_Query-set">Query.prototype.set()</a></li><li><a href="./api/query.html#query_Query-setOptions">Query.prototype.setOptions()</a></li><li><a href="./api/query.html#query_Query-setQuery">Query.prototype.setQuery()</a></li><li><a href="./api/query.html#query_Query-setUpdate">Query.prototype.setUpdate()</a></li><li><a href="./api/query.html#query_Query-size">Query.prototype.size()</a></li><li><a href="./api/query.html#query_Query-skip">Query.prototype.skip()</a></li><li><a href="./api/query.html#query_Query-slice">Query.prototype.slice()</a></li><li><a href="./api/query.html#query_Query-snapshot">Query.prototype.snapshot()</a></li><li><a href="./api/query.html#query_Query-sort">Query.prototype.sort()</a></li><li><a href="./api/query.html#query_Query-tailable">Query.prototype.tailable()</a></li><li><a href="./api/query.html#query_Query-then">Query.prototype.then()</a></li><li><a href="./api/query.html#query_Query-toConstructor">Query.prototype.toConstructor()</a></li><li><a href="./api/query.html#query_Query-transform">Query.prototype.transform()</a></li><li><a href="./api/query.html#query_Query-update">Query.prototype.update()</a></li><li><a href="./api/query.html#query_Query-updateMany">Query.prototype.updateMany()</a></li><li><a href="./api/query.html#query_Query-updateOne">Query.prototype.updateOne()</a></li><li><a href="./api/query.html#query_Query-w">Query.prototype.w()</a></li><li><a href="./api/query.html#query_Query-where">Query.prototype.where()</a></li><li><a href="./api/query.html#query_Query-within">Query.prototype.within()</a></li><li><a href="./api/query.html#query_Query-writeConcern">Query.prototype.writeConcern()</a></li><li><a href="./api/query.html#query_Query-wtimeout">Query.prototype.wtimeout()</a></li><li><a href="./api/query.html#query_Query-[Symbol.asyncIterator]">Query.prototype[Symbol.asyncIterator]()</a></li><li><a href="./api/query.html#query_Query-use$geoWithin">Query.use$geoWithin</a></li></ul></div><div class="nav-item" id="nav-QueryCursor"><div class="nav-item-title"><a href="./api/querycursor.html">QueryCursor</a></div><ul class="nav-item-sub"><li><a href="./api/querycursor.html#querycursor_QueryCursor">QueryCursor()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-addCursorFlag">QueryCursor.prototype.addCursorFlag()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-close">QueryCursor.prototype.close()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-eachAsync">QueryCursor.prototype.eachAsync()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-map">QueryCursor.prototype.map()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-next">QueryCursor.prototype.next()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-options">QueryCursor.prototype.options</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-rewind">QueryCursor.prototype.rewind()</a></li><li><a href="./api/querycursor.html#querycursor_QueryCursor-[Symbol.asyncIterator]">QueryCursor.prototype[Symbol.asyncIterator]()</a></li></ul></div><div class="nav-item" id="nav-Aggregate"><div class="nav-item-title"><a href="./api/aggregate.html">Aggregate</a></div><ul class="nav-item-sub"><li><a href="./api/aggregate.html#aggregate_Aggregate">Aggregate()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-addFields">Aggregate.prototype.addFields()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-allowDiskUse">Aggregate.prototype.allowDiskUse()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-append">Aggregate.prototype.append()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-catch">Aggregate.prototype.catch()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-collation">Aggregate.prototype.collation()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-count">Aggregate.prototype.count()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-cursor">Aggregate.prototype.cursor()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-densify">Aggregate.prototype.densify()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-exec">Aggregate.prototype.exec()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-explain">Aggregate.prototype.explain()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-facet">Aggregate.prototype.facet()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-fill">Aggregate.prototype.fill()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-graphLookup">Aggregate.prototype.graphLookup()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-group">Aggregate.prototype.group()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-hint">Aggregate.prototype.hint()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-limit">Aggregate.prototype.limit()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-lookup">Aggregate.prototype.lookup()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-match">Aggregate.prototype.match()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-model">Aggregate.prototype.model()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-near">Aggregate.prototype.near()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-option">Aggregate.prototype.option()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-options">Aggregate.prototype.options</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-pipeline">Aggregate.prototype.pipeline()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-project">Aggregate.prototype.project()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-read">Aggregate.prototype.read()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-readConcern">Aggregate.prototype.readConcern()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-redact">Aggregate.prototype.redact()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-replaceRoot">Aggregate.prototype.replaceRoot()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-sample">Aggregate.prototype.sample()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-search">Aggregate.prototype.search()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-session">Aggregate.prototype.session()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-skip">Aggregate.prototype.skip()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-sort">Aggregate.prototype.sort()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-sortByCount">Aggregate.prototype.sortByCount()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-then">Aggregate.prototype.then()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-unionWith">Aggregate.prototype.unionWith()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-unwind">Aggregate.prototype.unwind()</a></li><li><a href="./api/aggregate.html#aggregate_Aggregate-[Symbol.asyncIterator]">Aggregate.prototype[Symbol.asyncIterator]()</a></li></ul></div><div class="nav-item" id="nav-AggregationCursor"><div class="nav-item-title"><a href="./api/aggregationcursor.html">AggregationCursor</a></div><ul class="nav-item-sub"><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor">AggregationCursor()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-addCursorFlag">AggregationCursor.prototype.addCursorFlag()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-close">AggregationCursor.prototype.close()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-eachAsync">AggregationCursor.prototype.eachAsync()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-map">AggregationCursor.prototype.map()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-next">AggregationCursor.prototype.next()</a></li><li><a href="./api/aggregationcursor.html#aggregationcursor_AggregationCursor-[Symbol.asyncIterator]">AggregationCursor.prototype[Symbol.asyncIterator]()</a></li></ul></div><div class="nav-item" id="nav-Schematype"><div class="nav-item-title"><a href="./api/schematype.html">Schematype</a></div><ul class="nav-item-sub"><li><a href="./api/schematype.html#schematype_SchemaType">SchemaType()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-cast">SchemaType.cast()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-checkRequired">SchemaType.checkRequired()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-get">SchemaType.get()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-cast">SchemaType.prototype.cast()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-castFunction">SchemaType.prototype.castFunction()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-default">SchemaType.prototype.default()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-doValidate">SchemaType.prototype.doValidate()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-get">SchemaType.prototype.get()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-immutable">SchemaType.prototype.immutable()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-index">SchemaType.prototype.index()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-isRequired">SchemaType.prototype.isRequired</a></li><li><a href="./api/schematype.html#schematype_SchemaType-path">SchemaType.prototype.path</a></li><li><a href="./api/schematype.html#schematype_SchemaType-ref">SchemaType.prototype.ref()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-required">SchemaType.prototype.required()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-select">SchemaType.prototype.select()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-set">SchemaType.prototype.set()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-sparse">SchemaType.prototype.sparse()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-text">SchemaType.prototype.text()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-transform">SchemaType.prototype.transform()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-unique">SchemaType.prototype.unique()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-validate">SchemaType.prototype.validate()</a></li><li><a href="./api/schematype.html#schematype_SchemaType-validators">SchemaType.prototype.validators</a></li><li><a href="./api/schematype.html#schematype_SchemaType-set">SchemaType.set()</a></li></ul></div><div class="nav-item" id="nav-Virtualtype"><div class="nav-item-title"><a href="./api/virtualtype.html">Virtualtype</a></div><ul class="nav-item-sub"><li><a href="./api/virtualtype.html#virtualtype_VirtualType">VirtualType()</a></li><li><a href="./api/virtualtype.html#virtualtype_VirtualType-applyGetters">VirtualType.prototype.applyGetters()</a></li><li><a href="./api/virtualtype.html#virtualtype_VirtualType-applySetters">VirtualType.prototype.applySetters()</a></li><li><a href="./api/virtualtype.html#virtualtype_VirtualType-get">VirtualType.prototype.get()</a></li><li><a href="./api/virtualtype.html#virtualtype_VirtualType-set">VirtualType.prototype.set()</a></li></ul></div><div class="nav-item" id="nav-Error"><div class="nav-item-title"><a href="./api/error.html">Error</a></div><ul class="nav-item-sub"><li><a href="./api/error.html#error_Error">Error()</a></li><li><a href="./api/error.html#error_Error-CastError">Error.CastError</a></li><li><a href="./api/error.html#error_Error-DivergentArrayError">Error.DivergentArrayError</a></li><li><a href="./api/error.html#error_Error-DocumentNotFoundError">Error.DocumentNotFoundError</a></li><li><a href="./api/error.html#error_Error-MissingSchemaError">Error.MissingSchemaError</a></li><li><a href="./api/error.html#error_Error-MongooseServerSelectionError">Error.MongooseServerSelectionError</a></li><li><a href="./api/error.html#error_Error-OverwriteModelError">Error.OverwriteModelError</a></li><li><a href="./api/error.html#error_Error-ParallelSaveError">Error.ParallelSaveError</a></li><li><a href="./api/error.html#error_Error-StrictModeError">Error.StrictModeError</a></li><li><a href="./api/error.html#error_Error-StrictPopulateError">Error.StrictPopulateError</a></li><li><a href="./api/error.html#error_Error-ValidationError">Error.ValidationError</a></li><li><a href="./api/error.html#error_Error-ValidatorError">Error.ValidatorError</a></li><li><a href="./api/error.html#error_Error-VersionError">Error.VersionError</a></li><li><a href="./api/error.html#error_Error-messages">Error.messages</a></li><li><a href="./api/error.html#error_Error-name">Error.prototype.name</a></li></ul></div><div class="nav-item" id="nav-SchemaArray"><div class="nav-item-title"><a href="./api/schemaarray.html">SchemaArray</a></div><ul class="nav-item-sub"><li><a href="./api/schemaarray.html#schemaarray_SchemaArray">SchemaArray()</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-checkRequired">SchemaArray.checkRequired()</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-options">SchemaArray.options</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-checkRequired">SchemaArray.prototype.checkRequired()</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-enum">SchemaArray.prototype.enum()</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-schemaName">SchemaArray.schemaName</a></li><li><a href="./api/schemaarray.html#schemaarray_SchemaArray-set">SchemaArray.set()</a></li></ul></div><div class="nav-item" id="nav-DocumentArrayPath"><div class="nav-item-title"><a href="./api/documentarraypath.html">DocumentArrayPath</a></div><ul class="nav-item-sub"><li><a href="./api/documentarraypath.html#documentarraypath_DocumentArrayPath">DocumentArrayPath()</a></li><li><a href="./api/documentarraypath.html#documentarraypath_DocumentArrayPath-options">DocumentArrayPath.options</a></li><li><a href="./api/documentarraypath.html#documentarraypath_DocumentArrayPath-discriminator">DocumentArrayPath.prototype.discriminator()</a></li><li><a href="./api/documentarraypath.html#documentarraypath_DocumentArrayPath-schemaName">DocumentArrayPath.schemaName</a></li><li><a href="./api/documentarraypath.html#documentarraypath_DocumentArrayPath-set">DocumentArrayPath.set()</a></li></ul></div><div class="nav-item" id="nav-SubdocumentPath"><div class="nav-item-title"><a href="./api/subdocumentpath.html">SubdocumentPath</a></div><ul class="nav-item-sub"><li><a href="./api/subdocumentpath.html#subdocumentpath_SubdocumentPath">SubdocumentPath()</a></li><li><a href="./api/subdocumentpath.html#subdocumentpath_SubdocumentPath-discriminator">SubdocumentPath.prototype.discriminator()</a></li><li><a href="./api/subdocumentpath.html#subdocumentpath_SubdocumentPath-set">SubdocumentPath.set()</a></li></ul></div><div class="nav-item" id="nav-MongooseDocumentArray"><div class="nav-item-title"><a href="./api/mongoosedocumentarray.html">MongooseDocumentArray</a></div><ul class="nav-item-sub"><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-create">MongooseDocumentArray.prototype.create()</a></li><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-id">MongooseDocumentArray.prototype.id()</a></li><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-inspect">MongooseDocumentArray.prototype.inspect()</a></li><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-pull">MongooseDocumentArray.prototype.pull()</a></li><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-push">MongooseDocumentArray.prototype.push()</a></li><li><a href="./api/mongoosedocumentarray.html#mongoosedocumentarray_MongooseDocumentArray-toObject">MongooseDocumentArray.prototype.toObject()</a></li></ul></div><div class="nav-item" id="nav-Subdocument"><div class="nav-item-title"><a href="./api/subdocument.html">Subdocument</a></div><ul class="nav-item-sub"><li><a href="./api/subdocument.html#subdocument_Subdocument-$parent">Subdocument.prototype.$parent()</a></li><li><a href="./api/subdocument.html#subdocument_Subdocument-inspect">Subdocument.prototype.inspect()</a></li><li><a href="./api/subdocument.html#subdocument_Subdocument-ownerDocument">Subdocument.prototype.ownerDocument()</a></li><li><a href="./api/subdocument.html#subdocument_Subdocument-parent">Subdocument.prototype.parent()</a></li><li><a href="./api/subdocument.html#subdocument_Subdocument-remove">Subdocument.prototype.remove()</a></li></ul></div><div class="nav-item" id="nav-ArraySubdocument"><div class="nav-item-title"><a href="./api/arraysubdocument.html">ArraySubdocument</a></div><ul class="nav-item-sub"><li><a href="./api/arraysubdocument.html#arraysubdocument_ArraySubdocument-$parent">ArraySubdocument.prototype.$parent()</a></li><li><a href="./api/arraysubdocument.html#arraysubdocument_ArraySubdocument-parentArray">ArraySubdocument.prototype.parentArray()</a></li></ul></div><div class="nav-item" id="nav-Buffer"><div class="nav-item-title"><a href="./api/buffer.html">Buffer</a></div><ul class="nav-item-sub"><li><a href="./api/buffer.html#mongoosebuffer.mixin_MongooseBuffer.mixin-copy">MongooseBuffer.mixin.copy()</a></li><li><a href="./api/buffer.html#mongoosebuffer_MongooseBuffer-equals">MongooseBuffer.mixin.equals()</a></li><li><a href="./api/buffer.html#mongoosebuffer_MongooseBuffer-subtype">MongooseBuffer.mixin.subtype()</a></li><li><a href="./api/buffer.html#mongoosebuffer_MongooseBuffer-toBSON">MongooseBuffer.mixin.toBSON()</a></li><li><a href="./api/buffer.html#mongoosebuffer_MongooseBuffer-toObject">MongooseBuffer.mixin.toObject()</a></li><li><a href="./api/buffer.html#mongoosebuffer.mixin_MongooseBuffer.mixin-write">MongooseBuffer.mixin.write()</a></li></ul></div><div class="nav-item" id="nav-Decimal128"><div class="nav-item-title"><a href="./api/decimal128.html">Decimal128</a></div><ul class="nav-item-sub"><li><a href="./api/decimal128.html#decimal128_Decimal128">Decimal128()</a></li></ul></div><div class="nav-item" id="nav-Map"><div class="nav-item-title"><a href="./api/map.html">Map</a></div><ul class="nav-item-sub"><li><a href="./api/map.html#mongoosemap_MongooseMap-$isMongooseMap">MongooseMap.prototype.$isMongooseMap</a></li><li><a href="./api/map.html#map_Map-clear">MongooseMap.prototype.clear()</a></li><li><a href="./api/map.html#map_Map-delete">MongooseMap.prototype.delete()</a></li><li><a href="./api/map.html#map_Map-get">MongooseMap.prototype.get()</a></li><li><a href="./api/map.html#map_Map-set">MongooseMap.prototype.set()</a></li><li><a href="./api/map.html#map_Map-toBSON">MongooseMap.prototype.toBSON()</a></li><li><a href="./api/map.html#map_Map-toJSON">MongooseMap.prototype.toJSON()</a></li></ul></div></div></div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/index.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Mongoose"><a href="#Mongoose">Mongoose</a></h2></div><ul><li><a href="#mongoose_Mongoose">Mongoose()</a></li><li><a href="#mongoose_Mongoose-Aggregate">Mongoose.prototype.Aggregate()</a></li><li><a href="#mongoose_Mongoose-CastError">Mongoose.prototype.CastError()</a></li><li><a href="#mongoose_Mongoose-Collection">Mongoose.prototype.Collection()</a></li><li><a href="#mongoose_Mongoose-Connection">Mongoose.prototype.Connection()</a></li><li><a href="#mongoose_Mongoose-ConnectionStates">Mongoose.prototype.ConnectionStates</a></li><li><a href="#mongoose_Mongoose-Date">Mongoose.prototype.Date</a></li><li><a href="#mongoose_Mongoose-Decimal128">Mongoose.prototype.Decimal128</a></li><li><a href="#mongoose_Mongoose-Document">Mongoose.prototype.Document()</a></li><li><a href="#mongoose_Mongoose-DocumentProvider">Mongoose.prototype.DocumentProvider()</a></li><li><a href="#mongoose_Mongoose-Error">Mongoose.prototype.Error()</a></li><li><a href="#mongoose_Mongoose-Mixed">Mongoose.prototype.Mixed</a></li><li><a href="#mongoose_Mongoose-Model">Mongoose.prototype.Model()</a></li><li><a href="#mongoose_Mongoose-Mongoose">Mongoose.prototype.Mongoose()</a></li><li><a href="#mongoose_Mongoose-Number">Mongoose.prototype.Number</a></li><li><a href="#mongoose_Mongoose-ObjectId">Mongoose.prototype.ObjectId</a></li><li><a href="#mongoose_Mongoose-Promise">Mongoose.prototype.Promise</a></li><li><a href="#mongoose_Mongoose-PromiseProvider">Mongoose.prototype.PromiseProvider()</a></li><li><a href="#mongoose_Mongoose-Query">Mongoose.prototype.Query()</a></li><li><a href="#mongoose_Mongoose-STATES">Mongoose.prototype.STATES</a></li><li><a href="#mongoose_Mongoose-Schema">Mongoose.prototype.Schema()</a></li><li><a href="#mongoose_Mongoose-SchemaType">Mongoose.prototype.SchemaType()</a></li><li><a href="#mongoose_Mongoose-SchemaTypeOptions">Mongoose.prototype.SchemaTypeOptions()</a></li><li><a href="#mongoose_Mongoose-SchemaTypes">Mongoose.prototype.SchemaTypes</a></li><li><a href="#mongoose_Mongoose-Types">Mongoose.prototype.Types</a></li><li><a href="#mongoose_Mongoose-VirtualType">Mongoose.prototype.VirtualType()</a></li><li><a href="#mongoose_Mongoose-connect">Mongoose.prototype.connect()</a></li><li><a href="#mongoose_Mongoose-connection">Mongoose.prototype.connection</a></li><li><a href="#mongoose_Mongoose-connections">Mongoose.prototype.connections</a></li><li><a href="#mongoose_Mongoose-createConnection">Mongoose.prototype.createConnection()</a></li><li><a href="#mongoose_Mongoose-deleteModel">Mongoose.prototype.deleteModel()</a></li><li><a href="#mongoose_Mongoose-disconnect">Mongoose.prototype.disconnect()</a></li><li><a href="#mongoose_Mongoose-driver">Mongoose.prototype.driver</a></li><li><a href="#mongoose_Mongoose-get">Mongoose.prototype.get()</a></li><li><a href="#mongoose_Mongoose-isObjectIdOrHexString">Mongoose.prototype.isObjectIdOrHexString()</a></li><li><a href="#mongoose_Mongoose-isValidObjectId">Mongoose.prototype.isValidObjectId()</a></li><li><a href="#mongoose_Mongoose-model">Mongoose.prototype.model()</a></li><li><a href="#mongoose_Mongoose-modelNames">Mongoose.prototype.modelNames()</a></li><li><a href="#mongoose_Mongoose-mongo">Mongoose.prototype.mongo</a></li><li><a href="#mongoose_Mongoose-mquery">Mongoose.prototype.mquery</a></li><li><a href="#mongoose_Mongoose-now">Mongoose.prototype.now()</a></li><li><a href="#mongoose_Mongoose-overwriteMiddlewareResult">Mongoose.prototype.overwriteMiddlewareResult()</a></li><li><a href="#mongoose_Mongoose-plugin">Mongoose.prototype.plugin()</a></li><li><a href="#mongoose_Mongoose-pluralize">Mongoose.prototype.pluralize()</a></li><li><a href="#mongoose_Mongoose-sanitizeFilter">Mongoose.prototype.sanitizeFilter()</a></li><li><a href="#mongoose_Mongoose-set">Mongoose.prototype.set()</a></li><li><a href="#mongoose_Mongoose-setDriver">Mongoose.prototype.setDriver()</a></li><li><a href="#mongoose_Mongoose-skipMiddlewareFunction">Mongoose.prototype.skipMiddlewareFunction()</a></li><li><a href="#mongoose_Mongoose-startSession">Mongoose.prototype.startSession()</a></li><li><a href="#mongoose_Mongoose-syncIndexes">Mongoose.prototype.syncIndexes()</a></li><li><a href="#mongoose_Mongoose-trusted">Mongoose.prototype.trusted()</a></li><li><a href="#mongoose_Mongoose-version">Mongoose.prototype.version</a></li></ul><hr class="separate-api-elements"><h3 id="mongoose_Mongoose"><a href="#mongoose_Mongoose">Mongoose()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> see <a href="/docs/api/mongoose.html#mongoose_Mongoose-set"><code>Mongoose#set()</code> docs</a></p>
</li></ul><div><p>Mongoose constructor.</p>
<p>The exports object of the <code>mongoose</code> module is an instance of this class.
Most apps will only use this one instance.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
mongoose <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Mongoose</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Create a new Mongoose instance with its own `connect()`, `set()`, `model()`, etc.</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Mongoose</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Aggregate"><a href="#mongoose_Mongoose-Aggregate">Mongoose.prototype.Aggregate()</a></h3><div><p>The Mongoose Aggregate constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-CastError"><a href="#mongoose_Mongoose-CastError">Mongoose.prototype.CastError()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">type
<span class="method-type">&laquo;String&raquo;</span> The name of the type</p>
</li><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> The value that failed to cast</p>
</li><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> The path <code>a.b.c</code> in the doc where this cast error occurred</p>
</li><li class="param">[reason]
<span class="method-type">&laquo;Error&raquo;</span> The original error that was thrown</p>
</li></ul><div><p>The Mongoose CastError constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Collection"><a href="#mongoose_Mongoose-Collection">Mongoose.prototype.Collection()</a></h3><div><p>The Mongoose Collection constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Connection"><a href="#mongoose_Mongoose-Connection">Mongoose.prototype.Connection()</a></h3><div><p>The Mongoose <a href="#connection_Connection">Connection</a> constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-ConnectionStates"><a href="#mongoose_Mongoose-ConnectionStates">Mongoose.prototype.ConnectionStates</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Expose connection states for user-land</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Date"><a href="#mongoose_Mongoose-Date">Mongoose.prototype.Date</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose Date <a href="/docs/schematypes.html">SchemaType</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">test</span>: <span class="hljs-title class_">Date</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;test&#x27;</span>) <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Date</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Decimal128"><a href="#mongoose_Mongoose-Decimal128">Mongoose.prototype.Decimal128</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose Decimal128 <a href="/docs/schematypes.html">SchemaType</a>. Used for
declaring paths in your schema that should be
<a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-34-decimal.html">128-bit decimal floating points</a>.
Do not use this to create a new Decimal128 instance, use <code>mongoose.Types.Decimal128</code>
instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> vehicleSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">fuelLevel</span>: mongoose.<span class="hljs-property">Decimal128</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Document"><a href="#mongoose_Mongoose-Document">Mongoose.prototype.Document()</a></h3><div><p>The Mongoose <a href="/docs/api/document.html#Document">Document</a> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-DocumentProvider"><a href="#mongoose_Mongoose-DocumentProvider">Mongoose.prototype.DocumentProvider()</a></h3><div><p>The Mongoose DocumentProvider constructor. Mongoose users should not have to
use this directly</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Error"><a href="#mongoose_Mongoose-Error">Mongoose.prototype.Error()</a></h3><div><p>The <a href="#error_MongooseError">MongooseError</a> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Mixed"><a href="#mongoose_Mongoose-Mixed">Mongoose.prototype.Mixed</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose Mixed <a href="/docs/schematypes.html">SchemaType</a>. Used for
declaring paths in your schema that Mongoose&#39;s change tracking, casting,
and validation should ignore.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">arbitrary</span>: mongoose.<span class="hljs-property">Mixed</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Model"><a href="#mongoose_Mongoose-Model">Mongoose.prototype.Model()</a></h3><div><p>The Mongoose <a href="#model_Model">Model</a> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Mongoose"><a href="#mongoose_Mongoose-Mongoose">Mongoose.prototype.Mongoose()</a></h3><div><p>The Mongoose constructor</p>
<p>The exports of the mongoose module is an instance of this class.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> mongoose2 = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Mongoose</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Number"><a href="#mongoose_Mongoose-Number">Mongoose.prototype.Number</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose Number <a href="/docs/schematypes.html">SchemaType</a>. Used for
declaring paths in your schema that Mongoose should cast to numbers.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: mongoose.<span class="hljs-property">Number</span> });
<span class="hljs-comment">// Equivalent to:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">&#x27;number&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-ObjectId"><a href="#mongoose_Mongoose-ObjectId">Mongoose.prototype.ObjectId</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose ObjectId <a href="/docs/schematypes.html">SchemaType</a>. Used for
declaring paths in your schema that should be
<a href="https://www.mongodb.com/docs/manual/reference/method/ObjectId/">MongoDB ObjectIds</a>.
Do not use this to create a new ObjectId instance, use <code>mongoose.Types.ObjectId</code>
instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> childSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">parentId</span>: mongoose.<span class="hljs-property">ObjectId</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Promise"><a href="#mongoose_Mongoose-Promise">Mongoose.prototype.Promise</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose <a href="#promise_Promise">Promise</a> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-PromiseProvider"><a href="#mongoose_Mongoose-PromiseProvider">Mongoose.prototype.PromiseProvider()</a></h3><div><p>Storage layer for mongoose promises</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Query"><a href="#mongoose_Mongoose-Query">Mongoose.prototype.Query()</a></h3><div><p>The Mongoose <a href="#query_Query">Query</a> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-STATES"><a href="#mongoose_Mongoose-STATES">Mongoose.prototype.STATES</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Expose connection states for user-land</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Schema"><a href="#mongoose_Mongoose-Schema">Mongoose.prototype.Schema()</a></h3><div><p>The Mongoose <a href="#schema_Schema">Schema</a> constructor</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Schema</span> = mongoose.<span class="hljs-property">Schema</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CatSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-SchemaType"><a href="#mongoose_Mongoose-SchemaType">Mongoose.prototype.SchemaType()</a></h3><div><p>The Mongoose <a href="#schematype_SchemaType">SchemaType</a> constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-SchemaTypeOptions"><a href="#mongoose_Mongoose-SchemaTypeOptions">Mongoose.prototype.SchemaTypeOptions()</a></h3><div><p>The constructor used for schematype options</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-SchemaTypes"><a href="#mongoose_Mongoose-SchemaTypes">Mongoose.prototype.SchemaTypes</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The various Mongoose SchemaTypes.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><em>Alias of mongoose.Schema.Types for backwards compatibility.</em></p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-Types"><a href="#mongoose_Mongoose-Types">Mongoose.prototype.Types</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The various Mongoose Types.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> array = mongoose.<span class="hljs-property">Types</span>.<span class="hljs-property">Array</span>;
</code></pre>
<h4 id="types">
      <a href="#types">
        Types:
      </a>
    </h4>
<ul>
<li><a href="/docs/schematypes.html#arrays">Array</a></li>
<li><a href="/docs/schematypes.html#buffers">Buffer</a></li>
<li><a href="/docs/schematypes.html#schemas">Embedded</a></li>
<li><a href="/docs/api/documentarraypath.html">DocumentArray</a></li>
<li><a href="/docs/api/mongoose.html#mongoose_Mongoose-Decimal128">Decimal128</a></li>
<li><a href="/docs/schematypes.html#objectids">ObjectId</a></li>
<li><a href="/docs/schematypes.html#maps">Map</a></li>
<li><a href="/docs/schematypes.html#schemas">Subdocument</a></li>
</ul>
<p>Using this exposed access to the <code>ObjectId</code> type, we can construct ids on demand.</p>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">ObjectId</span> = mongoose.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>;
<span class="hljs-keyword">const</span> id1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>;
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-VirtualType"><a href="#mongoose_Mongoose-VirtualType">Mongoose.prototype.VirtualType()</a></h3><div><p>The Mongoose <a href="#virtualtype_VirtualType">VirtualType</a> constructor</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-connect"><a href="#mongoose_Mongoose-connect">Mongoose.prototype.connect()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">uri
<span class="method-type">&laquo;String&raquo;</span> mongodb URI to connect to</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> passed down to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html">MongoDB driver&#39;s <code>connect()</code> function</a>, except for 4 mongoose-specific options explained below.</p>
</li><ul style="margin-top: 0.5em"><li>[options.bufferCommands=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose specific option. Set to false to <a href="https://mongoosejs.com/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.bufferTimeoutMS=10000]
<span class="method-type">&laquo;Number&raquo;</span> Mongoose specific option. If <code>bufferCommands</code> is true, Mongoose will throw an error after <code>bufferTimeoutMS</code> if the operation is still buffered.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.dbName]
<span class="method-type">&laquo;String&raquo;</span> The name of the database we want to use. If not provided, use database name from connection string.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.user]
<span class="method-type">&laquo;String&raquo;</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.pass]
<span class="method-type">&laquo;String&raquo;</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxPoolSize=100]
<span class="method-type">&laquo;Number&raquo;</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.minPoolSize=0]
<span class="method-type">&laquo;Number&raquo;</span> The minimum number of sockets the MongoDB driver will keep open for this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.serverSelectionTimeoutMS]
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver will try to find a server to send any given operation to, and keep retrying for <code>serverSelectionTimeoutMS</code> milliseconds before erroring out. If not set, the MongoDB driver defaults to using <code>30000</code> (30 seconds).</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.heartbeatFrequencyMS]
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver sends a heartbeat every <code>heartbeatFrequencyMS</code> to check on the status of the connection. A heartbeat is subject to <code>serverSelectionTimeoutMS</code>, so the MongoDB driver will retry failed heartbeats for up to 30 seconds by default. Mongoose only emits a <code>&#39;disconnected&#39;</code> event after a heartbeat has failed, so you may want to decrease this setting to reduce the time between when your server goes down and when Mongoose emits <code>&#39;disconnected&#39;</code>. We recommend you do <strong>not</strong> set this setting below 1000, too many heartbeats can lead to performance degradation.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.autoIndex=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.promiseLibrary]
<span class="method-type">&laquo;Class&raquo;</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver&#39;s promise library</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.connectTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>during initial connection</em>. Defaults to 30000. This option is passed transparently to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js&#39; <code>socket#setTimeout()</code> function</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.socketTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. A socket may be inactive because of either no activity or a long-running operation. This is set to <code>30000</code> by default, you should set this to 2-3x your longest running operation if you expect some of your database operations to run longer than 20 seconds. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.family=0]
<span class="method-type">&laquo;Number&raquo;</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js&#39; <code>dns.lookup()</code></a> function. May be either <code>0</code>, <code>4</code>, or <code>6</code>. <code>4</code> means use IPv4 only, <code>6</code> means use IPv6 only, <code>0</code> means try both.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.autoCreate=false]
<span class="method-type">&laquo;Boolean&raquo;</span> Set to <code>true</code> to make Mongoose automatically call <code>createCollection()</code> on every model created on this connection.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> resolves to <code>this</code> if connection succeeded</li></ul><div><p>Opens the default mongoose connection.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port/database&#x27;</span>);

<span class="hljs-comment">// replica sets</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/mydatabase&#x27;</span>;
mongoose.<span class="hljs-title function_">connect</span>(uri);

<span class="hljs-comment">// with options</span>
mongoose.<span class="hljs-title function_">connect</span>(uri, options);

<span class="hljs-comment">// optional callback that gets fired when initial connection completed</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">&#x27;mongodb://nonexistent.domain:27000&#x27;</span>;
mongoose.<span class="hljs-title function_">connect</span>(uri, <span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-comment">// if error is truthy, the initial connection failed.</span>
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-connection"><a href="#mongoose_Mongoose-connection">Mongoose.prototype.connection</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span></li></ul><div><p>The Mongoose module&#39;s default connection. Equivalent to <code>mongoose.connections[0]</code>, see <a href="#mongoose_Mongoose-connections"><code>connections</code></a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
mongoose.<span class="hljs-title function_">connect</span>(...);
mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, cb);
</code></pre>
<p>This is the connection used by default for every model created using <a href="#index_Mongoose-model">mongoose.model</a>.</p>
<p>To create a new connection, use <a href="#mongoose_Mongoose-createConnection"><code>createConnection()</code></a>.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-connections"><a href="#mongoose_Mongoose-connections">Mongoose.prototype.connections</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span></li></ul><div><p>An array containing all <a href="connection.html">connections</a> associated with this
Mongoose instance. By default, there is 1 connection. Calling
<a href="#mongoose_Mongoose-createConnection"><code>createConnection()</code></a> adds a connection
to this array.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
mongoose.<span class="hljs-property">connections</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1, just the default connection</span>
mongoose.<span class="hljs-property">connections</span>[<span class="hljs-number">0</span>] === mongoose.<span class="hljs-property">connection</span>; <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>);
mongoose.<span class="hljs-property">connections</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 2</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-createConnection"><a href="#mongoose_Mongoose-createConnection">Mongoose.prototype.createConnection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">uri
<span class="method-type">&laquo;String&raquo;</span> mongodb URI to connect to</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> passed down to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html">MongoDB driver&#39;s <code>connect()</code> function</a>, except for 4 mongoose-specific options explained below.</p>
</li><ul style="margin-top: 0.5em"><li>[options.bufferCommands=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose specific option. Set to false to <a href="https://mongoosejs.com/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.dbName]
<span class="method-type">&laquo;String&raquo;</span> The name of the database you want to use. If not provided, Mongoose uses the database name from connection string.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.user]
<span class="method-type">&laquo;String&raquo;</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.pass]
<span class="method-type">&laquo;String&raquo;</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.autoIndex=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.promiseLibrary]
<span class="method-type">&laquo;Class&raquo;</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver&#39;s promise library</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxPoolSize=5]
<span class="method-type">&laquo;Number&raquo;</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.minPoolSize=1]
<span class="method-type">&laquo;Number&raquo;</span> The minimum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.connectTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>during initial connection</em>. Defaults to 30000. This option is passed transparently to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js&#39; <code>socket#setTimeout()</code> function</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.socketTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. A socket may be inactive because of either no activity or a long-running operation. This is set to <code>30000</code> by default, you should set this to 2-3x your longest running operation if you expect some of your database operations to run longer than 20 seconds. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.family=0]
<span class="method-type">&laquo;Number&raquo;</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js&#39; <code>dns.lookup()</code></a> function. May be either <code>0</code>, <code>4</code>, or <code>6</code>. <code>4</code> means use IPv4 only, <code>6</code> means use IPv6 only, <code>0</code> means try both.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> the created Connection object. Connections are not thenable, so you can&#39;t do <code>await mongoose.createConnection()</code>. To await use <code>mongoose.createConnection(uri).asPromise()</code> instead.</li></ul><div><p>Creates a Connection instance.</p>
<p>Each <code>connection</code> instance maps to a single database. This method is helpful when managing multiple db connections.</p>
<p><em>Options passed take precedence over options included in connection strings.</em></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// with mongodb:// URI</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port/database&#x27;</span>);

<span class="hljs-comment">// and options</span>
<span class="hljs-keyword">const</span> opts = { <span class="hljs-attr">db</span>: { <span class="hljs-attr">native_parser</span>: <span class="hljs-literal">true</span> }}
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port/database&#x27;</span>, opts);

<span class="hljs-comment">// replica sets</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/database&#x27;</span>);

<span class="hljs-comment">// and options</span>
<span class="hljs-keyword">const</span> opts = { <span class="hljs-attr">replset</span>: { <span class="hljs-attr">strategy</span>: <span class="hljs-string">&#x27;ping&#x27;</span>, <span class="hljs-attr">rs_name</span>: <span class="hljs-string">&#x27;testSet&#x27;</span> }}
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/database&#x27;</span>, opts);

<span class="hljs-comment">// initialize now, connect later</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>();
db.<span class="hljs-title function_">openUri</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-string">&#x27;database&#x27;</span>, port, [opts]);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-deleteModel"><a href="#mongoose_Mongoose-deleteModel">Mongoose.prototype.deleteModel()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|RegExp&raquo;</span> if string, the name of the model to remove. If regexp, removes all models whose name matches the regexp.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Mongoose&raquo;</span> this</li></ul><div><p>Removes the model named <code>name</code> from the default connection, if it exists.
You can use this function to clean up any models you created in your tests to
prevent OverwriteModelErrors.</p>
<p>Equivalent to <code>mongoose.connection.deleteModel(name)</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// Model object</span>
mongoose.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-string">&#x27;User&#x27;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// Usually useful in a Mocha `afterEach()` hook</span>
<span class="hljs-title function_">afterEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  mongoose.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-regexp">/.+/</span>); <span class="hljs-comment">// Delete every model</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-disconnect"><a href="#mongoose_Mongoose-disconnect">Mongoose.prototype.disconnect()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> called after all connection close, or when first error occurred.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> resolves when all connections are closed, or rejects with the first error that occurred.</li></ul><div><p>Runs <code>.close()</code> on all connections in parallel.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-driver"><a href="#mongoose_Mongoose-driver">Mongoose.prototype.driver</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Object with <code>get()</code> and <code>set()</code> containing the underlying driver this Mongoose instance
uses to communicate with the database. A driver is a Mongoose-specific interface that defines functions
like <code>find()</code>.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-get"><a href="#mongoose_Mongoose-get">Mongoose.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Gets mongoose options</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;test&#x27;</span>) <span class="hljs-comment">// returns the &#x27;test&#x27; value</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-isObjectIdOrHexString"><a href="#mongoose_Mongoose-isObjectIdOrHexString">Mongoose.prototype.isObjectIdOrHexString()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">v
<span class="method-type">&laquo;Any&raquo;</span> </li></ul><div><p>Returns true if the given value is a Mongoose ObjectId (using <code>instanceof</code>) or if the
given value is a 24 character hex string, which is the most commonly used string representation
of an ObjectId.</p>
<p>This function is similar to <code>isValidObjectId()</code>, but considerably more strict, because
<code>isValidObjectId()</code> will return <code>true</code> for <em>any</em> value that Mongoose can convert to an
ObjectId. That includes Mongoose documents, any string of length 12, and any number.
<code>isObjectIdOrHexString()</code> returns true only for <code>ObjectId</code> instances or 24 character hex
strings, and will return false for numbers, documents, and strings of length 12.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-keyword">new</span> mongoose.<span class="hljs-property">Types</span>.<span class="hljs-title class_">ObjectId</span>()); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-string">&#x27;62261a65d66c6be0a63c051f&#x27;</span>); <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-string">&#x27;0123456789ab&#x27;</span>); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-number">6</span>); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> })); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>({ <span class="hljs-attr">test</span>: <span class="hljs-number">42</span> }); <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-isValidObjectId"><a href="#mongoose_Mongoose-isValidObjectId">Mongoose.prototype.isValidObjectId()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">v
<span class="method-type">&laquo;Any&raquo;</span> </li></ul><div><p>Returns true if Mongoose can cast the given value to an ObjectId, or
false otherwise.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-keyword">new</span> mongoose.<span class="hljs-property">Types</span>.<span class="hljs-title class_">ObjectId</span>()); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-string">&#x27;0123456789ab&#x27;</span>); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-number">6</span>); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> })); <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">isValidObjectId</span>({ <span class="hljs-attr">test</span>: <span class="hljs-number">42</span> }); <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-model"><a href="#mongoose_Mongoose-model">Mongoose.prototype.model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|Function&raquo;</span> model name or class extending Model</p>
</li><li class="param">[schema]
<span class="method-type">&laquo;Schema&raquo;</span> the schema to use.</p>
</li><li class="param">[collection]
<span class="method-type">&laquo;String&raquo;</span> name (optional, inferred from model name)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> The model associated with <code>name</code>. Mongoose will create the model if it doesn&#39;t already exist.</li></ul><div><p>Defines a model or retrieves it.</p>
<p>Models defined on the <code>mongoose</code> instance are available to all connection
created by the same <code>mongoose</code> instance.</p>
<p>If you call <code>mongoose.model()</code> with twice the same name but a different schema,
you will get an <code>OverwriteModelError</code>. If you call <code>mongoose.model()</code> with
the same name and same schema, you&#39;ll get the same schema back.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);

<span class="hljs-comment">// define an Actor model with this mongoose instance</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema);

<span class="hljs-comment">// create a new connection</span>
<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(..);

<span class="hljs-comment">// create Actor model</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Actor</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema);
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true, same schema</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema, <span class="hljs-string">&#x27;actors&#x27;</span>) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true, same schema and collection name</span>

<span class="hljs-comment">// This throws an `OverwriteModelError` because the schema is different.</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
</code></pre>
<p><em>When no <code>collection</code> argument is passed, Mongoose uses the model name. If you don&#39;t like this behavior, either pass a collection name, use <code>mongoose.pluralize()</code>, or set your schemas collection name option.</em></p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">collection</span>: <span class="hljs-string">&#x27;actor&#x27;</span> });

<span class="hljs-comment">// or</span>

schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;collection&#x27;</span>, <span class="hljs-string">&#x27;actor&#x27;</span>);

<span class="hljs-comment">// or</span>

<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">&#x27;actor&#x27;</span>
<span class="hljs-keyword">const</span> M = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema, collectionName)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-modelNames"><a href="#mongoose_Mongoose-modelNames">Mongoose.prototype.modelNames()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Returns an array of model names created on this instance of Mongoose.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><em>Does not include names of models created using <code>connection.model()</code>.</em></p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-mongo"><a href="#mongoose_Mongoose-mongo">Mongoose.prototype.mongo</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The <a href="https://github.com/mongodb/node-mongodb-native">node-mongodb-native</a> driver Mongoose uses.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-mquery"><a href="#mongoose_Mongoose-mquery">Mongoose.prototype.mquery</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The <a href="https://github.com/aheckmann/mquery">mquery</a> query builder Mongoose uses.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-now"><a href="#mongoose_Mongoose-now">Mongoose.prototype.now()</a></h3><div><p>Mongoose uses this function to get the current time when setting
<a href="/docs/guide.html#timestamps">timestamps</a>. You may stub out this function
using a tool like <a href="https://www.npmjs.com/package/sinon">Sinon</a> for testing.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-overwriteMiddlewareResult"><a href="#mongoose_Mongoose-overwriteMiddlewareResult">Mongoose.prototype.overwriteMiddlewareResult()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">result
<span class="method-type">&laquo;any&raquo;</span> </li></ul><div><p>Use this function in <code>post()</code> middleware to replace the result</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;find&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) {
  <span class="hljs-comment">// Normally you have to modify `res` in place. But with</span>
  <span class="hljs-comment">// `overwriteMiddlewarResult()`, you can make `find()` return a</span>
  <span class="hljs-comment">// completely different value.</span>
  <span class="hljs-keyword">return</span> mongoose.<span class="hljs-title function_">overwriteMiddlewareResult</span>(res.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">doc</span> =&gt;</span> !doc.<span class="hljs-property">isDeleted</span>));
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-plugin"><a href="#mongoose_Mongoose-plugin">Mongoose.prototype.plugin()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> plugin callback</p>
</li><li class="param">[opts]
<span class="method-type">&laquo;Object&raquo;</span> optional options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Mongoose&raquo;</span> this</li></ul><div><p>Declares a global plugin executed on all Schemas.</p>
<p>Equivalent to calling <code>.plugin(fn)</code> on each Schema you create.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-pluralize"><a href="#mongoose_Mongoose-pluralize">Mongoose.prototype.pluralize()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[fn]
<span class="method-type">&laquo;Function|null&raquo;</span> overwrites the function used to pluralize collection names</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function,null&raquo;</span> the current function used to pluralize collection names, defaults to the legacy function from <code>mongoose-legacy-pluralize</code>.</li></ul><div><p>Getter/setter around function for pluralizing collection names.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-sanitizeFilter"><a href="#mongoose_Mongoose-sanitizeFilter">Mongoose.prototype.sanitizeFilter()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Sanitizes query filters against <a href="https://thecodebarbarian.com/2014/09/04/defending-against-query-selector-injection-attacks.html">query selector injection attacks</a>
by wrapping any nested objects that have a property whose name starts with <code>$</code> in a <code>$eq</code>.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;val&#x27;</span>, <span class="hljs-attr">pwd</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-literal">null</span> } };
<span class="hljs-title function_">sanitizeFilter</span>(obj);
obj; <span class="hljs-comment">// { username: &#x27;val&#x27;, pwd: { $eq: { $ne: null } } });</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-set"><a href="#mongoose_Mongoose-set">Mongoose.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String|Object&raquo;</span> The name of the option or a object of multiple key-value pairs</p>
</li><li class="param">value
<span class="method-type">&laquo;String|Function|Boolean&raquo;</span> The value of the option, unused if &quot;key&quot; is a object</p>
</li></ul><div><p>Sets mongoose options</p>
<p><code>key</code> can be used a object to set multiple options at once.
If a error gets thrown for one option, other options will still be evaluated.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;test&#x27;</span>, value) <span class="hljs-comment">// sets the &#x27;test&#x27; option to `value`</span>

mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;debug&#x27;</span>, <span class="hljs-literal">true</span>) <span class="hljs-comment">// enable logging collection methods + arguments to the console/file</span>

mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;debug&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">collectionName, methodName, ...methodArgs</span>) {}); <span class="hljs-comment">// use custom function to log collection methods + arguments</span>

mongoose.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">autoIndex</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// set multiple options at once</span>
</code></pre>
<p>Currently supported options are:</p>
<ul>
<li><code>allowDiskUse</code>: Set to <code>true</code> to set <code>allowDiskUse</code> to true to all aggregation operations by default.</li>
<li><code>applyPluginsToChildSchemas</code>: <code>true</code> by default. Set to false to skip applying global plugins to child schemas</li>
<li><code>applyPluginsToDiscriminators</code>: <code>false</code> by default. Set to true to apply global plugins to discriminator schemas. This typically isn&#39;t necessary because plugins are applied to the base schema and discriminators copy all middleware, methods, statics, and properties from the base schema.</li>
<li><code>autoCreate</code>: Set to <code>true</code> to make Mongoose call <a href="/docs/api/model.html#model_Model-createCollection"><code>Model.createCollection()</code></a> automatically when you create a model with <code>mongoose.model()</code> or <code>conn.model()</code>. This is useful for testing transactions, change streams, and other features that require the collection to exist.</li>
<li><code>autoIndex</code>: <code>true</code> by default. Set to false to disable automatic index creation for all models associated with this Mongoose instance.</li>
<li><code>bufferCommands</code>: enable/disable mongoose&#39;s buffering mechanism for all connections and models</li>
<li><code>bufferTimeoutMS</code>: If bufferCommands is on, this option sets the maximum amount of time Mongoose buffering will wait before throwing an error. If not specified, Mongoose will use 10000 (10 seconds).</li>
<li><code>cloneSchemas</code>: <code>false</code> by default. Set to <code>true</code> to <code>clone()</code> all schemas before compiling into a model.</li>
<li><code>debug</code>: If <code>true</code>, prints the operations mongoose sends to MongoDB to the console. If a writable stream is passed, it will log to that stream, without colorization. If a callback function is passed, it will receive the collection name, the method name, then all arguments passed to the method. For example, if you wanted to replicate the default logging, you could output from the callback <code>Mongoose: ${collectionName}.${methodName}(${methodArgs.join(&#39;, &#39;)})</code>.</li>
<li><code>id</code>: If <code>true</code>, adds a <code>id</code> virtual to all schemas unless overwritten on a per-schema basis.</li>
<li><code>timestamps.createdAt.immutable</code>: <code>true</code> by default. If <code>false</code>, it will change the <code>createdAt</code> field to be <a href="https://mongoosejs.com/docs/api/schematype.html#schematype_SchemaType-immutable"><code>immutable: false</code></a> which means you can update the <code>createdAt</code></li>
<li><code>maxTimeMS</code>: If set, attaches <a href="https://www.mongodb.com/docs/manual/reference/operator/meta/maxTimeMS/">maxTimeMS</a> to every query</li>
<li><code>objectIdGetter</code>: <code>true</code> by default. Mongoose adds a getter to MongoDB ObjectId&#39;s called <code>_id</code> that returns <code>this</code> for convenience with populate. Set this to false to remove the getter.</li>
<li><code>overwriteModels</code>: Set to <code>true</code> to default to overwriting models with the same name when calling <code>mongoose.model()</code>, as opposed to throwing an <code>OverwriteModelError</code>.</li>
<li><code>returnOriginal</code>: If <code>false</code>, changes the default <code>returnOriginal</code> option to <code>findOneAndUpdate()</code>, <code>findByIdAndUpdate</code>, and <code>findOneAndReplace()</code> to false. This is equivalent to setting the <code>new</code> option to <code>true</code> for <code>findOneAndX()</code> calls by default. Read our <a href="/docs/tutorials/findoneandupdate.html"><code>findOneAndUpdate()</code> tutorial</a> for more information.</li>
<li><code>runValidators</code>: <code>false</code> by default. Set to true to enable <a href="/docs/validation.html#update-validators">update validators</a> for all validators by default.</li>
<li><code>sanitizeFilter</code>: <code>false</code> by default. Set to true to enable the <a href="/docs/api/mongoose.html#mongoose_Mongoose-sanitizeFilter">sanitization of the query filters</a> against query selector injection attacks by wrapping any nested objects that have a property whose name starts with <code>$</code> in a <code>$eq</code>.</li>
<li><code>selectPopulatedPaths</code>: <code>true</code> by default. Set to false to opt out of Mongoose adding all fields that you <code>populate()</code> to your <code>select()</code>. The schema-level option <code>selectPopulatedPaths</code> overwrites this one.</li>
<li><code>strict</code>: <code>true</code> by default, may be <code>false</code>, <code>true</code>, or <code>&#39;throw&#39;</code>. Sets the default strict mode for schemas.</li>
<li><code>strictQuery</code>: same value as &#39;strict&#39; by default (<code>true</code>), may be <code>false</code>, <code>true</code>, or <code>&#39;throw&#39;</code>. Sets the default <a href="/docs/guide.html#strictQuery">strictQuery</a> mode for schemas. The default value will be switched back to <code>false</code> in Mongoose 7, use <code>mongoose.set(&#39;strictQuery&#39;, false);</code> if you want to prepare for the change.</li>
<li><code>toJSON</code>: <code>{ transform: true, flattenDecimals: true }</code> by default. Overwrites default objects to <a href="/docs/api/document.html#document_Document-toJSON"><code>toJSON()</code></a>, for determining how Mongoose documents get serialized by <code>JSON.stringify()</code></li>
<li><code>toObject</code>: <code>{ transform: true, flattenDecimals: true }</code> by default. Overwrites default objects to <a href="/docs/api/document.html#document_Document-toObject"><code>toObject()</code></a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-setDriver"><a href="#mongoose_Mongoose-setDriver">Mongoose.prototype.setDriver()</a></h3><div><p>Overwrites the current driver used by this Mongoose instance. A driver is a
Mongoose-specific interface that defines functions like <code>find()</code>.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-skipMiddlewareFunction"><a href="#mongoose_Mongoose-skipMiddlewareFunction">Mongoose.prototype.skipMiddlewareFunction()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">result
<span class="method-type">&laquo;any&raquo;</span> </li></ul><div><p>Use this function in <code>pre()</code> middleware to skip calling the wrapped function.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// Will skip executing `save()`, but will execute post hooks as if</span>
  <span class="hljs-comment">// `save()` had executed with the result `{ matchedCount: 0 }`</span>
  <span class="hljs-keyword">return</span> mongoose.<span class="hljs-title function_">skipMiddlewareFunction</span>({ <span class="hljs-attr">matchedCount</span>: <span class="hljs-number">0</span> });
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-startSession"><a href="#mongoose_Mongoose-startSession">Mongoose.prototype.startSession()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#startSession">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.causalConsistency=true]
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to disable causal consistency</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;ClientSession&gt;&raquo;</span> promise that resolves to a MongoDB driver <code>ClientSession</code></li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Starts a <a href="https://www.mongodb.com/docs/manual/release-notes/3.6/#client-sessions">MongoDB session</a>
for benefits like causal consistency, <a href="https://www.mongodb.com/docs/manual/core/retryable-writes/">retryable writes</a>,
and <a href="https://thecodebarbarian.com/a-node-js-perspective-on-mongodb-4-transactions.html">transactions</a>.</p>
<p>Calling <code>mongoose.startSession()</code> is equivalent to calling <code>mongoose.connection.startSession()</code>.
Sessions are scoped to a connection, so calling <code>mongoose.startSession()</code>
starts a session on the <a href="/docs/api/mongoose.html#mongoose_Mongoose-connection">default mongoose connection</a>.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-syncIndexes"><a href="#mongoose_Mongoose-syncIndexes">Mongoose.prototype.syncIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">options.continueOnError
<span class="method-type">&laquo;Boolean&raquo;</span> <code>false</code> by default. If set to <code>true</code>, mongoose will not throw an error if one model syncing failed, and will return an object where the keys are the names of the models, and the values are the results/errors for each model.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise, when the Promise resolves the value is a list of the dropped indexes.</li></ul><div><p>Syncs all the indexes for the models registered with this connection.</p>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-trusted"><a href="#mongoose_Mongoose-trusted">Mongoose.prototype.trusted()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Tells <code>sanitizeFilter()</code> to skip the given object when filtering out potential <a href="https://thecodebarbarian.com/2014/09/04/defending-against-query-selector-injection-attacks.html">query selector injection attacks</a>.
Use this method when you have a known query selector that you want to use.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;val&#x27;</span>, <span class="hljs-attr">pwd</span>: <span class="hljs-title function_">trusted</span>({ <span class="hljs-attr">$type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">$eq</span>: <span class="hljs-string">&#x27;my secret&#x27;</span> }) };
<span class="hljs-title function_">sanitizeFilter</span>(obj);

<span class="hljs-comment">// Note that `sanitizeFilter()` did not add `$eq` around `$type`.</span>
obj; <span class="hljs-comment">// { username: &#x27;val&#x27;, pwd: { $type: &#x27;string&#x27;, $eq: &#x27;my secret&#x27; } });</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoose_Mongoose-version"><a href="#mongoose_Mongoose-version">Mongoose.prototype.version</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The Mongoose version</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-property">version</span>); <span class="hljs-comment">// &#x27;5.x.x&#x27;</span>
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schema.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Schema"><a href="#Schema">Schema</a></h2></div><ul><li><a href="#schema_Schema">Schema()</a></li><li><a href="#schema_Schema-Types">Schema.Types</a></li><li><a href="#schema_Schema-indexTypes">Schema.indexTypes</a></li><li><a href="#schema_Schema-add">Schema.prototype.add()</a></li><li><a href="#schema_Schema-alias">Schema.prototype.alias()</a></li><li><a href="#schema_Schema-childSchemas">Schema.prototype.childSchemas</a></li><li><a href="#schema_Schema-clearIndexes">Schema.prototype.clearIndexes()</a></li><li><a href="#schema_Schema-clone">Schema.prototype.clone()</a></li><li><a href="#schema_Schema-discriminator">Schema.prototype.discriminator()</a></li><li><a href="#schema_Schema-eachPath">Schema.prototype.eachPath()</a></li><li><a href="#schema_Schema-get">Schema.prototype.get()</a></li><li><a href="#schema_Schema-index">Schema.prototype.index()</a></li><li><a href="#schema_Schema-indexes">Schema.prototype.indexes()</a></li><li><a href="#schema_Schema-loadClass">Schema.prototype.loadClass()</a></li><li><a href="#schema_Schema-method">Schema.prototype.method()</a></li><li><a href="#schema_Schema-obj">Schema.prototype.obj</a></li><li><a href="#schema_Schema-omit">Schema.prototype.omit()</a></li><li><a href="#schema_Schema-path">Schema.prototype.path()</a></li><li><a href="#schema_Schema-pathType">Schema.prototype.pathType()</a></li><li><a href="#schema_Schema-paths">Schema.prototype.paths</a></li><li><a href="#schema_Schema-pick">Schema.prototype.pick()</a></li><li><a href="#schema_Schema-plugin">Schema.prototype.plugin()</a></li><li><a href="#schema_Schema-post">Schema.prototype.post()</a></li><li><a href="#schema_Schema-pre">Schema.prototype.pre()</a></li><li><a href="#schema_Schema-queue">Schema.prototype.queue()</a></li><li><a href="#schema_Schema-remove">Schema.prototype.remove()</a></li><li><a href="#schema_Schema-removeIndex">Schema.prototype.removeIndex()</a></li><li><a href="#schema_Schema-removeVirtual">Schema.prototype.removeVirtual()</a></li><li><a href="#schema_Schema-requiredPaths">Schema.prototype.requiredPaths()</a></li><li><a href="#schema_Schema-set">Schema.prototype.set()</a></li><li><a href="#schema_Schema-static">Schema.prototype.static()</a></li><li><a href="#schema_Schema-virtual">Schema.prototype.virtual()</a></li><li><a href="#schema_Schema-virtualpath">Schema.prototype.virtualpath()</a></li><li><a href="#schema_Schema-virtuals">Schema.prototype.virtuals</a></li><li><a href="#schema_Schema-reserved">Schema.reserved</a></li></ul><hr class="separate-api-elements"><h3 id="schema_Schema"><a href="#schema_Schema">Schema()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[definition]
<span class="method-type">&laquo;Object|Schema|Array&raquo;</span> Can be one of: object describing schema paths, or schema to copy, or array of objects and schemas</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Schema constructor.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">children</span>: [child] });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Tree</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Tree&#x27;</span>, schema);

<span class="hljs-comment">// setting schema options</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">_id</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">autoIndex</span>: <span class="hljs-literal">false</span> })
</code></pre>
<h4 id="options">
      <a href="#options">
        Options:
      </a>
    </h4>
<ul>
<li><a href="/docs/guide.html#autoIndex">autoIndex</a>: bool - defaults to null (which means use the connection&#39;s autoIndex option)</li>
<li><a href="/docs/guide.html#autoCreate">autoCreate</a>: bool - defaults to null (which means use the connection&#39;s autoCreate option)</li>
<li><a href="/docs/guide.html#bufferCommands">bufferCommands</a>: bool - defaults to true</li>
<li><a href="/docs/guide.html#bufferTimeoutMS">bufferTimeoutMS</a>: number - defaults to 10000 (10 seconds). If <code>bufferCommands</code> is enabled, the amount of time Mongoose will wait for connectivity to be restablished before erroring out.</li>
<li><a href="/docs/guide.html#capped">capped</a>: bool | number | object - defaults to false</li>
<li><a href="/docs/guide.html#collection">collection</a>: string - no default</li>
<li><a href="/docs/guide.html#discriminatorKey">discriminatorKey</a>: string - defaults to <code>__t</code></li>
<li><a href="/docs/guide.html#id">id</a>: bool - defaults to true</li>
<li><a href="/docs/guide.html#_id">_id</a>: bool - defaults to true</li>
<li><a href="/docs/guide.html#minimize">minimize</a>: bool - controls <a href="#document_Document-toObject">document#toObject</a> behavior when called manually - defaults to true</li>
<li><a href="/docs/guide.html#read">read</a>: string</li>
<li><a href="/docs/guide.html#writeConcern">writeConcern</a>: object - defaults to null, use to override <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">the MongoDB server&#39;s default write concern settings</a></li>
<li><a href="/docs/guide.html#shardKey">shardKey</a>: object - defaults to <code>null</code></li>
<li><a href="/docs/guide.html#strict">strict</a>: bool - defaults to true</li>
<li><a href="/docs/guide.html#strictQuery">strictQuery</a>: bool - defaults to false</li>
<li><a href="/docs/guide.html#toJSON">toJSON</a> - object - no default</li>
<li><a href="/docs/guide.html#toObject">toObject</a> - object - no default</li>
<li><a href="/docs/guide.html#typeKey">typeKey</a> - string - defaults to &#39;type&#39;</li>
<li><a href="/docs/guide.html#validateBeforeSave">validateBeforeSave</a> - bool - defaults to <code>true</code></li>
<li><a href="/docs/guide.html#versionKey">versionKey</a>: string or object - defaults to &quot;__v&quot;</li>
<li><a href="/docs/guide.html#optimisticConcurrency">optimisticConcurrency</a>: bool - defaults to false. Set to true to enable <a href="https://thecodebarbarian.com/whats-new-in-mongoose-5-10-optimistic-concurrency.html">optimistic concurrency</a>.</li>
<li><a href="/docs/guide.html#collation">collation</a>: object - defaults to null (which means use no collation)</li>
<li><a href="/docs/guide.html#timeseries">timeseries</a>: object - defaults to null (which means this schema&#39;s collection won&#39;t be a timeseries collection)</li>
<li><a href="/docs/guide.html#selectPopulatedPaths">selectPopulatedPaths</a>: boolean - defaults to <code>true</code></li>
<li><a href="/docs/guide.html#skipVersioning">skipVersioning</a>: object - paths to exclude from versioning</li>
<li><a href="/docs/guide.html#timestamps">timestamps</a>: object or boolean - defaults to <code>false</code>. If true, Mongoose adds <code>createdAt</code> and <code>updatedAt</code> properties to your schema and manages those properties for you.</li>
<li><a href="/docs/guide.html#pluginTags">pluginTags</a>: array of strings - defaults to <code>undefined</code>. If set and plugin called with <code>tags</code> option, will only apply that plugin to schemas with a matching tag.</li>
</ul>
<h4 id="options-for-nested-schemas">
      <a href="#options-for-nested-schemas">
        Options for Nested Schemas:
      </a>
    </h4>
<ul>
<li><code>excludeIndexes</code>: bool - defaults to <code>false</code>. If <code>true</code>, skip building indexes on this schema&#39;s paths.</li>
</ul>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><em>When nesting schemas, (<code>children</code> in the example above), always declare the child schema first before passing it into its parent.</em></p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-Types"><a href="#schema_Schema-Types">Schema.Types</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The various built-in Mongoose Schema Types.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ObjectId</span> = mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>;
</code></pre>
<h4 id="types">
      <a href="#types">
        Types:
      </a>
    </h4>
<ul>
<li><a href="/docs/schematypes.html#strings">String</a></li>
<li><a href="/docs/schematypes.html#numbers">Number</a></li>
<li><a href="/docs/schematypes.html#booleans">Boolean</a> | Bool</li>
<li><a href="/docs/schematypes.html#arrays">Array</a></li>
<li><a href="/docs/schematypes.html#buffers">Buffer</a></li>
<li><a href="/docs/schematypes.html#dates">Date</a></li>
<li><a href="/docs/schematypes.html#objectids">ObjectId</a> | Oid</li>
<li><a href="/docs/schematypes.html#mixed">Mixed</a></li>
</ul>
<p>Using this exposed access to the <code>Mixed</code> SchemaType, we can use them in our schema.</p>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Mixed</span> = mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Mixed</span>;
<span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">_user</span>: <span class="hljs-title class_">Mixed</span> })
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-indexTypes"><a href="#schema_Schema-indexTypes">Schema.indexTypes</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The allowed index types</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-add"><a href="#schema_Schema-add">Schema.prototype.add()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object|Schema&raquo;</span> plain object with paths to add, or another schema</p>
</li><li class="param">[prefix]
<span class="method-type">&laquo;String&raquo;</span> path to prefix the newly added paths with</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Adds key path / schema type pairs to this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">ToySchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>();
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">add</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">price</span>: <span class="hljs-string">&#x27;number&#x27;</span> });

<span class="hljs-keyword">const</span> <span class="hljs-title class_">TurboManSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>();
<span class="hljs-comment">// You can also `add()` another schema and copy over all paths, virtuals,</span>
<span class="hljs-comment">// getters, setters, indexes, methods, and statics.</span>
<span class="hljs-title class_">TurboManSchema</span>.<span class="hljs-title function_">add</span>(<span class="hljs-title class_">ToySchema</span>).<span class="hljs-title function_">add</span>({ <span class="hljs-attr">year</span>: <span class="hljs-title class_">Number</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-alias"><a href="#schema_Schema-alias">Schema.prototype.alias()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> real path to alias</p>
</li><li class="param">alias
<span class="method-type">&laquo;String|Array[String]&raquo;</span> the path(s) to use as an alias for <code>path</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Add an alias for <code>path</code>. This means getting or setting the <code>alias</code>
is equivalent to getting or setting the <code>path</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> toySchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">n</span>: <span class="hljs-title class_">String</span> });

<span class="hljs-comment">// Make &#x27;name&#x27; an alias for &#x27;n&#x27;</span>
toySchema.<span class="hljs-title function_">alias</span>(<span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Toy</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Toy&#x27;</span>, toySchema);
<span class="hljs-keyword">const</span> turboMan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Toy</span>({ <span class="hljs-attr">n</span>: <span class="hljs-string">&#x27;Turbo Man&#x27;</span> });

turboMan.<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;Turbo Man&#x27;</span>
turboMan.<span class="hljs-property">n</span>; <span class="hljs-comment">// &#x27;Turbo Man&#x27;</span>

turboMan.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;Turbo Man Action Figure&#x27;</span>;
turboMan.<span class="hljs-property">n</span>; <span class="hljs-comment">// &#x27;Turbo Man Action Figure&#x27;</span>

<span class="hljs-keyword">await</span> turboMan.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// Saves { _id: ..., n: &#x27;Turbo Man Action Figure&#x27; }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-childSchemas"><a href="#schema_Schema-childSchemas">Schema.prototype.childSchemas</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Array of child schemas (from document arrays and single nested subdocs)
and their corresponding compiled models. Each element of the array is
an object with 2 properties: <code>schema</code> and <code>model</code>.</p>
<p>This property is typically only useful for plugin authors and advanced users.
You do not need to interact with this property at all to use mongoose.</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-clearIndexes"><a href="#schema_Schema-clearIndexes">Schema.prototype.clearIndexes()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Remove all indexes from this schema.</p>
<p>clearIndexes only removes indexes from your schema object. Does <strong>not</strong> affect the indexes
in MongoDB.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">ToySchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">price</span>: <span class="hljs-title class_">Number</span> });
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">index</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> });
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">index</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">1</span> });

<span class="hljs-comment">// Remove all indexes on this schema</span>
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">clearIndexes</span>();

<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">indexes</span>(); <span class="hljs-comment">// []</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-clone"><a href="#schema_Schema-clone">Schema.prototype.clone()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the cloned schema</li></ul><div><p>Returns a deep copy of the schema</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">const</span> clone = schema.<span class="hljs-title function_">clone</span>();
clone === schema; <span class="hljs-comment">// false</span>
clone.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// SchemaString { ... }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-discriminator"><a href="#schema_Schema-discriminator">Schema.prototype.discriminator()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> the name of the discriminator</p>
</li><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> the discriminated Schema</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Inherit a Schema by applying a discriminator on an existing Schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> eventSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span> }, { <span class="hljs-attr">discriminatorKey</span>: <span class="hljs-string">&#x27;kind&#x27;</span> });

<span class="hljs-keyword">const</span> clickedEventSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">element</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">discriminatorKey</span>: <span class="hljs-string">&#x27;kind&#x27;</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ClickedModel</span> = eventSchema.<span class="hljs-title function_">discriminator</span>(<span class="hljs-string">&#x27;clicked&#x27;</span>, clickedEventSchema);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Event&#x27;</span>, eventSchema);

<span class="hljs-title class_">Event</span>.<span class="hljs-property">discriminators</span>[<span class="hljs-string">&#x27;clicked&#x27;</span>]; <span class="hljs-comment">// Model { clicked }</span>

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Event</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">kind</span>: <span class="hljs-string">&#x27;clicked&#x27;</span>, <span class="hljs-attr">element</span>: <span class="hljs-string">&#x27;#hero&#x27;</span> });
doc.<span class="hljs-property">element</span>; <span class="hljs-comment">// &#x27;#hero&#x27;</span>
doc <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ClickedModel</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-eachPath"><a href="#schema_Schema-eachPath">Schema.prototype.eachPath()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> callback function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> this</li></ul><div><p>Iterates the schemas paths similar to Array#forEach.</p>
<p>The callback is passed the pathname and the schemaType instance.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">registeredAt</span>: <span class="hljs-title class_">Date</span> });
userSchema.<span class="hljs-title function_">eachPath</span>(<span class="hljs-function">(<span class="hljs-params">pathname, schematype</span>) =&gt;</span> {
  <span class="hljs-comment">// Prints twice:</span>
  <span class="hljs-comment">// name SchemaString { ... }</span>
  <span class="hljs-comment">// registeredAt SchemaDate { ... }</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pathname, schematype);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-get"><a href="#schema_Schema-get">Schema.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> The name of the Option to get the current value for</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> the option&#39;s value</li></ul><div><p>Gets a schema option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;strict&#x27;</span>); <span class="hljs-comment">// true</span>
schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;strict&#x27;</span>, <span class="hljs-literal">false</span>);
schema.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;strict&#x27;</span>); <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-index"><a href="#schema_Schema-index">Schema.prototype.index()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fields
<span class="method-type">&laquo;Object&raquo;</span> The Fields to index, with the order, available values: <code>1 | -1 | &#39;2d&#39; | &#39;2dsphere&#39; | &#39;geoHaystack&#39; | &#39;hashed&#39; | &#39;text&#39;</code></p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options to pass to <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#createIndex">MongoDB driver&#39;s <code>createIndex()</code> function</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.expires=null]
<span class="method-type">&laquo;String|number&raquo;</span> Mongoose-specific syntactic sugar, uses <a href="https://www.npmjs.com/package/ms">ms</a> to convert <code>expires</code> option into seconds for the <code>expireAfterSeconds</code> in the above link.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.language_override=null]
<span class="method-type">&laquo;String&raquo;</span> Tells mongodb to use the specified field instead of <code>language</code> for parsing text indexes.</p>
</li></ul></ul><div><p>Defines an index (most likely compound) for this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">index</span>({ <span class="hljs-attr">first</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">last</span>: -<span class="hljs-number">1</span> })
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-indexes"><a href="#schema_Schema-indexes">Schema.prototype.indexes()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> list of indexes defined in the schema</li></ul><div><p>Returns a list of indexes that this schema declares, via <code>schema.index()</code> or by <code>index: true</code> in a path&#39;s options.
Indexes are expressed as an array <code>[spec, options]</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">registeredAt</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span> }
});

<span class="hljs-comment">// [ [ { email: 1 }, { unique: true, background: true } ],</span>
<span class="hljs-comment">//   [ { registeredAt: 1 }, { background: true } ] ]</span>
userSchema.<span class="hljs-title function_">indexes</span>();
</code></pre>
<p><a href="/docs/plugins.html">Plugins</a> can use the return value of this function to modify a schema&#39;s indexes.
For example, the below plugin makes every index unique by default.</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">myPlugin</span>(<span class="hljs-params">schema</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> index <span class="hljs-keyword">of</span> schema.<span class="hljs-title function_">indexes</span>()) {
    <span class="hljs-keyword">if</span> (index[<span class="hljs-number">1</span>].<span class="hljs-property">unique</span> === <span class="hljs-literal">undefined</span>) {
      index[<span class="hljs-number">1</span>].<span class="hljs-property">unique</span> = <span class="hljs-literal">true</span>;
    }
  }
}
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-loadClass"><a href="#schema_Schema-loadClass">Schema.prototype.loadClass()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">model
<span class="method-type">&laquo;Function&raquo;</span> The Class to load</p>
</li><li class="param">[virtualsOnly]
<span class="method-type">&laquo;Boolean&raquo;</span> if truthy, only pulls virtuals from the class, not methods or statics</p>
</li></ul><div><p>Loads an ES6 class into a schema. Maps <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/set">setters</a> + <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get">getters</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/static">static methods</a>,
and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#Class_body_and_method_definitions">instance methods</a>
to schema <a href="/docs/guide.html#virtuals">virtuals</a>,
<a href="/docs/guide.html#statics">statics</a>, and
<a href="/docs/guide.html#methods">methods</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;md5&#x27;</span>);
<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">email</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserClass</span> {
  <span class="hljs-comment">// `gravatarImage` becomes a virtual</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">gravatarImage</span>() {
    <span class="hljs-keyword">const</span> hash = <span class="hljs-title function_">md5</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span>.<span class="hljs-title function_">toLowerCase</span>());
    <span class="hljs-keyword">return</span> <span class="hljs-string">`https://www.gravatar.com/avatar/<span class="hljs-subst">${hash}</span>`</span>;
  }

  <span class="hljs-comment">// `getProfileUrl()` becomes a document method</span>
  <span class="hljs-title function_">getProfileUrl</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`https://mysite.com/<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.email}</span>`</span>;
  }

  <span class="hljs-comment">// `findByEmail()` becomes a static</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">findByEmail</span>(<span class="hljs-params">email</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findOne</span>({ email });
  }
}

<span class="hljs-comment">// `schema` will now have a `gravatarImage` virtual, a `getProfileUrl()` method,</span>
<span class="hljs-comment">// and a `findByEmail()` static</span>
userSchema.<span class="hljs-title function_">loadClass</span>(<span class="hljs-title class_">UserClass</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-method"><a href="#schema_Schema-method">Schema.prototype.method()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|Object&raquo;</span> The Method Name for a single function, or a Object of &quot;string-function&quot; pairs.</p>
</li><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> The Function in a single-function definition.</p>
</li></ul><div><p>Adds an instance method to documents constructed from Models compiled from this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = kittySchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);

schema.<span class="hljs-title function_">method</span>(<span class="hljs-string">&#x27;meow&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;meeeeeoooooooooooow&#x27;</span>);
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Kitty</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Kitty&#x27;</span>, schema);

<span class="hljs-keyword">const</span> fizz = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Kitty</span>;
fizz.<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// meeeeeooooooooooooow</span>
</code></pre>
<p>If a hash of name/fn pairs is passed as the only argument, each name/fn pair will be added as methods.</p>
<pre><code>schema.<span class="hljs-title function_">method</span>({
    <span class="hljs-attr">purr</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {}
  , <span class="hljs-attr">scratch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {}
});

<span class="hljs-comment">// later</span>
<span class="hljs-keyword">const</span> fizz = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Kitty</span>;
fizz.<span class="hljs-title function_">purr</span>();
fizz.<span class="hljs-title function_">scratch</span>();
</code></pre>
<p>NOTE: <code>Schema.method()</code> adds instance methods to the <code>Schema.methods</code> object. You can also add instance methods directly to the <code>Schema.methods</code> object as seen in the <a href="/docs/guide.html#methods">guide</a></p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-obj"><a href="#schema_Schema-obj">Schema.prototype.obj</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The original object passed to the schema constructor</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">a</span>: <span class="hljs-title class_">String</span> }).<span class="hljs-title function_">add</span>({ <span class="hljs-attr">b</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-property">obj</span>; <span class="hljs-comment">// { a: String }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-omit"><a href="#schema_Schema-omit">Schema.prototype.omit()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">paths
<span class="method-type">&laquo;Array[String]&raquo;</span> List of Paths to omit for the new Schema</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options to pass to the new Schema Constructor (same as <code>new Schema(.., Options)</code>). Defaults to <code>this.options</code> if not set.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> </li></ul><div><p>Returns a new schema that has the <code>paths</code> from the original schema, minus the omitted ones.</p>
<p>This method is analagous to <a href="https://lodash.com/docs/#omit">Lodash&#39;s <code>omit()</code> function</a> for Mongoose schemas.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span> });
<span class="hljs-comment">// Creates a new schema omitting the `age` path</span>
<span class="hljs-keyword">const</span> newSchema = schema.<span class="hljs-title function_">omit</span>([<span class="hljs-string">&#x27;age&#x27;</span>]);

newSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// SchemaString { ... }</span>
newSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;age&#x27;</span>); <span class="hljs-comment">// undefined</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-path"><a href="#schema_Schema-path">Schema.prototype.path()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> The name of the Path to get / set</p>
</li><li class="param">[obj]
<span class="method-type">&laquo;Object&raquo;</span> The Type to set the path to, if provided the path will be SET, otherwise the path will be GET</p>
</li></ul><div><p>Gets/sets schema paths.</p>
<p>Sets a path (if arity 2)
Gets a path (if arity 1)</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>) <span class="hljs-comment">// returns a SchemaType</span>
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-title class_">Number</span>) <span class="hljs-comment">// changes the schemaType of `name` to Number</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-pathType"><a href="#schema_Schema-pathType">Schema.prototype.pathType()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Returns the pathType of <code>path</code> for this schema.</p>
<p>Given a path, returns whether it is a real, virtual, nested, or ad-hoc/undefined path.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">nested</span>: { <span class="hljs-attr">foo</span>: <span class="hljs-title class_">String</span> } });
s.<span class="hljs-title function_">virtual</span>(<span class="hljs-string">&#x27;foo&#x27;</span>).<span class="hljs-title function_">get</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-number">42</span>);
s.<span class="hljs-title function_">pathType</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// &quot;real&quot;</span>
s.<span class="hljs-title function_">pathType</span>(<span class="hljs-string">&#x27;nested&#x27;</span>); <span class="hljs-comment">// &quot;nested&quot;</span>
s.<span class="hljs-title function_">pathType</span>(<span class="hljs-string">&#x27;foo&#x27;</span>); <span class="hljs-comment">// &quot;virtual&quot;</span>
s.<span class="hljs-title function_">pathType</span>(<span class="hljs-string">&#x27;fail&#x27;</span>); <span class="hljs-comment">// &quot;adhocOrUndefined&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-paths"><a href="#schema_Schema-paths">Schema.prototype.paths</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The paths defined on this schema. The keys are the top-level paths
in this schema, and the values are instances of the SchemaType class.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">_id</span>: <span class="hljs-literal">false</span> });
schema.<span class="hljs-property">paths</span>; <span class="hljs-comment">// { name: SchemaString { ... } }</span>

schema.<span class="hljs-title function_">add</span>({ <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span> });
schema.<span class="hljs-property">paths</span>; <span class="hljs-comment">// { name: SchemaString { ... }, age: SchemaNumber { ... } }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-pick"><a href="#schema_Schema-pick">Schema.prototype.pick()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">paths
<span class="method-type">&laquo;Array[String]&raquo;</span> List of Paths to pick for the new Schema</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options to pass to the new Schema Constructor (same as <code>new Schema(.., Options)</code>). Defaults to <code>this.options</code> if not set.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> </li></ul><div><p>Returns a new schema that has the picked <code>paths</code> from this schema.</p>
<p>This method is analagous to <a href="https://lodash.com/docs/4.17.15#pick">Lodash&#39;s <code>pick()</code> function</a> for Mongoose schemas.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span> });
<span class="hljs-comment">// Creates a new schema with the same `name` path as `schema`,</span>
<span class="hljs-comment">// but no `age` path.</span>
<span class="hljs-keyword">const</span> newSchema = schema.<span class="hljs-title function_">pick</span>([<span class="hljs-string">&#x27;name&#x27;</span>]);

newSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// SchemaString { ... }</span>
newSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;age&#x27;</span>); <span class="hljs-comment">// undefined</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-plugin"><a href="#schema_Schema-plugin">Schema.prototype.plugin()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">plugin
<span class="method-type">&laquo;Function&raquo;</span> The Plugin&#39;s callback</p>
</li><li class="param">[opts]
<span class="method-type">&laquo;Object&raquo;</span> Options to pass to the plugin</p>
</li><ul style="margin-top: 0.5em"><li>[opts.deduplicate=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, ignore duplicate plugins (same <code>fn</code> argument using <code>===</code>)</p>
</li></ul></ul><div><p>Registers a plugin for this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
s.<span class="hljs-title function_">plugin</span>(<span class="hljs-function"><span class="hljs-params">schema</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">path</span>));
mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, s); <span class="hljs-comment">// Prints &#x27;name&#x27;</span>
</code></pre>
<p>Or with Options:</p>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
s.<span class="hljs-title function_">plugin</span>(<span class="hljs-function">(<span class="hljs-params">schema, opts</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(opts.<span class="hljs-property">text</span>, schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">path</span>), { <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;Schema Path Name:&quot;</span> });
mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, s); <span class="hljs-comment">// Prints &#x27;Schema Path Name: name&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-post"><a href="#schema_Schema-post">Schema.prototype.post()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">methodName
<span class="method-type">&laquo;String|RegExp|Array[String]&raquo;</span> The method name or regular expression to match method name</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.document]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>name</code> is a hook for both document and query middleware, set to <code>true</code> to run on document middleware.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.query]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>name</code> is a hook for both document and query middleware, set to <code>true</code> to run on query middleware.</p>
</li></ul><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> callback</p>
</li></ul><div><p>Defines a post hook for the document</p>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);
schema.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this fired after a document was saved&#x27;</span>);
});

schema.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;find&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">docs</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this fired after you ran a find query&#x27;</span>);
});

schema.<span class="hljs-title function_">post</span>(<span class="hljs-regexp">/Many$/</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this fired after you ran `updateMany()` or `deleteMany()`&#x27;</span>);
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Model&#x27;</span>, schema);

<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>(..);
m.<span class="hljs-title function_">save</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this fires after the `post` hook&#x27;</span>);
});

m.<span class="hljs-title function_">find</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, docs</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this fires after the post find hook&#x27;</span>);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-pre"><a href="#schema_Schema-pre">Schema.prototype.pre()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">methodName
<span class="method-type">&laquo;String|RegExp|Array[String]&raquo;</span> The method name or regular expression to match method name</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.document]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>name</code> is a hook for both document and query middleware, set to <code>true</code> to run on document middleware. For example, set <code>options.document</code> to <code>true</code> to apply this hook to <code>Document#deleteOne()</code> rather than <code>Query#deleteOne()</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.query]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>name</code> is a hook for both document and query middleware, set to <code>true</code> to run on query middleware.</p>
</li></ul><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Defines a pre hook for the model.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> toySchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">created</span>: <span class="hljs-title class_">Date</span> });

toySchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">created</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">created</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>;
  <span class="hljs-title function_">next</span>();
});

toySchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;validate&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> !== <span class="hljs-string">&#x27;Woody&#x27;</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;Woody&#x27;</span>;
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// Equivalent to calling `pre()` on `find`, `findOne`, `findOneAndUpdate`.</span>
toySchema.<span class="hljs-title function_">pre</span>(<span class="hljs-regexp">/^find/</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFilter</span>());
});

<span class="hljs-comment">// Equivalent to calling `pre()` on `updateOne`, `findOneAndUpdate`.</span>
toySchema.<span class="hljs-title function_">pre</span>([<span class="hljs-string">&#x27;updateOne&#x27;</span>, <span class="hljs-string">&#x27;findOneAndUpdate&#x27;</span>], <span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFilter</span>());
});

toySchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;deleteOne&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// Runs when you call `Toy.deleteOne()`</span>
});

toySchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;deleteOne&#x27;</span>, { <span class="hljs-attr">document</span>: <span class="hljs-literal">true</span> }, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// Runs when you call `doc.deleteOne()`</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-queue"><a href="#schema_Schema-queue">Schema.prototype.queue()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> name of the document method to call later</p>
</li><li class="param">args
<span class="method-type">&laquo;Array&raquo;</span> arguments to pass to the method</p>
</li></ul><div><p>Adds a method call to the queue.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-property">methods</span>.<span class="hljs-property">print</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); };
schema.<span class="hljs-title function_">queue</span>(<span class="hljs-string">&#x27;print&#x27;</span>, []); <span class="hljs-comment">// Print the doc every one is instantiated</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> }); <span class="hljs-comment">// Prints &#x27;{&quot;_id&quot;: ..., &quot;name&quot;: &quot;test&quot; }&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-remove"><a href="#schema_Schema-remove">Schema.prototype.remove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Array&raquo;</span> The Path(s) to remove</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Removes the given <code>path</code> (or [<code>paths</code>]).</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span> });
schema.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;name&#x27;</span>);
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// Undefined</span>
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;age&#x27;</span>); <span class="hljs-comment">// SchemaNumber { ... }</span>
</code></pre>
<p>Or as a Array:</p>
<pre><code>schema.<span class="hljs-title function_">remove</span>([<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>]);
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// Undefined</span>
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;age&#x27;</span>); <span class="hljs-comment">// Undefined</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-removeIndex"><a href="#schema_Schema-removeIndex">Schema.prototype.removeIndex()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">index
<span class="method-type">&laquo;Object|string&raquo;</span> name or index specification</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Schema&raquo;</span> the Schema instance</li></ul><div><p>Remove an index by name or index specification.</p>
<p>removeIndex only removes indexes from your schema object. Does <strong>not</strong> affect the indexes
in MongoDB.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">ToySchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">price</span>: <span class="hljs-title class_">Number</span> });

<span class="hljs-comment">// Add a new index on { name, color }</span>
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">index</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">1</span> });

<span class="hljs-comment">// Remove index on { name, color }</span>
<span class="hljs-comment">// Keep in mind that order matters! `removeIndex({ color: 1, name: 1 })` won&#x27;t remove the index</span>
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">removeIndex</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">1</span> });

<span class="hljs-comment">// Add an index with a custom name</span>
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">index</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my custom index name&#x27;</span> });
<span class="hljs-comment">// Remove index by name</span>
<span class="hljs-title class_">ToySchema</span>.<span class="hljs-title function_">removeIndex</span>(<span class="hljs-string">&#x27;my custom index name&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-removeVirtual"><a href="#schema_Schema-removeVirtual">Schema.prototype.removeVirtual()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Array&raquo;</span> The virutal path(s) to remove.</p>
</li></ul><div><p>Removes the given virtual or virtuals from the schema.</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-requiredPaths"><a href="#schema_Schema-requiredPaths">Schema.prototype.requiredPaths()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">invalidate
<span class="method-type">&laquo;Boolean&raquo;</span> Refresh the cache</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Returns an Array of path strings that are required by this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">notes</span>: <span class="hljs-title class_">String</span>
});
s.requiredPaths(); <span class="hljs-comment">// [ &#x27;age&#x27;, &#x27;name&#x27; ]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-set"><a href="#schema_Schema-set">Schema.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> The name of the option to set the value to</p>
</li><li class="param">[value]
<span class="method-type">&laquo;Object&raquo;</span> The value to set the option to, if not passed, the option will be reset to default</p>
</li></ul><div><p>Sets a schema option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;strict&#x27;</span>); <span class="hljs-comment">// &#x27;true&#x27; by default</span>
schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;strict&#x27;</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// Sets &#x27;strict&#x27; to false</span>
schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;strict&#x27;</span>); <span class="hljs-comment">// &#x27;false&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-static"><a href="#schema_Schema-static">Schema.prototype.static()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|Object&raquo;</span> The Method Name for a single function, or a Object of &quot;string-function&quot; pairs.</p>
</li><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> The Function in a single-function definition.</p>
</li></ul><div><p>Adds static &quot;class&quot; methods to Models compiled from this schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);
<span class="hljs-comment">// Equivalent to `schema.statics.findByName = function(name) {}`;</span>
schema.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;findByName&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: name });
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Drink</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Drink&#x27;</span>, schema);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Drink</span>.<span class="hljs-title function_">findByName</span>(<span class="hljs-string">&#x27;LaCroix&#x27;</span>);
</code></pre>
<p>If a hash of name/fn pairs is passed as the only argument, each name/fn pair will be added as methods.</p>
<pre><code>schema.<span class="hljs-title function_">static</span>({
    <span class="hljs-attr">findByName</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {..}
  , <span class="hljs-attr">findByCost</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {..}
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Drink</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Drink&#x27;</span>, schema);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Drink</span>.<span class="hljs-title function_">findByName</span>(<span class="hljs-string">&#x27;LaCroix&#x27;</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Drink</span>.<span class="hljs-title function_">findByCost</span>(<span class="hljs-number">3</span>);
</code></pre>
<p>If a hash of name/fn pairs is passed as the only argument, each name/fn pair will be added as statics.</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-virtual"><a href="#schema_Schema-virtual">Schema.prototype.virtual()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> The name of the Virtual</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.ref]
<span class="method-type">&laquo;String|Model&raquo;</span> model name or model instance. Marks this as a <a href="/docs/populate.html#populate-virtuals">populate virtual</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.localField]
<span class="method-type">&laquo;String|Function&raquo;</span> Required for populate virtuals. See <a href="/docs/populate.html#populate-virtuals">populate virtual docs</a> for more information.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.foreignField]
<span class="method-type">&laquo;String|Function&raquo;</span> Required for populate virtuals. See <a href="/docs/populate.html#populate-virtuals">populate virtual docs</a> for more information.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.justOne=false]
<span class="method-type">&laquo;Boolean|Function&raquo;</span> Only works with populate virtuals. If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, will be a single doc or <code>null</code>. Otherwise, the populate virtual will be an array.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.count=false]
<span class="method-type">&laquo;Boolean&raquo;</span> Only works with populate virtuals. If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, this populate virtual will contain the number of documents rather than the documents themselves when you <code>populate()</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.get=null]
<span class="method-type">&laquo;Function|null&raquo;</span> Adds a <a href="/docs/tutorials/getters-setters.html">getter</a> to this virtual to transform the populated doc.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;VirtualType&raquo;</span> </li></ul><div><p>Creates a virtual type with the given name.</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-virtualpath"><a href="#schema_Schema-virtualpath">Schema.prototype.virtualpath()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> The name of the Virtual to get</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;VirtualType,null&raquo;</span> </li></ul><div><p>Returns the virtual type with the given <code>name</code>.</p>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-virtuals"><a href="#schema_Schema-virtuals">Schema.prototype.virtuals</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Object containing all virtuals defined on this schema.
The objects&#39; keys are the virtual paths and values are instances of <code>VirtualType</code>.</p>
<p>This property is typically only useful for plugin authors and advanced users.
You do not need to interact with this property at all to use mongoose.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({});
schema.<span class="hljs-title function_">virtual</span>(<span class="hljs-string">&#x27;answer&#x27;</span>).<span class="hljs-title function_">get</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-number">42</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(schema.<span class="hljs-property">virtuals</span>); <span class="hljs-comment">// { answer: VirtualType { path: &#x27;answer&#x27;, ... } }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(schema.<span class="hljs-property">virtuals</span>[<span class="hljs-string">&#x27;answer&#x27;</span>].<span class="hljs-property">getters</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">call</span>()); <span class="hljs-comment">// 42</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schema_Schema-reserved"><a href="#schema_Schema-reserved">Schema.reserved</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Reserved document keys.</p>
<p>Keys in this object are names that are warned in schema declarations
because they have the potential to break Mongoose/ Mongoose plugins functionality. If you create a schema
using <code>new Schema()</code> with one of these property names, Mongoose will log a warning.</p>
<ul>
<li>_posts</li>
<li>_pres</li>
<li>collection</li>
<li>emit</li>
<li>errors</li>
<li>get</li>
<li>init</li>
<li>isModified</li>
<li>isNew</li>
<li>listeners</li>
<li>modelName</li>
<li>on</li>
<li>once</li>
<li>populated</li>
<li>prototype</li>
<li>remove</li>
<li>removeListener</li>
<li>save</li>
<li>schema</li>
<li>toObject</li>
<li>validate</li>
</ul>
<p><em>NOTE:</em> Use of these terms as method names is permitted, but play at your own risk, as they may be existing mongoose document methods you are stomping on.</p>
<pre><code> <span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);
 schema.<span class="hljs-property">methods</span>.<span class="hljs-property">init</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {} <span class="hljs-comment">// potentially breaking</span>
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/connection.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Connection"><a href="#Connection">Connection</a></h2></div><ul><li><a href="#connection_Connection">Connection()</a></li><li><a href="#connection_Connection-asPromise">Connection.prototype.asPromise()</a></li><li><a href="#connection_Connection-client">Connection.prototype.client</a></li><li><a href="#connection_Connection-close">Connection.prototype.close()</a></li><li><a href="#connection_Connection-collection">Connection.prototype.collection()</a></li><li><a href="#connection_Connection-collections">Connection.prototype.collections</a></li><li><a href="#connection_Connection-config">Connection.prototype.config</a></li><li><a href="#connection_Connection-createCollection">Connection.prototype.createCollection()</a></li><li><a href="#connection_Connection-db">Connection.prototype.db</a></li><li><a href="#connection_Connection-deleteModel">Connection.prototype.deleteModel()</a></li><li><a href="#connection_Connection-destroy">Connection.prototype.destroy()</a></li><li><a href="#connection_Connection-dropCollection">Connection.prototype.dropCollection()</a></li><li><a href="#connection_Connection-dropDatabase">Connection.prototype.dropDatabase()</a></li><li><a href="#connection_Connection-get">Connection.prototype.get()</a></li><li><a href="#connection_Connection-getClient">Connection.prototype.getClient()</a></li><li><a href="#connection_Connection-host">Connection.prototype.host</a></li><li><a href="#connection_Connection-id">Connection.prototype.id</a></li><li><a href="#connection_Connection-model">Connection.prototype.model()</a></li><li><a href="#connection_Connection-modelNames">Connection.prototype.modelNames()</a></li><li><a href="#connection_Connection-models">Connection.prototype.models</a></li><li><a href="#connection_Connection-name">Connection.prototype.name</a></li><li><a href="#connection_Connection-openUri">Connection.prototype.openUri()</a></li><li><a href="#connection_Connection-pass">Connection.prototype.pass</a></li><li><a href="#connection_Connection-plugin">Connection.prototype.plugin()</a></li><li><a href="#connection_Connection-plugins">Connection.prototype.plugins</a></li><li><a href="#connection_Connection-port">Connection.prototype.port</a></li><li><a href="#connection_Connection-readyState">Connection.prototype.readyState</a></li><li><a href="#connection_Connection-set">Connection.prototype.set()</a></li><li><a href="#connection_Connection-setClient">Connection.prototype.setClient()</a></li><li><a href="#connection_Connection-startSession">Connection.prototype.startSession()</a></li><li><a href="#connection_Connection-syncIndexes">Connection.prototype.syncIndexes</a></li><li><a href="#connection_Connection-transaction">Connection.prototype.transaction()</a></li><li><a href="#connection_Connection-useDb">Connection.prototype.useDb()</a></li><li><a href="#connection_Connection-user">Connection.prototype.user</a></li><li><a href="#connection_Connection-watch">Connection.prototype.watch()</a></li></ul><hr class="separate-api-elements"><h3 id="connection_Connection"><a href="#connection_Connection">Connection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">base
<span class="method-type">&laquo;Mongoose&raquo;</span> a mongoose instance</p>
</li></ul><div><p>Connection constructor</p>
<p>For practical reasons, a Connection equals a Db.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-asPromise"><a href="#connection_Connection-asPromise">Connection.prototype.asPromise()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Returns a promise that resolves when this connection
successfully connects to MongoDB, or rejects if this connection failed
to connect.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>).
  <span class="hljs-title function_">asPromise</span>();
conn.<span class="hljs-property">readyState</span>; <span class="hljs-comment">// 1, means Mongoose is connected</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-client"><a href="#connection_Connection-client">Connection.prototype.client</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The MongoClient instance this connection uses to talk to MongoDB. Mongoose automatically sets this property
when the connection is opened.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-close"><a href="#connection_Connection-close">Connection.prototype.close()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[force]
<span class="method-type">&laquo;Boolean&raquo;</span> optional</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Closes the connection</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-collection"><a href="#connection_Connection-collection">Connection.prototype.collection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> of the collection</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional collection options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Collection&raquo;</span> collection instance</li></ul><div><p>Retrieves a collection, creating it if not cached.</p>
<p>Not typically needed by applications. Just talk to your collection through your model.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-collections"><a href="#connection_Connection-collections">Connection.prototype.collections</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A hash of the collections associated with this connection</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-config"><a href="#connection_Connection-config">Connection.prototype.config</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A hash of the global options that are associated with this connection</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-createCollection"><a href="#connection_Connection-createCollection">Connection.prototype.createCollection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">collection
<span class="method-type">&laquo;string&raquo;</span> The collection to create</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createCollection">MongoDB driver docs</a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Helper for <code>createCollection()</code>. Will explicitly create the given collection
with specified options. Used to create <a href="https://www.mongodb.com/docs/manual/core/capped-collections/">capped collections</a>
and <a href="https://www.mongodb.com/docs/manual/core/views/">views</a> from mongoose.</p>
<p>Options are passed down without modification to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createCollection">MongoDB driver&#39;s <code>createCollection()</code> function</a></p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-db"><a href="#connection_Connection-db">Connection.prototype.db</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The mongodb.Db instance, set when the connection is opened</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-deleteModel"><a href="#connection_Connection-deleteModel">Connection.prototype.deleteModel()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|RegExp&raquo;</span> if string, the name of the model to remove. If regexp, removes all models whose name matches the regexp.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Removes the model named <code>name</code> from this connection, if it exists. You can
use this function to clean up any models you created in your tests to
prevent OverwriteModelErrors.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// Model object</span>
conn.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-string">&#x27;User&#x27;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// Usually useful in a Mocha `afterEach()` hook</span>
<span class="hljs-title function_">afterEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  conn.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-regexp">/.+/</span>); <span class="hljs-comment">// Delete every model</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-destroy"><a href="#connection_Connection-destroy">Connection.prototype.destroy()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[force]
<span class="method-type">&laquo;Boolean&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Destory the connection (not just a alias of <a href="#connection_Connection-close"><code>.close</code></a>)</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-dropCollection"><a href="#connection_Connection-dropCollection">Connection.prototype.dropCollection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">collection
<span class="method-type">&laquo;string&raquo;</span> The collection to delete</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Helper for <code>dropCollection()</code>. Will delete the given collection, including
all documents and indexes.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-dropDatabase"><a href="#connection_Connection-dropDatabase">Connection.prototype.dropDatabase()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Helper for <code>dropDatabase()</code>. Deletes the given database, including all
collections, documents, and indexes.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
<span class="hljs-comment">// Deletes the entire &#x27;mydb&#x27; database</span>
<span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">dropDatabase</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-get"><a href="#connection_Connection-get">Connection.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Gets the value of the option <code>key</code>. Equivalent to <code>conn.options[key]</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>conn.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">// returns the &#x27;test&#x27; value</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-getClient"><a href="#connection_Connection-getClient">Connection.prototype.getClient()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;MongoClient&raquo;</span> </li></ul><div><p>Returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html">MongoDB driver <code>MongoClient</code></a> instance
that this connection uses to talk to MongoDB.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>).
  <span class="hljs-title function_">asPromise</span>();

conn.<span class="hljs-title function_">getClient</span>(); <span class="hljs-comment">// MongoClient { ... }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-host"><a href="#connection_Connection-host">Connection.prototype.host</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The host name portion of the URI. If multiple hosts, such as a replica set,
this will contain the first host name in the URI</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">host</span>; <span class="hljs-comment">// &quot;127.0.0.1&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-id"><a href="#connection_Connection-id">Connection.prototype.id</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A number identifier for this connection. Used for debugging when
you have <a href="/docs/connections.html#multiple_connections">multiple connections</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// The default connection has `id = 0`</span>
mongoose.<span class="hljs-property">connection</span>.<span class="hljs-property">id</span>; <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// If you create a new connection, Mongoose increments id</span>
<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>();
conn.<span class="hljs-property">id</span>; <span class="hljs-comment">// 1</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-model"><a href="#connection_Connection-model">Connection.prototype.model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String|Function&raquo;</span> the model name or class extending Model</p>
</li><li class="param">[schema]
<span class="method-type">&laquo;Schema&raquo;</span> a schema. necessary when defining a model</p>
</li><li class="param">[collection]
<span class="method-type">&laquo;String&raquo;</span> name of mongodb collection (optional) if not given it will be induced from model name</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.overwriteModels=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, overwrite existing models with the same name to avoid <code>OverwriteModelError</code></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> The compiled model</li></ul><div><p>Defines or retrieves a model.</p>
<pre><code><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(..);
db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Venue&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Ticket</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Ticket&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Venue</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Venue&#x27;</span>);
</code></pre>
<p><em>When no <code>collection</code> argument is passed, Mongoose produces a collection name by passing the model <code>name</code> to the <a href="#utils_exports-toCollectionName">utils.toCollectionName</a> method. This method pluralizes the name. If you don&#39;t like this behavior, either pass a collection name or set your schemas collection name option.</em></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">collection</span>: <span class="hljs-string">&#x27;actor&#x27;</span> });

<span class="hljs-comment">// or</span>

schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;collection&#x27;</span>, <span class="hljs-string">&#x27;actor&#x27;</span>);

<span class="hljs-comment">// or</span>

<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">&#x27;actor&#x27;</span>
<span class="hljs-keyword">const</span> M = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema, collectionName)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-modelNames"><a href="#connection_Connection-modelNames">Connection.prototype.modelNames()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array[String]&raquo;</span> </li></ul><div><p>Returns an array of model names created on this connection.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-models"><a href="#connection_Connection-models">Connection.prototype.models</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A <a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a> containing
a map from model names to models. Contains all models that have been
added to this connection using <a href="/docs/api/connection.html#connection_Connection-model"><code>Connection#model()</code></a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(conn.<span class="hljs-property">models</span>).<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>
conn.<span class="hljs-property">models</span>.<span class="hljs-property">Test</span> === <span class="hljs-title class_">Test</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-name"><a href="#connection_Connection-name">Connection.prototype.name</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The name of the database this connection points to.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">name</span>; <span class="hljs-comment">// &quot;mydb&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-openUri"><a href="#connection_Connection-openUri">Connection.prototype.openUri()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">uri
<span class="method-type">&laquo;String&raquo;</span> The URI to connect with.</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Passed on to <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#connect-1"><code>MongoClient.connect</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.bufferCommands=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose specific option. Set to false to <a href="https://mongoosejs.com/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.bufferTimeoutMS=10000]
<span class="method-type">&laquo;Number&raquo;</span> Mongoose specific option. If <code>bufferCommands</code> is true, Mongoose will throw an error after <code>bufferTimeoutMS</code> if the operation is still buffered.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.dbName]
<span class="method-type">&laquo;String&raquo;</span> The name of the database we want to use. If not provided, use database name from connection string.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.user]
<span class="method-type">&laquo;String&raquo;</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.pass]
<span class="method-type">&laquo;String&raquo;</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxPoolSize=100]
<span class="method-type">&laquo;Number&raquo;</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.minPoolSize=0]
<span class="method-type">&laquo;Number&raquo;</span> The minimum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.serverSelectionTimeoutMS]
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver will try to find a server to send any given operation to, and keep retrying for <code>serverSelectionTimeoutMS</code> milliseconds before erroring out. If not set, the MongoDB driver defaults to using <code>30000</code> (30 seconds).</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.heartbeatFrequencyMS]
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver sends a heartbeat every <code>heartbeatFrequencyMS</code> to check on the status of the connection. A heartbeat is subject to <code>serverSelectionTimeoutMS</code>, so the MongoDB driver will retry failed heartbeats for up to 30 seconds by default. Mongoose only emits a <code>&#39;disconnected&#39;</code> event after a heartbeat has failed, so you may want to decrease this setting to reduce the time between when your server goes down and when Mongoose emits <code>&#39;disconnected&#39;</code>. We recommend you do <strong>not</strong> set this setting below 1000, too many heartbeats can lead to performance degradation.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.autoIndex=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.promiseLibrary]
<span class="method-type">&laquo;Class&raquo;</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver&#39;s promise library</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.connectTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>during initial connection</em>. Defaults to 30000. This option is passed transparently to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js&#39; <code>socket#setTimeout()</code> function</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.socketTimeoutMS=30000]
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. A socket may be inactive because of either no activity or a long-running operation. This is set to <code>30000</code> by default, you should set this to 2-3x your longest running operation if you expect some of your database operations to run longer than 20 seconds. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.family=0]
<span class="method-type">&laquo;Number&raquo;</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js&#39; <code>dns.lookup()</code></a> function. May be either <code>0, </code>4<code>, or </code>6<code>. </code>4<code>means use IPv4 only,</code>6<code>means use IPv6 only,</code>0` means try both.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.autoCreate=false]
<span class="method-type">&laquo;Boolean&raquo;</span> Set to <code>true</code> to make Mongoose automatically call <code>createCollection()</code> on every model created on this connection.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Opens the connection with a URI using <code>MongoClient.connect()</code>.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-pass"><a href="#connection_Connection-pass">Connection.prototype.pass</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The password specified in the URI</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://val:psw@127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">pass</span>; <span class="hljs-comment">// &quot;psw&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-plugin"><a href="#connection_Connection-plugin">Connection.prototype.plugin()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> plugin callback</p>
</li><li class="param">[opts]
<span class="method-type">&laquo;Object&raquo;</span> optional options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Declares a plugin executed on all schemas you pass to <code>conn.model()</code></p>
<p>Equivalent to calling <code>.plugin(fn)</code> on each schema you create.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
db.<span class="hljs-title function_">plugin</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Applied&#x27;</span>));
db.<span class="hljs-property">plugins</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>

db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({})); <span class="hljs-comment">// Prints &quot;Applied&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-plugins"><a href="#connection_Connection-plugins">Connection.prototype.plugins</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The plugins that will be applied to all models created on this connection.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
db.<span class="hljs-title function_">plugin</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Applied&#x27;</span>));
db.<span class="hljs-property">plugins</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>

db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({})); <span class="hljs-comment">// Prints &quot;Applied&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-port"><a href="#connection_Connection-port">Connection.prototype.port</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The port portion of the URI. If multiple hosts, such as a replica set,
this will contain the port from the first host name in the URI.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">port</span>; <span class="hljs-comment">// 27017</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-readyState"><a href="#connection_Connection-readyState">Connection.prototype.readyState</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Connection ready state</p>
<ul>
<li>0 = disconnected</li>
<li>1 = connected</li>
<li>2 = connecting</li>
<li>3 = disconnecting</li>
</ul>
<p>Each state change emits its associated event name.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connected&#x27;</span>, callback);
conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;disconnected&#x27;</span>, callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-set"><a href="#connection_Connection-set">Connection.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Any&raquo;</span> </li></ul><div><p>Sets the value of the option <code>key</code>. Equivalent to <code>conn.options[key] = val</code></p>
<p>Supported options include:</p>
<ul>
<li><code>maxTimeMS</code>: Set <a href="/docs/api/query.html#query_Query-maxTimeMS"><code>maxTimeMS</code></a> for all queries on this connection.</li>
<li>&#39;debug&#39;: If <code>true</code>, prints the operations mongoose sends to MongoDB to the console. If a writable stream is passed, it will log to that stream, without colorization. If a callback function is passed, it will receive the collection name, the method name, then all arugments passed to the method. For example, if you wanted to replicate the default logging, you could output from the callback <code>Mongoose: ${collectionName}.${methodName}(${methodArgs.join(&#39;, &#39;)})</code>.</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>conn.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;foo&#x27;</span>);
conn.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">// &#x27;foo&#x27;</span>
conn.<span class="hljs-property">options</span>.<span class="hljs-property">test</span>; <span class="hljs-comment">// &#x27;foo&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-setClient"><a href="#connection_Connection-setClient">Connection.prototype.setClient()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">client
<span class="method-type">&laquo;MongClient&raquo;</span> The Client to set to be used.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Set the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html">MongoDB driver <code>MongoClient</code></a> instance
that this connection uses to talk to MongoDB. This is useful if you already have a MongoClient instance, and want to
reuse it.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> mongodb.<span class="hljs-property">MongoClient</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>);

<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>().<span class="hljs-title function_">setClient</span>(client);

conn.<span class="hljs-title function_">getClient</span>(); <span class="hljs-comment">// MongoClient { ... }</span>
conn.<span class="hljs-property">readyState</span>; <span class="hljs-comment">// 1, means &#x27;CONNECTED&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-startSession"><a href="#connection_Connection-startSession">Connection.prototype.startSession()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#startSession">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.causalConsistency=true]
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to disable causal consistency</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;ClientSession&gt;&raquo;</span> promise that resolves to a MongoDB driver <code>ClientSession</code></li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Starts a <a href="https://www.mongodb.com/docs/manual/release-notes/3.6/#client-sessions">MongoDB session</a>
for benefits like causal consistency, <a href="https://www.mongodb.com/docs/manual/core/retryable-writes/">retryable writes</a>,
and <a href="https://thecodebarbarian.com/a-node-js-perspective-on-mongodb-4-transactions.html">transactions</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">let</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session });
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">remove</span>();
<span class="hljs-comment">// `doc` will always be null, even if reading from a replica set</span>
<span class="hljs-comment">// secondary. Without causal consistency, it is possible to</span>
<span class="hljs-comment">// get a doc back from the below query if the query reads from a</span>
<span class="hljs-comment">// secondary that is experiencing replication lag.</span>
doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session, <span class="hljs-attr">readPreference</span>: <span class="hljs-string">&#x27;secondary&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-syncIndexes"><a href="#connection_Connection-syncIndexes">Connection.prototype.syncIndexes</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.continueOnError]
<span class="method-type">&laquo;Boolean&raquo;</span> <code>false</code> by default. If set to <code>true</code>, mongoose will not throw an error if one model syncing failed, and will return an object where the keys are the names of the models, and the values are the results/errors for each model.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;Object&gt;&raquo;</span> Returns a Promise, when the Promise resolves the value is a list of the dropped indexes.</li></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Syncs all the indexes for the models registered with this connection.</p>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-transaction"><a href="#connection_Connection-transaction">Connection.prototype.transaction()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> Function to execute in a transaction</p>
</li><li class="param">[options]
<span class="method-type">&laquo;[object Object]&raquo;</span> Optional settings for the transaction</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;Any&gt;&raquo;</span> promise that is fulfilled if Mongoose successfully committed the transaction, or rejects if the transaction was aborted or if Mongoose failed to commit the transaction. If fulfilled, the promise resolves to a MongoDB command result.</li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Executes the wrapped async function
in a transaction. Mongoose will commit the transaction if the
async function executes successfully and attempt to retry if
there was a retriable error.</p>
<p>Calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/ClientSession.html#withTransaction"><code>session.withTransaction()</code></a>,
but also handles resetting Mongoose document state as shown below.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Will Riker&#x27;</span> });
<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">transaction</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setRank</span>(<span class="hljs-params">session</span>) {
  doc.<span class="hljs-property">rank</span> = <span class="hljs-string">&#x27;Captain&#x27;</span>;
  <span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>({ session });
  doc.<span class="hljs-property">isNew</span>; <span class="hljs-comment">// false</span>

  <span class="hljs-comment">// Throw an error to abort the transaction</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Oops!&#x27;</span>);
},{ <span class="hljs-attr">readPreference</span>: <span class="hljs-string">&#x27;primary&#x27;</span> }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {});

<span class="hljs-comment">// true, `transaction()` reset the document&#x27;s state because the</span>
<span class="hljs-comment">// transaction was aborted.</span>
doc.<span class="hljs-property">isNew</span>;
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-useDb"><a href="#connection_Connection-useDb">Connection.prototype.useDb()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> The database name</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.useCache=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, cache results so calling <code>useDb()</code> multiple times with the same name only creates 1 connection object.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.noListener=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, the connection object will not make the db listen to events on the original connection. See <a href="https://github.com/Automattic/mongoose/issues/9961">issue #9961</a>.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> New Connection Object</li></ul><div><p>Switches to a different database using the same connection pool.</p>
<p>Returns a new connection object, with the new db.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Connect to `initialdb` first</span>
<span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/initialdb&#x27;</span>).<span class="hljs-title function_">asPromise</span>();

<span class="hljs-comment">// Creates an un-cached connection to `mydb`</span>
<span class="hljs-keyword">const</span> db = conn.<span class="hljs-title function_">useDb</span>(<span class="hljs-string">&#x27;mydb&#x27;</span>);
<span class="hljs-comment">// Creates a cached connection to `mydb2`. All calls to `conn.useDb(&#x27;mydb2&#x27;, { useCache: true })` will return the same</span>
<span class="hljs-comment">// connection instance as opposed to creating a new connection instance</span>
<span class="hljs-keyword">const</span> db2 = conn.<span class="hljs-title function_">useDb</span>(<span class="hljs-string">&#x27;mydb2&#x27;</span>, { <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-user"><a href="#connection_Connection-user">Connection.prototype.user</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The username specified in the URI</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://val:psw@127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">user</span>; <span class="hljs-comment">// &quot;val&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="connection_Connection-watch"><a href="#connection_Connection-watch">Connection.prototype.watch()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pipeline]
<span class="method-type">&laquo;Array&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> passed without changes to <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#watch">the MongoDB driver&#39;s <code>Db#watch()</code> function</a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ChangeStream&raquo;</span> mongoose-specific change stream wrapper, inherits from EventEmitter</li></ul><div><p>Watches the entire underlying database for changes. Similar to
<a href="/docs/api/model.html#model_Model-watch"><code>Model.watch()</code></a>.</p>
<p>This function does <strong>not</strong> trigger any middleware. In particular, it
does <strong>not</strong> trigger aggregate middleware.</p>
<p>The ChangeStream object is an event emitter that emits the following events:</p>
<ul>
<li>&#39;change&#39;: A change occurred, see below example</li>
<li>&#39;error&#39;: An unrecoverable error occurred. In particular, change streams currently error out if they lose connection to the replica set primary. Follow <a href="https://github.com/Automattic/mongoose/issues/6799">this GitHub issue</a> for updates.</li>
<li>&#39;end&#39;: Emitted if the underlying stream is closed</li>
<li>&#39;close&#39;: Emitted if the underlying stream is closed</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-keyword">const</span> changeStream = conn.<span class="hljs-title function_">watch</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));

<span class="hljs-comment">// Triggers a &#x27;change&#x27; event on the change stream.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> });
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/document.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Document"><a href="#Document">Document</a></h2></div><ul><li><a href="#document_Document-$assertPopulated">Document.prototype.$assertPopulated()</a></li><li><a href="#document_Document-$clone">Document.prototype.$clone()</a></li><li><a href="#document_Document-$errors">Document.prototype.$errors</a></li><li><a href="#document_Document-$getAllSubdocs">Document.prototype.$getAllSubdocs()</a></li><li><a href="#document_Document-$getPopulatedDocs">Document.prototype.$getPopulatedDocs()</a></li><li><a href="#document_Document-$ignore">Document.prototype.$ignore()</a></li><li><a href="#document_Document-$inc">Document.prototype.$inc()</a></li><li><a href="#document_Document-$init">Document.prototype.$init()</a></li><li><a href="#document_Document-$isDefault">Document.prototype.$isDefault()</a></li><li><a href="#document_Document-$isDeleted">Document.prototype.$isDeleted()</a></li><li><a href="#document_Document-$isEmpty">Document.prototype.$isEmpty()</a></li><li><a href="#document_Document-$isModified">Document.prototype.$isModified()</a></li><li><a href="#document_Document-$isNew">Document.prototype.$isNew</a></li><li><a href="#document_Document-$locals">Document.prototype.$locals</a></li><li><a href="#document_Document-$markValid">Document.prototype.$markValid()</a></li><li><a href="#document_Document-$op">Document.prototype.$op</a></li><li><a href="#document_Document-$parent">Document.prototype.$parent()</a></li><li><a href="#document_Document-$populated">Document.prototype.$populated()</a></li><li><a href="#document_Document-$session">Document.prototype.$session()</a></li><li><a href="#document_Document-$set">Document.prototype.$set()</a></li><li><a href="#document_Document-$timestamps">Document.prototype.$timestamps()</a></li><li><a href="#document_Document-$validate">Document.prototype.$validate()</a></li><li><a href="#document_Document-$where">Document.prototype.$where</a></li><li><a href="#document_Document-depopulate">Document.prototype.depopulate()</a></li><li><a href="#document_Document-directModifiedPaths">Document.prototype.directModifiedPaths()</a></li><li><a href="#document_Document-equals">Document.prototype.equals()</a></li><li><a href="#document_Document-errors">Document.prototype.errors</a></li><li><a href="#document_Document-get">Document.prototype.get()</a></li><li><a href="#document_Document-getChanges">Document.prototype.getChanges()</a></li><li><a href="#document_Document-id">Document.prototype.id</a></li><li><a href="#document_Document-init">Document.prototype.init()</a></li><li><a href="#document_Document-inspect">Document.prototype.inspect()</a></li><li><a href="#document_Document-invalidate">Document.prototype.invalidate()</a></li><li><a href="#document_Document-isDirectModified">Document.prototype.isDirectModified()</a></li><li><a href="#document_Document-isDirectSelected">Document.prototype.isDirectSelected()</a></li><li><a href="#document_Document-isInit">Document.prototype.isInit()</a></li><li><a href="#document_Document-isModified">Document.prototype.isModified()</a></li><li><a href="#document_Document-isNew">Document.prototype.isNew</a></li><li><a href="#document_Document-isSelected">Document.prototype.isSelected()</a></li><li><a href="#document_Document-markModified">Document.prototype.markModified()</a></li><li><a href="#document_Document-modifiedPaths">Document.prototype.modifiedPaths()</a></li><li><a href="#document_Document-overwrite">Document.prototype.overwrite()</a></li><li><a href="#document_Document-parent">Document.prototype.parent()</a></li><li><a href="#document_Document-populate">Document.prototype.populate()</a></li><li><a href="#document_Document-populated">Document.prototype.populated()</a></li><li><a href="#document_Document-replaceOne">Document.prototype.replaceOne()</a></li><li><a href="#document_Document-save">Document.prototype.save()</a></li><li><a href="#document_Document-schema">Document.prototype.schema</a></li><li><a href="#document_Document-set">Document.prototype.set()</a></li><li><a href="#document_Document-toJSON">Document.prototype.toJSON()</a></li><li><a href="#document_Document-toObject">Document.prototype.toObject()</a></li><li><a href="#document_Document-toString">Document.prototype.toString()</a></li><li><a href="#document_Document-unmarkModified">Document.prototype.unmarkModified()</a></li><li><a href="#document_Document-update">Document.prototype.update()</a></li><li><a href="#document_Document-updateOne">Document.prototype.updateOne()</a></li><li><a href="#document_Document-validate">Document.prototype.validate()</a></li><li><a href="#document_Document-validateSync">Document.prototype.validateSync()</a></li></ul><hr class="separate-api-elements"><h3 id="document_Document-$assertPopulated"><a href="#document_Document-$assertPopulated">Document.prototype.$assertPopulated()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Array[String]&raquo;</span> path or array of paths to check. <code>$assertPopulated</code> throws if any of the given paths is not populated.</p>
</li><li class="param">[values]
<span class="method-type">&laquo;Object&raquo;</span> optional values to <code>$set()</code>. Convenient if you want to manually populate a path and assert that the path was populated in 1 call.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Throws an error if a given path is not populated</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;author&#x27;</span>);

doc.$assertPopulated(<span class="hljs-string">&#x27;author&#x27;</span>); <span class="hljs-comment">// does not throw</span>
doc.$assertPopulated(<span class="hljs-string">&#x27;other path&#x27;</span>); <span class="hljs-comment">// throws an error</span>

<span class="hljs-comment">// Manually populate and assert in one call. The following does</span>
<span class="hljs-comment">// `doc.$set({ likes })` before asserting.</span>
doc.$assertPopulated(<span class="hljs-string">&#x27;likes&#x27;</span>, { likes });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$clone"><a href="#document_Document-$clone">Document.prototype.$clone()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> a copy of this document</li></ul><div><p>Returns a copy of this document with a deep clone of <code>_doc</code> and <code>$__</code>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$errors"><a href="#document_Document-$errors">Document.prototype.$errors</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Hash containing current validation $errors.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$getAllSubdocs"><a href="#document_Document-$getAllSubdocs">Document.prototype.$getAllSubdocs()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Get all subdocs (by bfs)</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$getPopulatedDocs"><a href="#document_Document-$getPopulatedDocs">Document.prototype.$getPopulatedDocs()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array[Document]&raquo;</span> array of populated documents. Empty array if there are no populated documents associated with this document.</li></ul><div><p>Gets all populated documents associated with this document.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$ignore"><a href="#document_Document-$ignore">Document.prototype.$ignore()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> the path to ignore</p>
</li></ul><div><p>Don&#39;t run validation on this path or persist changes to this path.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-property">foo</span> = <span class="hljs-literal">null</span>;
doc.$ignore(<span class="hljs-string">&#x27;foo&#x27;</span>);
doc.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// changes to foo will not be persisted and validators won&#x27;t be run</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$inc"><a href="#document_Document-$inc">Document.prototype.$inc()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Array&raquo;</span> path or paths to update</p>
</li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> increment <code>path</code> by this value</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Increments the numeric value at <code>path</code> by the given <code>val</code>.
When you call <code>save()</code> on this document, Mongoose will send a
<a href="https://www.mongodb.com/docs/manual/reference/operator/update/inc/"><code>$inc</code></a>
as opposed to a <code>$set</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">counter</span>: <span class="hljs-title class_">Number</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Test</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">counter</span>: <span class="hljs-number">0</span> });
doc.$inc(<span class="hljs-string">&#x27;counter&#x27;</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// Sends a `{ $inc: { counter: 2 } }` to MongoDB</span>
doc.<span class="hljs-property">counter</span>; <span class="hljs-comment">// 2</span>

doc.<span class="hljs-property">counter</span> += <span class="hljs-number">2</span>;
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// Sends a `{ $set: { counter: 2 } }` to MongoDB</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$init"><a href="#document_Document-$init">Document.prototype.$init()</a></h3><div><p>Alias for <a href="#document_Document-init"><code>.init</code></a></p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$isDefault"><a href="#document_Document-$isDefault">Document.prototype.$isDefault()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Checks if a path is set to its default.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">MyModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;test&#x27;</span>, { <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;Val &#x27;</span>} });
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModel</span>();
m.$isDefault(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$isDeleted"><a href="#document_Document-$isDeleted">Document.prototype.$isDeleted()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[val]
<span class="method-type">&laquo;Boolean&raquo;</span> optional, overrides whether mongoose thinks the doc is deleted</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean,Document&raquo;</span> whether mongoose thinks this doc is deleted.</li></ul><div><p>Getter/setter, determines whether the document was removed or not.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">remove</span>();
product.$isDeleted(); <span class="hljs-comment">// true</span>
product.<span class="hljs-title function_">remove</span>(); <span class="hljs-comment">// no-op, doesn&#x27;t send anything to the db</span>

product.$isDeleted(<span class="hljs-literal">false</span>);
product.$isDeleted(); <span class="hljs-comment">// false</span>
product.<span class="hljs-title function_">remove</span>(); <span class="hljs-comment">// will execute a remove against the db</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$isEmpty"><a href="#document_Document-$isEmpty">Document.prototype.$isEmpty()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Returns true if the given path is nullish or only contains empty objects.
Useful for determining whether this subdoc will get stripped out by the
<a href="/docs/guide.html#minimize">minimize option</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">nested</span>: { <span class="hljs-attr">foo</span>: <span class="hljs-title class_">String</span> } });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({});
doc.$isEmpty(<span class="hljs-string">&#x27;nested&#x27;</span>); <span class="hljs-comment">// true</span>
doc.<span class="hljs-property">nested</span>.$isEmpty(); <span class="hljs-comment">// true</span>

doc.<span class="hljs-property">nested</span>.<span class="hljs-property">foo</span> = <span class="hljs-string">&#x27;bar&#x27;</span>;
doc.$isEmpty(<span class="hljs-string">&#x27;nested&#x27;</span>); <span class="hljs-comment">// false</span>
doc.<span class="hljs-property">nested</span>.$isEmpty(); <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$isModified"><a href="#document_Document-$isModified">Document.prototype.$isModified()</a></h3><div><p>Alias of <a href="#document_Document-isModified"><code>.isModified</code></a></p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$isNew"><a href="#document_Document-$isNew">Document.prototype.$isNew</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Boolean flag specifying if the document is new. If you create a document
using <code>new</code>, this document will be considered &quot;new&quot;. <code>$isNew</code> is how
Mongoose determines whether <code>save()</code> should use <code>insertOne()</code> to create
a new document or <code>updateOne()</code> to update an existing document.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Smith&#x27;</span> });
user.<span class="hljs-property">$isNew</span>; <span class="hljs-comment">// true</span>

<span class="hljs-keyword">await</span> user.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// Sends an `insertOne` to MongoDB</span>
</code></pre>
<p>On the other hand, if you load an existing document from the database
using <code>findOne()</code> or another <a href="/docs/queries.html">query operation</a>,
<code>$isNew</code> will be false.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Smith&#x27;</span> });
user.<span class="hljs-property">$isNew</span>; <span class="hljs-comment">// false</span>
</code></pre>
<p>Mongoose sets <code>$isNew</code> to <code>false</code> immediately after <code>save()</code> succeeds.
That means Mongoose sets <code>$isNew</code> to false <strong>before</strong> <code>post(&#39;save&#39;)</code> hooks run.
In <code>post(&#39;save&#39;)</code> hooks, <code>$isNew</code> will be <code>false</code> if <code>save()</code> succeeded.</p>
<h4 id="example-2">
      <a href="#example-2">
        Example:
      </a>
    </h4>
<pre><code>userSchema.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$isNew</span>; <span class="hljs-comment">// false</span>
});
<span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Smith&#x27;</span> });
</code></pre>
<p>For subdocuments, <code>$isNew</code> is true if either the parent has <code>$isNew</code> set,
or if you create a new subdocument.</p>
<h4 id="example-3">
      <a href="#example-3">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Assume `Group` has a document array `users`</span>
<span class="hljs-keyword">const</span> group = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Group</span>.<span class="hljs-title function_">findOne</span>();
group.<span class="hljs-property">users</span>[<span class="hljs-number">0</span>].<span class="hljs-property">$isNew</span>; <span class="hljs-comment">// false</span>

group.<span class="hljs-property">users</span>.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Smith&#x27;</span> });
group.<span class="hljs-property">users</span>[<span class="hljs-number">1</span>].<span class="hljs-property">$isNew</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$locals"><a href="#document_Document-$locals">Document.prototype.$locals</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Empty object that you can use for storing properties on the document. This
is handy for passing data to middleware without conflicting with Mongoose
internals.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>schema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// Mongoose will set `isNew` to `false` if `save()` succeeds</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$locals</span>.<span class="hljs-property">wasNew</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">isNew</span>;
});

schema.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// Prints true if `isNew` was set before `save()`</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$locals</span>.<span class="hljs-property">wasNew</span>);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$markValid"><a href="#document_Document-$markValid">Document.prototype.$markValid()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> the field to mark as valid</p>
</li></ul><div><p>Marks a path as valid, removing existing validation errors.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$op"><a href="#document_Document-$op">Document.prototype.$op</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A string containing the current operation that Mongoose is executing
on this document. May be <code>null</code>, <code>&#39;save&#39;</code>, <code>&#39;validate&#39;</code>, or <code>&#39;remove&#39;</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> });
doc.<span class="hljs-property">$op</span>; <span class="hljs-comment">// null</span>

<span class="hljs-keyword">const</span> promise = doc.<span class="hljs-title function_">save</span>();
doc.<span class="hljs-property">$op</span>; <span class="hljs-comment">// &#x27;save&#x27;</span>

<span class="hljs-keyword">await</span> promise;
doc.<span class="hljs-property">$op</span>; <span class="hljs-comment">// null</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$parent"><a href="#document_Document-$parent">Document.prototype.$parent()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> </li></ul><div><p>Alias for <a href="#document_Document-parent"><code>parent()</code></a>. If this document is a subdocument or populated
document, returns the document&#39;s parent. Returns <code>undefined</code> otherwise.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$populated"><a href="#document_Document-$populated">Document.prototype.$populated()</a></h3><div><p>Alias of <a href="#document_Document-populated"><code>.populated</code></a>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$session"><a href="#document_Document-$session">Document.prototype.$session()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[session]
<span class="method-type">&laquo;ClientSession&raquo;</span> overwrite the current session</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ClientSession&raquo;</span> </li></ul><div><p>Getter/setter around the session associated with this document. Used to
automatically set <code>session</code> if you <code>save()</code> a doc that you got from a
query with an associated session.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> session = <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">session</span>(session);
doc.$session() === session; <span class="hljs-comment">// true</span>
doc.$session(<span class="hljs-literal">null</span>);
doc.$session() === <span class="hljs-literal">null</span>; <span class="hljs-comment">// true</span>
</code></pre>
<p>If this is a top-level document, setting the session propagates to all child
docs.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$set"><a href="#document_Document-$set">Document.prototype.$set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/vals to set</p>
</li><li class="param">val
<span class="method-type">&laquo;Any&raquo;</span> the value to set</p>
</li><li class="param">[type]
<span class="method-type">&laquo;Schema|String|Number|Buffer|[object Object]&raquo;</span> optionally specify a type for &quot;on-the-fly&quot; attributes</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optionally specify options that modify the behavior of the set</p>
</li><ul style="margin-top: 0.5em"><li>[options.merge=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, setting a <a href="/docs/subdocs.html#subdocuments-versus-nested-paths">nested path</a> will merge existing values rather than overwrite the whole object. So <code>doc.set(&#39;nested&#39;, { a: 1, b: 2 })</code> becomes <code>doc.set(&#39;nested.a&#39;, 1); doc.set(&#39;nested.b&#39;, 2);</code></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Alias for <code>set()</code>, used internally to avoid conflicts</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$timestamps"><a href="#document_Document-$timestamps">Document.prototype.$timestamps()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[value]
<span class="method-type">&laquo;Boolean&raquo;</span> overwrite the current session</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document,boolean,undefined,void&raquo;</span> When used as a getter (no argument), a boolean will be returned indicating the timestamps option state or if unset &quot;undefined&quot; will be used, otherwise will return &quot;this&quot;</li></ul><div><p>Getter/setter around whether this document will apply timestamps by
default when using <code>save()</code> and <code>bulkSave()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">TestModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">true</span> }));
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestModel</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Smith&#x27;</span> });

doc.$timestamps(); <span class="hljs-comment">// true</span>

doc.$timestamps(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// Does **not** apply timestamps</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-$validate"><a href="#document_Document-$validate">Document.prototype.$validate()</a></h3><div><p>Alias of <a href="#document_Document-validate"><code>.validate</code></a></p>
</div><hr class="separate-api-elements"><h3 id="document_Document-$where"><a href="#document_Document-$where">Document.prototype.$where</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Set this property to add additional query filters when Mongoose saves this document and <code>isNew</code> is false.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make sure `save()` never updates a soft deleted document.</span>
schema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;save&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$where</span> = { <span class="hljs-attr">isDeleted</span>: <span class="hljs-literal">false</span> };
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-depopulate"><a href="#document_Document-depopulate">Document.prototype.depopulate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String|Array[String]&raquo;</span> Specific Path to depopulate. If unset, will depopulate all paths on the Document. Or multiple space-delimited paths.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Takes a populated field and returns it to its unpopulated state.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;author&#x27;</span>).<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, doc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">author</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// Dr.Seuss</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-title function_">depopulate</span>(<span class="hljs-string">&#x27;author&#x27;</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">author</span>); <span class="hljs-comment">// &#x27;5144cf8050f071d979c118a7&#x27;</span>
})
</code></pre>
<p>If the path was not provided, then all populated fields are returned to their unpopulated state.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-directModifiedPaths"><a href="#document_Document-directModifiedPaths">Document.prototype.directModifiedPaths()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array[String]&raquo;</span> </li></ul><div><p>Returns the list of paths that have been directly modified. A direct
modified path is a path that you explicitly set, whether via <code>doc.foo = &#39;bar&#39;</code>,
<code>Object.assign(doc, { foo: &#39;bar&#39; })</code>, or <code>doc.set(&#39;foo&#39;, &#39;bar&#39;)</code>.</p>
<p>A path <code>a</code> may be in <code>modifiedPaths()</code> but not in <code>directModifiedPaths()</code>
because a child of <code>a</code> was directly modified.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">nested</span>: { <span class="hljs-attr">bar</span>: <span class="hljs-title class_">String</span> } });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;original&#x27;</span>, <span class="hljs-attr">nested</span>: { <span class="hljs-attr">bar</span>: <span class="hljs-string">&#x27;original&#x27;</span> } });

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>();
doc.<span class="hljs-property">nested</span>.<span class="hljs-property">bar</span> = <span class="hljs-string">&#x27;modified&#x27;</span>;
doc.<span class="hljs-title function_">directModifiedPaths</span>(); <span class="hljs-comment">// [&#x27;nested.bar&#x27;]</span>
doc.<span class="hljs-title function_">modifiedPaths</span>(); <span class="hljs-comment">// [&#x27;nested&#x27;, &#x27;nested.bar&#x27;]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-equals"><a href="#document_Document-equals">Document.prototype.equals()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[doc]
<span class="method-type">&laquo;Document&raquo;</span> a document to compare. If falsy, will always return &quot;false&quot;.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Returns true if this document is equal to another document.</p>
<p>Documents are considered equal when they have matching <code>_id</code>s, unless neither
document has an <code>_id</code>, in which case this function falls back to using
<code>deepEqual()</code>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-errors"><a href="#document_Document-errors">Document.prototype.errors</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Hash containing current validation errors.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-get"><a href="#document_Document-get">Document.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[type]
<span class="method-type">&laquo;Schema|String|Number|Buffer|[object Object]&raquo;</span> optionally specify a type for on-the-fly attributes</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.virtuals=false]
<span class="method-type">&laquo;Boolean&raquo;</span> Apply virtuals before getting this path</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.getters=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If false, skip applying getters and just get the raw value</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> </li></ul><div><p>Returns the value of a path.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// path</span>
doc.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;age&#x27;</span>) <span class="hljs-comment">// 47</span>

<span class="hljs-comment">// dynamic casting to a string</span>
doc.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-title class_">String</span>) <span class="hljs-comment">// &quot;47&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-getChanges"><a href="#document_Document-getChanges">Document.prototype.getChanges()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Returns the changes that happened to the document
in the format that will be sent to MongoDB.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>,
  <span class="hljs-attr">country</span>: <span class="hljs-title class_">String</span>
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, userSchema);
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Hafez&#x27;</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">country</span>: <span class="hljs-string">&#x27;Egypt&#x27;</span>
});

<span class="hljs-comment">// returns an empty object, no changes happened yet</span>
user.<span class="hljs-title function_">getChanges</span>(); <span class="hljs-comment">// { }</span>

user.<span class="hljs-property">country</span> = <span class="hljs-literal">undefined</span>;
user.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>;

user.<span class="hljs-title function_">getChanges</span>(); <span class="hljs-comment">// { $set: { age: 26 }, { $unset: { country: 1 } } }</span>

<span class="hljs-keyword">await</span> user.<span class="hljs-title function_">save</span>();

user.<span class="hljs-title function_">getChanges</span>(); <span class="hljs-comment">// { }</span>
</code></pre>
<p>Modifying the object that <code>getChanges()</code> returns does not affect the document&#39;s
change tracking state. Even if you <code>delete user.getChanges().$set</code>, Mongoose
will still send a <code>$set</code> to the server.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-id"><a href="#document_Document-id">Document.prototype.id</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The string version of this documents _id.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This getter exists on all documents by default. The getter can be disabled by setting the <code>id</code> <a href="/docs/guide.html#id">option</a> of its <code>Schema</code> to false at construction time.</p>
<pre><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-literal">false</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-init"><a href="#document_Document-init">Document.prototype.init()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> document returned by mongo</p>
</li><li class="param">[opts]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Initializes the document without setters or marking anything modified.</p>
<p>Called internally after a document is returned from mongodb. Normally,
you do <strong>not</strong> need to call this function on your own.</p>
<p>This function triggers <code>init</code> <a href="/docs/middleware.html">middleware</a>.
Note that <code>init</code> hooks are <a href="/docs/middleware.html#synchronous">synchronous</a>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-inspect"><a href="#document_Document-inspect">Document.prototype.inspect()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Helper for console.log</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-invalidate"><a href="#document_Document-invalidate">Document.prototype.invalidate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> the field to invalidate. For array elements, use the <code>array.i.field</code> syntax, where <code>i</code> is the 0-based index in the array.</p>
</li><li class="param">err
<span class="method-type">&laquo;String|Error&raquo;</span> the error which states the reason <code>path</code> was invalid</p>
</li><li class="param">val
<span class="method-type">&laquo;Object|String|Number|any&raquo;</span> optional invalid value</p>
</li><li class="param">[kind]
<span class="method-type">&laquo;String&raquo;</span> optional <code>kind</code> property for the error</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ValidationError&raquo;</span> the current ValidationError, with all currently invalidated paths</li></ul><div><p>Marks a path as invalid, causing validation to fail.</p>
<p>The <code>errorMsg</code> argument will become the message of the <code>ValidationError</code>.</p>
<p>The <code>value</code> argument (if passed) will be available through the <code>ValidationError.value</code> property.</p>
<pre><code>doc.<span class="hljs-title function_">invalidate</span>(<span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;must be less than 20&#x27;</span>, <span class="hljs-number">14</span>);

doc.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
  <span class="hljs-comment">// prints</span>
  { <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Validation failed&#x27;</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ValidationError&#x27;</span>,
    <span class="hljs-attr">errors</span>:
     { <span class="hljs-attr">size</span>:
        { <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;must be less than 20&#x27;</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ValidatorError&#x27;</span>,
          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;size&#x27;</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;user defined&#x27;</span>,
          <span class="hljs-attr">value</span>: <span class="hljs-number">14</span> } } }
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-isDirectModified"><a href="#document_Document-isDirectModified">Document.prototype.isDirectModified()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String|Array[String]&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Returns true if <code>path</code> was directly set and modified, else false.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;documents.0.title&#x27;</span>, <span class="hljs-string">&#x27;changed&#x27;</span>);
doc.<span class="hljs-title function_">isDirectModified</span>(<span class="hljs-string">&#x27;documents.0.title&#x27;</span>) <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isDirectModified</span>(<span class="hljs-string">&#x27;documents&#x27;</span>) <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-isDirectSelected"><a href="#document_Document-isDirectSelected">Document.prototype.isDirectSelected()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Checks if <code>path</code> was explicitly selected. If no projection, always returns
true.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;nested.name&#x27;</span>).<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, doc</span>) {
   doc.<span class="hljs-title function_">isDirectSelected</span>(<span class="hljs-string">&#x27;nested.name&#x27;</span>) <span class="hljs-comment">// true</span>
   doc.<span class="hljs-title function_">isDirectSelected</span>(<span class="hljs-string">&#x27;nested.otherName&#x27;</span>) <span class="hljs-comment">// false</span>
   doc.<span class="hljs-title function_">isDirectSelected</span>(<span class="hljs-string">&#x27;nested&#x27;</span>)  <span class="hljs-comment">// false</span>
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-isInit"><a href="#document_Document-isInit">Document.prototype.isInit()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Checks if <code>path</code> is in the <code>init</code> state, that is, it was set by <code>Document#init()</code> and not modified since.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-isModified"><a href="#document_Document-isModified">Document.prototype.isModified()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> optional</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.ignoreAtomics=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, doesn&#39;t return true if path is underneath an array that was modified with atomic operations like <code>push()</code></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Returns true if any of the given paths is modified, else false. If no arguments, returns <code>true</code> if any path
in this document is modified.</p>
<p>If <code>path</code> is given, checks if a path or any full path containing <code>path</code> as part of its path chain has been modified.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;documents.0.title&#x27;</span>, <span class="hljs-string">&#x27;changed&#x27;</span>);
doc.<span class="hljs-title function_">isModified</span>()                      <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isModified</span>(<span class="hljs-string">&#x27;documents&#x27;</span>)           <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isModified</span>(<span class="hljs-string">&#x27;documents.0.title&#x27;</span>)   <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isModified</span>(<span class="hljs-string">&#x27;documents otherProp&#x27;</span>) <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isDirectModified</span>(<span class="hljs-string">&#x27;documents&#x27;</span>)     <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-isNew"><a href="#document_Document-isNew">Document.prototype.isNew</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Legacy alias for <code>$isNew</code>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-isSelected"><a href="#document_Document-isSelected">Document.prototype.isSelected()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Array[String]&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Checks if <code>path</code> was selected in the source query which initialized this document.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;name&#x27;</span>);
doc.<span class="hljs-title function_">isSelected</span>(<span class="hljs-string">&#x27;name&#x27;</span>) <span class="hljs-comment">// true</span>
doc.<span class="hljs-title function_">isSelected</span>(<span class="hljs-string">&#x27;age&#x27;</span>)  <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-markModified"><a href="#document_Document-markModified">Document.prototype.markModified()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> the path to mark modified</p>
</li><li class="param">[scope]
<span class="method-type">&laquo;Document&raquo;</span> the scope to run validators with</p>
</li></ul><div><p>Marks the path as having pending changes to write to the db.</p>
<p><em>Very helpful when using <a href="https://mongoosejs.com/docs/schematypes.html#mixed">Mixed</a> types.</em></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-property">mixed</span>.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;changed&#x27;</span>;
doc.<span class="hljs-title function_">markModified</span>(<span class="hljs-string">&#x27;mixed.type&#x27;</span>);
doc.<span class="hljs-title function_">save</span>() <span class="hljs-comment">// changes to mixed.type are now persisted</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-modifiedPaths"><a href="#document_Document-modifiedPaths">Document.prototype.modifiedPaths()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.includeChildren=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns children of modified paths as well. For example, if false, the list of modified paths for <code>doc.colors = { primary: &#39;blue&#39; };</code> will <strong>not</strong> contain <code>colors.primary</code>. If true, <code>modifiedPaths()</code> will return an array that contains <code>colors.primary</code>.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array[String]&raquo;</span> </li></ul><div><p>Returns the list of paths that have been modified.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-overwrite"><a href="#document_Document-overwrite">Document.prototype.overwrite()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> the object to overwrite this document with</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Overwrite all values in this document with the values of <code>obj</code>, except
for immutable properties. Behaves similarly to <code>set()</code>, except for it
unsets all properties that aren&#39;t in <code>obj</code>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-parent"><a href="#document_Document-parent">Document.prototype.parent()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> </li></ul><div><p>If this document is a subdocument or populated document, returns the document&#39;s
parent. Returns the original document if there is no parent.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-populate"><a href="#document_Document-populate">Document.prototype.populate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object|Array&raquo;</span> either the path to populate or an object specifying all parameters, or either an array of those</p>
</li><li class="param">[select]
<span class="method-type">&laquo;Object|String&raquo;</span> Field selection for the population query</p>
</li><li class="param">[model]
<span class="method-type">&laquo;Model&raquo;</span> The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema&#39;s <code>ref</code> field.</p>
</li><li class="param">[match]
<span class="method-type">&laquo;Object&raquo;</span> Conditions for the population query</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options for the population query (sort, etc)</p>
</li><ul style="margin-top: 0.5em"><li>[options.path=null]
<span class="method-type">&laquo;String&raquo;</span> The path to populate.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.populate=null]
<span class="method-type">&laquo;string|PopulateOptions&raquo;</span> Recursively populate paths in the populated documents. See <a href="/docs/populate.html#deep-populate">deep populate docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.retainNullValues=false]
<span class="method-type">&laquo;boolean&raquo;</span> by default, Mongoose removes null and undefined values from populated arrays. Use this option to make <code>populate()</code> retain <code>null</code> and <code>undefined</code> array entries.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.getters=false]
<span class="method-type">&laquo;boolean&raquo;</span> if true, Mongoose will call any getters defined on the <code>localField</code>. By default, Mongoose gets the raw value of <code>localField</code>. For example, you would need to set this option to <code>true</code> if you wanted to <a href="/docs/schematypes.html#schematype-options">add a <code>lowercase</code> getter to your <code>localField</code></a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=false]
<span class="method-type">&laquo;boolean&raquo;</span> When you do <code>BlogPost.find().populate(&#39;author&#39;)</code>, blog posts with the same author will share 1 copy of an <code>author</code> doc. Enable this option to make Mongoose clone populated docs before assigning them.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.match=null]
<span class="method-type">&laquo;Object|Function&raquo;</span> Add an additional filter to the populate query. Can be a filter object containing <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/">MongoDB query syntax</a>, or a function that returns a filter object.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.transform=null]
<span class="method-type">&laquo;Function&raquo;</span> Function that Mongoose will call on every populated document that allows you to transform the populated document.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.options=null]
<span class="method-type">&laquo;Object&raquo;</span> Additional options like <code>limit</code> and <code>lean</code>.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> Callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,null&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Populates paths on an existing document.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Given a document, `populate()` lets you pull in referenced docs</span>
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">populate</span>([
  <span class="hljs-string">&#x27;stories&#x27;</span>,
  { <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;fans&#x27;</span>, <span class="hljs-attr">sort</span>: { <span class="hljs-attr">name</span>: -<span class="hljs-number">1</span> } }
]);
doc.<span class="hljs-title function_">populated</span>(<span class="hljs-string">&#x27;stories&#x27;</span>); <span class="hljs-comment">// Array of ObjectIds</span>
doc.<span class="hljs-property">stories</span>[<span class="hljs-number">0</span>].<span class="hljs-property">title</span>; <span class="hljs-comment">// &#x27;Casino Royale&#x27;</span>
doc.<span class="hljs-title function_">populated</span>(<span class="hljs-string">&#x27;fans&#x27;</span>); <span class="hljs-comment">// Array of ObjectIds</span>

<span class="hljs-comment">// If the referenced doc has been deleted, `populate()` will</span>
<span class="hljs-comment">// remove that entry from the array.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Story</span>.<span class="hljs-title function_">delete</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Casino Royale&#x27;</span> });
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;stories&#x27;</span>); <span class="hljs-comment">// Empty array</span>

<span class="hljs-comment">// You can also pass additional query options to `populate()`,</span>
<span class="hljs-comment">// like projections:</span>
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;fans&#x27;</span>, <span class="hljs-string">&#x27;-email&#x27;</span>);
doc.<span class="hljs-property">fans</span>[<span class="hljs-number">0</span>].<span class="hljs-property">email</span> <span class="hljs-comment">// undefined because of 2nd param `select`</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-populated"><a href="#document_Document-populated">Document.prototype.populated()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[val]
<span class="method-type">&laquo;Any&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array,ObjectId,Number,Buffer,String,undefined,void&raquo;</span> </li></ul><div><p>Gets _id(s) used during population of the given <code>path</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;author&#x27;</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">author</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// Dr.Seuss</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-title function_">populated</span>(<span class="hljs-string">&#x27;author&#x27;</span>)); <span class="hljs-comment">// &#x27;5144cf8050f071d979c118a7&#x27;</span>
</code></pre>
<p>If the path was not populated, returns <code>undefined</code>.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-replaceOne"><a href="#document_Document-replaceOne">Document.prototype.replaceOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Sends a replaceOne command with this document <code>_id</code> as the query selector.</p>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options:
      </a>
    </h4>
<ul>
<li>same as in <a href="https://mongoosejs.com/docs/api/model.html#model_Model-replaceOne">Model.replaceOne</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="document_Document-save"><a href="#document_Document-save">Document.prototype.save()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> options optional options</p>
</li><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;Session&raquo;</span> the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a> associated with this save operation. If not specified, defaults to the <a href="#document_Document-$session">document&#39;s associated session</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.safe]
<span class="method-type">&laquo;Object&raquo;</span> (DEPRECATED) overrides <a href="https://mongoosejs.com//docs/guide.html#safe">schema&#39;s safe option</a>. Use the <code>w</code> option instead.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.validateBeforeSave]
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to save without validating.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>true</code>, Mongoose will only validate modified paths, as opposed to modified paths and <code>required</code> paths.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.w]
<span class="method-type">&laquo;Number|String&raquo;</span> set the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#w-option">write concern</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.j]
<span class="method-type">&laquo;Boolean&raquo;</span> set to true for MongoDB to wait until this <code>save()</code> has been <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#j-option">journaled before resolving the returned promise</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.wtimeout]
<span class="method-type">&laquo;Number&raquo;</span> sets a <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout">timeout for the write concern</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.checkKeys=true]
<span class="method-type">&laquo;Boolean&raquo;</span> the MongoDB driver prevents you from saving keys that start with &#39;$&#39; or contain &#39;.&#39; by default. Set this option to <code>false</code> to skip that check. See <a href="https://www.mongodb.com/docs/manual/reference/limits/#Restrictions-on-Field-Names">restrictions on field names</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>false</code> and <a href="/docs/guide.html#timestamps">timestamps</a> are enabled, skip timestamps for this <code>save()</code>.</p>
</li></ul><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> Returns undefined if used with callback or a Promise otherwise.</li></ul><div><p>Saves this document by inserting a new document into the database if <a href="#document_Document-isNew">document.isNew</a> is <code>true</code>,
or sends an <a href="#document_Document-updateOne">updateOne</a> operation <strong>only</strong> with the modifications to the database, it does not replace the whole document in the latter case.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>product.<span class="hljs-property">sold</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
product = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">save</span>();
</code></pre>
<p>If save is successful, the returned promise will fulfill with the document
saved.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> newProduct = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">save</span>();
newProduct === product; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-schema"><a href="#document_Document-schema">Document.prototype.schema</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The document&#39;s schema.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-set"><a href="#document_Document-set">Document.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/vals to set</p>
</li><li class="param">val
<span class="method-type">&laquo;Any&raquo;</span> the value to set</p>
</li><li class="param">[type]
<span class="method-type">&laquo;Schema|String|Number|Buffer|[object Object]&raquo;</span> optionally specify a type for &quot;on-the-fly&quot; attributes</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optionally specify options that modify the behavior of the set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> this</li></ul><div><p>Sets the value of a path, or many paths.
Alias for <a href="#document_Document-$set"><code>.$set</code></a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// path, value</span>
doc.<span class="hljs-title function_">set</span>(path, value)

<span class="hljs-comment">// object</span>
doc.<span class="hljs-title function_">set</span>({
    path  : value
  , path2 : {
       path  : value
    }
})

<span class="hljs-comment">// on-the-fly cast to number</span>
doc.<span class="hljs-title function_">set</span>(path, value, <span class="hljs-title class_">Number</span>)

<span class="hljs-comment">// on-the-fly cast to string</span>
doc.<span class="hljs-title function_">set</span>(path, value, <span class="hljs-title class_">String</span>)

<span class="hljs-comment">// changing strict mode behavior</span>
doc.<span class="hljs-title function_">set</span>(path, value, { <span class="hljs-attr">strict</span>: <span class="hljs-literal">false</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-toJSON"><a href="#document_Document-toJSON">Document.prototype.toJSON()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.flattenMaps=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, convert Maps to <a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJOs</a>. Useful if you want to <code>JSON.stringify()</code> the result.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>The return value of this method is used in calls to <a href="https://thecodebarbarian.com/the-80-20-guide-to-json-stringify-in-javascript#the-tojson-function"><code>JSON.stringify(doc)</code></a>.</p>
<p>This method accepts the same options as <a href="#document_Document-toObject">Document#toObject</a>. To apply the options to every document of your schema by default, set your <a href="#schema_Schema">schemas</a> <code>toJSON</code> option to the same argument.</p>
<pre><code>schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;toJSON&#x27;</span>, { <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> });
</code></pre>
<p>There is one difference between <code>toJSON()</code> and <code>toObject()</code> options.
When you call <code>toJSON()</code>, the <a href="./document.html#document_Document-toObject"><code>flattenMaps</code> option</a> defaults to <code>true</code>, because <code>JSON.stringify()</code> doesn&#39;t convert maps to objects by default.
When you call <code>toObject()</code>, the <code>flattenMaps</code> option is <code>false</code> by default.</p>
<p>See <a href="/docs/guide.html#toJSON">schema options</a> for more information on setting <code>toJSON</code> option defaults.</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-toObject"><a href="#document_Document-toObject">Document.prototype.toObject()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.getters=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, apply all getters, including virtuals</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.virtuals=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, apply virtuals, including aliases. Use <code>{ getters: true, virtuals: false }</code> to just apply getters, not virtuals</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.aliases=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>options.virtuals = true</code>, you can set <code>options.aliases = false</code> to skip applying aliases. This option is a no-op if <code>options.virtuals = false</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.minimize=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, omit any empty objects from the output</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.transform=null]
<span class="method-type">&laquo;Function|null&raquo;</span> if set, mongoose will call this function to allow you to transform the returned object</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.depopulate=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, replace any conventionally populated paths with the original id in the output. Has no affect on virtual populated paths.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.versionKey=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if false, exclude the version key (<code>__v</code> by default) from the output</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.flattenMaps=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, convert Maps to POJOs. Useful if you want to <code>JSON.stringify()</code> the result of <code>toObject()</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.useProjection=false]
<span class="method-type">&laquo;Boolean&raquo;</span> <ul>
<li>If true, omits fields that are excluded in this document&#39;s projection. Unless you specified a projection, this will omit any field that has <code>select: false</code> in the schema.</li>
</ul>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> js object (not a POJO)</li></ul><div><p>Converts this document into a plain-old JavaScript object (<a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a>).</p>
<p>Buffers are converted to instances of <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Binary.html">mongodb.Binary</a> for proper storage.</p>
<h4 id="gettersvirtuals">
      <a href="#gettersvirtuals">
        Getters/Virtuals
      </a>
    </h4>
<p>Example of only applying path getters</p>
<pre><code>doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">getters</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">false</span> })
</code></pre>
<p>Example of only applying virtual getters</p>
<pre><code>doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>Example of applying both path and virtual getters</p>
<pre><code>doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">getters</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>To apply these options to every document of your schema by default, set your <a href="#schema_Schema">schemas</a> <code>toObject</code> option to the same argument.</p>
<pre><code>schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;toObject&#x27;</span>, { <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h4 id="transform">
      <a href="#transform">
        Transform:
      </a>
    </h4>
<p>We may need to perform a transformation of the resulting object based on some criteria, say to remove some sensitive information or return a custom object. In this case we set the optional <code>transform</code> function.</p>
<p>Transform functions receive three arguments</p>
<pre><code><span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) {}
</code></pre>
<ul>
<li><code>doc</code> The mongoose document which is being converted</li>
<li><code>ret</code> The plain object representation which has been converted</li>
<li><code>options</code> The options in use (either schema options or the options passed inline)</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// specify the transform schema option</span>
<span class="hljs-keyword">if</span> (!schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>) schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span> = {};
schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>.<span class="hljs-property">transform</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) {
  <span class="hljs-comment">// remove the _id of every document before returning the result</span>
  <span class="hljs-keyword">delete</span> ret.<span class="hljs-property">_id</span>;
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">// without the transformation in the schema</span>
doc.<span class="hljs-title function_">toObject</span>(); <span class="hljs-comment">// { _id: &#x27;anId&#x27;, name: &#x27;Wreck-it Ralph&#x27; }</span>

<span class="hljs-comment">// with the transformation</span>
doc.<span class="hljs-title function_">toObject</span>(); <span class="hljs-comment">// { name: &#x27;Wreck-it Ralph&#x27; }</span>
</code></pre>
<p>With transformations we can do a lot more than remove properties. We can even return completely new customized objects:</p>
<pre><code><span class="hljs-keyword">if</span> (!schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>) schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span> = {};
schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>.<span class="hljs-property">transform</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">movie</span>: ret.<span class="hljs-property">name</span> }
}

<span class="hljs-comment">// without the transformation in the schema</span>
doc.<span class="hljs-title function_">toObject</span>(); <span class="hljs-comment">// { _id: &#x27;anId&#x27;, name: &#x27;Wreck-it Ralph&#x27; }</span>

<span class="hljs-comment">// with the transformation</span>
doc.<span class="hljs-title function_">toObject</span>(); <span class="hljs-comment">// { movie: &#x27;Wreck-it Ralph&#x27; }</span>
</code></pre>
<p><em>Note: if a transform function returns <code>undefined</code>, the return value will be ignored.</em></p>
<p>Transformations may also be applied inline, overridding any transform set in the options:</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">xform</span> (doc, ret, options) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">inline</span>: ret.<span class="hljs-property">name</span>, <span class="hljs-attr">custom</span>: <span class="hljs-literal">true</span> }
}

<span class="hljs-comment">// pass the transform as an inline option</span>
doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">transform</span>: xform }); <span class="hljs-comment">// { inline: &#x27;Wreck-it Ralph&#x27;, custom: true }</span>
</code></pre>
<p>If you want to skip transformations, use <code>transform: false</code>:</p>
<pre><code>schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>.<span class="hljs-property">hide</span> = <span class="hljs-string">&#x27;_id&#x27;</span>;
schema.<span class="hljs-property">options</span>.<span class="hljs-property">toObject</span>.<span class="hljs-property">transform</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) {
  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">hide</span>) {
    options.<span class="hljs-property">hide</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">prop</span>) {
      <span class="hljs-keyword">delete</span> ret[prop];
    });
  }
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Doc</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-string">&#x27;anId&#x27;</span>, <span class="hljs-attr">secret</span>: <span class="hljs-number">47</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Wreck-it Ralph&#x27;</span> });
doc.<span class="hljs-title function_">toObject</span>();                                        <span class="hljs-comment">// { secret: 47, name: &#x27;Wreck-it Ralph&#x27; }</span>
doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">hide</span>: <span class="hljs-string">&#x27;secret _id&#x27;</span>, <span class="hljs-attr">transform</span>: <span class="hljs-literal">false</span> });<span class="hljs-comment">// { _id: &#x27;anId&#x27;, secret: 47, name: &#x27;Wreck-it Ralph&#x27; }</span>
doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">hide</span>: <span class="hljs-string">&#x27;secret _id&#x27;</span>, <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// { name: &#x27;Wreck-it Ralph&#x27; }</span>
</code></pre>
<p>If you pass a transform in <code>toObject()</code> options, Mongoose will apply the transform
to <a href="/docs/subdocs.html">subdocuments</a> in addition to the top-level document.
Similarly, <code>transform: false</code> skips transforms for all subdocuments.
Note that this behavior is different for transforms defined in the schema:
if you define a transform in <code>schema.options.toObject.transform</code>, that transform
will <strong>not</strong> apply to subdocuments.</p>
<pre><code><span class="hljs-keyword">const</span> memberSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">email</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">const</span> groupSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">members</span>: [memberSchema], <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, email });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Group</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Group&#x27;</span>, groupSchema);

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Group</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Engineering&#x27;</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;dev@mongoosejs.io&#x27;</span>,
  <span class="hljs-attr">members</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Val&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;val@mongoosejs.io&#x27;</span> }]
});

<span class="hljs-comment">// Removes `email` from both top-level document **and** array elements</span>
<span class="hljs-comment">// { name: &#x27;Engineering&#x27;, members: [{ name: &#x27;Val&#x27; }] }</span>
doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params">doc, ret</span>) =&gt;</span> { <span class="hljs-keyword">delete</span> ret.<span class="hljs-property">email</span>; <span class="hljs-keyword">return</span> ret; } });
</code></pre>
<p>Transforms, like all of these options, are also available for <code>toJSON</code>. See <a href="https://thecodebarbarian.com/the-80-20-guide-to-json-stringify-in-javascript.html">this guide to <code>JSON.stringify()</code></a> to learn why <code>toJSON()</code> and <code>toObject()</code> are separate functions.</p>
<p>See <a href="/docs/guide.html#toObject">schema options</a> for some more details.</p>
<p><em>During save, no custom options are applied to the document before being sent to the database.</em></p>
</div><hr class="separate-api-elements"><h3 id="document_Document-toString"><a href="#document_Document-toString">Document.prototype.toString()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Helper for console.log</p>
</div><hr class="separate-api-elements"><h3 id="document_Document-unmarkModified"><a href="#document_Document-unmarkModified">Document.prototype.unmarkModified()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> the path to unmark modified</p>
</li></ul><div><p>Clears the modified state on the specified path.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-property">foo</span> = <span class="hljs-string">&#x27;bar&#x27;</span>;
doc.<span class="hljs-title function_">unmarkModified</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);
doc.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// changes to foo will not be persisted</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-update"><a href="#document_Document-update">Document.prototype.update()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">...ops
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sends an update command with this document <code>_id</code> as the query selector.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>weirdCar.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">wheels</span>:<span class="hljs-number">1</span> } }, { <span class="hljs-attr">w</span>: <span class="hljs-number">1</span> }, callback);
</code></pre>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options:
      </a>
    </h4>
<ul>
<li>same as in <a href="#model_Model-update">Model.update</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="document_Document-updateOne"><a href="#document_Document-updateOne">Document.prototype.updateOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="/docs/api/query.html#query_Query-lean"><code>Query.lean()</code></a> and the <a href="/docs/tutorials/lean.html">Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Sends an updateOne command with this document <code>_id</code> as the query selector.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>weirdCar.<span class="hljs-title function_">updateOne</span>({<span class="hljs-attr">$inc</span>: {<span class="hljs-attr">wheels</span>:<span class="hljs-number">1</span>}}, { <span class="hljs-attr">w</span>: <span class="hljs-number">1</span> }, callback);
</code></pre>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options:
      </a>
    </h4>
<ul>
<li>same as in <a href="#model_Model-updateOne">Model.updateOne</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="document_Document-validate"><a href="#document_Document-validate">Document.prototype.validate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pathsToValidate]
<span class="method-type">&laquo;Array|String&raquo;</span> list of paths to validate. If set, Mongoose will validate only the modified paths that are in the given list.</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> internal options</p>
</li><ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>true</code> mongoose validates only modified paths.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.pathsToSkip]
<span class="method-type">&laquo;Array|string&raquo;</span> list of paths to skip. If set, Mongoose will validate every modified path that is not in this list.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback called after validation completes, passing an error if one occurred</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no <code>callback</code> is given.</li></ul><div><p>Executes registered validation rules for this document.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This method is called <code>pre</code> save and if a validation rule is violated, <a href="#model_Model-save">save</a> is aborted and the error is returned to your <code>callback</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">handleError</span>(err);
  <span class="hljs-keyword">else</span> <span class="hljs-comment">// validation passed</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="document_Document-validateSync"><a href="#document_Document-validateSync">Document.prototype.validateSync()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pathsToValidate]
<span class="method-type">&laquo;Array|string&raquo;</span> only validate the given paths</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> options for validation</p>
</li><ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>true</code>, Mongoose will only validate modified paths, as opposed to modified paths and <code>required</code> paths.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.pathsToSkip]
<span class="method-type">&laquo;Array|string&raquo;</span> list of paths to skip. If set, Mongoose will validate every modified path that is not in this list.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ValidationError,undefined,void&raquo;</span> ValidationError if there are errors during validation, or undefined if there is no error.</li></ul><div><p>Executes registered validation rules (skipping asynchronous validators) for this document.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This method is useful if you need synchronous validation.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> err = doc.<span class="hljs-title function_">validateSync</span>();
<span class="hljs-keyword">if</span> (err) {
  <span class="hljs-title function_">handleError</span>(err);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// validation passed</span>
}
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/model.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Model"><a href="#Model">Model</a></h2></div><ul><li><a href="#model_Model">Model()</a></li><li><a href="#model_Model-$where">Model.$where()</a></li><li><a href="#model_Model-aggregate">Model.aggregate()</a></li><li><a href="#model_Model-applyDefaults">Model.applyDefaults()</a></li><li><a href="#model_Model-bulkSave">Model.bulkSave</a></li><li><a href="#model_Model-bulkWrite">Model.bulkWrite()</a></li><li><a href="#model_Model-castObject">Model.castObject()</a></li><li><a href="#model_Model-cleanIndexes">Model.cleanIndexes()</a></li><li><a href="#model_Model-count">Model.count()</a></li><li><a href="#model_Model-countDocuments">Model.countDocuments()</a></li><li><a href="#model_Model-create">Model.create()</a></li><li><a href="#model_Model-createCollection">Model.createCollection()</a></li><li><a href="#model_Model-createIndexes">Model.createIndexes()</a></li><li><a href="#model_Model-db">Model.db</a></li><li><a href="#model_Model-deleteMany">Model.deleteMany()</a></li><li><a href="#model_Model-deleteOne">Model.deleteOne()</a></li><li><a href="#model_Model-diffIndexes">Model.diffIndexes()</a></li><li><a href="#model_Model-discriminator">Model.discriminator()</a></li><li><a href="#model_Model-distinct">Model.distinct()</a></li><li><a href="#model_Model-ensureIndexes">Model.ensureIndexes()</a></li><li><a href="#model_Model-estimatedDocumentCount">Model.estimatedDocumentCount()</a></li><li><a href="#model_Model-events">Model.events</a></li><li><a href="#model_Model-exists">Model.exists()</a></li><li><a href="#model_Model-find">Model.find()</a></li><li><a href="#model_Model-findById">Model.findById()</a></li><li><a href="#model_Model-findByIdAndDelete">Model.findByIdAndDelete()</a></li><li><a href="#model_Model-findByIdAndRemove">Model.findByIdAndRemove()</a></li><li><a href="#model_Model-findByIdAndUpdate">Model.findByIdAndUpdate()</a></li><li><a href="#model_Model-findOne">Model.findOne()</a></li><li><a href="#model_Model-findOneAndDelete">Model.findOneAndDelete()</a></li><li><a href="#model_Model-findOneAndRemove">Model.findOneAndRemove()</a></li><li><a href="#model_Model-findOneAndReplace">Model.findOneAndReplace()</a></li><li><a href="#model_Model-findOneAndUpdate">Model.findOneAndUpdate()</a></li><li><a href="#model_Model-hydrate">Model.hydrate()</a></li><li><a href="#model_Model-init">Model.init()</a></li><li><a href="#model_Model-insertMany">Model.insertMany()</a></li><li><a href="#model_Model-inspect">Model.inspect()</a></li><li><a href="#model_Model-listIndexes">Model.listIndexes()</a></li><li><a href="#model_Model-mapReduce">Model.mapReduce()</a></li><li><a href="#model_Model-populate">Model.populate()</a></li><li><a href="#model_Model-$model">Model.prototype.$model()</a></li><li><a href="#model_Model-$remove">Model.prototype.$remove()</a></li><li><a href="#model_Model-$where">Model.prototype.$where</a></li><li><a href="#model_Model-base">Model.prototype.base</a></li><li><a href="#model_Model-baseModelName">Model.prototype.baseModelName</a></li><li><a href="#model_Model-collection">Model.prototype.collection</a></li><li><a href="#model_Model-collection">Model.prototype.collection</a></li><li><a href="#model_Model-db">Model.prototype.db</a></li><li><a href="#model_Model-deleteOne">Model.prototype.deleteOne()</a></li><li><a href="#model_Model-discriminators">Model.prototype.discriminators</a></li><li><a href="#model_Model-increment">Model.prototype.increment()</a></li><li><a href="#model_Model-model">Model.prototype.model()</a></li><li><a href="#model_Model-modelName">Model.prototype.modelName</a></li><li><a href="#model_Model-remove">Model.prototype.remove()</a></li><li><a href="#model_Model-save">Model.prototype.save()</a></li><li><a href="#model_Model-remove">Model.remove()</a></li><li><a href="#model_Model-replaceOne">Model.replaceOne()</a></li><li><a href="#model_Model-schema">Model.schema</a></li><li><a href="#model_Model-startSession">Model.startSession()</a></li><li><a href="#model_Model-syncIndexes">Model.syncIndexes()</a></li><li><a href="#model_Model-translateAliases">Model.translateAliases()</a></li><li><a href="#model_Model-update">Model.update()</a></li><li><a href="#model_Model-updateMany">Model.updateMany()</a></li><li><a href="#model_Model-updateOne">Model.updateOne()</a></li><li><a href="#model_Model-validate">Model.validate()</a></li><li><a href="#model_Model-watch">Model.watch()</a></li><li><a href="#model_Model-where">Model.where()</a></li></ul><hr class="separate-api-elements"><h3 id="model_Model"><a href="#model_Model">Model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> values for initial set</p>
</li><li class="param">[fields]
<span class="method-type">&laquo;Object&raquo;</span> optional object containing the fields that were selected in the query which returned this document. You do <strong>not</strong> need to set this parameter to ensure Mongoose handles your <a href="/docs/api/query.html#query_Query-select">query projection</a>.</p>
</li><li class="param">[skipId=false]
<span class="method-type">&laquo;Boolean&raquo;</span> optional boolean. If true, mongoose doesn&#39;t add an <code>_id</code> field to the document.</p>
</li></ul><div><p>A Model is a class that&#39;s your primary tool for interacting with MongoDB.
An instance of a Model is called a <a href="/docs/api/document.html#Document">Document</a>.</p>
<p>In Mongoose, the term &quot;Model&quot; refers to subclasses of the <code>mongoose.Model</code>
class. You should not use the <code>mongoose.Model</code> class directly. The
<a href="/docs/api/mongoose.html#mongoose_Mongoose-model"><code>mongoose.model()</code></a> and
<a href="/docs/api/connection.html#connection_Connection-model"><code>connection.model()</code></a> functions
create subclasses of <code>mongoose.Model</code> as shown below.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// `UserModel` is a &quot;Model&quot;, a subclass of `mongoose.Model`.</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-comment">// You can use a Model to create new documents using `new`:</span>
<span class="hljs-keyword">const</span> userDoc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserModel</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Foo&#x27;</span> });
<span class="hljs-keyword">await</span> userDoc.<span class="hljs-title function_">save</span>();

<span class="hljs-comment">// You also use a model to create queries:</span>
<span class="hljs-keyword">const</span> userFromDb = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Foo&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-$where"><a href="#model_Model-$where">Model.$where()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">argument
<span class="method-type">&laquo;String|Function&raquo;</span> is a javascript string or anonymous function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Creates a <code>Query</code> and specifies a <code>$where</code> condition.</p>
<p>Sometimes you need to query for things in mongodb using a JavaScript expression. You can do so via <code>find({ $where: javascript })</code>, or you can use the mongoose shortcut method $where via a Query chain or from your mongoose Model.</p>
<pre><code><span class="hljs-title class_">Blog</span>.$where(<span class="hljs-string">&#x27;this.username.indexOf(&quot;val&quot;) !== -1&#x27;</span>).<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, docs</span>) {});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-aggregate"><a href="#model_Model-aggregate">Model.aggregate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pipeline]
<span class="method-type">&laquo;Array&raquo;</span> aggregation pipeline as an array of objects</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> aggregation options</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Performs <a href="https://www.mongodb.com/docs/manual/applications/aggregation/">aggregations</a> on the models collection.</p>
<p>If a <code>callback</code> is passed, the <code>aggregate</code> is executed and a <code>Promise</code> is returned. If a callback is not passed, the <code>aggregate</code> itself is returned.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>aggregate()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Find the max balance of all accounts</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Users</span>.<span class="hljs-title function_">aggregate</span>([
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">maxBalance</span>: { <span class="hljs-attr">$max</span>: <span class="hljs-string">&#x27;$balance&#x27;</span> }}},
  { <span class="hljs-attr">$project</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">maxBalance</span>: <span class="hljs-number">1</span> }}
]);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// [ { maxBalance: 98000 } ]</span>

<span class="hljs-comment">// Or use the aggregation pipeline builder.</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Users</span>.<span class="hljs-title function_">aggregate</span>().
  <span class="hljs-title function_">group</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">maxBalance</span>: { <span class="hljs-attr">$max</span>: <span class="hljs-string">&#x27;$balance&#x27;</span> } }).
  <span class="hljs-title function_">project</span>(<span class="hljs-string">&#x27;-id maxBalance&#x27;</span>).
  <span class="hljs-title function_">exec</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// [ { maxBalance: 98 } ]</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<ul>
<li>Mongoose does <strong>not</strong> cast aggregation pipelines to the model&#39;s schema because <code>$project</code> and <code>$group</code> operators allow redefining the &quot;shape&quot; of the documents at any stage of the pipeline, which may leave documents in an incompatible format. You can use the <a href="https://github.com/AbdelrahmanHafez/mongoose-cast-aggregation">mongoose-cast-aggregation plugin</a> to enable minimal casting for aggregation pipelines.</li>
<li>The documents returned are plain javascript objects, not mongoose documents (since any shape of document can be returned).</li>
</ul>
<h4 id="more-about-aggregations">
      <a href="#more-about-aggregations">
        More About Aggregations:
      </a>
    </h4>
<ul>
<li><a href="/docs/api/aggregate.html">Mongoose <code>Aggregate</code></a></li>
<li><a href="https://masteringjs.io/tutorials/mongoose/aggregate">An Introduction to Mongoose Aggregate</a></li>
<li><a href="https://www.mongodb.com/docs/manual/applications/aggregation/">MongoDB Aggregation docs</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-applyDefaults"><a href="#model_Model-applyDefaults">Model.applyDefaults()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object|Document&raquo;</span> object or document to apply defaults on</p>
</li></ul><div><p>Apply defaults to the given document or POJO.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-bulkSave"><a href="#model_Model-bulkSave">Model.bulkSave</a></h3><h5>Parameters</h5><ul class="params"><li class="param">documents
<span class="method-type">&laquo;Array&lt;Document&gt;&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> options passed to the underlying <code>bulkWrite()</code></p>
</li><ul style="margin-top: 0.5em"><li>[options.timestamps]
<span class="method-type">&laquo;Boolean&raquo;</span> defaults to <code>null</code>, when set to false, mongoose will not add/update timestamps to the documents.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this bulk write. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.w=1]
<span class="method-type">&laquo;String|number&raquo;</span> The <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a>. See <a href="/docs/api/query.html#query_Query-w"><code>Query#w()</code></a> for more information.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.wtimeout=null]
<span class="method-type">&laquo;number&raquo;</span> The <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout">write concern timeout</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.j=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If false, disable <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#j-option">journal acknowledgement</a></p>
</li></ul></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>takes an array of documents, gets the changes and inserts/updates documents in the database
 according to whether or not the document is new, or whether it has changes or not.</p>
<p><code>bulkSave</code> uses <code>bulkWrite</code> under the hood, so it&#39;s mostly useful when dealing with many documents (10K+)</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-bulkWrite"><a href="#model_Model-bulkWrite">Model.bulkWrite()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">ops
<span class="method-type">&laquo;Array&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[ops.insertOne.document]
<span class="method-type">&laquo;Object&raquo;</span> The document to insert</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.filter]
<span class="method-type">&laquo;Object&raquo;</span> Update the first document that matches this filter</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.update]
<span class="method-type">&laquo;Object&raquo;</span> An object containing <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">update operators</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, insert a doc if none match</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.timestamps=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If false, do not apply <a href="https://mongoosejs.com/docs/guide.html#timestamps">timestamps</a> to the operation</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.collation]
<span class="method-type">&laquo;Object&raquo;</span> The <a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-34-collations">MongoDB collation</a> to use</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateOne.arrayFilters]
<span class="method-type">&laquo;Array&raquo;</span> The <a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-36-array-filters.html">array filters</a> used in <code>update</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.filter]
<span class="method-type">&laquo;Object&raquo;</span> Update all the documents that match this filter</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.update]
<span class="method-type">&laquo;Object&raquo;</span> An object containing <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">update operators</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, insert a doc if no documents match <code>filter</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.timestamps=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If false, do not apply <a href="https://mongoosejs.com/docs/guide.html#timestamps">timestamps</a> to the operation</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.collation]
<span class="method-type">&laquo;Object&raquo;</span> The <a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-34-collations">MongoDB collation</a> to use</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.updateMany.arrayFilters]
<span class="method-type">&laquo;Array&raquo;</span> The <a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-36-array-filters.html">array filters</a> used in <code>update</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.deleteOne.filter]
<span class="method-type">&laquo;Object&raquo;</span> Delete the first document that matches this filter</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.deleteMany.filter]
<span class="method-type">&laquo;Object&raquo;</span> Delete all documents that match this filter</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.replaceOne.filter]
<span class="method-type">&laquo;Object&raquo;</span> Replace the first document that matches this filter</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.replaceOne.replacement]
<span class="method-type">&laquo;Object&raquo;</span> The replacement document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[ops.replaceOne.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, insert a doc if no documents match <code>filter</code></p>
</li></ul><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.ordered=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, execute writes in order and stop at the first error. If false, execute writes in parallel and continue until all writes have either succeeded or errored.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this bulk write. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.w=1]
<span class="method-type">&laquo;String|number&raquo;</span> The <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a>. See <a href="/docs/api/query.html#query_Query-w"><code>Query#w()</code></a> for more information.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.wtimeout=null]
<span class="method-type">&laquo;number&raquo;</span> The <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout">write concern timeout</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.j=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If false, disable <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#j-option">journal acknowledgement</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.skipValidation=false]
<span class="method-type">&laquo;Boolean&raquo;</span> Set to true to skip Mongoose schema validation on bulk write operations. Mongoose currently runs validation on <code>insertOne</code> and <code>replaceOne</code> operations by default.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.bypassDocumentValidation=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, disable <a href="https://www.mongodb.com/docs/manual/core/schema-validation/">MongoDB server-side schema validation</a> for all writes in this bulk.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict=null]
<span class="method-type">&laquo;Boolean&raquo;</span> Overwrites the <a href="/docs/guide.html#strict"><code>strict</code> option</a> on schema. If false, allows filtering and writing fields not defined in the schema for all writes in this bulk.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.throwOnValidationError=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true and <code>ordered: false</code>, throw an error if one of the operations failed validation, but all valid operations completed successfully.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> callback <code>function(error, bulkWriteOpResult) {}</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> resolves to a <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/BulkWriteResult.html"><code>BulkWriteOpResult</code></a> if the operation succeeds</li></ul><div><p>Sends multiple <code>insertOne</code>, <code>updateOne</code>, <code>updateMany</code>, <code>replaceOne</code>,
<code>deleteOne</code>, and/or <code>deleteMany</code> operations to the MongoDB server in one
command. This is faster than sending multiple independent operations (e.g.
if you use <code>create()</code>) because with <code>bulkWrite()</code> there is only one round
trip to MongoDB.</p>
<p>Mongoose will perform casting on all operations you provide.</p>
<p>This function does <strong>not</strong> trigger any middleware, neither <code>save()</code>, nor <code>update()</code>.
If you need to trigger
<code>save()</code> middleware for every document use <a href="#model_Model-create"><code>create()</code></a> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Character</span>.<span class="hljs-title function_">bulkWrite</span>([
  {
    <span class="hljs-attr">insertOne</span>: {
      <span class="hljs-attr">document</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Warden of the North&#x27;</span>
      }
    }
  },
  {
    <span class="hljs-attr">updateOne</span>: {
      <span class="hljs-attr">filter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> },
      <span class="hljs-comment">// If you were using the MongoDB driver directly, you&#x27;d need to do</span>
      <span class="hljs-comment">// `update: { $set: { title: ... } }` but mongoose adds $set for</span>
      <span class="hljs-comment">// you.</span>
      <span class="hljs-attr">update</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Hand of the King&#x27;</span> }
    }
  },
  {
    <span class="hljs-attr">deleteOne</span>: {
      <span class="hljs-attr">filter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> }
    }
  }
]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
 <span class="hljs-comment">// Prints &quot;1 1 1&quot;</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">insertedCount</span>, res.<span class="hljs-property">modifiedCount</span>, res.<span class="hljs-property">deletedCount</span>);
});
</code></pre>
<p>The <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite">supported operations</a> are:</p>
<ul>
<li><code>insertOne</code></li>
<li><code>updateOne</code></li>
<li><code>updateMany</code></li>
<li><code>deleteOne</code></li>
<li><code>deleteMany</code></li>
<li><code>replaceOne</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-castObject"><a href="#model_Model-castObject">Model.castObject()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> object or document to cast</p>
</li><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> options passed to castObject</p>
</li><li class="param">options.ignoreCastErrors
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code> will not throw a ValidationError and only return values that were successfully cast.</p>
</li></ul><div><p>Cast the given POJO to the model&#39;s schema</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: <span class="hljs-title class_">Number</span> }));

<span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Test</span>.<span class="hljs-title function_">castObject</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">&#x27;42&#x27;</span> });
obj.<span class="hljs-property">num</span>; <span class="hljs-comment">// 42 as a number</span>

<span class="hljs-title class_">Test</span>.<span class="hljs-title function_">castObject</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">&#x27;not a number&#x27;</span> }); <span class="hljs-comment">// Throws a ValidationError</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-cleanIndexes"><a href="#model_Model-cleanIndexes">Model.cleanIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> Returns <code>undefined</code> if callback is specified, returns a promise if no callback.</li></ul><div><p>Deletes all indexes that aren&#39;t defined in this model&#39;s schema. Used by
<code>syncIndexes()</code>.</p>
<p>The returned promise resolves to a list of the dropped indexes&#39; names as an array</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-count"><a href="#model_Model-count">Model.count()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Counts number of documents that match <code>filter</code> in a database collection.</p>
<p>This method is deprecated. If you want to count the number of documents in
a collection, e.g. <code>count({})</code>, use the <a href="#model_Model-estimatedDocumentCount"><code>estimatedDocumentCount()</code> function</a>
instead. Otherwise, use the <a href="#model_Model-countDocuments"><code>countDocuments()</code></a> function instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> count = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">count</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;jungle&#x27;</span> });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;there are %d jungle adventures&#x27;</span>, count);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-countDocuments"><a href="#model_Model-countDocuments">Model.countDocuments()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Counts number of documents matching <code>filter</code> in a database collection.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">countDocuments</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;jungle&#x27;</span> }, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, count</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;there are %d jungle adventures&#x27;</span>, count);
});
</code></pre>
<p>If you want to count all documents in a large collection,
use the <a href="#model_Model-estimatedDocumentCount"><code>estimatedDocumentCount()</code> function</a>
instead. If you call <code>countDocuments({})</code>, MongoDB will always execute
a full collection scan and <strong>not</strong> use any indexes.</p>
<p>The <code>countDocuments()</code> function is similar to <code>count()</code>, but there are a
<a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments">few operators that <code>countDocuments()</code> does not support</a>.
Below are the operators that <code>count()</code> supports but <code>countDocuments()</code> does not,
and the suggested replacement:</p>
<ul>
<li><code>$where</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/expr/"><code>$expr</code></a></li>
<li><code>$near</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center"><code>$center</code></a></li>
<li><code>$nearSphere</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere"><code>$centerSphere</code></a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-create"><a href="#model_Model-create">Model.create()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">docs
<span class="method-type">&laquo;Array|Object&raquo;</span> Documents to insert, as a spread or array</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options passed down to <code>save()</code>. To specify <code>options</code>, <code>docs</code> <strong>must</strong> be an array, not a spread. See <a href="#model_Model-save">Model.save</a> for available options.</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Shortcut for saving one or more documents to the database.
<code>MyModel.create(docs)</code> does <code>new MyModel(doc).save()</code> for every doc in
docs.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>save()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Insert one new `Character` document</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> });

<span class="hljs-comment">// Insert multiple new `Character` documents</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">create</span>([{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Will Riker&#x27;</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Geordi LaForge&#x27;</span> }]);

<span class="hljs-comment">// Create a new character within a transaction. Note that you **must**</span>
<span class="hljs-comment">// pass an array as the first parameter to `create()` if you want to</span>
<span class="hljs-comment">// specify options.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">create</span>([{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> }], { session });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-createCollection"><a href="#model_Model-createCollection">Model.createCollection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createCollection">MongoDB driver docs</a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Create the collection for this model. By default, if no indexes are specified,
mongoose will not create the collection for the model until any documents are
created. Use this method to create the collection explicitly.</p>
<p>Note 1: You may need to call this before starting a transaction
See <a href="https://www.mongodb.com/docs/manual/core/transactions/#transactions-and-operations">https://www.mongodb.com/docs/manual/core/transactions/#transactions-and-operations</a></p>
<p>Note 2: You don&#39;t have to call this if your schema contains index or unique field.
In that case, just use <code>Model.init()</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> })
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, userSchema);

<span class="hljs-title class_">User</span>.<span class="hljs-title function_">createCollection</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">collection</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Collection is created!&#x27;</span>);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-createIndexes"><a href="#model_Model-createIndexes">Model.createIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> internal options</p>
</li><li class="param">[cb]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Similar to <code>ensureIndexes()</code>, except for it uses the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createIndex"><code>createIndex</code></a>
function.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-db"><a href="#model_Model-db">Model.db</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Connection instance the model uses.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-deleteMany"><a href="#model_Model-deleteMany">Model.deleteMany()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">conditions
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Deletes all of the documents that match <code>conditions</code> from the collection.
It returns an object with the property <code>deletedCount</code> containing the number of documents deleted.
Behaves like <code>remove()</code>, but deletes all documents that match <code>conditions</code>
regardless of the <code>single</code> option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> } }); <span class="hljs-comment">// returns {deletedCount: x} where x is the number of documents deleted.</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This function triggers <code>deleteMany</code> query hooks. Read the
<a href="/docs/middleware.html#naming">middleware docs</a> to learn more.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-deleteOne"><a href="#model_Model-deleteOne">Model.deleteOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">conditions
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Deletes the first document that matches <code>conditions</code> from the collection.
It returns an object with the property <code>deletedCount</code> indicating how many documents were deleted.
Behaves like <code>remove()</code>, but deletes at most one document regardless of the
<code>single</code> option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> }); <span class="hljs-comment">// returns {deletedCount: 1}</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This function triggers <code>deleteOne</code> query hooks. Read the
<a href="/docs/middleware.html#naming">middleware docs</a> to learn more.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-diffIndexes"><a href="#model_Model-diffIndexes">Model.diffIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><div><p>Does a dry-run of Model.syncIndexes(), meaning that
the result of this function would be the result of
Model.syncIndexes().</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-discriminator"><a href="#model_Model-discriminator">Model.discriminator()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> discriminator model name</p>
</li><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> discriminator model schema</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object|String&raquo;</span> If string, same as <code>options.value</code>.</p>
</li><ul style="margin-top: 0.5em"><li>[options.value]
<span class="method-type">&laquo;String&raquo;</span> the string stored in the <code>discriminatorKey</code> property. If not specified, Mongoose uses the <code>name</code> parameter.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=true]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>discriminator()</code> clones the given <code>schema</code>. Set to <code>false</code> to skip cloning.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.overwriteModels=false]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, Mongoose does not allow you to define a discriminator with the same name as another discriminator. Set this to allow overwriting discriminators with the same name.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.mergeHooks=true]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, Mongoose merges the base schema&#39;s hooks with the discriminator schema&#39;s hooks. Set this option to <code>false</code> to make Mongoose use the discriminator schema&#39;s hooks instead.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.mergePlugins=true]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, Mongoose merges the base schema&#39;s plugins with the discriminator schema&#39;s plugins. Set this option to <code>false</code> to make Mongoose use the discriminator schema&#39;s plugins instead.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> The newly created discriminator model</li></ul><div><p>Adds a discriminator type.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">BaseSchema</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title class_">Schema</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);

  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>
  });
}
util.<span class="hljs-title function_">inherits</span>(<span class="hljs-title class_">BaseSchema</span>, <span class="hljs-title class_">Schema</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">PersonSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseSchema</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title class_">BossSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseSchema</span>({ <span class="hljs-attr">department</span>: <span class="hljs-title class_">String</span> });

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Person</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>, <span class="hljs-title class_">PersonSchema</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Boss</span> = <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">discriminator</span>(<span class="hljs-string">&#x27;Boss&#x27;</span>, <span class="hljs-title class_">BossSchema</span>);
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Boss</span>().<span class="hljs-property">__t</span>; <span class="hljs-comment">// &quot;Boss&quot;. `__t` is the default `discriminatorKey`</span>

<span class="hljs-keyword">const</span> employeeSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">boss</span>: <span class="hljs-title class_">ObjectId</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Employee</span> = <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">discriminator</span>(<span class="hljs-string">&#x27;Employee&#x27;</span>, employeeSchema, <span class="hljs-string">&#x27;staff&#x27;</span>);
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>().<span class="hljs-property">__t</span>; <span class="hljs-comment">// &quot;staff&quot; because of 3rd argument above</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-distinct"><a href="#model_Model-distinct">Model.distinct()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">field
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[conditions]
<span class="method-type">&laquo;Object&raquo;</span> optional</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Creates a Query for a <code>distinct</code> operation.</p>
<p>Passing a <code>callback</code> executes the query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Link</span>.<span class="hljs-title function_">distinct</span>(<span class="hljs-string">&#x27;url&#x27;</span>, { <span class="hljs-attr">clicks</span>: { <span class="hljs-attr">$gt</span>: <span class="hljs-number">100</span> } }, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleError</span>(err);

  <span class="hljs-title function_">assert</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(result));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;unique urls with more than 100 clicks&#x27;</span>, result);
})

<span class="hljs-keyword">const</span> query = <span class="hljs-title class_">Link</span>.<span class="hljs-title function_">distinct</span>(<span class="hljs-string">&#x27;url&#x27;</span>);
query.<span class="hljs-title function_">exec</span>(callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-ensureIndexes"><a href="#model_Model-ensureIndexes">Model.ensureIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> internal options</p>
</li><li class="param">[cb]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Sends <code>createIndex</code> commands to mongo for each index declared in the schema.
The <code>createIndex</code> commands are sent in series.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Event</span>.<span class="hljs-title function_">ensureIndexes</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleError</span>(err);
});
</code></pre>
<p>After completion, an <code>index</code> event is emitted on this <code>Model</code> passing an error if one occurred.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> eventSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">thing</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> } })
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Event&#x27;</span>, eventSchema);

<span class="hljs-title class_">Event</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err); <span class="hljs-comment">// error occurred during index creation</span>
})
</code></pre>
<p><em>NOTE: It is not recommended that you run this in production. Index creation may impact database performance depending on your load. Use with caution.</em></p>
</div><hr class="separate-api-elements"><h3 id="model_Model-estimatedDocumentCount"><a href="#model_Model-estimatedDocumentCount">Model.estimatedDocumentCount()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Estimates the number of documents in the MongoDB collection. Faster than
using <code>countDocuments()</code> for large collections because
<code>estimatedDocumentCount()</code> uses collection metadata rather than scanning
the entire collection.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> numAdventures = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">estimatedDocumentCount</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-events"><a href="#model_Model-events">Model.events</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Event emitter that reports any errors that occurred. Useful for global error
handling.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">MyModel</span>.<span class="hljs-property">events</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>));

<span class="hljs-comment">// Prints a &#x27;CastError&#x27; because of the above handler</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-string">&#x27;Not a valid ObjectId&#x27;</span> }).<span class="hljs-title function_">catch</span>(noop);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-exists"><a href="#model_Model-exists">Model.exists()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Returns a document with <code>_id</code> only if at least one document exists in the database that matches
the given <code>filter</code>, and <code>null</code> otherwise.</p>
<p>Under the hood, <code>MyModel.exists({ answer: 42 })</code> is equivalent to
<code>MyModel.findOne({ answer: 42 }).select({ _id: 1 }).lean()</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteMany</span>({});
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> });

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">exists</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/picard/i</span> }); <span class="hljs-comment">// { _id: ... }</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">exists</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/riker/i</span> }); <span class="hljs-comment">// null</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOne()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-find"><a href="#model_Model-find">Model.find()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object|ObjectId&raquo;</span> </li><li class="param">[projection]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Finds documents.</p>
<p>Mongoose casts the <code>filter</code> to match the model&#39;s schema before the command is sent.
See our <a href="/docs/tutorials/query_casting.html">query casting tutorial</a> for
more information on how Mongoose casts <code>filter</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// find all documents</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>({});

<span class="hljs-comment">// find all documents named john and at least 18</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;john&#x27;</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> } }).<span class="hljs-title function_">exec</span>();

<span class="hljs-comment">// executes, passing results to callback</span>
<span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;john&#x27;</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> }}, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, docs</span>) {});

<span class="hljs-comment">// executes, name LIKE john and only selecting the &quot;name&quot; and &quot;friends&quot; fields</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/john/i</span> }, <span class="hljs-string">&#x27;name friends&#x27;</span>).<span class="hljs-title function_">exec</span>();

<span class="hljs-comment">// passing options</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/john/i</span> }, <span class="hljs-literal">null</span>, { <span class="hljs-attr">skip</span>: <span class="hljs-number">10</span> }).<span class="hljs-title function_">exec</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findById"><a href="#model_Model-findById">Model.findById()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">id
<span class="method-type">&laquo;Any&raquo;</span> value of <code>_id</code> to query by</p>
</li><li class="param">[projection]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Finds a single document by its _id field. <code>findById(id)</code> is almost*
equivalent to <code>findOne({ _id: id })</code>. If you want to query by a document&#39;s
<code>_id</code>, use <code>findById()</code> instead of <code>findOne()</code>.</p>
<p>The <code>id</code> is cast based on the Schema before sending the command.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOne()</code></li>
</ul>
<p>* Except for how it treats <code>undefined</code>. If you use <code>findOne()</code>, you&#39;ll see
that <code>findOne(undefined)</code> and <code>findOne({ _id: undefined })</code> are equivalent
to <code>findOne({})</code> and return arbitrary documents. However, mongoose
translates <code>findById(undefined)</code> into <code>findOne({ _id: null })</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Find the adventure with the given `id`, or `null` if not found</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">exec</span>();

<span class="hljs-comment">// using callback</span>
<span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, adventure</span>) {});

<span class="hljs-comment">// select only the adventures name and length</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-string">&#x27;name length&#x27;</span>).<span class="hljs-title function_">exec</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findByIdAndDelete"><a href="#model_Model-findByIdAndDelete">Model.findByIdAndDelete()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">id
<span class="method-type">&laquo;Object|Number|String&raquo;</span> value of <code>_id</code> to query by</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issue a MongoDB <code>findOneAndDelete()</code> command by a document&#39;s _id field.
In other words, <code>findByIdAndDelete(id)</code> is a shorthand for
<code>findOneAndDelete({ _id: id })</code>.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndDelete()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-findByIdAndRemove"><a href="#model_Model-findByIdAndRemove">Model.findByIdAndRemove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">id
<span class="method-type">&laquo;Object|Number|String&raquo;</span> value of <code>_id</code> to query by</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.projection=null]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.select]
<span class="method-type">&laquo;Object|String&raquo;</span> sets the document fields to return.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issue a mongodb findAndModify remove command by a document&#39;s _id field. <code>findByIdAndRemove(id, ...)</code> is equivalent to <code>findOneAndRemove({ _id: id }, ...)</code>.</p>
<p>Finds a matching document, removes it, passing the found document (if any) to the callback.</p>
<p>Executes the query if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndRemove()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findByIdAndRemove</span>(id, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findByIdAndRemove</span>(id, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">findByIdAndRemove</span>(id, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findByIdAndRemove</span>(id) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findByIdAndRemove</span>()           <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findByIdAndUpdate"><a href="#model_Model-findByIdAndUpdate">Model.findByIdAndUpdate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">id
<span class="method-type">&laquo;Object|Number|String&raquo;</span> value of <code>_id</code> to query by</p>
</li><li class="param">[update]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.returnDocument='before']
<span class="method-type">&laquo;String&raquo;</span> Has two possible values, <code>&#39;before&#39;</code> and <code>&#39;after&#39;</code>. By default, it will return the document before the update was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="/docs/api/query.html#query_Query-lean"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.overwrite=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, if you don&#39;t include any <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">update operators</a> in <code>update</code>, Mongoose will wrap <code>update</code> in <code>$set</code> for you. This prevents you from accidentally overwriting the document. This option tells Mongoose to skip adding <code>$set</code>. An alternative to this would be using <a href="#model_Model-findOneAndReplace">Model.findOneAndReplace({ _id: id }, update, options, callback)</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.runValidators]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.setDefaultsOnInsert=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.new=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, return the modified document rather than the original</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.select]
<span class="method-type">&laquo;Object|String&raquo;</span> sets the document fields to return.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issues a mongodb findAndModify update command by a document&#39;s _id field.
<code>findByIdAndUpdate(id, ...)</code> is equivalent to <code>findOneAndUpdate({ _id: id }, ...)</code>.</p>
<p>Finds a matching document, updates it according to the <code>update</code> arg,
passing any <code>options</code>, and returns the found document (if any) to the
callback. The query executes if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndUpdate()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findByIdAndUpdate</span>(id, update, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findByIdAndUpdate</span>(id, update, options)  <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findByIdAndUpdate</span>(id, update, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findByIdAndUpdate</span>(id, update)           <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findByIdAndUpdate</span>()                     <span class="hljs-comment">// returns Query</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>All top level update keys which are not <code>atomic</code> operation names are treated as set operations:</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(id, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }, options, callback)

<span class="hljs-comment">// is sent as</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(id, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }}, options, callback)
</code></pre>
<p>This helps prevent accidentally overwriting your document with <code>{ name: &#39;jason bourne&#39; }</code>.
To prevent this behaviour, see the <code>overwrite</code> option</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p><code>findOneAndX</code> and <code>findByIdAndX</code> functions support limited validation. You can
enable validation by setting the <code>runValidators</code> option.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findById</span>(id)
doc.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;jason bourne&#x27;</span>;
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findOne"><a href="#model_Model-findOne">Model.findOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[conditions]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[projection]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Finds one document.</p>
<p>The <code>conditions</code> are cast to their respective SchemaTypes before the command is sent.</p>
<p><em>Note:</em> <code>conditions</code> is optional, and if <code>conditions</code> is null or undefined,
mongoose will send an empty <code>findOne</code> command to MongoDB, which will return
an arbitrary document. If you&#39;re querying by <code>_id</code>, use <code>findById()</code> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Find one adventure whose `country` is &#x27;Croatia&#x27;, otherwise `null`</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">country</span>: <span class="hljs-string">&#x27;Croatia&#x27;</span> }).<span class="hljs-title function_">exec</span>();

<span class="hljs-comment">// using callback</span>
<span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">country</span>: <span class="hljs-string">&#x27;Croatia&#x27;</span> }, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, adventure</span>) {});

<span class="hljs-comment">// select only the adventures name and length</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Adventure</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">country</span>: <span class="hljs-string">&#x27;Croatia&#x27;</span> }, <span class="hljs-string">&#x27;name length&#x27;</span>).<span class="hljs-title function_">exec</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findOneAndDelete"><a href="#model_Model-findOneAndDelete">Model.findOneAndDelete()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">conditions
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.projection=null]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.select]
<span class="method-type">&laquo;Object|String&raquo;</span> sets the document fields to return.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> puts a time limit on the query - requires mongodb &gt;= 2.6.0</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issue a MongoDB <code>findOneAndDelete()</code> command.</p>
<p>Finds a matching document, removes it, and passes the found document
(if any) to the callback.</p>
<p>Executes the query if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndDelete()</code></li>
</ul>
<p>This function differs slightly from <code>Model.findOneAndRemove()</code> in that
<code>findOneAndRemove()</code> becomes a <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findAndModify/">MongoDB <code>findAndModify()</code> command</a>,
as opposed to a <code>findOneAndDelete()</code> command. For most mongoose use cases,
this distinction is purely pedantic. You should use <code>findOneAndDelete()</code>
unless you have a good reason not to.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findOneAndDelete</span>(conditions, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndDelete</span>(conditions, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">findOneAndDelete</span>(conditions, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndDelete</span>(conditions) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findOneAndDelete</span>()           <span class="hljs-comment">// returns Query</span>
</code></pre>
<p><code>findOneAndX</code> and <code>findByIdAndX</code> functions support limited validation. You can
enable validation by setting the <code>runValidators</code> option.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findById</span>(id)
doc.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;jason bourne&#x27;</span>;
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findOneAndRemove"><a href="#model_Model-findOneAndRemove">Model.findOneAndRemove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">conditions
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.projection=null]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.select]
<span class="method-type">&laquo;Object|String&raquo;</span> sets the document fields to return.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> puts a time limit on the query - requires mongodb &gt;= 2.6.0</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issue a mongodb findAndModify remove command.</p>
<p>Finds a matching document, removes it, passing the found document (if any) to the callback.</p>
<p>Executes the query if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndRemove()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findOneAndRemove</span>(conditions, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndRemove</span>(conditions, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">findOneAndRemove</span>(conditions, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndRemove</span>(conditions) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findOneAndRemove</span>()           <span class="hljs-comment">// returns Query</span>
</code></pre>
<p><code>findOneAndX</code> and <code>findByIdAndX</code> functions support limited validation. You can
enable validation by setting the <code>runValidators</code> option.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findById</span>(id);
doc.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;jason bourne&#x27;</span>;
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findOneAndReplace"><a href="#model_Model-findOneAndReplace">Model.findOneAndReplace()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> Replace the first document that matches this filter</p>
</li><li class="param">[replacement]
<span class="method-type">&laquo;Object&raquo;</span> Replace with this document</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.returnDocument='before']
<span class="method-type">&laquo;String&raquo;</span> Has two possible values, <code>&#39;before&#39;</code> and <code>&#39;after&#39;</code>. By default, it will return the document before the update was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="/docs/api/query.html#query_Query-lean"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.projection=null]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.select]
<span class="method-type">&laquo;Object|String&raquo;</span> sets the document fields to return.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> puts a time limit on the query - requires mongodb &gt;= 2.6.0</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issue a MongoDB <code>findOneAndReplace()</code> command.</p>
<p>Finds a matching document, replaces it with the provided doc, and passes the
returned doc to the callback.</p>
<p>Executes the query if <code>callback</code> is passed.</p>
<p>This function triggers the following query middleware.</p>
<ul>
<li><code>findOneAndReplace()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findOneAndReplace</span>()                    <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-findOneAndUpdate"><a href="#model_Model-findOneAndUpdate">Model.findOneAndUpdate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[conditions]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[update]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.returnDocument='before']
<span class="method-type">&laquo;String&raquo;</span> Has two possible values, <code>&#39;before&#39;</code> and <code>&#39;after&#39;</code>. By default, it will return the document before the update was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="/docs/api/query.html#query_Query-lean"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.overwrite=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, if you don&#39;t include any <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">update operators</a> in <code>update</code>, Mongoose will wrap <code>update</code> in <code>$set</code> for you. This prevents you from accidentally overwriting the document. This option tells Mongoose to skip adding <code>$set</code>. An alternative to this would be using <a href="#model_Model-findOneAndReplace">Model.findOneAndReplace(conditions, update, options, callback)</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.projection=null]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional fields to return, see <a href="#query_Query-select"><code>Query.prototype.select()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.new=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, return the modified document rather than the original</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.fields]
<span class="method-type">&laquo;Object|String&raquo;</span> Field selection. Equivalent to <code>.select(fields).findOneAndUpdate()</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.maxTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> puts a time limit on the query - requires mongodb &gt;= 2.6.0</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.sort]
<span class="method-type">&laquo;Object|String&raquo;</span> if multiple docs are found by the conditions, sets the sort order to choose which doc to update.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.runValidators]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.setDefaultsOnInsert=true]
<span class="method-type">&laquo;Boolean&raquo;</span> If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Issues a mongodb findAndModify update command.</p>
<p>Finds a matching document, updates it according to the <code>update</code> arg, passing any <code>options</code>, and returns the found document (if any) to the callback. The query executes if <code>callback</code> is passed else a Query object is returned.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, options)  <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update)           <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">findOneAndUpdate</span>()                             <span class="hljs-comment">// returns Query</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>All top level update keys which are not <code>atomic</code> operation names are treated as set operations:</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;borne&#x27;</span> };
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOneAndUpdate</span>(query, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }, options, callback)

<span class="hljs-comment">// is sent as</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOneAndUpdate</span>(query, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }}, options, callback)
</code></pre>
<p>This helps prevent accidentally overwriting your document with <code>{ name: &#39;jason bourne&#39; }</code>.
To prevent this behaviour, see the <code>overwrite</code> option</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p><code>findOneAndX</code> and <code>findByIdAndX</code> functions support limited validation that
you can enable by setting the <code>runValidators</code> option.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findById</span>(id);
doc.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;jason bourne&#x27;</span>;
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-hydrate"><a href="#model_Model-hydrate">Model.hydrate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[projection]
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> optional projection containing which fields should be selected for this document</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional options</p>
</li><ul style="margin-top: 0.5em"><li>[options.setters=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, apply schema setters when hydrating</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> document instance</li></ul><div><p>Shortcut for creating a new Document from existing raw data, pre-saved in the DB.
The document returned has no paths marked as modified initially.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// hydrate previous data into a Mongoose document</span>
<span class="hljs-keyword">const</span> mongooseCandy = <span class="hljs-title class_">Candy</span>.<span class="hljs-title function_">hydrate</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-string">&#x27;54108337212ffb6d459f854c&#x27;</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;jelly bean&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-init"><a href="#model_Model-init">Model.init()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>This function is responsible for building <a href="https://www.mongodb.com/docs/manual/indexes/">indexes</a>,
unless <a href="https://mongoosejs.com/docs/guide.html#autoIndex"><code>autoIndex</code></a> is turned off.</p>
<p>Mongoose calls this function automatically when a model is created using
<a href="/docs/api/mongoose.html#mongoose_Mongoose-model"><code>mongoose.model()</code></a> or
<a href="/docs/api/connection.html#connection_Connection-model"><code>connection.model()</code></a>, so you
don&#39;t need to call <code>init()</code> to trigger index builds.</p>
<p>However, you <em>may</em> need to call <code>init()</code>  to get back a promise that will resolve when your indexes are finished.
Calling <code>await Model.init()</code> is helpful if you need to wait for indexes to build before continuing.
For example, if you want to wait for unique indexes to build before continuing with a test case.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> eventSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">thing</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> } })
<span class="hljs-comment">// This calls `Event.init()` implicitly, so you don&#x27;t need to call</span>
<span class="hljs-comment">// `Event.init()` on your own.</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Event&#x27;</span>, eventSchema);

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Event</span>.<span class="hljs-title function_">init</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Indexes are done building!&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-insertMany"><a href="#model_Model-insertMany">Model.insertMany()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">doc(s)
<span class="method-type">&laquo;Array|Object|[object Object]&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#insertMany">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.ordered=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, will fail fast on the first error encountered. If false, will insert all the documents it can and report errors later. An <code>insertMany()</code> with <code>ordered = false</code> is called an &quot;unordered&quot; <code>insertMany()</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.rawResult=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if false, the returned promise resolves to the documents that passed mongoose document validation. If <code>true</code>, will return the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/InsertManyResult.html">raw result from the MongoDB driver</a> with a <code>mongoose</code> property that contains <code>validationErrors</code> and <code>results</code> if this is an unordered <code>insertMany</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>true</code>, skips hydrating the documents. This means Mongoose will <strong>not</strong> cast or validate any of the documents passed to <code>insertMany()</code>. This option is useful if you need the extra performance, but comes with data integrity risk. Consider using with <a href="#model_Model-castObject"><code>castObject()</code></a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.limit=null]
<span class="method-type">&laquo;Number&raquo;</span> this limits the number of documents being processed (validation/casting) by mongoose in parallel, this does <strong>NOT</strong> send the documents in batches to MongoDB. Use this option if you&#39;re processing a large number of documents and your app is running out of memory.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.populate=null]
<span class="method-type">&laquo;String|Object|Array&raquo;</span> populates the result documents. This option is a no-op if <code>rawResult</code> is set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.throwOnValidationError=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true and <code>ordered: false</code>, throw an error if one of the operations failed validation, but all valid operations completed successfully.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> resolving to the raw result from the MongoDB driver if <code>options.rawResult</code> was <code>true</code>, or the documents that passed validation, otherwise</li></ul><div><p>Shortcut for validating an array of documents and inserting them into
MongoDB if they&#39;re all valid. This function is faster than <code>.create()</code>
because it only sends one operation to the server, rather than one for each
document.</p>
<p>Mongoose always validates each document <strong>before</strong> sending <code>insertMany</code>
to MongoDB. So if one document has a validation error, no documents will
be saved, unless you set
<a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.insertMany/#error-handling">the <code>ordered</code> option to false</a>.</p>
<p>This function does <strong>not</strong> trigger save middleware.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>insertMany()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> arr = [{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Star Wars&#x27;</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;The Empire Strikes Back&#x27;</span> }];
<span class="hljs-title class_">Movies</span>.<span class="hljs-title function_">insertMany</span>(arr, <span class="hljs-keyword">function</span>(<span class="hljs-params">error, docs</span>) {});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-inspect"><a href="#model_Model-inspect">Model.inspect()</a></h3><div><p>Helper for console.log. Given a model named &#39;MyModel&#39;, returns the string
<code>&#39;Model { MyModel }&#39;</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">inspect</span>(); <span class="hljs-comment">// &#x27;Model { Test }&#x27;</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MyModel</span>); <span class="hljs-comment">// Prints &#x27;Model { Test }&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-listIndexes"><a href="#model_Model-listIndexes">Model.listIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[cb]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> Returns <code>undefined</code> if callback is specified, returns a promise if no callback.</li></ul><div><p>Lists the indexes currently defined in MongoDB. This may or may not be
the same as the indexes defined in your schema depending on whether you
use the <a href="/docs/guide.html#autoIndex"><code>autoIndex</code> option</a> and if you
build indexes manually.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-mapReduce"><a href="#model_Model-mapReduce">Model.mapReduce()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">opts
<span class="method-type">&laquo;Object&raquo;</span> an object specifying map-reduce options</p>
</li><ul style="margin-top: 0.5em"><li>[opts.verbose=false]
<span class="method-type">&laquo;Boolean&raquo;</span> provide statistics on job execution time</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.readPreference]
<span class="method-type">&laquo;ReadPreference|String&raquo;</span> a read-preference string or a read-preference instance</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.jsMode=false]
<span class="method-type">&laquo;Boolean&raquo;</span> it is possible to make the execution stay in JS. Provided in MongoDB &gt; 2.0.X</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.scope]
<span class="method-type">&laquo;Object&raquo;</span> scope variables exposed to map/reduce/finalize during execution</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.finalize]
<span class="method-type">&laquo;Function&raquo;</span> finalize function</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.keeptemp=false]
<span class="method-type">&laquo;Boolean&raquo;</span> keep temporary data</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.limit]
<span class="method-type">&laquo;Number&raquo;</span> max number of documents</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.sort]
<span class="method-type">&laquo;Object&raquo;</span> sort input objects using this key</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.query]
<span class="method-type">&laquo;Object&raquo;</span> query filter object</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.out]
<span class="method-type">&laquo;Object&raquo;</span> sets the output target for the map reduce job</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.out.inline=1]
<span class="method-type">&laquo;Number&raquo;</span> the results are returned in an array</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.out.replace]
<span class="method-type">&laquo;String&raquo;</span> add the results to collectionName: the results replace the collection</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.out.reduce]
<span class="method-type">&laquo;String&raquo;</span> add the results to collectionName: if dups are detected, uses the reducer / finalize functions</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.out.merge]
<span class="method-type">&laquo;String&raquo;</span> add the results to collectionName: if dups exist the new docs overwrite the old</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes a mapReduce command.</p>
<p><code>opts</code> is an object specifying all mapReduce options as well as the map and reduce functions. All options are delegated to the driver implementation. See <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#mapReduce">node-mongodb-native mapReduce() documentation</a> for more detail about options.</p>
<p>This function does not trigger any middleware.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> opts = {};
<span class="hljs-comment">// `map()` and `reduce()` are run on the MongoDB server, not Node.js,</span>
<span class="hljs-comment">// these functions are converted to strings</span>
opts.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) { <span class="hljs-title function_">emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, <span class="hljs-number">1</span>) };
opts.<span class="hljs-property">reduce</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">k, vals</span>) { <span class="hljs-keyword">return</span> vals.<span class="hljs-property">length</span> };
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">mapReduce</span>(opts, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, results</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results)
})
</code></pre>
<p>If <code>opts.out</code> is set to <code>replace</code>, <code>merge</code>, or <code>reduce</code>, a Model instance is returned that can be used for further querying. Queries run against this model are all executed with the <a href="/docs/tutorials/lean.html"><code>lean</code> option</a>; meaning only the js object is returned and no Mongoose magic is applied (getters, setters, etc).</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> opts = {};
<span class="hljs-comment">// You can also define `map()` and `reduce()` as strings if your</span>
<span class="hljs-comment">// linter complains about `emit()` not being defined</span>
opts.<span class="hljs-property">map</span> = <span class="hljs-string">&#x27;function () { emit(this.name, 1) }&#x27;</span>;
opts.<span class="hljs-property">reduce</span> = <span class="hljs-string">&#x27;function (k, vals) { return vals.length }&#x27;</span>;
opts.<span class="hljs-property">out</span> = { <span class="hljs-attr">replace</span>: <span class="hljs-string">&#x27;createdCollectionNameForResults&#x27;</span> }
opts.<span class="hljs-property">verbose</span> = <span class="hljs-literal">true</span>;

<span class="hljs-title class_">User</span>.<span class="hljs-title function_">mapReduce</span>(opts, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, model, stats</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;map reduce took %d ms&#x27;</span>, stats.<span class="hljs-property">processtime</span>)
  model.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;value&#x27;</span>).<span class="hljs-title function_">gt</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, docs</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(docs);
  });
})

<span class="hljs-comment">// `mapReduce()` returns a promise. However, ES6 promises can only</span>
<span class="hljs-comment">// resolve to exactly one value,</span>
opts.<span class="hljs-property">resolveToObject</span> = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">const</span> promise = <span class="hljs-title class_">User</span>.<span class="hljs-title function_">mapReduce</span>(opts);
promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) {
  <span class="hljs-keyword">const</span> model = res.<span class="hljs-property">model</span>;
  <span class="hljs-keyword">const</span> stats = res.<span class="hljs-property">stats</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;map reduce took %d ms&#x27;</span>, stats.<span class="hljs-property">processtime</span>)
  <span class="hljs-keyword">return</span> model.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;value&#x27;</span>).<span class="hljs-title function_">gt</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">exec</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">docs</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(docs);
}).<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, handleError).<span class="hljs-title function_">end</span>()
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-populate"><a href="#model_Model-populate">Model.populate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">docs
<span class="method-type">&laquo;Document|Array&raquo;</span> Either a single document or array of documents to populate.</p>
</li><li class="param">options
<span class="method-type">&laquo;Object|String&raquo;</span> Either the paths to populate or an object specifying all parameters</p>
</li><ul style="margin-top: 0.5em"><li>[options.path=null]
<span class="method-type">&laquo;string&raquo;</span> The path to populate.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.populate=null]
<span class="method-type">&laquo;string|PopulateOptions&raquo;</span> Recursively populate paths in the populated documents. See <a href="/docs/populate.html#deep-populate">deep populate docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.retainNullValues=false]
<span class="method-type">&laquo;boolean&raquo;</span> By default, Mongoose removes null and undefined values from populated arrays. Use this option to make <code>populate()</code> retain <code>null</code> and <code>undefined</code> array entries.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.getters=false]
<span class="method-type">&laquo;boolean&raquo;</span> If true, Mongoose will call any getters defined on the <code>localField</code>. By default, Mongoose gets the raw value of <code>localField</code>. For example, you would need to set this option to <code>true</code> if you wanted to <a href="/docs/schematypes.html#schematype-options">add a <code>lowercase</code> getter to your <code>localField</code></a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=false]
<span class="method-type">&laquo;boolean&raquo;</span> When you do <code>BlogPost.find().populate(&#39;author&#39;)</code>, blog posts with the same author will share 1 copy of an <code>author</code> doc. Enable this option to make Mongoose clone populated docs before assigning them.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.match=null]
<span class="method-type">&laquo;Object|Function&raquo;</span> Add an additional filter to the populate query. Can be a filter object containing <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/">MongoDB query syntax</a>, or a function that returns a filter object.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.skipInvalidIds=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, Mongoose throws a cast error if <code>localField</code> and <code>foreignField</code> schemas don&#39;t line up. If you enable this option, Mongoose will instead filter out any <code>localField</code> properties that cannot be casted to <code>foreignField</code>&#39;s schema type.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.perDocumentLimit=null]
<span class="method-type">&laquo;Number&raquo;</span> For legacy reasons, <code>limit</code> with <code>populate()</code> may give incorrect results because it only executes a single query for every document being populated. If you set <code>perDocumentLimit</code>, Mongoose will ensure correct <code>limit</code> per document by executing a separate query for each document to <code>populate()</code>. For example, <code>.find().populate({ path: &#39;test&#39;, perDocumentLimit: 2 })</code> will execute 2 additional queries if <code>.find()</code> returns 2 documents.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strictPopulate=true]
<span class="method-type">&laquo;Boolean&raquo;</span> Set to false to allow populating paths that aren&#39;t defined in the given model&#39;s schema.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.options=null]
<span class="method-type">&laquo;Object&raquo;</span> Additional options like <code>limit</code> and <code>lean</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.transform=null]
<span class="method-type">&laquo;Function&raquo;</span> Function that Mongoose will call on every populated document that allows you to transform the populated document.</p>
</li></ul><li class="param">[callback(err,doc)]
<span class="method-type">&laquo;Function&raquo;</span> Optional callback, executed upon completion. Receives <code>err</code> and the <code>doc(s)</code>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Populates document references.</p>
<p>Changed in Mongoose 6: the model you call <code>populate()</code> on should be the
&quot;local field&quot; model, <strong>not</strong> the &quot;foreign field&quot; model.</p>
<h4 id="available-top-level-options">
      <a href="#available-top-level-options">
        Available top-level options:
      </a>
    </h4>
<ul>
<li>path: space delimited path(s) to populate</li>
<li>select: optional fields to select</li>
<li>match: optional query conditions to match</li>
<li>model: optional name of the model to use for population</li>
<li>options: optional query options like sort, limit, etc</li>
<li>justOne: optional boolean, if true Mongoose will always set <code>path</code> to a document, or <code>null</code> if no document was found. If false, Mongoose will always set <code>path</code> to an array, which will be empty if no documents are found. Inferred from schema by default.</li>
<li>strictPopulate: optional boolean, set to <code>false</code> to allow populating paths that aren&#39;t in the schema.</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Dog</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Dog&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">breed</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Person</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">pet</span>: { <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-string">&#x27;Dog&#x27;</span> }
}));

<span class="hljs-keyword">const</span> pets = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Pet</span>.<span class="hljs-title function_">create</span>([
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Daisy&#x27;</span>, <span class="hljs-attr">breed</span>: <span class="hljs-string">&#x27;Beagle&#x27;</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Einstein&#x27;</span>, <span class="hljs-attr">breed</span>: <span class="hljs-string">&#x27;Catalan Sheepdog&#x27;</span> }
]);

<span class="hljs-comment">// populate many plain objects</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Wick&#x27;</span>, <span class="hljs-attr">dog</span>: pets[<span class="hljs-number">0</span>].<span class="hljs-property">_id</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Doc Brown&#x27;</span>, <span class="hljs-attr">dog</span>: pets[<span class="hljs-number">1</span>].<span class="hljs-property">_id</span> }
];
<span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">populate</span>(users, { <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-attr">select</span>: <span class="hljs-string">&#x27;name&#x27;</span> });
users[<span class="hljs-number">0</span>].<span class="hljs-property">dog</span>.<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;Daisy&#x27;</span>
users[<span class="hljs-number">0</span>].<span class="hljs-property">dog</span>.<span class="hljs-property">breed</span>; <span class="hljs-comment">// undefined because of `select`</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-$model"><a href="#model_Model-$model">Model.prototype.$model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> model name</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> </li></ul><div><p>Returns another Model instance.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tank</span>;
doc.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>).<span class="hljs-title function_">findById</span>(id, callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-$remove"><a href="#model_Model-$remove">Model.prototype.$remove()</a></h3><div><p>Alias for remove</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-$where"><a href="#model_Model-$where">Model.prototype.$where</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Additional properties to attach to the query when calling <code>save()</code> and
<code>isNew</code> is false.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-base"><a href="#model_Model-base">Model.prototype.base</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Base Mongoose instance the model uses.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-baseModelName"><a href="#model_Model-baseModelName">Model.prototype.baseModelName</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>If this is a discriminator model, <code>baseModelName</code> is the name of
the base model.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-collection"><a href="#model_Model-collection">Model.prototype.collection</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Collection the model uses.</p>
<p>This property is read-only. Modifying this property is a no-op.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-collection"><a href="#model_Model-collection">Model.prototype.collection</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Collection the model uses.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-db"><a href="#model_Model-db">Model.prototype.db</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Connection the model uses.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-deleteOne"><a href="#model_Model-deleteOne">Model.prototype.deleteOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[fn]
<span class="method-type">&laquo;[object Object]&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Promise</li></ul><div><p>Removes this document from the db. Equivalent to <code>.remove()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>product = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">deleteOne</span>();
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Product</span>.<span class="hljs-title function_">findById</span>(product.<span class="hljs-property">_id</span>); <span class="hljs-comment">// null</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-discriminators"><a href="#model_Model-discriminators">Model.prototype.discriminators</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Registered discriminators for this model.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-increment"><a href="#model_Model-increment">Model.prototype.increment()</a></h3><div><p>Signal that we desire an increment of this documents version.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findById</span>(id);
doc.<span class="hljs-title function_">increment</span>();
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-model"><a href="#model_Model-model">Model.prototype.model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> model name</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> </li></ul><div><p>Returns another Model instance.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tank</span>;
doc.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>).<span class="hljs-title function_">findById</span>(id, callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-modelName"><a href="#model_Model-modelName">Model.prototype.modelName</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The name of the model</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-remove"><a href="#model_Model-remove">Model.prototype.remove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;Session&raquo;</span> the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a> associated with this operation. If not specified, defaults to the <a href="/docs/api/document.html#document_Document-$session">document&#39;s associated session</a>.</p>
</li></ul><li class="param">[fn]
<span class="method-type">&laquo;[object Object]&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Promise</li></ul><div><p>Removes this document from the db.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">remove</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
   assert.<span class="hljs-title function_">ok</span>(err);
});
<span class="hljs-keyword">const</span> foundProduct = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Product</span>.<span class="hljs-title function_">findById</span>(product.<span class="hljs-property">_id</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foundProduct) <span class="hljs-comment">// null</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-save"><a href="#model_Model-save">Model.prototype.save()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> options optional options</p>
</li><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;Session&raquo;</span> the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a> associated with this save operation. If not specified, defaults to the <a href="/docs/api/document.html#document_Document-$session">document&#39;s associated session</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.safe]
<span class="method-type">&laquo;Object&raquo;</span> (DEPRECATED) overrides <a href="https://mongoosejs.com//docs/guide.html#safe">schema&#39;s safe option</a>. Use the <code>w</code> option instead.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.validateBeforeSave]
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to save without validating.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>true</code>, Mongoose will only validate modified paths, as opposed to modified paths and <code>required</code> paths.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.w]
<span class="method-type">&laquo;Number|String&raquo;</span> set the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#w-option">write concern</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.j]
<span class="method-type">&laquo;Boolean&raquo;</span> set to true for MongoDB to wait until this <code>save()</code> has been <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#j-option">journaled before resolving the returned promise</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.wtimeout]
<span class="method-type">&laquo;Number&raquo;</span> sets a <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout">timeout for the write concern</a>. Overrides the <a href="/docs/guide.html#writeConcern">schema-level <code>writeConcern</code> option</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.checkKeys=true]
<span class="method-type">&laquo;Boolean&raquo;</span> the MongoDB driver prevents you from saving keys that start with &#39;$&#39; or contain &#39;.&#39; by default. Set this option to <code>false</code> to skip that check. See <a href="https://www.mongodb.com/docs/manual/reference/limits/#Restrictions-on-Field-Names">restrictions on field names</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=true]
<span class="method-type">&laquo;Boolean&raquo;</span> if <code>false</code> and <a href="/docs/guide.html#timestamps">timestamps</a> are enabled, skip timestamps for this <code>save()</code>.</p>
</li></ul><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> Returns undefined if used with callback or a Promise otherwise.</li></ul><div><p>Saves this document by inserting a new document into the database if <a href="/docs/api/document.html#document_Document-isNew">document.isNew</a> is <code>true</code>,
or sends an <a href="/docs/api/document.html#document_Document-updateOne">updateOne</a> operation with just the modified paths if <code>isNew</code> is <code>false</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>product.<span class="hljs-property">sold</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
product = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">save</span>();
</code></pre>
<p>If save is successful, the returned promise will fulfill with the document
saved.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> newProduct = <span class="hljs-keyword">await</span> product.<span class="hljs-title function_">save</span>();
newProduct === product; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-remove"><a href="#model_Model-remove">Model.remove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">conditions
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;Session&raquo;</span> the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a> associated with this operation.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Removes all documents that match <code>conditions</code> from the collection.
To remove just the first document that matches <code>conditions</code>, set the <code>single</code>
option to true.</p>
<p>This method is deprecated. See <a href="../deprecations.html#remove">Deprecation Warnings</a> for details.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> });
res.<span class="hljs-property">deletedCount</span>; <span class="hljs-comment">// Number of documents removed</span>
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>This method sends a remove command directly to MongoDB, no Mongoose documents
are involved. Because no Mongoose documents are involved, Mongoose does
not execute <a href="/docs/middleware.html#types-of-middleware">document middleware</a>.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-replaceOne"><a href="#model_Model-replaceOne">Model.replaceOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> <code>function(error, res) {}</code> where <code>res</code> has 3 properties: <code>n</code>, <code>nModified</code>, <code>ok</code>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Same as <code>update()</code>, except MongoDB replace the existing document with the
given document (no atomic operators like <code>$set</code>).</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">replaceOne</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-number">24601</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean Valjean&#x27;</span> });
res.<span class="hljs-property">matchedCount</span>; <span class="hljs-comment">// Number of documents matched</span>
res.<span class="hljs-property">modifiedCount</span>; <span class="hljs-comment">// Number of documents modified</span>
res.<span class="hljs-property">acknowledged</span>; <span class="hljs-comment">// Boolean indicating everything went smoothly.</span>
res.<span class="hljs-property">upsertedId</span>; <span class="hljs-comment">// null or an id containing a document that had to be upserted.</span>
res.<span class="hljs-property">upsertedCount</span>; <span class="hljs-comment">// Number indicating how many documents had to be upserted. Will either be 0 or 1.</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>replaceOne()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-schema"><a href="#model_Model-schema">Model.schema</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Schema the model uses.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-startSession"><a href="#model_Model-startSession">Model.startSession()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#startSession">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.causalConsistency=true]
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to disable causal consistency</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;ClientSession&gt;&raquo;</span> promise that resolves to a MongoDB driver <code>ClientSession</code></li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Starts a <a href="https://www.mongodb.com/docs/manual/release-notes/3.6/#client-sessions">MongoDB session</a>
for benefits like causal consistency, <a href="https://www.mongodb.com/docs/manual/core/retryable-writes/">retryable writes</a>,
and <a href="https://thecodebarbarian.com/a-node-js-perspective-on-mongodb-4-transactions.html">transactions</a>.</p>
<p>Calling <code>MyModel.startSession()</code> is equivalent to calling <code>MyModel.db.startSession()</code>.</p>
<p>This function does not trigger any middleware.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">let</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session });
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">remove</span>();
<span class="hljs-comment">// `doc` will always be null, even if reading from a replica set</span>
<span class="hljs-comment">// secondary. Without causal consistency, it is possible to</span>
<span class="hljs-comment">// get a doc back from the below query if the query reads from a</span>
<span class="hljs-comment">// secondary that is experiencing replication lag.</span>
doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session, <span class="hljs-attr">readPreference</span>: <span class="hljs-string">&#x27;secondary&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-syncIndexes"><a href="#model_Model-syncIndexes">Model.syncIndexes()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> options to pass to <code>ensureIndexes()</code></p>
</li><ul style="margin-top: 0.5em"><li>[options.background=null]
<span class="method-type">&laquo;Boolean&raquo;</span> if specified, overrides each index&#39;s <code>background</code> property</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> Returns <code>undefined</code> if callback is specified, returns a promise if no callback, when the Promise resolves the value is a list of the dropped indexes.</li></ul><div><p>Makes the indexes in MongoDB match the indexes defined in this model&#39;s
schema. This function will drop any indexes that are not defined in
the model&#39;s schema except the <code>_id</code> index, and build any indexes that
are in your schema but not in MongoDB.</p>
<p>See the <a href="https://thecodebarbarian.com/whats-new-in-mongoose-5-2-syncindexes">introductory blog post</a>
for more information.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> } });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Customer</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Customer&#x27;</span>, schema);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Customer</span>.<span class="hljs-property">collection</span>.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">1</span> }); <span class="hljs-comment">// Index is not in schema</span>
<span class="hljs-comment">// Will drop the &#x27;age&#x27; index and create an index on `name`</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Customer</span>.<span class="hljs-title function_">syncIndexes</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-translateAliases"><a href="#model_Model-translateAliases">Model.translateAliases()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fields
<span class="method-type">&laquo;Object&raquo;</span> fields/conditions that may contain aliased keys</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the translated &#39;pure&#39; fields/conditions</li></ul><div><p>Translate any aliases fields/conditions so the final query or document object is pure</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Character</span>
  .<span class="hljs-title function_">find</span>(<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">translateAliases</span>({
    <span class="hljs-string">&#x27;名&#x27;</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> <span class="hljs-comment">// Alias for &#x27;name&#x27;</span>
  })
  .<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, characters</span>) {})
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Only translate arguments of object type anything else is returned raw</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-update"><a href="#model_Model-update">Model.update()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">doc
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.multi=false]
<span class="method-type">&laquo;Boolean&raquo;</span> whether multiple documents should be updated or just the first one that matches <code>filter</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.runValidators=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.setDefaultsOnInsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> <code>true</code> by default. If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.overwrite=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, if you don&#39;t include any <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">update operators</a> in <code>doc</code>, Mongoose will wrap <code>doc</code> in <code>$set</code> for you. This prevents you from accidentally overwriting the document. This option tells Mongoose to skip adding <code>$set</code>.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html">updateWriteOpResult</a>)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Updates one document in the database without returning it.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>update()</code></li>
</ul>
<p>This method is deprecated. See <a href="../deprecations.html#update">Deprecation Warnings</a> for details.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gt</span>: <span class="hljs-number">18</span> } }, { <span class="hljs-attr">oldEnough</span>: <span class="hljs-literal">true</span> }, fn);

<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Tobi&#x27;</span> }, { <span class="hljs-attr">ferret</span>: <span class="hljs-literal">true</span> });
res.<span class="hljs-property">n</span>; <span class="hljs-comment">// Number of documents that matched `{ name: &#x27;Tobi&#x27; }`</span>
<span class="hljs-comment">// Number of documents that were changed. If every doc matched already</span>
<span class="hljs-comment">// had `ferret` set to `true`, `nModified` will be 0.</span>
res.<span class="hljs-property">nModified</span>;
</code></pre>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options:
      </a>
    </h4>
<ul>
<li><code>strict</code> (boolean): overrides the <a href="/docs/guide.html#strict">schema-level <code>strict</code> option</a> for this update</li>
<li><code>upsert</code> (boolean): whether to create the doc if it doesn&#39;t match (false)</li>
<li><code>writeConcern</code> (object): sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></li>
<li><code>multi</code> (boolean): whether multiple documents should be updated (false)</li>
<li><code>runValidators</code>: if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema.</li>
<li><code>setDefaultsOnInsert</code> (boolean): if this and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on <a href="https://www.mongodb.com/docs/manual/reference/operator/update/setOnInsert/">MongoDB&#39;s <code>$setOnInsert</code> operator</a>.</li>
<li><code>timestamps</code> (boolean): If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</li>
<li><code>overwrite</code> (boolean): disables update-only mode, allowing you to overwrite the doc (false)</li>
</ul>
<p>All <code>update</code> values are cast to their appropriate SchemaTypes before being sent.</p>
<p>The <code>callback</code> function receives <code>(err, rawResponse)</code>.</p>
<ul>
<li><code>err</code> is the error if any occurred</li>
<li><code>rawResponse</code> is the full response from Mongo</li>
</ul>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>All top level keys which are not <code>atomic</code> operation names are treated as set operations:</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;borne&#x27;</span> };
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">update</span>(query, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }, options, callback);

<span class="hljs-comment">// is sent as</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">update</span>(query, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jason bourne&#x27;</span> }}, options, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>));
<span class="hljs-comment">// if overwrite option is false. If overwrite is true, sent without the $set wrapper.</span>
</code></pre>
<p>This helps prevent accidentally overwriting all documents in your collection with <code>{ name: &#39;jason bourne&#39; }</code>.</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p>Be careful to not use an existing model instance for the update clause (this won&#39;t work and can cause weird behavior like infinite loops). Also, ensure that the update clause does not have an _id property, which causes Mongo to return a &quot;Mod on _id not allowed&quot; error.</p>
</div><hr class="separate-api-elements"><h3 id="model_Model-updateMany"><a href="#model_Model-updateMany">Model.updateMany()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">update
<span class="method-type">&laquo;Object|Array&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> <code>function(error, res) {}</code> where <code>res</code> has 5 properties: <code>modifiedCount</code>, <code>matchedCount</code>, <code>acknowledged</code>, <code>upsertedId</code>, and <code>upsertedCount</code>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Same as <code>update()</code>, except MongoDB will update <em>all</em> documents that match
<code>filter</code> (as opposed to just the first one) regardless of the value of
the <code>multi</code> option.</p>
<p><strong>Note</strong> updateMany will <em>not</em> fire update middleware. Use <code>pre(&#39;updateMany&#39;)</code>
and <code>post(&#39;updateMany&#39;)</code> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">updateMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark$/</span> }, { <span class="hljs-attr">isDeleted</span>: <span class="hljs-literal">true</span> });
res.<span class="hljs-property">matchedCount</span>; <span class="hljs-comment">// Number of documents matched</span>
res.<span class="hljs-property">modifiedCount</span>; <span class="hljs-comment">// Number of documents modified</span>
res.<span class="hljs-property">acknowledged</span>; <span class="hljs-comment">// Boolean indicating everything went smoothly.</span>
res.<span class="hljs-property">upsertedId</span>; <span class="hljs-comment">// null or an id containing a document that had to be upserted.</span>
res.<span class="hljs-property">upsertedCount</span>; <span class="hljs-comment">// Number indicating how many documents had to be upserted. Will either be 0 or 1.</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateMany()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-updateOne"><a href="#model_Model-updateOne">Model.updateOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">filter
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">update
<span class="method-type">&laquo;Object|Array&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="https://mongoosejs.com/docs/api/query.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Same as <code>update()</code>, except it does not support the <code>multi</code> or <code>overwrite</code>
options.</p>
<ul>
<li>MongoDB will update <em>only</em> the first document that matches <code>filter</code> regardless of the value of the <code>multi</code> option.</li>
<li>Use <code>replaceOne()</code> if you want to overwrite an entire document rather than using atomic operators like <code>$set</code>.</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> }, { <span class="hljs-attr">ship</span>: <span class="hljs-string">&#x27;USS Enterprise&#x27;</span> });
res.<span class="hljs-property">matchedCount</span>; <span class="hljs-comment">// Number of documents matched</span>
res.<span class="hljs-property">modifiedCount</span>; <span class="hljs-comment">// Number of documents modified</span>
res.<span class="hljs-property">acknowledged</span>; <span class="hljs-comment">// Boolean indicating everything went smoothly.</span>
res.<span class="hljs-property">upsertedId</span>; <span class="hljs-comment">// null or an id containing a document that had to be upserted.</span>
res.<span class="hljs-property">upsertedCount</span>; <span class="hljs-comment">// Number indicating how many documents had to be upserted. Will either be 0 or 1.</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateOne()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="model_Model-validate"><a href="#model_Model-validate">Model.validate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">pathsToValidate
<span class="method-type">&laquo;Array|String&raquo;</span> </li><li class="param">[context]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise,undefined,void&raquo;</span> </li></ul><div><p>Casts and validates the given object against this model&#39;s schema, passing the
given <code>context</code> to custom validators.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> }
});

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">validate</span>({ <span class="hljs-attr">name</span>: <span class="hljs-literal">null</span> }, [<span class="hljs-string">&#x27;name&#x27;</span>])
} <span class="hljs-keyword">catch</span> (err) {
  err <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Error</span>.<span class="hljs-property">ValidationError</span>; <span class="hljs-comment">// true</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(err.<span class="hljs-property">errors</span>); <span class="hljs-comment">// [&#x27;name&#x27;]</span>
}
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-watch"><a href="#model_Model-watch">Model.watch()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pipeline]
<span class="method-type">&laquo;Array&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#watch">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li>[options.hydrate=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true and <code>fullDocument: &#39;updateLookup&#39;</code> is set, Mongoose will automatically hydrate <code>fullDocument</code> into a fully fledged Mongoose document</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ChangeStream&raquo;</span> mongoose-specific change stream wrapper, inherits from EventEmitter</li></ul><div><p><em>Requires a replica set running MongoDB &gt;= 3.6.0.</em> Watches the
underlying collection for changes using
<a href="https://www.mongodb.com/docs/manual/changeStreams/">MongoDB change streams</a>.</p>
<p>This function does <strong>not</strong> trigger any middleware. In particular, it
does <strong>not</strong> trigger aggregate middleware.</p>
<p>The ChangeStream object is an event emitter that emits the following events:</p>
<ul>
<li>&#39;change&#39;: A change occurred, see below example</li>
<li>&#39;error&#39;: An unrecoverable error occurred. In particular, change streams currently error out if they lose connection to the replica set primary. Follow <a href="https://github.com/Automattic/mongoose/issues/6799">this GitHub issue</a> for updates.</li>
<li>&#39;end&#39;: Emitted if the underlying stream is closed</li>
<li>&#39;close&#39;: Emitted if the underlying stream is closed</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> });
<span class="hljs-keyword">const</span> changeStream = <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">watch</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function"><span class="hljs-params">change</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(change));
<span class="hljs-comment">// Will print from the above `console.log()`:</span>
<span class="hljs-comment">// { _id: { _data: ... },</span>
<span class="hljs-comment">//   operationType: &#x27;delete&#x27;,</span>
<span class="hljs-comment">//   ns: { db: &#x27;mydb&#x27;, coll: &#x27;Person&#x27; },</span>
<span class="hljs-comment">//   documentKey: { _id: 5a51b125c5500f5aa094c7bd } }</span>
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">remove</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="model_Model-where"><a href="#model_Model-where">Model.where()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[val]
<span class="method-type">&laquo;Object&raquo;</span> optional value</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> </li></ul><div><p>Creates a Query, applies the passed conditions, and returns the Query.</p>
<p>For example, instead of writing:</p>
<pre><code><span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">$lte</span>: <span class="hljs-number">65</span> } }, callback);
</code></pre>
<p>we can instead write:</p>
<pre><code><span class="hljs-title class_">User</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">21</span>).<span class="hljs-title function_">lte</span>(<span class="hljs-number">65</span>).<span class="hljs-title function_">exec</span>(callback);
</code></pre>
<p>Since the Query class also supports <code>where</code> you can continue chaining</p>
<pre><code><span class="hljs-title class_">User</span>
.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">21</span>).<span class="hljs-title function_">lte</span>(<span class="hljs-number">65</span>)
.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-regexp">/^b/i</span>)
... etc
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/query.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Query"><a href="#Query">Query</a></h2></div><ul><li><a href="#query_Query">Query()</a></li><li><a href="#query_Query-$where">Query.prototype.$where()</a></li><li><a href="#query_Query-all">Query.prototype.all()</a></li><li><a href="#query_Query-allowDiskUse">Query.prototype.allowDiskUse()</a></li><li><a href="#query_Query-and">Query.prototype.and()</a></li><li><a href="#query_Query-batchSize">Query.prototype.batchSize()</a></li><li><a href="#query_Query-box">Query.prototype.box()</a></li><li><a href="#query_Query-cast">Query.prototype.cast()</a></li><li><a href="#query_Query-catch">Query.prototype.catch()</a></li><li><a href="#query_Query-center">Query.prototype.center()</a></li><li><a href="#query_Query-centerSphere">Query.prototype.centerSphere()</a></li><li><a href="#query_Query-circle">Query.prototype.circle()</a></li><li><a href="#query_Query-clone">Query.prototype.clone()</a></li><li><a href="#query_Query-collation">Query.prototype.collation()</a></li><li><a href="#query_Query-comment">Query.prototype.comment()</a></li><li><a href="#query_Query-count">Query.prototype.count()</a></li><li><a href="#query_Query-countDocuments">Query.prototype.countDocuments()</a></li><li><a href="#query_Query-cursor">Query.prototype.cursor()</a></li><li><a href="#query_Query-deleteMany">Query.prototype.deleteMany()</a></li><li><a href="#query_Query-deleteOne">Query.prototype.deleteOne()</a></li><li><a href="#query_Query-distinct">Query.prototype.distinct()</a></li><li><a href="#query_Query-elemMatch">Query.prototype.elemMatch()</a></li><li><a href="#query_Query-equals">Query.prototype.equals()</a></li><li><a href="#query_Query-error">Query.prototype.error()</a></li><li><a href="#query_Query-estimatedDocumentCount">Query.prototype.estimatedDocumentCount()</a></li><li><a href="#query_Query-exec">Query.prototype.exec()</a></li><li><a href="#query_Query-exists">Query.prototype.exists()</a></li><li><a href="#query_Query-explain">Query.prototype.explain()</a></li><li><a href="#query_Query-find">Query.prototype.find()</a></li><li><a href="#query_Query-findOne">Query.prototype.findOne()</a></li><li><a href="#query_Query-findOneAndDelete">Query.prototype.findOneAndDelete()</a></li><li><a href="#query_Query-findOneAndRemove">Query.prototype.findOneAndRemove()</a></li><li><a href="#query_Query-findOneAndReplace">Query.prototype.findOneAndReplace()</a></li><li><a href="#query_Query-findOneAndUpdate">Query.prototype.findOneAndUpdate()</a></li><li><a href="#query_Query-geometry">Query.prototype.geometry()</a></li><li><a href="#query_Query-get">Query.prototype.get()</a></li><li><a href="#query_Query-getFilter">Query.prototype.getFilter()</a></li><li><a href="#query_Query-getOptions">Query.prototype.getOptions()</a></li><li><a href="#query_Query-getPopulatedPaths">Query.prototype.getPopulatedPaths()</a></li><li><a href="#query_Query-getQuery">Query.prototype.getQuery()</a></li><li><a href="#query_Query-getUpdate">Query.prototype.getUpdate()</a></li><li><a href="#query_Query-gt">Query.prototype.gt()</a></li><li><a href="#query_Query-gte">Query.prototype.gte()</a></li><li><a href="#query_Query-hint">Query.prototype.hint()</a></li><li><a href="#query_Query-in">Query.prototype.in()</a></li><li><a href="#query_Query-intersects">Query.prototype.intersects()</a></li><li><a href="#query_Query-j">Query.prototype.j()</a></li><li><a href="#query_Query-lean">Query.prototype.lean()</a></li><li><a href="#query_Query-limit">Query.prototype.limit()</a></li><li><a href="#query_Query-lt">Query.prototype.lt()</a></li><li><a href="#query_Query-lte">Query.prototype.lte()</a></li><li><a href="#query_Query-maxDistance">Query.prototype.maxDistance()</a></li><li><a href="#query_Query-maxScan">Query.prototype.maxScan()</a></li><li><a href="#query_Query-maxTimeMS">Query.prototype.maxTimeMS()</a></li><li><a href="#query_Query-maxscan">Query.prototype.maxscan()</a></li><li><a href="#query_Query-merge">Query.prototype.merge()</a></li><li><a href="#query_Query-mod">Query.prototype.mod()</a></li><li><a href="#query_Query-model">Query.prototype.model</a></li><li><a href="#query_Query-mongooseOptions">Query.prototype.mongooseOptions()</a></li><li><a href="#query_Query-ne">Query.prototype.ne()</a></li><li><a href="#query_Query-near">Query.prototype.near()</a></li><li><a href="#query_Query-nearSphere">Query.prototype.nearSphere()</a></li><li><a href="#query_Query-nin">Query.prototype.nin()</a></li><li><a href="#query_Query-nor">Query.prototype.nor()</a></li><li><a href="#query_Query-or">Query.prototype.or()</a></li><li><a href="#query_Query-orFail">Query.prototype.orFail()</a></li><li><a href="#query_Query-polygon">Query.prototype.polygon()</a></li><li><a href="#query_Query-populate">Query.prototype.populate()</a></li><li><a href="#query_Query-post">Query.prototype.post()</a></li><li><a href="#query_Query-pre">Query.prototype.pre()</a></li><li><a href="#query_Query-projection">Query.prototype.projection()</a></li><li><a href="#query_Query-read">Query.prototype.read()</a></li><li><a href="#query_Query-readConcern">Query.prototype.readConcern()</a></li><li><a href="#query_Query-regex">Query.prototype.regex()</a></li><li><a href="#query_Query-remove">Query.prototype.remove()</a></li><li><a href="#query_Query-replaceOne">Query.prototype.replaceOne()</a></li><li><a href="#query_Query-select">Query.prototype.select()</a></li><li><a href="#query_Query-selected">Query.prototype.selected()</a></li><li><a href="#query_Query-selectedExclusively">Query.prototype.selectedExclusively()</a></li><li><a href="#query_Query-selectedInclusively">Query.prototype.selectedInclusively()</a></li><li><a href="#query_Query-session">Query.prototype.session()</a></li><li><a href="#query_Query-set">Query.prototype.set()</a></li><li><a href="#query_Query-setOptions">Query.prototype.setOptions()</a></li><li><a href="#query_Query-setQuery">Query.prototype.setQuery()</a></li><li><a href="#query_Query-setUpdate">Query.prototype.setUpdate()</a></li><li><a href="#query_Query-size">Query.prototype.size()</a></li><li><a href="#query_Query-skip">Query.prototype.skip()</a></li><li><a href="#query_Query-slice">Query.prototype.slice()</a></li><li><a href="#query_Query-snapshot">Query.prototype.snapshot()</a></li><li><a href="#query_Query-sort">Query.prototype.sort()</a></li><li><a href="#query_Query-tailable">Query.prototype.tailable()</a></li><li><a href="#query_Query-then">Query.prototype.then()</a></li><li><a href="#query_Query-toConstructor">Query.prototype.toConstructor()</a></li><li><a href="#query_Query-transform">Query.prototype.transform()</a></li><li><a href="#query_Query-update">Query.prototype.update()</a></li><li><a href="#query_Query-updateMany">Query.prototype.updateMany()</a></li><li><a href="#query_Query-updateOne">Query.prototype.updateOne()</a></li><li><a href="#query_Query-w">Query.prototype.w()</a></li><li><a href="#query_Query-where">Query.prototype.where()</a></li><li><a href="#query_Query-within">Query.prototype.within()</a></li><li><a href="#query_Query-writeConcern">Query.prototype.writeConcern()</a></li><li><a href="#query_Query-wtimeout">Query.prototype.wtimeout()</a></li><li><a href="#query_Query-[Symbol.asyncIterator]">Query.prototype[Symbol.asyncIterator]()</a></li><li><a href="#query_Query-use$geoWithin">Query.use$geoWithin</a></li></ul><hr class="separate-api-elements"><h3 id="query_Query"><a href="#query_Query">Query()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[model]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[conditions]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[collection]
<span class="method-type">&laquo;Object&raquo;</span> Mongoose collection</p>
</li></ul><div><p>Query constructor used for building queries. You do not need
to instantiate a <code>Query</code> directly. Instead use Model functions like
<a href="/docs/api/model.html#model_Model-find"><code>Model.find()</code></a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>(); <span class="hljs-comment">// `query` is an instance of `Query`</span>
query.<span class="hljs-title function_">setOptions</span>({ lean : <span class="hljs-literal">true</span> });
query.<span class="hljs-title function_">collection</span>(<span class="hljs-title class_">MyModel</span>.<span class="hljs-property">collection</span>);
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">21</span>).<span class="hljs-title function_">exec</span>(callback);

<span class="hljs-comment">// You can instantiate a query directly. There is no need to do</span>
<span class="hljs-comment">// this unless you&#x27;re an advanced user with a very good reason to.</span>
<span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Query</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-$where"><a href="#query_Query-$where">Query.prototype.$where()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">js
<span class="method-type">&laquo;String|Function&raquo;</span> javascript string or function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a javascript function or expression to pass to MongoDBs query system.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.$where(<span class="hljs-string">&#x27;this.comments.length === 10 || this.name.length === 5&#x27;</span>)

<span class="hljs-comment">// or</span>

query.$where(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">comments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">10</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">length</span> === <span class="hljs-number">5</span>;
})
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Only use <code>$where</code> when you have a condition that cannot be met using other MongoDB operators like <code>$lt</code>.
<strong>Be sure to read about all of <a href="https://www.mongodb.com/docs/manual/reference/operator/where/">its caveats</a> before using.</strong></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-all"><a href="#query_Query-all">Query.prototype.all()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Specifies an <code>$all</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;pets&#x27;</span>).<span class="hljs-title function_">all</span>([<span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;ferret&#x27;</span>]);
<span class="hljs-comment">// Equivalent:</span>
<span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">all</span>(<span class="hljs-string">&#x27;pets&#x27;</span>, [<span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;ferret&#x27;</span>]);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-allowDiskUse"><a href="#query_Query-allowDiskUse">Query.prototype.allowDiskUse()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[v]
<span class="method-type">&laquo;Boolean&raquo;</span> Enable/disable <code>allowDiskUse</code>. If called with 0 arguments, sets <code>allowDiskUse: true</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.allowDiskUse/"><code>allowDiskUse</code> option</a>,
which allows the MongoDB server to use more than 100 MB for this query&#39;s <code>sort()</code>. This option can
let you work around <code>QueryExceededMemoryLimitNoDiskUseAllowed</code> errors from the MongoDB server.</p>
<p>Note that this option requires MongoDB server &gt;= 4.4. Setting this option is a no-op for MongoDB 4.2
and earlier.</p>
<p>Calling <code>query.allowDiskUse(v)</code> is equivalent to <code>query.setOptions({ allowDiskUse: v })</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> query.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">allowDiskUse</span>(<span class="hljs-literal">true</span>);
<span class="hljs-comment">// Equivalent:</span>
<span class="hljs-keyword">await</span> query.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">allowDiskUse</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-and"><a href="#query_Query-and">Query.prototype.and()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">array
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies arguments for a <code>$and</code> condition.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">and</span>([{ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;green&#x27;</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> }])
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-batchSize"><a href="#query_Query-batchSize">Query.prototype.batchSize()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies the batchSize option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">batchSize</span>(<span class="hljs-number">100</span>)
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-box"><a href="#query_Query-box">Query.prototype.box()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val1
<span class="method-type">&laquo;Object|Array&lt;Number&gt;&raquo;</span> Lower Left Coordinates OR a object of lower-left(ll) and upper-right(ur) Coordinates</p>
</li><li class="param">[val2]
<span class="method-type">&laquo;Array&lt;Number&gt;&raquo;</span> Upper Right Coordinates</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$box</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> lowerLeft = [<span class="hljs-number">40.73083</span>, -<span class="hljs-number">73.99756</span>]
<span class="hljs-keyword">const</span> upperRight= [<span class="hljs-number">40.741404</span>,  -<span class="hljs-number">73.988135</span>]

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">box</span>(lowerLeft, upperRight)
query.<span class="hljs-title function_">box</span>({ ll : lowerLeft, ur : upperRight })
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-cast"><a href="#query_Query-cast">Query.prototype.cast()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[model]
<span class="method-type">&laquo;Model&raquo;</span> the model to cast to. If not set, defaults to <code>this.model</code></p>
</li><li class="param">[obj]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Casts this query to the schema of <code>model</code></p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>If <code>obj</code> is present, it is cast instead of this query.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-catch"><a href="#query_Query-catch">Query.prototype.catch()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[reject]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with either the doc(s) or rejected with the error.
Like <code>.then()</code>, but only takes a rejection handler.</p>
<p>More about <a href="https://masteringjs.io/tutorials/fundamentals/catch">Promise <code>catch()</code> in JavaScript</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-center"><a href="#query_Query-center">Query.prototype.center()</a></h3><div><p><em>DEPRECATED</em> Alias for <a href="#query_Query-circle">circle</a></p>
<p><strong>Deprecated.</strong> Use <a href="#query_Query-circle">circle</a> instead.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-centerSphere"><a href="#query_Query-centerSphere">Query.prototype.centerSphere()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p><em>DEPRECATED</em> Specifies a <code>$centerSphere</code> condition</p>
<p><strong>Deprecated.</strong> Use <a href="#query_Query-circle">circle</a> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> area = { <span class="hljs-attr">center</span>: [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span> };
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">centerSphere</span>(area);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-circle"><a href="#query_Query-circle">Query.prototype.circle()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">area
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$center</code> or <code>$centerSphere</code> condition.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> area = { <span class="hljs-attr">center</span>: [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> }
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">circle</span>(area)
<span class="hljs-comment">// alternatively</span>
query.<span class="hljs-title function_">circle</span>(<span class="hljs-string">&#x27;loc&#x27;</span>, area);

<span class="hljs-comment">// spherical calculations</span>
<span class="hljs-keyword">const</span> area = { <span class="hljs-attr">center</span>: [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">spherical</span>: <span class="hljs-literal">true</span> }
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">circle</span>(area)
<span class="hljs-comment">// alternatively</span>
query.<span class="hljs-title function_">circle</span>(<span class="hljs-string">&#x27;loc&#x27;</span>, area);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-clone"><a href="#query_Query-clone">Query.prototype.clone()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> copy</li></ul><div><p>Make a copy of this query so you can re-execute it.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> q = <span class="hljs-title class_">Book</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Casino Royale&#x27;</span> });
<span class="hljs-keyword">await</span> q.<span class="hljs-title function_">exec</span>();
<span class="hljs-keyword">await</span> q.<span class="hljs-title function_">exec</span>(); <span class="hljs-comment">// Throws an error because you can&#x27;t execute a query twice</span>

<span class="hljs-keyword">await</span> q.<span class="hljs-title function_">clone</span>().<span class="hljs-title function_">exec</span>(); <span class="hljs-comment">// Works</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-collation"><a href="#query_Query-collation">Query.prototype.collation()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Adds a collation to this op (MongoDB 3.4 and up)</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-comment"><a href="#query_Query-comment">Query.prototype.comment()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Specifies the <code>comment</code> option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">comment</span>(<span class="hljs-string">&#x27;login query&#x27;</span>)
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-count"><a href="#query_Query-count">Query.prototype.count()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> count documents that match this object</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, count)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies this query as a <code>count</code> query.</p>
<p>This method is deprecated. If you want to count the number of documents in
a collection, e.g. <code>count({})</code>, use the <a href="#query_Query-estimatedDocumentCount"><code>estimatedDocumentCount()</code> function</a>
instead. Otherwise, use the <a href="#query_Query-countDocuments"><code>countDocuments()</code></a> function instead.</p>
<p>Passing a <code>callback</code> executes the query.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>count()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> countQuery = model.<span class="hljs-title function_">where</span>({ <span class="hljs-string">&#x27;color&#x27;</span>: <span class="hljs-string">&#x27;black&#x27;</span> }).<span class="hljs-title function_">count</span>();

query.<span class="hljs-title function_">count</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;black&#x27;</span> }).<span class="hljs-title function_">count</span>(callback)

query.<span class="hljs-title function_">count</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;black&#x27;</span> }, callback)

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;color&#x27;</span>, <span class="hljs-string">&#x27;black&#x27;</span>).<span class="hljs-title function_">count</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, count</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleError</span>(err);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;there are %d kittens&#x27;</span>, count);
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-countDocuments"><a href="#query_Query-countDocuments">Query.prototype.countDocuments()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> mongodb selector</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, count)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies this query as a <code>countDocuments()</code> query. Behaves like <code>count()</code>,
except it always does a full collection scan when passed an empty filter <code>{}</code>.</p>
<p>There are also minor differences in how <code>countDocuments()</code> handles
<a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments"><code>$where</code> and a couple geospatial operators</a>.
versus <code>count()</code>.</p>
<p>Passing a <code>callback</code> executes the query.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>countDocuments()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> countQuery = model.<span class="hljs-title function_">where</span>({ <span class="hljs-string">&#x27;color&#x27;</span>: <span class="hljs-string">&#x27;black&#x27;</span> }).<span class="hljs-title function_">countDocuments</span>();

query.<span class="hljs-title function_">countDocuments</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;black&#x27;</span> }).<span class="hljs-title function_">count</span>(callback);

query.<span class="hljs-title function_">countDocuments</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;black&#x27;</span> }, callback);

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;color&#x27;</span>, <span class="hljs-string">&#x27;black&#x27;</span>).<span class="hljs-title function_">countDocuments</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, count</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleError</span>(err);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;there are %d kittens&#x27;</span>, count);
});
</code></pre>
<p>The <code>countDocuments()</code> function is similar to <code>count()</code>, but there are a
<a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments">few operators that <code>countDocuments()</code> does not support</a>.
Below are the operators that <code>count()</code> supports but <code>countDocuments()</code> does not,
and the suggested replacement:</p>
<ul>
<li><code>$where</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/expr/"><code>$expr</code></a></li>
<li><code>$near</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center"><code>$center</code></a></li>
<li><code>$nearSphere</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere"><code>$centerSphere</code></a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-cursor"><a href="#query_Query-cursor">Query.prototype.cursor()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;QueryCursor&raquo;</span> </li></ul><div><p>Returns a wrapper around a <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/FindCursor.html">mongodb driver cursor</a>.
A QueryCursor exposes a Streams3 interface, as well as a <code>.next()</code> function.</p>
<p>The <code>.cursor()</code> function triggers pre find hooks, but <strong>not</strong> post find hooks.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// There are 2 ways to use a cursor. First, as a stream:</span>
<span class="hljs-title class_">Thing</span>.
  <span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">doc</span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc); }).
  <span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Done!&#x27;</span>); });

<span class="hljs-comment">// Or you can use `.next()` to manually get the next doc in the stream.</span>
<span class="hljs-comment">// `.next()` returns a promise, so you can use promises or callbacks.</span>
<span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).<span class="hljs-title function_">cursor</span>();
cursor.<span class="hljs-title function_">next</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc);
});

<span class="hljs-comment">// Because `.next()` returns a promise, you can use co</span>
<span class="hljs-comment">// to easily iterate through all documents without loading them</span>
<span class="hljs-comment">// all into memory.</span>
<span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).<span class="hljs-title function_">cursor</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> doc = <span class="hljs-keyword">await</span> cursor.<span class="hljs-title function_">next</span>(); doc != <span class="hljs-literal">null</span>; doc = <span class="hljs-keyword">await</span> cursor.<span class="hljs-title function_">next</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc);
}
</code></pre>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options
      </a>
    </h4>
<ul>
<li><code>transform</code>: optional function which accepts a mongoose document. The return value of the function will be emitted on <code>data</code> and returned by <code>.next()</code>.</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-deleteMany"><a href="#query_Query-deleteMany">Query.prototype.deleteMany()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object|Query&raquo;</span> mongodb selector</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, mongooseDeleteResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as a <code>deleteMany()</code> operation. Works like
remove, except it deletes <em>every</em> document that matches <code>filter</code> in the
collection, regardless of the value of <code>single</code>.</p>
<p>This function triggers <code>deleteMany</code> middleware.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> } });

<span class="hljs-comment">// Using callbacks:</span>
<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> } }, callback);
</code></pre>
<p>This function calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteMany"><code>Collection#deleteMany()</code> function</a>.
The returned <a href="https://mongoosejs.com/docs/queries.html">promise</a> resolves to an
object that contains 3 properties:</p>
<ul>
<li><code>ok</code>: <code>1</code> if no errors occurred</li>
<li><code>deletedCount</code>: the number of documents deleted</li>
<li><code>n</code>: the number of documents deleted. Equal to <code>deletedCount</code>.</li>
</ul>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">18</span> } });
<span class="hljs-comment">// `0` if no docs matched the filter, number of docs deleted otherwise</span>
res.<span class="hljs-property">deletedCount</span>;
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-deleteOne"><a href="#query_Query-deleteOne">Query.prototype.deleteOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object|Query&raquo;</span> mongodb selector</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, mongooseDeleteResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as a <code>deleteOne()</code> operation. Works like
remove, except it deletes at most one document regardless of the <code>single</code>
option.</p>
<p>This function triggers <code>deleteOne</code> middleware.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> });

<span class="hljs-comment">// Using callbacks:</span>
<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> }, callback);
</code></pre>
<p>This function calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteOne"><code>Collection#deleteOne()</code> function</a>.
The returned <a href="https://mongoosejs.com/docs/queries.html">promise</a> resolves to an
object that contains 3 properties:</p>
<ul>
<li><code>ok</code>: <code>1</code> if no errors occurred</li>
<li><code>deletedCount</code>: the number of documents deleted</li>
<li><code>n</code>: the number of documents deleted. Equal to <code>deletedCount</code>.</li>
</ul>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Eddard Stark&#x27;</span> });
<span class="hljs-comment">// `1` if MongoDB deleted a doc, `0` if no docs matched the filter `{ name: ... }`</span>
res.<span class="hljs-property">deletedCount</span>;
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-distinct"><a href="#query_Query-distinct">Query.prototype.distinct()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[field]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[filter]
<span class="method-type">&laquo;Object|Query&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, arr)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declares or executes a distinct() operation.</p>
<p>Passing a <code>callback</code> executes the query.</p>
<p>This function does not trigger any middleware.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title function_">distinct</span>(field, conditions, callback)
<span class="hljs-title function_">distinct</span>(field, conditions)
<span class="hljs-title function_">distinct</span>(field, callback)
<span class="hljs-title function_">distinct</span>(field)
<span class="hljs-title function_">distinct</span>(callback)
<span class="hljs-title function_">distinct</span>()
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-elemMatch"><a href="#query_Query-elemMatch">Query.prototype.elemMatch()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object|Function&raquo;</span> </li><li class="param">filter
<span class="method-type">&laquo;Object|Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies an <code>$elemMatch</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">elemMatch</span>(<span class="hljs-string">&#x27;comment&#x27;</span>, { <span class="hljs-attr">author</span>: <span class="hljs-string">&#x27;autobot&#x27;</span>, <span class="hljs-attr">votes</span>: {<span class="hljs-attr">$gte</span>: <span class="hljs-number">5</span>}})

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;comment&#x27;</span>).<span class="hljs-title function_">elemMatch</span>({ <span class="hljs-attr">author</span>: <span class="hljs-string">&#x27;autobot&#x27;</span>, <span class="hljs-attr">votes</span>: {<span class="hljs-attr">$gte</span>: <span class="hljs-number">5</span>}})

query.<span class="hljs-title function_">elemMatch</span>(<span class="hljs-string">&#x27;comment&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">elem</span>) {
  elem.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;author&#x27;</span>).<span class="hljs-title function_">equals</span>(<span class="hljs-string">&#x27;autobot&#x27;</span>);
  elem.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;votes&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">5</span>);
})

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;comment&#x27;</span>).<span class="hljs-title function_">elemMatch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">elem</span>) {
  elem.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">author</span>: <span class="hljs-string">&#x27;autobot&#x27;</span> });
  elem.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;votes&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">5</span>);
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-equals"><a href="#query_Query-equals">Query.prototype.equals()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies the complementary comparison value for paths specified with <code>where()</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">User</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">equals</span>(<span class="hljs-number">49</span>);

<span class="hljs-comment">// is the same as</span>

<span class="hljs-title class_">User</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-number">49</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-error"><a href="#query_Query-error">Query.prototype.error()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">err
<span class="method-type">&laquo;Error|null&raquo;</span> if set, <code>exec()</code> will fail fast before sending the query to MongoDB</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Gets/sets the error flag on this query. If this flag is not null or
undefined, the <code>exec()</code> promise will reject without executing.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Query</span>().<span class="hljs-title function_">error</span>(); <span class="hljs-comment">// Get current error value</span>
<span class="hljs-title class_">Query</span>().<span class="hljs-title function_">error</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// Unset the current error</span>
<span class="hljs-title class_">Query</span>().<span class="hljs-title function_">error</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;test&#x27;</span>)); <span class="hljs-comment">// `exec()` will resolve with test</span>
<span class="hljs-title class_">Schema</span>.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;find&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getQuery</span>().<span class="hljs-property">userId</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">error</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Not allowed to query without setting userId&#x27;</span>));
  }
});
</code></pre>
<p>Note that query casting runs <strong>after</strong> hooks, so cast errors will override
custom errors.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">TestSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: <span class="hljs-title class_">Number</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TestModel</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-title class_">TestSchema</span>);
<span class="hljs-title class_">TestModel</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">&#x27;not a number&#x27;</span> }).<span class="hljs-title function_">error</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;woops&#x27;</span>)).<span class="hljs-title function_">exec</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-comment">// `error` will be a cast error because `num` failed to cast</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-estimatedDocumentCount"><a href="#query_Query-estimatedDocumentCount">Query.prototype.estimatedDocumentCount()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> passed transparently to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/EstimatedDocumentCountOptions.html">MongoDB driver</a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, count)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies this query as a <code>estimatedDocumentCount()</code> query. Faster than
using <code>countDocuments()</code> for large collections because
<code>estimatedDocumentCount()</code> uses collection metadata rather than scanning
the entire collection.</p>
<p><code>estimatedDocumentCount()</code> does <strong>not</strong> accept a filter. <code>Model.find({ foo: bar }).estimatedDocumentCount()</code>
is equivalent to <code>Model.find().estimatedDocumentCount()</code></p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>estimatedDocumentCount()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">estimatedDocumentCount</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-exec"><a href="#query_Query-exec">Query.prototype.exec()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[operation]
<span class="method-type">&laquo;String|Function&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params depend on the function being called</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> promise = query.<span class="hljs-title function_">exec</span>();
<span class="hljs-keyword">const</span> promise = query.<span class="hljs-title function_">exec</span>(<span class="hljs-string">&#x27;update&#x27;</span>);

query.<span class="hljs-title function_">exec</span>(callback);
query.<span class="hljs-title function_">exec</span>(<span class="hljs-string">&#x27;find&#x27;</span>, callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-exists"><a href="#query_Query-exists">Query.prototype.exists()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies an <code>$exists</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// { name: { $exists: true }}</span>
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">exists</span>()
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">exists</span>(<span class="hljs-literal">true</span>)
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exists</span>(<span class="hljs-string">&#x27;name&#x27;</span>)

<span class="hljs-comment">// { name: { $exists: false }}</span>
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">exists</span>(<span class="hljs-literal">false</span>);
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exists</span>(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-literal">false</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-explain"><a href="#query_Query-explain">Query.prototype.explain()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[verbose]
<span class="method-type">&laquo;String&raquo;</span> The verbosity mode. Either &#39;queryPlanner&#39;, &#39;executionStats&#39;, or &#39;allPlansExecution&#39;. The default is &#39;queryPlanner&#39;</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.explain/"><code>explain</code> option</a>,
which makes this query return detailed execution stats instead of the actual
query result. This method is useful for determining what index your queries
use.</p>
<p>Calling <code>query.explain(v)</code> is equivalent to <code>query.setOptions({ explain: v })</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> query.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">explain</span>(<span class="hljs-string">&#x27;queryPlanner&#x27;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-find"><a href="#query_Query-find">Query.prototype.find()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object|ObjectId&raquo;</span> mongodb selector. If not specified, returns all documents.</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Find all documents that match <code>selector</code>. The result will be an array of documents.</p>
<p>If there are too many documents in the result to fit in memory, use
<a href="#query_Query-cursor"><code>Query.prototype.cursor()</code></a></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Using async/await</span>
<span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Movie</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">year</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">1980</span>, <span class="hljs-attr">$lte</span>: <span class="hljs-number">1989</span> } });

<span class="hljs-comment">// Using callbacks</span>
<span class="hljs-title class_">Movie</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">year</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">1980</span>, <span class="hljs-attr">$lte</span>: <span class="hljs-number">1989</span> } }, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, arr</span>) {});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-findOne"><a href="#query_Query-findOne">Query.prototype.findOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> mongodb selector</p>
</li><li class="param">[projection]
<span class="method-type">&laquo;Object&raquo;</span> optional fields to return</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> see <a href="#query_Query-setOptions"><code>setOptions()</code></a></p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, document)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declares the query a findOne operation. When executed, the first found document is passed to the callback.</p>
<p>Passing a <code>callback</code> executes the query. The result of the query is a single document.</p>
<ul>
<li><em>Note:</em> <code>conditions</code> is optional, and if <code>conditions</code> is null or undefined,
mongoose will send an empty <code>findOne</code> command to MongoDB, which will return
an arbitrary document. If you&#39;re querying by <code>_id</code>, use <code>Model.findById()</code>
instead.</li>
</ul>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOne()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query  = <span class="hljs-title class_">Kitten</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;white&#x27;</span> });
query.<span class="hljs-title function_">findOne</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, kitten</span>) {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleError</span>(err);
  <span class="hljs-keyword">if</span> (kitten) {
    <span class="hljs-comment">// doc may be null if no document matched</span>
  }
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-findOneAndDelete"><a href="#query_Query-findOneAndDelete">Query.prototype.findOneAndDelete()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, document)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Issues a MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndDelete/">findOneAndDelete</a> command.</p>
<p>Finds a matching document, removes it, and passes the found document (if any)
to the callback. Executes if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndDelete()</code></li>
</ul>
<p>This function differs slightly from <code>Model.findOneAndRemove()</code> in that
<code>findOneAndRemove()</code> becomes a <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findAndModify/">MongoDB <code>findAndModify()</code> command</a>,
as opposed to a <code>findOneAndDelete()</code> command. For most mongoose use cases,
this distinction is purely pedantic. You should use <code>findOneAndDelete()</code>
unless you have a good reason not to.</p>
<h4 id="available-options">
      <a href="#available-options">
        Available options
      </a>
    </h4>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>rawResult</code>: if true, resolves to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></li>
</ul>
<h4 id="callback-signature">
      <a href="#callback-signature">
        Callback Signature
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-comment">// error: any errors that occurred</span>
  <span class="hljs-comment">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
}
</code></pre>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>(conditions, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>(conditions, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>(conditions, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>(conditions) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>(callback)   <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndDelete</span>()           <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-findOneAndRemove"><a href="#query_Query-findOneAndRemove">Query.prototype.findOneAndRemove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[conditions]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, document)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Issues a mongodb <a href="https://www.mongodb.com/docs/manual/reference/command/findAndModify/">findAndModify</a> remove command.</p>
<p>Finds a matching document, removes it, passing the found document (if any) to
the callback. Executes if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndRemove()</code></li>
</ul>
<h4 id="available-options">
      <a href="#available-options">
        Available options
      </a>
    </h4>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>rawResult</code>: if true, resolves to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></li>
</ul>
<h4 id="callback-signature">
      <a href="#callback-signature">
        Callback Signature
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-comment">// error: any errors that occurred</span>
  <span class="hljs-comment">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
}
</code></pre>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>(conditions, options, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>(conditions, options)  <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>(conditions, callback) <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>(conditions) <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>(callback)   <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndRemove</span>()           <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-findOneAndReplace"><a href="#query_Query-findOneAndReplace">Query.prototype.findOneAndReplace()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[replacement]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.new=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>findOneAndUpdate()</code> returns the document as it was <strong>before</strong> <code>update</code> was applied. If you set <code>new: true</code>, <code>findOneAndUpdate()</code> will instead give you the object after <code>update</code> was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="#query_Query-lean"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.returnOriginal=null]
<span class="method-type">&laquo;Boolean&raquo;</span> An alias for the <code>new</code> option. <code>returnOriginal: false</code> is equivalent to <code>new: true</code>.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, document)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Issues a MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndReplace/">findOneAndReplace</a> command.</p>
<p>Finds a matching document, removes it, and passes the found document (if any)
to the callback. Executes if <code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndReplace()</code></li>
</ul>
<h4 id="available-options">
      <a href="#available-options">
        Available options
      </a>
    </h4>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>rawResult</code>: if true, resolves to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></li>
</ul>
<h4 id="callback-signature">
      <a href="#callback-signature">
        Callback Signature
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-comment">// error: any errors that occurred</span>
  <span class="hljs-comment">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
}
</code></pre>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, options, callback); <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, options); <span class="hljs-comment">// return Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(filter, replacement, callback); <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(filter); <span class="hljs-comment">// returns Query</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(callback); <span class="hljs-comment">// executes</span>
A.<span class="hljs-title function_">where</span>().<span class="hljs-title function_">findOneAndReplace</span>(); <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-findOneAndUpdate"><a href="#query_Query-findOneAndUpdate">Query.prototype.findOneAndUpdate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object|Query&raquo;</span> </li><li class="param">[doc]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.rawResult]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.multipleCastError]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.new=false]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>findOneAndUpdate()</code> returns the document as it was <strong>before</strong> <code>update</code> was applied. If you set <code>new: true</code>, <code>findOneAndUpdate()</code> will instead give you the object after <code>update</code> was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.lean]
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="#query_Query-lean"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session=null]
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.returnOriginal=null]
<span class="method-type">&laquo;Boolean&raquo;</span> An alias for the <code>new</code> option. <code>returnOriginal: false</code> is equivalent to <code>new: true</code>.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, doc), <em>unless</em> <code>rawResult</code> is used, in which case params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Issues a mongodb <a href="https://www.mongodb.com/docs/manual/reference/command/findAndModify/">findAndModify</a> update command.</p>
<p>Finds a matching document, updates it according to the <code>update</code> arg, passing any <code>options</code>, and returns the found
document (if any) to the callback. The query executes if
<code>callback</code> is passed.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndUpdate()</code></li>
</ul>
<h4 id="available-options">
      <a href="#available-options">
        Available options
      </a>
    </h4>
<ul>
<li><code>new</code>: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)</li>
<li><code>upsert</code>: bool - creates the object if it doesn&#39;t exist. defaults to false.</li>
<li><code>fields</code>: {Object|String} - Field selection. Equivalent to <code>.select(fields).findOneAndUpdate()</code></li>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>runValidators</code>: if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema.</li>
<li><code>setDefaultsOnInsert</code>: <code>true</code> by default. If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created.</li>
<li><code>rawResult</code>: if true, returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">raw result from the MongoDB driver</a></li>
</ul>
<h4 id="callback-signature">
      <a href="#callback-signature">
        Callback Signature
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-comment">// error: any errors that occurred</span>
  <span class="hljs-comment">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
}
</code></pre>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, options, callback) <span class="hljs-comment">// executes</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, options)  <span class="hljs-comment">// returns Query</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update, callback) <span class="hljs-comment">// executes</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(conditions, update)           <span class="hljs-comment">// returns Query</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(update, callback)             <span class="hljs-comment">// returns Query</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(update)                       <span class="hljs-comment">// returns Query</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>(callback)                     <span class="hljs-comment">// executes</span>
query.<span class="hljs-title function_">findOneAndUpdate</span>()                             <span class="hljs-comment">// returns Query</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-geometry"><a href="#query_Query-geometry">Query.prototype.geometry()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">object
<span class="method-type">&laquo;Object&raquo;</span> Must contain a <code>type</code> property which is a String and a <code>coordinates</code> property which is an Array. See the examples.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$geometry</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> polyA = [[[ <span class="hljs-number">10</span>, <span class="hljs-number">20</span> ], [ <span class="hljs-number">10</span>, <span class="hljs-number">40</span> ], [ <span class="hljs-number">30</span>, <span class="hljs-number">40</span> ], [ <span class="hljs-number">30</span>, <span class="hljs-number">20</span> ]]]
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">geometry</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Polygon&#x27;</span>, <span class="hljs-attr">coordinates</span>: polyA })

<span class="hljs-comment">// or</span>
<span class="hljs-keyword">const</span> polyB = [[ <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ], [ <span class="hljs-number">1</span>, <span class="hljs-number">1</span> ]]
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">geometry</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>, <span class="hljs-attr">coordinates</span>: polyB })

<span class="hljs-comment">// or</span>
<span class="hljs-keyword">const</span> polyC = [ <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ]
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">geometry</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>, <span class="hljs-attr">coordinates</span>: polyC })

<span class="hljs-comment">// or</span>
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">intersects</span>().<span class="hljs-title function_">geometry</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>, <span class="hljs-attr">coordinates</span>: polyC })
</code></pre>
<p>The argument is assigned to the most recent path passed to <code>where()</code>.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><code>geometry()</code> <strong>must</strong> come after either <code>intersects()</code> or <code>within()</code>.</p>
<p>The <code>object</code> argument must contain <code>type</code> and <code>coordinates</code> properties.</p>
<ul>
<li>type {String}</li>
<li>coordinates {Array}</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-get"><a href="#query_Query-get">Query.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/value pairs to get</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>For update operations, returns the value of a path in the update&#39;s <code>$set</code>.
Useful for writing getters/setters that can work with both update operations
and <code>save()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> } });
query.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;name&#x27;</span>); <span class="hljs-comment">// &#x27;Jean-Luc Picard&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-getFilter"><a href="#query_Query-getFilter">Query.prototype.getFilter()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current query filter</li></ul><div><p>Returns the current query filter (also known as conditions) as a <a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;b&#x27;</span>).<span class="hljs-title function_">gt</span>(<span class="hljs-number">2</span>);
query.<span class="hljs-title function_">getFilter</span>(); <span class="hljs-comment">// { a: 1, b: { $gt: 2 } }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-getOptions"><a href="#query_Query-getOptions">Query.prototype.getOptions()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the options</li></ul><div><p>Gets query options.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">limit</span>(<span class="hljs-number">10</span>);
query.<span class="hljs-title function_">setOptions</span>({ <span class="hljs-attr">maxTimeMS</span>: <span class="hljs-number">1000</span> });
query.<span class="hljs-title function_">getOptions</span>(); <span class="hljs-comment">// { limit: 10, maxTimeMS: 1000 }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-getPopulatedPaths"><a href="#query_Query-getPopulatedPaths">Query.prototype.getPopulatedPaths()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> an array of strings representing populated paths</li></ul><div><p>Gets a list of paths to be populated by this query</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code> bookSchema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">&#x27;findOne&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
   <span class="hljs-keyword">let</span> keys = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPopulatedPaths</span>(); <span class="hljs-comment">// [&#x27;author&#x27;]</span>
 });
 ...
 <span class="hljs-title class_">Book</span>.<span class="hljs-title function_">findOne</span>({}).<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;author&#x27;</span>);
</code></pre>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code> <span class="hljs-comment">// Deep populate</span>
 <span class="hljs-keyword">const</span> q = <span class="hljs-variable constant_">L1</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">populate</span>({
   <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;level2&#x27;</span>,
   <span class="hljs-attr">populate</span>: { <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;level3&#x27;</span> }
 });
 q.<span class="hljs-title function_">getPopulatedPaths</span>(); <span class="hljs-comment">// [&#x27;level2&#x27;, &#x27;level2.level3&#x27;]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-getQuery"><a href="#query_Query-getQuery">Query.prototype.getQuery()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current query filter</li></ul><div><p>Returns the current query filter. Equivalent to <code>getFilter()</code>.</p>
<p>You should use <code>getFilter()</code> instead of <code>getQuery()</code> where possible. <code>getQuery()</code>
will likely be deprecated in a future release.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;b&#x27;</span>).<span class="hljs-title function_">gt</span>(<span class="hljs-number">2</span>);
query.<span class="hljs-title function_">getQuery</span>(); <span class="hljs-comment">// { a: 1, b: { $gt: 2 } }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-getUpdate"><a href="#query_Query-getUpdate">Query.prototype.getUpdate()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current update operations</li></ul><div><p>Returns the current update operations as a JSON object.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">update</span>({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">5</span> } });
query.<span class="hljs-title function_">getUpdate</span>(); <span class="hljs-comment">// { $set: { a: 5 } }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-gt"><a href="#query_Query-gt">Query.prototype.gt()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>$gt</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gt</span>(<span class="hljs-number">21</span>);

<span class="hljs-comment">// or</span>
<span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">gt</span>(<span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-number">21</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-gte"><a href="#query_Query-gte">Query.prototype.gte()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>$gte</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-hint"><a href="#query_Query-hint">Query.prototype.hint()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Object&raquo;</span> a hint object</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets query hints.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">hint</span>({ <span class="hljs-attr">indexA</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">indexB</span>: -<span class="hljs-number">1</span> });
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-in"><a href="#query_Query-in">Query.prototype.in()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Specifies an <code>$in</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-intersects"><a href="#query_Query-intersects">Query.prototype.intersects()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[arg]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declares an intersects query for <code>geometry()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;path&#x27;</span>).<span class="hljs-title function_">intersects</span>().<span class="hljs-title function_">geometry</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>,
  <span class="hljs-attr">coordinates</span>: [[<span class="hljs-number">180.0</span>, <span class="hljs-number">11.0</span>], [<span class="hljs-number">180</span>, <span class="hljs-number">9.0</span>]]
});

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;path&#x27;</span>).<span class="hljs-title function_">intersects</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>,
  <span class="hljs-attr">coordinates</span>: [[<span class="hljs-number">180.0</span>, <span class="hljs-number">11.0</span>], [<span class="hljs-number">180</span>, <span class="hljs-number">9.0</span>]]
});
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><strong>MUST</strong> be used after <code>where()</code>.</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p>In Mongoose 3.7, <code>intersects</code> changed from a getter to a function. If you need the old syntax, use <a href="https://github.com/ebensing/mongoose-within">this</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-j"><a href="#query_Query-j">Query.prototype.j()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Requests acknowledgement that this operation has been persisted to MongoDB&#39;s
on-disk journal.
This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>remove()</code></li>
<li><code>update()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.j</code> option</a></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>).<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }).<span class="hljs-title function_">j</span>(<span class="hljs-literal">true</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-lean"><a href="#query_Query-lean">Query.prototype.lean()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean|Object&raquo;</span> defaults to true</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the lean option.</p>
<p>Documents returned from queries with the <code>lean</code> option enabled are plain
javascript objects, not <a href="/docs/api/document.html">Mongoose Documents</a>. They have no
<code>save</code> method, getters/setters, virtuals, or other Mongoose features.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">lean</span>() <span class="hljs-comment">// true</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">lean</span>(<span class="hljs-literal">true</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">lean</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> docs = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">lean</span>();
docs[<span class="hljs-number">0</span>] <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Document</span>; <span class="hljs-comment">// false</span>
</code></pre>
<p><a href="/docs/tutorials/lean.html">Lean is great for high-performance, read-only cases</a>,
especially when combined
with <a href="/docs/queries.html#streaming">cursors</a>.</p>
<p>If you need virtuals, getters/setters, or defaults with <code>lean()</code>, you need
to use a plugin. See:</p>
<ul>
<li><a href="https://plugins.mongoosejs.io/plugins/lean-virtuals">mongoose-lean-virtuals</a></li>
<li><a href="https://plugins.mongoosejs.io/plugins/lean-getters">mongoose-lean-getters</a></li>
<li><a href="https://www.npmjs.com/package/mongoose-lean-defaults">mongoose-lean-defaults</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-limit"><a href="#query_Query-limit">Query.prototype.limit()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies the maximum number of documents the query will return.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">limit</span>(<span class="hljs-number">20</span>);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-lt"><a href="#query_Query-lt">Query.prototype.lt()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>$lt</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-lte"><a href="#query_Query-lte">Query.prototype.lte()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>$lte</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-maxDistance"><a href="#query_Query-maxDistance">Query.prototype.maxDistance()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>maxDistance</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-maxScan"><a href="#query_Query-maxScan">Query.prototype.maxScan()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies the maxScan option.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">maxScan</span>(<span class="hljs-number">100</span>);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-maxTimeMS"><a href="#query_Query-maxTimeMS">Query.prototype.maxTimeMS()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[ms]
<span class="method-type">&laquo;Number&raquo;</span> The number of milliseconds</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.maxTimeMS/">maxTimeMS</a>
option. This will tell the MongoDB server to abort if the query or write op
has been running for more than <code>ms</code> milliseconds.</p>
<p>Calling <code>query.maxTimeMS(v)</code> is equivalent to <code>query.setOptions({ maxTimeMS: v })</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
<span class="hljs-comment">// Throws an error &#x27;operation exceeded time limit&#x27; as long as there&#x27;s</span>
<span class="hljs-comment">// &gt;= 1 doc in the queried collection</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> query.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">$where</span>: <span class="hljs-string">&#x27;sleep(1000) || true&#x27;</span> }).<span class="hljs-title function_">maxTimeMS</span>(<span class="hljs-number">100</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-maxscan"><a href="#query_Query-maxscan">Query.prototype.maxscan()</a></h3><div><p><em>DEPRECATED</em> Alias of <code>maxScan</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-merge"><a href="#query_Query-merge">Query.prototype.merge()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">source
<span class="method-type">&laquo;Query|Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Merges another Query or conditions object into this one.</p>
<p>When a Query is passed, conditions, field selection and options are merged.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-mod"><a href="#query_Query-mod">Query.prototype.mod()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Array&raquo;</span> must be of length 2, first element is <code>divisor</code>, 2nd element is <code>remainder</code>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$mod</code> condition, filters documents for documents whose
<code>path</code> property is a number that is equal to <code>remainder</code> modulo <code>divisor</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// All find products whose inventory is odd</span>
<span class="hljs-title class_">Product</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">mod</span>(<span class="hljs-string">&#x27;inventory&#x27;</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>]);
<span class="hljs-title class_">Product</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;inventory&#x27;</span>).<span class="hljs-title function_">mod</span>([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>]);
<span class="hljs-comment">// This syntax is a little strange, but supported.</span>
<span class="hljs-title class_">Product</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;inventory&#x27;</span>).<span class="hljs-title function_">mod</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-model"><a href="#query_Query-model">Query.prototype.model</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The model this query is associated with.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> q = <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">find</span>();
q.<span class="hljs-property">model</span> === <span class="hljs-title class_">MyModel</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-mongooseOptions"><a href="#query_Query-mongooseOptions">Query.prototype.mongooseOptions()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> if specified, overwrites the current options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the options</li></ul><div><p>Getter/setter around the current mongoose-specific options for this query
Below are the current Mongoose-specific options.</p>
<ul>
<li><code>populate</code>: an array representing what paths will be populated. Should have one entry for each call to <a href="#query_Query-populate"><code>Query.prototype.populate()</code></a></li>
<li><code>lean</code>: if truthy, Mongoose will not <a href="/docs/api/model.html#model_Model-hydrate">hydrate</a> any documents that are returned from this query. See <a href="#query_Query-lean"><code>Query.prototype.lean()</code></a> for more information.</li>
<li><code>strict</code>: controls how Mongoose handles keys that aren&#39;t in the schema for updates. This option is <code>true</code> by default, which means Mongoose will silently strip any paths in the update that aren&#39;t in the schema. See the <a href="/docs/guide.html#strict"><code>strict</code> mode docs</a> for more information.</li>
<li><code>strictQuery</code>: controls how Mongoose handles keys that aren&#39;t in the schema for the query <code>filter</code>. This option is <code>false</code> by default for backwards compatibility, which means Mongoose will allow <code>Model.find({ foo: &#39;bar&#39; })</code> even if <code>foo</code> is not in the schema. See the <a href="/docs/guide.html#strictQuery"><code>strictQuery</code> docs</a> for more information.</li>
<li><code>nearSphere</code>: use <code>$nearSphere</code> instead of <code>near()</code>. See the <a href="#query_Query-nearSphere"><code>Query.prototype.nearSphere()</code> docs</a></li>
</ul>
<p>Mongoose maintains a separate object for internal options because
Mongoose sends <code>Query.prototype.options</code> to the MongoDB server, and the
above options are not relevant for the MongoDB server.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-ne"><a href="#query_Query-ne">Query.prototype.ne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;any&raquo;</span> </li></ul><div><p>Specifies a <code>$ne</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-near"><a href="#query_Query-near">Query.prototype.near()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$near</code> or <code>$nearSphere</code> condition</p>
<p>These operators return documents sorted by distance.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">near</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>] });
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">near</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>], <span class="hljs-attr">maxDistance</span>: <span class="hljs-number">5</span> });
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">near</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>], <span class="hljs-attr">maxDistance</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">spherical</span>: <span class="hljs-literal">true</span> });
query.<span class="hljs-title function_">near</span>(<span class="hljs-string">&#x27;loc&#x27;</span>, { <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>], <span class="hljs-attr">maxDistance</span>: <span class="hljs-number">5</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-nearSphere"><a href="#query_Query-nearSphere">Query.prototype.nearSphere()</a></h3><div><p><em>DEPRECATED</em> Specifies a <code>$nearSphere</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">nearSphere</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>], <span class="hljs-attr">maxDistance</span>: <span class="hljs-number">5</span> });
</code></pre>
<p><strong>Deprecated.</strong> Use <code>query.near()</code> instead with the <code>spherical</code> option set to <code>true</code>.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">near</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>], <span class="hljs-attr">spherical</span>: <span class="hljs-literal">true</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-nin"><a href="#query_Query-nin">Query.prototype.nin()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Specifies an <code>$nin</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-nor"><a href="#query_Query-nor">Query.prototype.nor()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">array
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies arguments for a <code>$nor</code> condition.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">nor</span>([{ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;green&#x27;</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> }]);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-or"><a href="#query_Query-or">Query.prototype.or()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">array
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies arguments for an <code>$or</code> condition.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">or</span>([{ <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;emergency&#x27;</span> }]);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-orFail"><a href="#query_Query-orFail">Query.prototype.orFail()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[err]
<span class="method-type">&laquo;Function|Error&raquo;</span> optional error to throw if no docs match <code>filter</code>. If not specified, <code>orFail()</code> will throw a <code>DocumentNotFoundError</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Make this query throw an error if no documents match the given <code>filter</code>.
This is handy for integrating with async/await, because <code>orFail()</code> saves you
an extra <code>if</code> statement to check if no document was found.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Throws if no doc returned</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }).<span class="hljs-title function_">orFail</span>();

<span class="hljs-comment">// Throws if no document was updated. Note that `orFail()` will still</span>
<span class="hljs-comment">// throw if the only document that matches is `{ foo: &#x27;bar&#x27;, name: &#x27;test&#x27; }`,</span>
<span class="hljs-comment">// because `orFail()` will throw if no document was _updated_, not</span>
<span class="hljs-comment">// if no document was _found_.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> }).<span class="hljs-title function_">orFail</span>();

<span class="hljs-comment">// Throws &quot;No docs found!&quot; error if no docs match `{ foo: &#x27;bar&#x27; }`</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }).<span class="hljs-title function_">orFail</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No docs found!&#x27;</span>));

<span class="hljs-comment">// Throws &quot;Not found&quot; error if no document was found</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOneAndUpdate</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> }).
  <span class="hljs-title function_">orFail</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Not found&#x27;</span>));
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-polygon"><a href="#query_Query-polygon">Query.prototype.polygon()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String|Array&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[coordinatePairs...]
<span class="method-type">&laquo;Array|Object&raquo;</span> </li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$polygon</code> condition</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">polygon</span>([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>], [<span class="hljs-number">13</span>, <span class="hljs-number">25</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">15</span>]);
query.<span class="hljs-title function_">polygon</span>(<span class="hljs-string">&#x27;loc&#x27;</span>, [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>], [<span class="hljs-number">13</span>, <span class="hljs-number">25</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">15</span>]);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-populate"><a href="#query_Query-populate">Query.prototype.populate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> either the path(s) to populate or an object specifying all parameters</p>
</li><li class="param">[select]
<span class="method-type">&laquo;Object|String&raquo;</span> Field selection for the population query</p>
</li><li class="param">[model]
<span class="method-type">&laquo;Model&raquo;</span> The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema&#39;s <code>ref</code> field.</p>
</li><li class="param">[match]
<span class="method-type">&laquo;Object&raquo;</span> Conditions for the population query</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> Options for the population query (sort, etc)</p>
</li><ul style="margin-top: 0.5em"><li>[options.path=null]
<span class="method-type">&laquo;String&raquo;</span> The path to populate.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.retainNullValues=false]
<span class="method-type">&laquo;boolean&raquo;</span> by default, Mongoose removes null and undefined values from populated arrays. Use this option to make <code>populate()</code> retain <code>null</code> and <code>undefined</code> array entries.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.getters=false]
<span class="method-type">&laquo;boolean&raquo;</span> if true, Mongoose will call any getters defined on the <code>localField</code>. By default, Mongoose gets the raw value of <code>localField</code>. For example, you would need to set this option to <code>true</code> if you wanted to <a href="/docs/schematypes.html#schematype-options">add a <code>lowercase</code> getter to your <code>localField</code></a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=false]
<span class="method-type">&laquo;boolean&raquo;</span> When you do <code>BlogPost.find().populate(&#39;author&#39;)</code>, blog posts with the same author will share 1 copy of an <code>author</code> doc. Enable this option to make Mongoose clone populated docs before assigning them.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.match=null]
<span class="method-type">&laquo;Object|Function&raquo;</span> Add an additional filter to the populate query. Can be a filter object containing <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/">MongoDB query syntax</a>, or a function that returns a filter object.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.transform=null]
<span class="method-type">&laquo;Function&raquo;</span> Function that Mongoose will call on every populated document that allows you to transform the populated document.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.options=null]
<span class="method-type">&laquo;Object&raquo;</span> Additional options like <code>limit</code> and <code>lean</code>.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies paths which should be populated with other documents.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">let</span> book = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Book</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;authors&#x27;</span>);
book.<span class="hljs-property">title</span>; <span class="hljs-comment">// &#x27;Node.js in Action&#x27;</span>
book.<span class="hljs-property">authors</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;TJ Holowaychuk&#x27;</span>
book.<span class="hljs-property">authors</span>[<span class="hljs-number">1</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;Nathan Rajlich&#x27;</span>

<span class="hljs-keyword">let</span> books = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Book</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">populate</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;authors&#x27;</span>,
  <span class="hljs-comment">// `match` and `sort` apply to the Author model,</span>
  <span class="hljs-comment">// not the Book model. These options do not affect</span>
  <span class="hljs-comment">// which documents are in `books`, just the order and</span>
  <span class="hljs-comment">// contents of each book document&#x27;s `authors`.</span>
  <span class="hljs-attr">match</span>: { <span class="hljs-attr">name</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;.*h.*&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>) },
  <span class="hljs-attr">sort</span>: { <span class="hljs-attr">name</span>: -<span class="hljs-number">1</span> }
});
books[<span class="hljs-number">0</span>].<span class="hljs-property">title</span>; <span class="hljs-comment">// &#x27;Node.js in Action&#x27;</span>
<span class="hljs-comment">// Each book&#x27;s `authors` are sorted by name, descending.</span>
books[<span class="hljs-number">0</span>].<span class="hljs-property">authors</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;TJ Holowaychuk&#x27;</span>
books[<span class="hljs-number">0</span>].<span class="hljs-property">authors</span>[<span class="hljs-number">1</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;Marc Harter&#x27;</span>

books[<span class="hljs-number">1</span>].<span class="hljs-property">title</span>; <span class="hljs-comment">// &#x27;Professional AngularJS&#x27;</span>
<span class="hljs-comment">// Empty array, no authors&#x27; name has the letter &#x27;h&#x27;</span>
books[<span class="hljs-number">1</span>].<span class="hljs-property">authors</span>; <span class="hljs-comment">// []</span>
</code></pre>
<p>Paths are populated after the query executes and a response is received. A
separate query is then executed for each path specified for population. After
a response for each query has also been returned, the results are passed to
the callback.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-post"><a href="#query_Query-post">Query.prototype.post()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Add post <a href="/docs/middleware.html">middleware</a> to this query instance. Doesn&#39;t affect
other queries.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> q1 = <span class="hljs-title class_">Question</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-number">42</span> });
q1.<span class="hljs-title function_">post</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFilter</span>());
});
<span class="hljs-keyword">await</span> q1.<span class="hljs-title function_">exec</span>(); <span class="hljs-comment">// Prints &quot;{ answer: 42 }&quot;</span>

<span class="hljs-comment">// Doesn&#x27;t print anything, because `middleware()` is only</span>
<span class="hljs-comment">// registered on `q1`.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Question</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-number">42</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-pre"><a href="#query_Query-pre">Query.prototype.pre()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Add pre <a href="/docs/middleware.html">middleware</a> to this query instance. Doesn&#39;t affect
other queries.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> q1 = <span class="hljs-title class_">Question</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-number">42</span> });
q1.<span class="hljs-title function_">pre</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFilter</span>());
});
<span class="hljs-keyword">await</span> q1.<span class="hljs-title function_">exec</span>(); <span class="hljs-comment">// Prints &quot;{ answer: 42 }&quot;</span>

<span class="hljs-comment">// Doesn&#x27;t print anything, because `middleware()` is only</span>
<span class="hljs-comment">// registered on `q1`.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Question</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-number">42</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-projection"><a href="#query_Query-projection">Query.prototype.projection()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|null&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the current projection</li></ul><div><p>Get/set the current projection (AKA fields). Pass <code>null</code> to remove the
current projection.</p>
<p>Unlike <code>projection()</code>, the <code>select()</code> function modifies the current
projection in place. This function overwrites the existing projection.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> q = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>();
q.<span class="hljs-title function_">projection</span>(); <span class="hljs-comment">// null</span>

q.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;a b&#x27;</span>);
q.<span class="hljs-title function_">projection</span>(); <span class="hljs-comment">// { a: 1, b: 1 }</span>

q.<span class="hljs-title function_">projection</span>({ <span class="hljs-attr">c</span>: <span class="hljs-number">1</span> });
q.<span class="hljs-title function_">projection</span>(); <span class="hljs-comment">// { c: 1 }</span>

q.<span class="hljs-title function_">projection</span>(<span class="hljs-literal">null</span>);
q.<span class="hljs-title function_">projection</span>(); <span class="hljs-comment">// null</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-read"><a href="#query_Query-read">Query.prototype.read()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">pref
<span class="method-type">&laquo;String&raquo;</span> one of the listed preference options or aliases</p>
</li><li class="param">[tags]
<span class="method-type">&laquo;Array&raquo;</span> optional tags for this query</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Determines the MongoDB nodes from which to read.</p>
<h4 id="preferences">
      <a href="#preferences">
        Preferences:
      </a>
    </h4>
<pre><code>primary - (<span class="hljs-keyword">default</span>) <span class="hljs-title class_">Read</span> <span class="hljs-keyword">from</span> primary only. <span class="hljs-title class_">Operations</span> will produce an error <span class="hljs-keyword">if</span> primary is unavailable. <span class="hljs-title class_">Cannot</span> be combined <span class="hljs-keyword">with</span> tags.
secondary            <span class="hljs-title class_">Read</span> <span class="hljs-keyword">from</span> secondary <span class="hljs-keyword">if</span> available, otherwise error.
primaryPreferred     <span class="hljs-title class_">Read</span> <span class="hljs-keyword">from</span> primary <span class="hljs-keyword">if</span> available, otherwise a secondary.
secondaryPreferred   <span class="hljs-title class_">Read</span> <span class="hljs-keyword">from</span> a secondary <span class="hljs-keyword">if</span> available, otherwise read <span class="hljs-keyword">from</span> the primary.
nearest              <span class="hljs-title class_">All</span> operations read <span class="hljs-keyword">from</span> among the nearest candidates, but unlike other modes, <span class="hljs-variable language_">this</span> option will include both the primary and all secondaries <span class="hljs-keyword">in</span> the random selection.
</code></pre>
<p>Aliases</p>
<pre><code>p   primary
pp  primaryPreferred
s   secondary
sp  secondaryPreferred
n   nearest
</code></pre>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;primary&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;p&#x27;</span>)  <span class="hljs-comment">// same as primary</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;primaryPreferred&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;pp&#x27;</span>) <span class="hljs-comment">// same as primaryPreferred</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;secondary&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;s&#x27;</span>)  <span class="hljs-comment">// same as secondary</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;secondaryPreferred&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;sp&#x27;</span>) <span class="hljs-comment">// same as secondaryPreferred</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;nearest&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;n&#x27;</span>)  <span class="hljs-comment">// same as nearest</span>

<span class="hljs-comment">// read from secondaries with matching tags</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;s&#x27;</span>, [{ <span class="hljs-attr">dc</span>:<span class="hljs-string">&#x27;sf&#x27;</span>, <span class="hljs-attr">s</span>: <span class="hljs-number">1</span> },{ <span class="hljs-attr">dc</span>:<span class="hljs-string">&#x27;ma&#x27;</span>, <span class="hljs-attr">s</span>: <span class="hljs-number">2</span> }])
</code></pre>
<p>Read more about how to use read preferences <a href="https://www.mongodb.com/docs/manual/applications/replication/#read-preference">here</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-readConcern"><a href="#query_Query-readConcern">Query.prototype.readConcern()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">level
<span class="method-type">&laquo;String&raquo;</span> one of the listed read concern level or their aliases</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the readConcern option for the query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;local&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;l&#x27;</span>)  <span class="hljs-comment">// same as local</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;available&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;a&#x27;</span>)  <span class="hljs-comment">// same as available</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;majority&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;m&#x27;</span>)  <span class="hljs-comment">// same as majority</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;linearizable&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;lz&#x27;</span>) <span class="hljs-comment">// same as linearizable</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;snapshot&#x27;</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;s&#x27;</span>)  <span class="hljs-comment">// same as snapshot</span>
</code></pre>
<h4 id="read-concern-level">
      <a href="#read-concern-level">
        Read Concern Level:
      </a>
    </h4>
<pre><code>local         <span class="hljs-title class_">MongoDB</span> <span class="hljs-number">3.2</span>+ <span class="hljs-title class_">The</span> query returns <span class="hljs-keyword">from</span> the instance <span class="hljs-keyword">with</span> no guarantee guarantee that the data has been written to a majority <span class="hljs-keyword">of</span> the replica set members (i.<span class="hljs-property">e</span>. may be rolled back).
available     <span class="hljs-title class_">MongoDB</span> <span class="hljs-number">3.6</span>+ <span class="hljs-title class_">The</span> query returns <span class="hljs-keyword">from</span> the instance <span class="hljs-keyword">with</span> no guarantee guarantee that the data has been written to a majority <span class="hljs-keyword">of</span> the replica set members (i.<span class="hljs-property">e</span>. may be rolled back).
majority      <span class="hljs-title class_">MongoDB</span> <span class="hljs-number">3.2</span>+ <span class="hljs-title class_">The</span> query returns the data that has been acknowledged by a majority <span class="hljs-keyword">of</span> the replica set members. <span class="hljs-title class_">The</span> documents returned by the read operation are durable, even <span class="hljs-keyword">in</span> the event <span class="hljs-keyword">of</span> failure.
linearizable  <span class="hljs-title class_">MongoDB</span> <span class="hljs-number">3.4</span>+ <span class="hljs-title class_">The</span> query returns data that reflects all successful majority-acknowledged writes that completed prior to the start <span class="hljs-keyword">of</span> the read operation. <span class="hljs-title class_">The</span> query may wait <span class="hljs-keyword">for</span> concurrently executing writes to propagate to a majority <span class="hljs-keyword">of</span> replica set members before returning results.
snapshot      <span class="hljs-title class_">MongoDB</span> <span class="hljs-number">4.0</span>+ <span class="hljs-title class_">Only</span> available <span class="hljs-keyword">for</span> operations within multi-<span class="hljs-variable language_">document</span> transactions. <span class="hljs-title class_">Upon</span> transaction commit <span class="hljs-keyword">with</span> write concern <span class="hljs-string">&quot;majority&quot;</span>, the transaction operations are guaranteed to have read <span class="hljs-keyword">from</span> a snapshot <span class="hljs-keyword">of</span> majority-committed data.
</code></pre>
<p>Aliases</p>
<pre><code>l   local
a   available
m   majority
lz  linearizable
s   snapshot
</code></pre>
<p>Read more about how to use read concern <a href="https://www.mongodb.com/docs/manual/reference/read-concern/">here</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-regex"><a href="#query_Query-regex">Query.prototype.regex()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;String|RegExp&raquo;</span> </li></ul><div><p>Specifies a <code>$regex</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-remove"><a href="#query_Query-remove">Query.prototype.remove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object|Query&raquo;</span> mongodb selector</p>
</li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional params are (error, mongooseDeleteResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as a remove() operation. <code>remove()</code> is
deprecated, you should use <a href="#query_Query-deleteOne"><code>deleteOne()</code></a>
or <a href="#query_Query-deleteMany"><code>deleteMany()</code></a> instead.</p>
<p>This function does not trigger any middleware</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span> }, callback);
</code></pre>
<p>This function calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#remove"><code>Collection#remove()</code> function</a>.
The returned <a href="https://mongoosejs.com/docs/queries.html">promise</a> resolves to an
object that contains 3 properties:</p>
<ul>
<li><code>ok</code>: <code>1</code> if no errors occurred</li>
<li><code>deletedCount</code>: the number of documents deleted</li>
<li><code>n</code>: the number of documents deleted. Equal to <code>deletedCount</code>.</li>
</ul>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span> });
<span class="hljs-comment">// Number of docs deleted</span>
res.<span class="hljs-property">deletedCount</span>;
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Calling <code>remove()</code> creates a <a href="/docs/queries.html">Mongoose query</a>, and a query
does not execute until you either pass a callback, call <a href="#query_Query-then"><code>Query#then()</code></a>,
or call <a href="#query_Query-exec"><code>Query#exec()</code></a>.</p>
<pre><code><span class="hljs-comment">// not executed</span>
<span class="hljs-keyword">const</span> query = <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span> });

<span class="hljs-comment">// executed</span>
<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span> }, callback);
<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">remove</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark/</span> }).<span class="hljs-title function_">remove</span>(callback);

<span class="hljs-comment">// executed without a callback</span>
<span class="hljs-title class_">Character</span>.<span class="hljs-title function_">exec</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-replaceOne"><a href="#query_Query-replaceOne">Query.prototype.replaceOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[doc]
<span class="method-type">&laquo;Object&raquo;</span> the update command</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.multipleCastError]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as a replaceOne() operation. Same as
<code>update()</code>, except MongoDB will replace the existing document and will
not accept any <a href="https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern">atomic</a> operators (<code>$set</code>, etc.)</p>
<p><strong>Note</strong> replaceOne will <em>not</em> fire update middleware. Use <code>pre(&#39;replaceOne&#39;)</code>
and <code>post(&#39;replaceOne&#39;)</code> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">replaceOne</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-number">24601</span> }, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean Valjean&#x27;</span> });
res.<span class="hljs-property">acknowledged</span>; <span class="hljs-comment">// Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.</span>
res.<span class="hljs-property">matchedCount</span>; <span class="hljs-comment">// Number of documents that matched the filter</span>
res.<span class="hljs-property">modifiedCount</span>; <span class="hljs-comment">// Number of documents that were modified</span>
res.<span class="hljs-property">upsertedCount</span>; <span class="hljs-comment">// Number of documents that were upserted</span>
res.<span class="hljs-property">upsertedId</span>; <span class="hljs-comment">// Identifier of the inserted document (if an upsert took place)</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>replaceOne()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-select"><a href="#query_Query-select">Query.prototype.select()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies which document fields to include or exclude (also known as the query &quot;projection&quot;)</p>
<p>When using string syntax, prefixing a path with <code>-</code> will flag that path as excluded. When a path does not have the <code>-</code> prefix, it is included. Lastly, if a path is prefixed with <code>+</code>, it forces inclusion of the path, which is useful for paths excluded at the <a href="/docs/api/schematype.html#schematype_SchemaType-select">schema level</a>.</p>
<p>A projection <em>must</em> be either inclusive or exclusive. In other words, you must
either list the fields to include (which excludes all others), or list the fields
to exclude (which implies all other fields are included). The <a href="https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/#suppress-id-field"><code>_id</code> field is the only exception because MongoDB includes it by default</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// include a and b, exclude other fields</span>
query.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;a b&#x27;</span>);
<span class="hljs-comment">// Equivalent syntaxes:</span>
query.<span class="hljs-title function_">select</span>([<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>]);
query.<span class="hljs-title function_">select</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> });

<span class="hljs-comment">// exclude c and d, include other fields</span>
query.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;-c -d&#x27;</span>);

<span class="hljs-comment">// Use `+` to override schema-level `select: false` without making the</span>
<span class="hljs-comment">// projection inclusive.</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">foo</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">select</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-attr">bar</span>: <span class="hljs-title class_">String</span>
});
<span class="hljs-comment">// ...</span>
query.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;+foo&#x27;</span>); <span class="hljs-comment">// Override foo&#x27;s `select: false` without excluding `bar`</span>

<span class="hljs-comment">// or you may use object notation, useful when</span>
<span class="hljs-comment">// you have keys already prefixed with a &quot;-&quot;</span>
query.<span class="hljs-title function_">select</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> });
query.<span class="hljs-title function_">select</span>({ <span class="hljs-attr">c</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">0</span> });

<span class="hljs-title class_">Additional</span> calls to select can override the previous <span class="hljs-attr">selection</span>:
query.<span class="hljs-title function_">select</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">select</span>({ <span class="hljs-attr">b</span>: <span class="hljs-number">0</span> }); <span class="hljs-comment">// selection is now { a: 1 }</span>
query.<span class="hljs-title function_">select</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">0</span> }).<span class="hljs-title function_">select</span>({ <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> }); <span class="hljs-comment">// selection is now { a: 0 }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-selected"><a href="#query_Query-selected">Query.prototype.selected()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if field selection has been made.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-selectedExclusively"><a href="#query_Query-selectedExclusively">Query.prototype.selectedExclusively()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if exclusive field selection has been made.</p>
<pre><code>query.<span class="hljs-title function_">selectedExclusively</span>(); <span class="hljs-comment">// false</span>
query.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;-name&#x27;</span>);
query.<span class="hljs-title function_">selectedExclusively</span>(); <span class="hljs-comment">// true</span>
query.<span class="hljs-title function_">selectedInclusively</span>(); <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-selectedInclusively"><a href="#query_Query-selectedInclusively">Query.prototype.selectedInclusively()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if inclusive field selection has been made.</p>
<pre><code>query.<span class="hljs-title function_">selectedInclusively</span>(); <span class="hljs-comment">// false</span>
query.<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;name&#x27;</span>);
query.<span class="hljs-title function_">selectedInclusively</span>(); <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-session"><a href="#query_Query-session">Query.prototype.session()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[session]
<span class="method-type">&laquo;ClientSession&raquo;</span> from <code>await conn.startSession()</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">MongoDB session</a>
associated with this query. Sessions are how you mark a query as part of a
<a href="/docs/transactions.html">transaction</a>.</p>
<p>Calling <code>session(null)</code> removes the session from this query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>).<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Axl Rose&#x27;</span> }).<span class="hljs-title function_">session</span>(s);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-set"><a href="#query_Query-set">Query.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/value pairs to set</p>
</li><li class="param">[val]
<span class="method-type">&laquo;Any&raquo;</span> the value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Adds a <code>$set</code> to this query&#39;s update without changing the operation.
This is useful for query middleware so you can add an update regardless
of whether you use <code>updateOne()</code>, <code>updateMany()</code>, <code>findOneAndUpdate()</code>, etc.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Updates `{ $set: { updatedAt: new Date() } }`</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">updateOne</span>({}, {}).<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;updatedAt&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>().<span class="hljs-title function_">updateMany</span>({}, {}).<span class="hljs-title function_">set</span>({ <span class="hljs-attr">updatedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-setOptions"><a href="#query_Query-setOptions">Query.prototype.setOptions()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets query options. Some options only make sense for certain operations.</p>
<h4 id="options">
      <a href="#options">
        Options:
      </a>
    </h4>
<p>The following options are only for <code>find()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/core/tailable-cursors/">tailable</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/">sort</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.limit/">limit</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/">skip</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.allowDiskUse/">allowDiskUse</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.batchSize/">batchSize</a></li>
<li><a href="https://www.mongodb.com/docs/manual/applications/replication/#read-preference">readPreference</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.hint/">hint</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.comment/">comment</a></li>
<li>snapshot</li>
<li><a href="https://www.mongodb.com/docs/v4.0/reference/method/cursor.maxScan/">maxscan</a></li>
</ul>
<p>The following options are only for write operations: <code>update()</code>, <code>updateOne()</code>, <code>updateMany()</code>, <code>replaceOne()</code>, <code>findOneAndUpdate()</code>, and <code>findByIdAndUpdate()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">upsert</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">writeConcern</a></li>
<li><a href="https://mongoosejs.com/docs/guide.html#timestamps">timestamps</a>: If <code>timestamps</code> is set in the schema, set this option to <code>false</code> to skip timestamps for that particular update. Has no effect if <code>timestamps</code> is not enabled in the schema options.</li>
<li>overwriteDiscriminatorKey: allow setting the discriminator key in the update. Will use the correct discriminator schema if the update changes the discriminator key.</li>
</ul>
<p>The following options are only for <code>find()</code>, <code>findOne()</code>, <code>findById()</code>, <code>findOneAndUpdate()</code>, and <code>findByIdAndUpdate()</code>:</p>
<ul>
<li><a href="#query_Query-lean">lean</a></li>
<li><a href="/docs/populate.html">populate</a></li>
<li><a href="#query_Query-projection">projection</a></li>
<li>sanitizeProjection</li>
</ul>
<p>The following options are only for all operations <strong>except</strong> <code>update()</code>, <code>updateOne()</code>, <code>updateMany()</code>, <code>remove()</code>, <code>deleteOne()</code>, and <code>deleteMany()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/reference/operator/meta/maxTimeMS/">maxTimeMS</a></li>
</ul>
<p>The following options are for <code>findOneAndUpdate()</code> and <code>findOneAndRemove()</code></p>
<ul>
<li>rawResult</li>
</ul>
<p>The following options are for all operations:</p>
<ul>
<li><a href="/docs/guide.html#strict">strict</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/collation/">collation</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.explain/">explain</a></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-setQuery"><a href="#query_Query-setQuery">Query.prototype.setQuery()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">new
<span class="method-type">&laquo;Object&raquo;</span> query conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;undefined,void&raquo;</span> </li></ul><div><p>Sets the query conditions to the provided JSON object.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> })
query.<span class="hljs-title function_">setQuery</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">2</span> });
query.<span class="hljs-title function_">getQuery</span>(); <span class="hljs-comment">// { a: 2 }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-setUpdate"><a href="#query_Query-setUpdate">Query.prototype.setUpdate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">new
<span class="method-type">&laquo;Object&raquo;</span> update operation</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;undefined,void&raquo;</span> </li></ul><div><p>Sets the current update operation to new value.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>();
query.<span class="hljs-title function_">update</span>({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">5</span> } });
query.<span class="hljs-title function_">setUpdate</span>({ <span class="hljs-attr">$set</span>: { <span class="hljs-attr">b</span>: <span class="hljs-number">6</span> } });
query.<span class="hljs-title function_">getUpdate</span>(); <span class="hljs-comment">// { $set: { b: 6 } }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-size"><a href="#query_Query-size">Query.prototype.size()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies a <code>$size</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> docs = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;tags&#x27;</span>).<span class="hljs-title function_">size</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">exec</span>();
<span class="hljs-title function_">assert</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(docs));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;documents with 0 tags&#x27;</span>, docs);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-skip"><a href="#query_Query-skip">Query.prototype.skip()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies the number of documents to skip.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">skip</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">limit</span>(<span class="hljs-number">20</span>);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-slice"><a href="#query_Query-slice">Query.prototype.slice()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">val
<span class="method-type">&laquo;Number|Array&raquo;</span> number of elements to slice or array with number of elements to skip and number of elements to slice</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>$slice</code> projection for an array.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;comments&#x27;</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// Returns the first 5 comments</span>
query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;comments&#x27;</span>, -<span class="hljs-number">5</span>); <span class="hljs-comment">// Returns the last 5 comments</span>
query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;comments&#x27;</span>, [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// Returns the first 5 comments after the 10-th</span>
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;comments&#x27;</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// Returns the first 5 comments</span>
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;comments&#x27;</span>).<span class="hljs-title function_">slice</span>([-<span class="hljs-number">10</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// Returns the first 5 comments after the 10-th to last</span>
</code></pre>
<p><strong>Note:</strong> If the absolute value of the number of elements to be sliced is greater than the number of elements in the array, all array elements will be returned.</p>
<pre><code> <span class="hljs-comment">// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
 query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;arr&#x27;</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
 query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;arr&#x27;</span>, -<span class="hljs-number">20</span>); <span class="hljs-comment">// Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</code></pre>
<p><strong>Note:</strong> If the number of elements to skip is positive and greater than the number of elements in the array, an empty array will be returned.</p>
<pre><code> <span class="hljs-comment">// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
 query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;arr&#x27;</span>, [<span class="hljs-number">20</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// Returns []</span>
</code></pre>
<p><strong>Note:</strong> If the number of elements to skip is negative and its absolute value is greater than the number of elements in the array, the starting position is the start of the array.</p>
<pre><code> <span class="hljs-comment">// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
 query.<span class="hljs-title function_">slice</span>(<span class="hljs-string">&#x27;arr&#x27;</span>, [-<span class="hljs-number">20</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// Returns [1, 2, 3, 4, 5]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-snapshot"><a href="#query_Query-snapshot">Query.prototype.snapshot()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies this query as a <code>snapshot</code> query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">snapshot</span>(); <span class="hljs-comment">// true</span>
query.<span class="hljs-title function_">snapshot</span>(<span class="hljs-literal">true</span>);
query.<span class="hljs-title function_">snapshot</span>(<span class="hljs-literal">false</span>);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-sort"><a href="#query_Query-sort">Query.prototype.sort()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|String|Array&lt;Array&lt;string|number&gt;&gt;&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the sort order</p>
<p>If an object is passed, values allowed are <code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>.</p>
<p>If a string is passed, it must be a space delimited list of path names. The
sort order of each path is ascending unless the path name is prefixed with <code>-</code>
which will be treated as descending.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// sort by &quot;field&quot; ascending and &quot;test&quot; descending</span>
query.<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;asc&#x27;</span>, <span class="hljs-attr">test</span>: -<span class="hljs-number">1</span> });

<span class="hljs-comment">// equivalent</span>
query.<span class="hljs-title function_">sort</span>(<span class="hljs-string">&#x27;field -test&#x27;</span>);

<span class="hljs-comment">// also possible is to use a array with array key-value pairs</span>
query.<span class="hljs-title function_">sort</span>([[<span class="hljs-string">&#x27;field&#x27;</span>, <span class="hljs-string">&#x27;asc&#x27;</span>]]);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-tailable"><a href="#query_Query-tailable">Query.prototype.tailable()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean&raquo;</span> defaults to true</p>
</li><li class="param">[opts]
<span class="method-type">&laquo;Object&raquo;</span> options to set</p>
</li><ul style="margin-top: 0.5em"><li>[opts.awaitData]
<span class="method-type">&laquo;Boolean&raquo;</span> false by default. Set to true to keep the cursor open even if there&#39;s no data.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[opts.maxAwaitTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> the maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query. Requires <code>tailable</code> and <code>awaitData</code> to be true</p>
</li></ul></ul><div><p>Sets the tailable option (for use with capped collections).</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">tailable</span>(); <span class="hljs-comment">// true</span>
query.<span class="hljs-title function_">tailable</span>(<span class="hljs-literal">true</span>);
query.<span class="hljs-title function_">tailable</span>(<span class="hljs-literal">false</span>);

<span class="hljs-comment">// Set both `tailable` and `awaitData` options</span>
query.<span class="hljs-title function_">tailable</span>({ <span class="hljs-attr">awaitData</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Cannot be used with <code>distinct()</code></p>
</div><hr class="separate-api-elements"><h3 id="query_Query-then"><a href="#query_Query-then">Query.prototype.then()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[resolve]
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param">[reject]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with either the doc(s) or rejected with the error.</p>
<p>More about <a href="https://masteringjs.io/tutorials/fundamentals/then"><code>then()</code> in JavaScript</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-toConstructor"><a href="#query_Query-toConstructor">Query.prototype.toConstructor()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> subclass-of-Query</li></ul><div><p>Converts this query to a customized, reusable query constructor with all arguments and options retained.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Create a query for adventure movies and read from the primary</span>
<span class="hljs-comment">// node in the replica-set unless it is down, in which case we&#x27;ll</span>
<span class="hljs-comment">// read from a secondary node.</span>
<span class="hljs-keyword">const</span> query = <span class="hljs-title class_">Movie</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">tags</span>: <span class="hljs-string">&#x27;adventure&#x27;</span> }).<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;primaryPreferred&#x27;</span>);

<span class="hljs-comment">// create a custom Query constructor based off these settings</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Adventure</span> = query.<span class="hljs-title function_">toConstructor</span>();

<span class="hljs-comment">// Adventure is now a subclass of mongoose.Query and works the same way but with the</span>
<span class="hljs-comment">// default query parameters and options set.</span>
<span class="hljs-title class_">Adventure</span>().<span class="hljs-title function_">exec</span>(callback)

<span class="hljs-comment">// further narrow down our query results while still using the previous settings</span>
<span class="hljs-title class_">Adventure</span>().<span class="hljs-title function_">where</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^Life/</span> }).<span class="hljs-title function_">exec</span>(callback);

<span class="hljs-comment">// since Adventure is a stand-alone constructor we can also add our own</span>
<span class="hljs-comment">// helper methods and getters without impacting global queries</span>
<span class="hljs-title class_">Adventure</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">startsWith</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">prefix</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">name</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;^&#x27;</span> + prefix) })
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
}
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Adventure</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">&#x27;highlyRated&#x27;</span>, {
  <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">rating</span>: { <span class="hljs-attr">$gt</span>: <span class="hljs-number">4.5</span> }});
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
})
<span class="hljs-title class_">Adventure</span>().<span class="hljs-property">highlyRated</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;Life&#x27;</span>).<span class="hljs-title function_">exec</span>(callback)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-transform"><a href="#query_Query-transform">Query.prototype.transform()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> function to run to transform the query result</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Runs a function <code>fn</code> and treats the return value of <code>fn</code> as the new value
for the query to resolve to.</p>
<p>Any functions you pass to <code>transform()</code> will run <strong>after</strong> any post hooks.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">transform</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-comment">// Sets a `loadedAt` property on the doc that tells you the time the</span>
  <span class="hljs-comment">// document was loaded.</span>
  <span class="hljs-keyword">return</span> res == <span class="hljs-literal">null</span> ?
    res :
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(res, { <span class="hljs-attr">loadedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() });
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-update"><a href="#query_Query-update">Query.prototype.update()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[doc]
<span class="method-type">&laquo;Object&raquo;</span> the update command</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.multipleCastError]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as an update() operation.</p>
<p><em>All paths passed that are not <a href="https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern">atomic</a> operations will become <code>$set</code> ops.</em></p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>update()</code></li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">_id</span>: id }).<span class="hljs-title function_">update</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;words&#x27;</span> });

<span class="hljs-comment">// becomes</span>

<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">_id</span>: id }).<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$set</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;words&#x27;</span> }});
</code></pre>
<h4 id="valid-options">
      <a href="#valid-options">
        Valid options:
      </a>
    </h4>
<ul>
<li><code>upsert</code> (boolean) whether to create the doc if it doesn&#39;t match (false)</li>
<li><code>multi</code> (boolean) whether multiple documents should be updated (false)</li>
<li><code>runValidators</code> (boolean) if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema.</li>
<li><code>setDefaultsOnInsert</code> (boolean) <code>true</code> by default. If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="https://mongoosejs.com/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created.</li>
<li><code>strict</code> (boolean) overrides the <code>strict</code> option for this update</li>
<li><code>read</code></li>
<li><code>writeConcern</code></li>
</ul>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>Passing an empty object <code>{}</code> as the doc will result in a no-op. The update operation will be ignored and the callback executed without sending the command to MongoDB.</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p>The operation is only executed when a callback is passed. To force execution without a callback, we must first call update() and then execute it by using the <code>exec()</code> method.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> q = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">_id</span>: id });
q.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;bob&#x27;</span> }}).<span class="hljs-title function_">update</span>(); <span class="hljs-comment">// not executed</span>

q.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;bob&#x27;</span> }}).<span class="hljs-title function_">exec</span>(); <span class="hljs-comment">// executed</span>

<span class="hljs-comment">// keys that are not [atomic](https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern) ops become `$set`.</span>
<span class="hljs-comment">// this executes the same command as the previous example.</span>
q.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;bob&#x27;</span> }).<span class="hljs-title function_">exec</span>();

<span class="hljs-comment">// multi updates</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>()
     .<span class="hljs-title function_">update</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^match/</span> }, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">arr</span>: [] }}, { <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span> }, callback)

<span class="hljs-comment">// more multi updates</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>()
     .<span class="hljs-title function_">setOptions</span>({ <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span> })
     .<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$set</span>: { <span class="hljs-attr">arr</span>: [] }}, callback)

<span class="hljs-comment">// single update by default</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">where</span>({ <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;address@example.com&#x27;</span> })
     .<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">counter</span>: <span class="hljs-number">1</span> }}, callback)
</code></pre>
<p>API summary</p>
<pre><code class="language-javascript"><span class="hljs-title function_">update</span>(filter, doc, options, cb); <span class="hljs-comment">// executes</span>
<span class="hljs-title function_">update</span>(filter, doc, options);
<span class="hljs-title function_">update</span>(filter, doc, cb); <span class="hljs-comment">// executes</span>
<span class="hljs-title function_">update</span>(filter, doc);
<span class="hljs-title function_">update</span>(doc, cb); <span class="hljs-comment">// executes</span>
<span class="hljs-title function_">update</span>(doc);
<span class="hljs-title function_">update</span>(cb); <span class="hljs-comment">// executes</span>
<span class="hljs-title function_">update</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// executes</span>
<span class="hljs-title function_">update</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-updateMany"><a href="#query_Query-updateMany">Query.prototype.updateMany()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[update]
<span class="method-type">&laquo;Object|Array&raquo;</span> the update command</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.multipleCastError]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as an updateMany() operation. Same as
<code>update()</code>, except MongoDB will update <em>all</em> documents that match
<code>filter</code> (as opposed to just the first one) regardless of the value of
the <code>multi</code> option.</p>
<p><strong>Note</strong> updateMany will <em>not</em> fire update middleware. Use <code>pre(&#39;updateMany&#39;)</code>
and <code>post(&#39;updateMany&#39;)</code> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">updateMany</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/Stark$/</span> }, { <span class="hljs-attr">isDeleted</span>: <span class="hljs-literal">true</span> });
res.<span class="hljs-property">n</span>; <span class="hljs-comment">// Number of documents matched</span>
res.<span class="hljs-property">nModified</span>; <span class="hljs-comment">// Number of documents modified</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateMany()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-updateOne"><a href="#query_Query-updateOne">Query.prototype.updateOne()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[filter]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[update]
<span class="method-type">&laquo;Object|Array&raquo;</span> the update command</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.multipleCastError]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.strict]
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="https://mongoosejs.com/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.upsert=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.writeConcern=null]
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.timestamps=null]
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Declare and/or execute this query as an updateOne() operation. Same as
<code>update()</code>, except it does not support the <code>multi</code> option.</p>
<ul>
<li>MongoDB will update <em>only</em> the first document that matches <code>filter</code> regardless of the value of the <code>multi</code> option.</li>
<li>Use <code>replaceOne()</code> if you want to overwrite an entire document rather than using <a href="https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern">atomic</a> operators like <code>$set</code>.</li>
</ul>
<p><strong>Note</strong> updateOne will <em>not</em> fire update middleware. Use <code>pre(&#39;updateOne&#39;)</code>
and <code>post(&#39;updateOne&#39;)</code> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span> }, { <span class="hljs-attr">ship</span>: <span class="hljs-string">&#x27;USS Enterprise&#x27;</span> });
res.<span class="hljs-property">acknowledged</span>; <span class="hljs-comment">// Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.</span>
res.<span class="hljs-property">matchedCount</span>; <span class="hljs-comment">// Number of documents that matched the filter</span>
res.<span class="hljs-property">modifiedCount</span>; <span class="hljs-comment">// Number of documents that were modified</span>
res.<span class="hljs-property">upsertedCount</span>; <span class="hljs-comment">// Number of documents that were upserted</span>
res.<span class="hljs-property">upsertedId</span>; <span class="hljs-comment">// Identifier of the inserted document (if an upsert took place)</span>
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateOne()</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="query_Query-w"><a href="#query_Query-w">Query.prototype.w()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;String|number&raquo;</span> 0 for fire-and-forget, 1 for acknowledged by one server, &#39;majority&#39; for majority of the replica set, or <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#w-option">any of the more advanced options</a>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the specified number of <code>mongod</code> servers, or tag set of <code>mongod</code> servers,
that must acknowledge this write before this write is considered successful.
This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>remove()</code></li>
<li><code>update()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.w</code> option</a></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// The &#x27;majority&#x27; option means the `deleteOne()` promise won&#x27;t resolve</span>
<span class="hljs-comment">// until the `deleteOne()` has propagated to the majority of the replica set</span>
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>).
  <span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }).
  <span class="hljs-title function_">w</span>(<span class="hljs-string">&#x27;majority&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-where"><a href="#query_Query-where">Query.prototype.where()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[path]
<span class="method-type">&laquo;String|Object&raquo;</span> </li><li class="param">[val]
<span class="method-type">&laquo;any&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>path</code> for use with chaining.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// instead of writing:</span>
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>({<span class="hljs-attr">age</span>: {<span class="hljs-attr">$gte</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">$lte</span>: <span class="hljs-number">65</span>}}, callback);

<span class="hljs-comment">// we can instead write:</span>
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">21</span>).<span class="hljs-title function_">lte</span>(<span class="hljs-number">65</span>);

<span class="hljs-comment">// passing query conditions is permitted</span>
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">where</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;vonderful&#x27;</span> })

<span class="hljs-comment">// chaining</span>
<span class="hljs-title class_">User</span>
.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;age&#x27;</span>).<span class="hljs-title function_">gte</span>(<span class="hljs-number">21</span>).<span class="hljs-title function_">lte</span>(<span class="hljs-number">65</span>)
.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-regexp">/^vonderful/i</span>)
.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;friends&#x27;</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">10</span>)
.<span class="hljs-title function_">exec</span>(callback)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-within"><a href="#query_Query-within">Query.prototype.within()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Defines a <code>$within</code> or <code>$geoWithin</code> argument for geo-spatial queries.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>query.<span class="hljs-title function_">where</span>(path).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">box</span>()
query.<span class="hljs-title function_">where</span>(path).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">circle</span>()
query.<span class="hljs-title function_">where</span>(path).<span class="hljs-title function_">within</span>().<span class="hljs-title function_">geometry</span>()

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>({ <span class="hljs-attr">center</span>: [<span class="hljs-number">50</span>,<span class="hljs-number">50</span>], <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">spherical</span>: <span class="hljs-literal">true</span> });
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>({ <span class="hljs-attr">box</span>: [[<span class="hljs-number">40.73</span>, -<span class="hljs-number">73.9</span>], [<span class="hljs-number">40.7</span>, -<span class="hljs-number">73.988</span>]] });
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>({ <span class="hljs-attr">polygon</span>: [[],[],[],[]] });

query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>([], [], []) <span class="hljs-comment">// polygon</span>
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>([], []) <span class="hljs-comment">// box</span>
query.<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;loc&#x27;</span>).<span class="hljs-title function_">within</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;LineString&#x27;</span>, <span class="hljs-attr">coordinates</span>: [...] }); <span class="hljs-comment">// geometry</span>
</code></pre>
<p><strong>MUST</strong> be used after <code>where()</code>.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p>As of Mongoose 3.7, <code>$geoWithin</code> is always used for queries. To change this behavior, see <a href="#query_Query-use%2524geoWithin">Query.use$geoWithin</a>.</p>
<h4 id="note-1">
      <a href="#note-1">
        Note:
      </a>
    </h4>
<p>In Mongoose 3.7, <code>within</code> changed from a getter to a function. If you need the old syntax, use <a href="https://github.com/ebensing/mongoose-within">this</a>.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-writeConcern"><a href="#query_Query-writeConcern">Query.prototype.writeConcern()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">writeConcern
<span class="method-type">&laquo;Object&raquo;</span> the write concern value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the 3 write concern parameters for this query:</p>
<ul>
<li><code>w</code>: Sets the specified number of <code>mongod</code> servers, or tag set of <code>mongod</code> servers, that must acknowledge this write before this write is considered successful.</li>
<li><code>j</code>: Boolean, set to <code>true</code> to request acknowledgement that this operation has been persisted to MongoDB&#39;s on-disk journal.</li>
<li><code>wtimeout</code>: If <a href="#query_Query-w"><code>w &gt; 1</code></a>, the maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is <code>0</code>, which means no timeout.</li>
</ul>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>remove()</code></li>
<li><code>update()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern</code> option</a></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// The &#x27;majority&#x27; option means the `deleteOne()` promise won&#x27;t resolve</span>
<span class="hljs-comment">// until the `deleteOne()` has propagated to the majority of the replica set</span>
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>).
  <span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }).
  <span class="hljs-title function_">writeConcern</span>({ <span class="hljs-attr">w</span>: <span class="hljs-string">&#x27;majority&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-wtimeout"><a href="#query_Query-wtimeout">Query.prototype.wtimeout()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">ms
<span class="method-type">&laquo;number&raquo;</span> number of milliseconds to wait</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>If <a href="#query_Query-w"><code>w &gt; 1</code></a>, the maximum amount of time to
wait for this write to propagate through the replica set before this
operation fails. The default is <code>0</code>, which means no timeout.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>remove()</code></li>
<li><code>update()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.wtimeout</code> option</a></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// The `deleteOne()` promise won&#x27;t resolve until this `deleteOne()` has</span>
<span class="hljs-comment">// propagated to at least `w = 2` members of the replica set. If it takes</span>
<span class="hljs-comment">// longer than 1 second, this `deleteOne()` will fail.</span>
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Person&#x27;</span>).
  <span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }).
  <span class="hljs-title function_">w</span>(<span class="hljs-number">2</span>).
  <span class="hljs-title function_">wtimeout</span>(<span class="hljs-number">1000</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="query_Query-[Symbol.asyncIterator]"><a href="#query_Query-[Symbol.asyncIterator]">Query.prototype[Symbol.asyncIterator]()</a></h3><div><p>Returns an asyncIterator for use with <a href="https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js"><code>for/await/of</code> loops</a>
This function <em>only</em> works for <code>find()</code> queries.
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> } }])) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}
</code></pre>
<p>Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the <a href="https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187"><code>--harmony_async_iteration</code> flag</a>.</p>
<p><strong>Note:</strong> This function is not if <code>Symbol.asyncIterator</code> is undefined. If
<code>Symbol.asyncIterator</code> is undefined, that means your Node.js version does not
support async iterators.</p>
</div><hr class="separate-api-elements"><h3 id="query_Query-use$geoWithin"><a href="#query_Query-use$geoWithin">Query.use$geoWithin</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Flag to opt out of using <code>$geoWithin</code>.</p>
<pre><code class="language-javascript">mongoose.<span class="hljs-property">Query</span>.<span class="hljs-property">use$geoWithin</span> = <span class="hljs-literal">false</span>;
</code></pre>
<p>MongoDB 2.4 deprecated the use of <code>$within</code>, replacing it with <code>$geoWithin</code>. Mongoose uses <code>$geoWithin</code> by default (which is 100% backward compatible with <code>$within</code>). If you are running an older version of MongoDB, set this flag to <code>false</code> so your <code>within()</code> queries continue to work.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/cursor/QueryCursor.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="QueryCursor"><a href="#QueryCursor">QueryCursor</a></h2></div><ul><li><a href="#querycursor_QueryCursor">QueryCursor()</a></li><li><a href="#querycursor_QueryCursor-addCursorFlag">QueryCursor.prototype.addCursorFlag()</a></li><li><a href="#querycursor_QueryCursor-close">QueryCursor.prototype.close()</a></li><li><a href="#querycursor_QueryCursor-eachAsync">QueryCursor.prototype.eachAsync()</a></li><li><a href="#querycursor_QueryCursor-map">QueryCursor.prototype.map()</a></li><li><a href="#querycursor_QueryCursor-next">QueryCursor.prototype.next()</a></li><li><a href="#querycursor_QueryCursor-options">QueryCursor.prototype.options</a></li><li><a href="#querycursor_QueryCursor-rewind">QueryCursor.prototype.rewind()</a></li><li><a href="#querycursor_QueryCursor-[Symbol.asyncIterator]">QueryCursor.prototype[Symbol.asyncIterator]()</a></li></ul><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor"><a href="#querycursor_QueryCursor">QueryCursor()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">query
<span class="method-type">&laquo;Query&raquo;</span> </li><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> query options passed to <code>.find()</code></p>
</li></ul><div><p>A QueryCursor is a concurrency primitive for processing query results
one document at a time. A QueryCursor fulfills the Node.js streams3 API,
in addition to several other mechanisms for loading documents from MongoDB
one at a time.</p>
<p>QueryCursors execute the model&#39;s pre <code>find</code> hooks before loading any documents
from MongoDB, and the model&#39;s post <code>find</code> hooks after loading each document.</p>
<p>Unless you&#39;re an advanced user, do <strong>not</strong> instantiate this class directly.
Use <a href="/docs/api/query.html#query_Query-cursor"><code>Query#cursor()</code></a> instead.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-addCursorFlag"><a href="#querycursor_QueryCursor-addCursorFlag">QueryCursor.prototype.addCursorFlag()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">flag
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">value
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;AggregationCursor&raquo;</span> this</li></ul><div><p>Adds a <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/FindCursor.html#addCursorFlag">cursor flag</a>.
Useful for setting the <code>noCursorTimeout</code> and <code>tailable</code> flags.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-close"><a href="#querycursor_QueryCursor-close">QueryCursor.prototype.close()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Marks this cursor as closed. Will stop streaming and subsequent calls to
<code>next()</code> will error.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-eachAsync"><a href="#querycursor_QueryCursor-eachAsync">QueryCursor.prototype.eachAsync()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.parallel]
<span class="method-type">&laquo;Number&raquo;</span> the number of promises to execute in parallel. Defaults to 1.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.batchSize]
<span class="method-type">&laquo;Number&raquo;</span> if set, will call <code>fn()</code> with arrays of documents with length at most <code>batchSize</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.continueOnError=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if true, <code>eachAsync()</code> iterates through all docs even if <code>fn</code> throws an error. If false, <code>eachAsync()</code> throws an error immediately if the given function <code>fn()</code> throws an error.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> executed when all docs have been processed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Execute <code>fn</code> for every document in the cursor. If <code>fn</code> returns a promise,
will wait for the promise to resolve before iterating on to the next one.
Returns a promise that resolves when done.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Iterate over documents asynchronously</span>
<span class="hljs-title class_">Thing</span>.
  <span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">eachAsync</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">doc, i</span>) {
    doc.<span class="hljs-property">foo</span> = doc.<span class="hljs-property">bar</span> + i;
    <span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>();
  })
</code></pre>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-map"><a href="#querycursor_QueryCursor-map">QueryCursor.prototype.map()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;QueryCursor&raquo;</span> </li></ul><div><p>Registers a transform function which subsequently maps documents retrieved
via the streams interface or <code>.next()</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Map documents returned by `data` events</span>
<span class="hljs-title class_">Thing</span>.
  <span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
   doc.<span class="hljs-property">foo</span> = <span class="hljs-string">&quot;bar&quot;</span>;
   <span class="hljs-keyword">return</span> doc;
  })
  <span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">doc</span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">foo</span>); });

<span class="hljs-comment">// Or map documents returned by `.next()`</span>
<span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
    doc.<span class="hljs-property">foo</span> = <span class="hljs-string">&quot;bar&quot;</span>;
    <span class="hljs-keyword">return</span> doc;
  });
cursor.<span class="hljs-title function_">next</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">foo</span>);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-next"><a href="#querycursor_QueryCursor-next">QueryCursor.prototype.next()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Get the next document from this cursor. Will return <code>null</code> when there are
no documents left.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-options"><a href="#querycursor_QueryCursor-options">QueryCursor.prototype.options</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The <code>options</code> passed in to the <code>QueryCursor</code> constructor.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-rewind"><a href="#querycursor_QueryCursor-rewind">QueryCursor.prototype.rewind()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;AggregationCursor&raquo;</span> this</li></ul><div><p>Rewind this cursor to its uninitialized state. Any options that are present on the cursor will
remain in effect. Iterating this cursor will cause new queries to be sent to the server, even
if the resultant data has already been retrieved by this cursor.</p>
</div><hr class="separate-api-elements"><h3 id="querycursor_QueryCursor-[Symbol.asyncIterator]"><a href="#querycursor_QueryCursor-[Symbol.asyncIterator]">QueryCursor.prototype[Symbol.asyncIterator]()</a></h3><div><p>Returns an asyncIterator for use with <a href="https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js"><code>for/await/of</code> loops</a>.
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Works without using `cursor()`</span>
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>([{ <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> } }])) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// Can also use `cursor()`</span>
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">find</span>([{ <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">name</span>: <span class="hljs-number">1</span> } }]).<span class="hljs-title function_">cursor</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}
</code></pre>
<p>Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the <a href="https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187"><code>--harmony_async_iteration</code> flag</a>.</p>
<p><strong>Note:</strong> This function is not if <code>Symbol.asyncIterator</code> is undefined. If
<code>Symbol.asyncIterator</code> is undefined, that means your Node.js version does not
support async iterators.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/aggregate.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Aggregate"><a href="#Aggregate">Aggregate</a></h2></div><ul><li><a href="#aggregate_Aggregate">Aggregate()</a></li><li><a href="#aggregate_Aggregate-addFields">Aggregate.prototype.addFields()</a></li><li><a href="#aggregate_Aggregate-allowDiskUse">Aggregate.prototype.allowDiskUse()</a></li><li><a href="#aggregate_Aggregate-append">Aggregate.prototype.append()</a></li><li><a href="#aggregate_Aggregate-catch">Aggregate.prototype.catch()</a></li><li><a href="#aggregate_Aggregate-collation">Aggregate.prototype.collation()</a></li><li><a href="#aggregate_Aggregate-count">Aggregate.prototype.count()</a></li><li><a href="#aggregate_Aggregate-cursor">Aggregate.prototype.cursor()</a></li><li><a href="#aggregate_Aggregate-densify">Aggregate.prototype.densify()</a></li><li><a href="#aggregate_Aggregate-exec">Aggregate.prototype.exec()</a></li><li><a href="#aggregate_Aggregate-explain">Aggregate.prototype.explain()</a></li><li><a href="#aggregate_Aggregate-facet">Aggregate.prototype.facet()</a></li><li><a href="#aggregate_Aggregate-fill">Aggregate.prototype.fill()</a></li><li><a href="#aggregate_Aggregate-graphLookup">Aggregate.prototype.graphLookup()</a></li><li><a href="#aggregate_Aggregate-group">Aggregate.prototype.group()</a></li><li><a href="#aggregate_Aggregate-hint">Aggregate.prototype.hint()</a></li><li><a href="#aggregate_Aggregate-limit">Aggregate.prototype.limit()</a></li><li><a href="#aggregate_Aggregate-lookup">Aggregate.prototype.lookup()</a></li><li><a href="#aggregate_Aggregate-match">Aggregate.prototype.match()</a></li><li><a href="#aggregate_Aggregate-model">Aggregate.prototype.model()</a></li><li><a href="#aggregate_Aggregate-near">Aggregate.prototype.near()</a></li><li><a href="#aggregate_Aggregate-option">Aggregate.prototype.option()</a></li><li><a href="#aggregate_Aggregate-options">Aggregate.prototype.options</a></li><li><a href="#aggregate_Aggregate-pipeline">Aggregate.prototype.pipeline()</a></li><li><a href="#aggregate_Aggregate-project">Aggregate.prototype.project()</a></li><li><a href="#aggregate_Aggregate-read">Aggregate.prototype.read()</a></li><li><a href="#aggregate_Aggregate-readConcern">Aggregate.prototype.readConcern()</a></li><li><a href="#aggregate_Aggregate-redact">Aggregate.prototype.redact()</a></li><li><a href="#aggregate_Aggregate-replaceRoot">Aggregate.prototype.replaceRoot()</a></li><li><a href="#aggregate_Aggregate-sample">Aggregate.prototype.sample()</a></li><li><a href="#aggregate_Aggregate-search">Aggregate.prototype.search()</a></li><li><a href="#aggregate_Aggregate-session">Aggregate.prototype.session()</a></li><li><a href="#aggregate_Aggregate-skip">Aggregate.prototype.skip()</a></li><li><a href="#aggregate_Aggregate-sort">Aggregate.prototype.sort()</a></li><li><a href="#aggregate_Aggregate-sortByCount">Aggregate.prototype.sortByCount()</a></li><li><a href="#aggregate_Aggregate-then">Aggregate.prototype.then()</a></li><li><a href="#aggregate_Aggregate-unionWith">Aggregate.prototype.unionWith()</a></li><li><a href="#aggregate_Aggregate-unwind">Aggregate.prototype.unwind()</a></li><li><a href="#aggregate_Aggregate-[Symbol.asyncIterator]">Aggregate.prototype[Symbol.asyncIterator]()</a></li></ul><hr class="separate-api-elements"><h3 id="aggregate_Aggregate"><a href="#aggregate_Aggregate">Aggregate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[pipeline]
<span class="method-type">&laquo;Array&raquo;</span> aggregation pipeline as an array of objects</p>
</li><li class="param">[model]
<span class="method-type">&laquo;Model&raquo;</span> the model to use with this aggregate.</p>
</li></ul><div><p>Aggregate constructor used for building aggregation pipelines. Do not
instantiate this class directly, use <a href="/docs/api/model.html#model_Model-aggregate">Model.aggregate()</a> instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> aggregate = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([
  { <span class="hljs-attr">$project</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> } },
  { <span class="hljs-attr">$skip</span>: <span class="hljs-number">5</span> }
]);

<span class="hljs-title class_">Model</span>.
  <span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">21</span> }}}]).
  <span class="hljs-title function_">unwind</span>(<span class="hljs-string">&#x27;tags&#x27;</span>).
  <span class="hljs-title function_">exec</span>(callback);
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<ul>
<li><p>The documents returned are plain javascript objects, not mongoose documents (since any shape of document can be returned).</p>
</li>
<li><p>Mongoose does <strong>not</strong> cast pipeline stages. The below will <strong>not</strong> work unless <code>_id</code> is a string in the database</p>
<p>  new Aggregate([{ $match: { _id: &#39;00000000000000000000000a&#39; } }]);
  // Do this instead to cast to an ObjectId
  new Aggregate([{ $match: { _id: new mongoose.Types.ObjectId(&#39;00000000000000000000000a&#39;) } }]);</p>
</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-addFields"><a href="#aggregate_Aggregate-addFields">Aggregate.prototype.addFields()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> field specification</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $addFields operator to this aggregate pipeline.
Requires MongoDB v3.4+ to work</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// adding new fields based on existing fields</span>
aggregate.<span class="hljs-title function_">addFields</span>({
    <span class="hljs-attr">newField</span>: <span class="hljs-string">&#x27;$b.nested&#x27;</span>
  , <span class="hljs-attr">plusTen</span>: { <span class="hljs-attr">$add</span>: [<span class="hljs-string">&#x27;$val&#x27;</span>, <span class="hljs-number">10</span>]}
  , <span class="hljs-attr">sub</span>: {
       <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;$a&#x27;</span>
    }
})

<span class="hljs-comment">// etc</span>
aggregate.<span class="hljs-title function_">addFields</span>({ <span class="hljs-attr">salary_k</span>: { <span class="hljs-attr">$divide</span>: [ <span class="hljs-string">&quot;$salary&quot;</span>, <span class="hljs-number">1000</span> ] } });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-allowDiskUse"><a href="#aggregate_Aggregate-allowDiskUse">Aggregate.prototype.allowDiskUse()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Boolean&raquo;</span> Should tell server it can use hard drive to store data during aggregation.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Sets the allowDiskUse option for the aggregation query</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> } }]).<span class="hljs-title function_">allowDiskUse</span>(<span class="hljs-literal">true</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-append"><a href="#aggregate_Aggregate-append">Aggregate.prototype.append()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">...ops
<span class="method-type">&laquo;Object|Array[Object]&raquo;</span> operator(s) to append. Can either be a spread of objects or a single parameter of a object array.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new operators to this aggregate pipeline</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">append</span>({ <span class="hljs-attr">$project</span>: { <span class="hljs-attr">field</span>: <span class="hljs-number">1</span> }}, { <span class="hljs-attr">$limit</span>: <span class="hljs-number">2</span> });

<span class="hljs-comment">// or pass an array</span>
<span class="hljs-keyword">const</span> pipeline = [{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">daw</span>: <span class="hljs-string">&#x27;Logic Audio X&#x27;</span> }} ];
aggregate.<span class="hljs-title function_">append</span>(pipeline);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-catch"><a href="#aggregate_Aggregate-catch">Aggregate.prototype.catch()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[reject]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with either the doc(s) or rejected with the error.
Like <a href="#query_Query-then"><code>.then()</code></a>, but only takes a rejection handler.
Compatible with <code>await</code>.</p>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-collation"><a href="#aggregate_Aggregate-collation">Aggregate.prototype.collation()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">collation
<span class="method-type">&laquo;Object&raquo;</span> options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Adds a collation</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(pipeline).<span class="hljs-title function_">collation</span>({ <span class="hljs-attr">locale</span>: <span class="hljs-string">&#x27;en_US&#x27;</span>, <span class="hljs-attr">strength</span>: <span class="hljs-number">1</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-count"><a href="#aggregate_Aggregate-count">Aggregate.prototype.count()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fieldName
<span class="method-type">&laquo;String&raquo;</span> The name of the output field which has the count as its value. It must be a non-empty string, must not start with $ and must not contain the . character.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $count operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">count</span>(<span class="hljs-string">&quot;userCount&quot;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-cursor"><a href="#aggregate_Aggregate-cursor">Aggregate.prototype.cursor()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.batchSize]
<span class="method-type">&laquo;Number&raquo;</span> set the cursor batch size</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.useMongooseAggCursor]
<span class="method-type">&laquo;Boolean&raquo;</span> use experimental mongoose-specific aggregation cursor (for <code>eachAsync()</code> and other query cursor semantics)</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;AggregationCursor&raquo;</span> cursor representing this aggregation</li></ul><div><p>Sets the <code>cursor</code> option and executes this aggregation, returning an aggregation cursor.
Cursors are useful if you want to process the results of the aggregation one-at-a-time
because the aggregation result is too big to fit into memory.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">cursor</span>({ <span class="hljs-attr">batchSize</span>: <span class="hljs-number">1000</span> });
cursor.<span class="hljs-title function_">eachAsync</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">doc, i</span>) {
  <span class="hljs-comment">// use doc</span>
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-densify"><a href="#aggregate_Aggregate-densify">Aggregate.prototype.densify()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> $densify operator contents</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $densify operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code> aggregate.<span class="hljs-title function_">densify</span>({
   <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;timestamp&#x27;</span>,
   <span class="hljs-attr">range</span>: {
     <span class="hljs-attr">step</span>: <span class="hljs-number">1</span>,
     <span class="hljs-attr">unit</span>: <span class="hljs-string">&#x27;hour&#x27;</span>,
     <span class="hljs-attr">bounds</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2021-05-18T00:00:00.000Z&#x27;</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2021-05-18T08:00:00.000Z&#x27;</span>)]
   }
 });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-exec"><a href="#aggregate_Aggregate-exec">Aggregate.prototype.exec()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a Promise if no &quot;callback&quot; is given.</li></ul><div><p>Executes the aggregate pipeline on the currently bound Model.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">exec</span>(callback);

<span class="hljs-comment">// Because a promise is returned, the `callback` is optional.</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> aggregate.<span class="hljs-title function_">exec</span>();
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-explain"><a href="#aggregate_Aggregate-explain">Aggregate.prototype.explain()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[verbosity]
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> The callback function to call, if not specified, will return a Promise instead.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> Returns a promise if no &quot;callback&quot; is given</li></ul><div><p>Execute the aggregation with explain</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">explain</span>(callback)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-facet"><a href="#aggregate_Aggregate-facet">Aggregate.prototype.facet()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">facet
<span class="method-type">&laquo;Object&raquo;</span> options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Combines multiple aggregation pipelines.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>().<span class="hljs-title function_">facet</span>({
  <span class="hljs-attr">books</span>: [{ <span class="hljs-attr">groupBy</span>: <span class="hljs-string">&#x27;$author&#x27;</span> }],
  <span class="hljs-attr">price</span>: [{ <span class="hljs-attr">$bucketAuto</span>: { <span class="hljs-attr">groupBy</span>: <span class="hljs-string">&#x27;$price&#x27;</span>, <span class="hljs-attr">buckets</span>: <span class="hljs-number">2</span> } }]
});

<span class="hljs-comment">// Output: { books: [...], price: [{...}, {...}] }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-fill"><a href="#aggregate_Aggregate-fill">Aggregate.prototype.fill()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> $fill operator contents</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $fill operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code> aggregate.<span class="hljs-title function_">fill</span>({
   <span class="hljs-attr">output</span>: {
     <span class="hljs-attr">bootsSold</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">0</span> },
     <span class="hljs-attr">sandalsSold</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">0</span> },
     <span class="hljs-attr">sneakersSold</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">0</span> }
   }
 });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-graphLookup"><a href="#aggregate_Aggregate-graphLookup">Aggregate.prototype.graphLookup()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> to $graphLookup as described in the above link</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new custom $graphLookup operator(s) to this aggregate pipeline, performing a recursive search on a collection.</p>
<p>Note that graphLookup can only consume at most 100MB of memory, and does not allow disk use even if <code>{ allowDiskUse: true }</code> is specified.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code> <span class="hljs-comment">// Suppose we have a collection of courses, where a document might look like `{ _id: 0, name: &#x27;Calculus&#x27;, prerequisite: &#x27;Trigonometry&#x27;}` and `{ _id: 0, name: &#x27;Trigonometry&#x27;, prerequisite: &#x27;Algebra&#x27; }`</span>
 aggregate.<span class="hljs-title function_">graphLookup</span>({ <span class="hljs-attr">from</span>: <span class="hljs-string">&#x27;courses&#x27;</span>, <span class="hljs-attr">startWith</span>: <span class="hljs-string">&#x27;$prerequisite&#x27;</span>, <span class="hljs-attr">connectFromField</span>: <span class="hljs-string">&#x27;prerequisite&#x27;</span>, <span class="hljs-attr">connectToField</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;prerequisites&#x27;</span>, <span class="hljs-attr">maxDepth</span>: <span class="hljs-number">3</span> }) <span class="hljs-comment">// this will recursively search the &#x27;courses&#x27; collection up to 3 prerequisites</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-group"><a href="#aggregate_Aggregate-group">Aggregate.prototype.group()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> $group operator contents</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new custom $group operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">group</span>({ <span class="hljs-attr">_id</span>: <span class="hljs-string">&quot;$department&quot;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-hint"><a href="#aggregate_Aggregate-hint">Aggregate.prototype.hint()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Object|String&raquo;</span> a hint object or the index name</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Sets the hint option for the aggregation query</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">hint</span>({ <span class="hljs-attr">qty</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">category</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">exec</span>(callback)
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-limit"><a href="#aggregate_Aggregate-limit">Aggregate.prototype.limit()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">num
<span class="method-type">&laquo;Number&raquo;</span> maximum number of records to pass to the next stage</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $limit operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">limit</span>(<span class="hljs-number">10</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-lookup"><a href="#aggregate_Aggregate-lookup">Aggregate.prototype.lookup()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> to $lookup as described in the above link</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new custom $lookup operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">lookup</span>({ <span class="hljs-attr">from</span>: <span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-attr">localField</span>: <span class="hljs-string">&#x27;userId&#x27;</span>, <span class="hljs-attr">foreignField</span>: <span class="hljs-string">&#x27;_id&#x27;</span>, <span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;users&#x27;</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-match"><a href="#aggregate_Aggregate-match">Aggregate.prototype.match()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> $match operator contents</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new custom $match operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">match</span>({ <span class="hljs-attr">department</span>: { <span class="hljs-attr">$in</span>: [ <span class="hljs-string">&quot;sales&quot;</span>, <span class="hljs-string">&quot;engineering&quot;</span> ] } });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-model"><a href="#aggregate_Aggregate-model">Aggregate.prototype.model()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[model]
<span class="method-type">&laquo;Model&raquo;</span> Set the model associated with this aggregate. If not provided, returns the already stored model.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> </li></ul><div><p>Get/set the model that this aggregation will execute on.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> aggregate = <span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">answer</span>: <span class="hljs-number">42</span> } }]);
aggregate.<span class="hljs-title function_">model</span>() === <span class="hljs-title class_">MyModel</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Change the model. There&#x27;s rarely any reason to do this.</span>
aggregate.<span class="hljs-title function_">model</span>(<span class="hljs-title class_">SomeOtherModel</span>);
aggregate.<span class="hljs-title function_">model</span>() === <span class="hljs-title class_">SomeOtherModel</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-near"><a href="#aggregate_Aggregate-near">Aggregate.prototype.near()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $geoNear operator to this aggregate pipeline.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><strong>MUST</strong> be used as the first operator in the pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">near</span>({
  <span class="hljs-attr">near</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Point&#x27;</span>, <span class="hljs-attr">coordinates</span>: [<span class="hljs-number">40.724</span>, -<span class="hljs-number">73.997</span>] },
  <span class="hljs-attr">distanceField</span>: <span class="hljs-string">&quot;dist.calculated&quot;</span>, <span class="hljs-comment">// required</span>
  <span class="hljs-attr">maxDistance</span>: <span class="hljs-number">0.008</span>,
  <span class="hljs-attr">query</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;public&quot;</span> },
  <span class="hljs-attr">includeLocs</span>: <span class="hljs-string">&quot;dist.location&quot;</span>,
  <span class="hljs-attr">spherical</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-option"><a href="#aggregate_Aggregate-option">Aggregate.prototype.option()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> keys to merge into current options</p>
</li><ul style="margin-top: 0.5em"><li>[options.maxTimeMS]
<span class="method-type">&laquo;Number&raquo;</span> number limits the time this aggregation will run, see <a href="https://www.mongodb.com/docs/manual/reference/operator/meta/maxTimeMS/">MongoDB docs on <code>maxTimeMS</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.allowDiskUse]
<span class="method-type">&laquo;Boolean&raquo;</span> boolean if true, the MongoDB server will use the hard drive to store data during this aggregation</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.collation]
<span class="method-type">&laquo;Object&raquo;</span> object see <a href="#aggregate_Aggregate-collation"><code>Aggregate.prototype.collation()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.session]
<span class="method-type">&laquo;ClientSession&raquo;</span> ClientSession see <a href="#aggregate_Aggregate-session"><code>Aggregate.prototype.session()</code></a></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Lets you set arbitrary options, for middleware or plugins.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> agg = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">option</span>({ <span class="hljs-attr">allowDiskUse</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// Set the `allowDiskUse` option</span>
agg.<span class="hljs-property">options</span>; <span class="hljs-comment">// `{ allowDiskUse: true }`</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-options"><a href="#aggregate_Aggregate-options">Aggregate.prototype.options</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Contains options passed down to the <a href="https://www.mongodb.com/docs/manual/reference/command/aggregate/">aggregate command</a>.
Supported options are:</p>
<ul>
<li><a href="#aggregate_Aggregate-allowDiskUse"><code>allowDiskUse</code></a></li>
<li><code>bypassDocumentValidation</code></li>
<li><a href="#aggregate_Aggregate-collation"><code>collation</code></a></li>
<li><code>comment</code></li>
<li><a href="#aggregate_Aggregate-cursor"><code>cursor</code></a></li>
<li><a href="#aggregate_Aggregate-explain"><code>explain</code></a></li>
<li><code>fieldsAsRaw</code></li>
<li><a href="#aggregate_Aggregate-hint"><code>hint</code></a></li>
<li><code>let</code></li>
<li><code>maxTimeMS</code></li>
<li><code>raw</code></li>
<li><a href="#aggregate_Aggregate-readConcern"><code>readConcern</code></a></li>
<li><code>readPreference</code></li>
<li><a href="#aggregate_Aggregate-session"><code>session</code></a></li>
<li><code>writeConcern</code></li>
</ul>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-pipeline"><a href="#aggregate_Aggregate-pipeline">Aggregate.prototype.pipeline()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> The current pipeline similar to the operation that will be executed</li></ul><div><p>Returns the current pipeline</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">MyModel</span>.<span class="hljs-title function_">aggregate</span>().<span class="hljs-title function_">match</span>({ <span class="hljs-attr">test</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">pipeline</span>(); <span class="hljs-comment">// [{ $match: { test: 1 } }]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-project"><a href="#aggregate_Aggregate-project">Aggregate.prototype.project()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|String&raquo;</span> field specification</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $project operator to this aggregate pipeline.</p>
<p>Mongoose query <a href="#query_Query-select">selection syntax</a> is also supported.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// include a, include b, exclude _id</span>
aggregate.<span class="hljs-title function_">project</span>(<span class="hljs-string">&quot;a b -_id&quot;</span>);

<span class="hljs-comment">// or you may use object notation, useful when</span>
<span class="hljs-comment">// you have keys already prefixed with a &quot;-&quot;</span>
aggregate.<span class="hljs-title function_">project</span>({<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>});

<span class="hljs-comment">// reshaping documents</span>
aggregate.<span class="hljs-title function_">project</span>({
    <span class="hljs-attr">newField</span>: <span class="hljs-string">&#x27;$b.nested&#x27;</span>
  , <span class="hljs-attr">plusTen</span>: { <span class="hljs-attr">$add</span>: [<span class="hljs-string">&#x27;$val&#x27;</span>, <span class="hljs-number">10</span>]}
  , <span class="hljs-attr">sub</span>: {
       <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;$a&#x27;</span>
    }
})

<span class="hljs-comment">// etc</span>
aggregate.<span class="hljs-title function_">project</span>({ <span class="hljs-attr">salary_k</span>: { <span class="hljs-attr">$divide</span>: [ <span class="hljs-string">&quot;$salary&quot;</span>, <span class="hljs-number">1000</span> ] } });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-read"><a href="#aggregate_Aggregate-read">Aggregate.prototype.read()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">pref
<span class="method-type">&laquo;String|ReadPreference&raquo;</span> one of the listed preference options or their aliases</p>
</li><li class="param">[tags]
<span class="method-type">&laquo;Array&raquo;</span> optional tags for this query. DEPRECATED</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Sets the readPreference option for the aggregation query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(pipeline).<span class="hljs-title function_">read</span>(<span class="hljs-string">&#x27;primaryPreferred&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-readConcern"><a href="#aggregate_Aggregate-readConcern">Aggregate.prototype.readConcern()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">level
<span class="method-type">&laquo;String&raquo;</span> one of the listed read concern level or their aliases</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Sets the readConcern level for the aggregation query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(pipeline).<span class="hljs-title function_">readConcern</span>(<span class="hljs-string">&#x27;majority&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-redact"><a href="#aggregate_Aggregate-redact">Aggregate.prototype.redact()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">expression
<span class="method-type">&laquo;Object&raquo;</span> redact options or conditional expression</p>
</li><li class="param">[thenExpr]
<span class="method-type">&laquo;String|Object&raquo;</span> true case for the condition</p>
</li><li class="param">[elseExpr]
<span class="method-type">&laquo;String|Object&raquo;</span> false case for the condition</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Appends a new $redact operator to this aggregate pipeline.</p>
<p>If 3 arguments are supplied, Mongoose will wrap them with if-then-else of $cond operator respectively
If <code>thenExpr</code> or <code>elseExpr</code> is string, make sure it starts with $$, like <code>$$DESCEND</code>, <code>$$PRUNE</code> or <code>$$KEEP</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(pipeline).<span class="hljs-title function_">redact</span>({
  <span class="hljs-attr">$cond</span>: {
    <span class="hljs-attr">if</span>: { <span class="hljs-attr">$eq</span>: [ <span class="hljs-string">&#x27;$level&#x27;</span>, <span class="hljs-number">5</span> ] },
    <span class="hljs-attr">then</span>: <span class="hljs-string">&#x27;$$PRUNE&#x27;</span>,
    <span class="hljs-attr">else</span>: <span class="hljs-string">&#x27;$$DESCEND&#x27;</span>
  }
});

<span class="hljs-comment">// $redact often comes with $cond operator, you can also use the following syntax provided by mongoose</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(pipeline).<span class="hljs-title function_">redact</span>({ <span class="hljs-attr">$eq</span>: [ <span class="hljs-string">&#x27;$level&#x27;</span>, <span class="hljs-number">5</span> ] }, <span class="hljs-string">&#x27;$$PRUNE&#x27;</span>, <span class="hljs-string">&#x27;$$DESCEND&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-replaceRoot"><a href="#aggregate_Aggregate-replaceRoot">Aggregate.prototype.replaceRoot()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">newRoot
<span class="method-type">&laquo;String|Object&raquo;</span> the field or document which will become the new root document</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $replaceRoot operator to this aggregate pipeline.</p>
<p>Note that the <code>$replaceRoot</code> operator requires field strings to start with &#39;$&#39;.
If you are passing in a string Mongoose will prepend &#39;$&#39; if the specified field doesn&#39;t start &#39;$&#39;.
If you are passing in an object the strings in your expression will not be altered.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">replaceRoot</span>(<span class="hljs-string">&quot;user&quot;</span>);

aggregate.<span class="hljs-title function_">replaceRoot</span>({ <span class="hljs-attr">x</span>: { <span class="hljs-attr">$concat</span>: [<span class="hljs-string">&#x27;$this&#x27;</span>, <span class="hljs-string">&#x27;$that&#x27;</span>] } });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-sample"><a href="#aggregate_Aggregate-sample">Aggregate.prototype.sample()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">size
<span class="method-type">&laquo;Number&raquo;</span> number of random documents to pick</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new custom $sample operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">sample</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// Add a pipeline that picks 3 random documents</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-search"><a href="#aggregate_Aggregate-search">Aggregate.prototype.search()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">$search
<span class="method-type">&laquo;Object&raquo;</span> options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Helper for <a href="https://www.mongodb.com/docs/atlas/atlas-search/tutorial/">Atlas Text Search</a>&#39;s
<code>$search</code> stage.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>().
 <span class="hljs-title function_">search</span>({
   <span class="hljs-attr">text</span>: {
     <span class="hljs-attr">query</span>: <span class="hljs-string">&#x27;baseball&#x27;</span>,
     <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;plot&#x27;</span>
   }
 });

<span class="hljs-comment">// Output: [{ plot: &#x27;...&#x27;, title: &#x27;...&#x27; }]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-session"><a href="#aggregate_Aggregate-session">Aggregate.prototype.session()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">session
<span class="method-type">&laquo;ClientSession&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Sets the session for this aggregation. Useful for <a href="/docs/transactions.html">transactions</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">session</span>(session);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-skip"><a href="#aggregate_Aggregate-skip">Aggregate.prototype.skip()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">num
<span class="method-type">&laquo;Number&raquo;</span> number of records to skip before next stage</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends a new $skip operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">skip</span>(<span class="hljs-number">10</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-sort"><a href="#aggregate_Aggregate-sort">Aggregate.prototype.sort()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Appends a new $sort operator to this aggregate pipeline.</p>
<p>If an object is passed, values allowed are <code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>.</p>
<p>If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with <code>-</code> which will be treated as descending.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// these are equivalent</span>
aggregate.<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;asc&#x27;</span>, <span class="hljs-attr">test</span>: -<span class="hljs-number">1</span> });
aggregate.<span class="hljs-title function_">sort</span>(<span class="hljs-string">&#x27;field -test&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-sortByCount"><a href="#aggregate_Aggregate-sortByCount">Aggregate.prototype.sortByCount()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">arg
<span class="method-type">&laquo;Object|String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> this</li></ul><div><p>Appends a new $sortByCount operator to this aggregate pipeline. Accepts either a string field name
or a pipeline object.</p>
<p>Note that the <code>$sortByCount</code> operator requires the new root to start with &#39;$&#39;.
Mongoose will prepend &#39;$&#39; if the specified field name doesn&#39;t start with &#39;$&#39;.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">sortByCount</span>(<span class="hljs-string">&#x27;users&#x27;</span>);
aggregate.<span class="hljs-title function_">sortByCount</span>({ <span class="hljs-attr">$mergeObjects</span>: [ <span class="hljs-string">&quot;$employee&quot;</span>, <span class="hljs-string">&quot;$business&quot;</span> ] })
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-then"><a href="#aggregate_Aggregate-then">Aggregate.prototype.then()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[resolve]
<span class="method-type">&laquo;Function&raquo;</span> successCallback</p>
</li><li class="param">[reject]
<span class="method-type">&laquo;Function&raquo;</span> errorCallback</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Provides a Promise-like <code>then</code> function, which will call <code>.exec</code> without a callback
Compatible with <code>await</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>(..).<span class="hljs-title function_">then</span>(successCallback, errorCallback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-unionWith"><a href="#aggregate_Aggregate-unionWith">Aggregate.prototype.unionWith()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> to $unionWith query as described in the above link</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new $unionWith operator to this aggregate pipeline.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">unionWith</span>({ <span class="hljs-attr">coll</span>: <span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-attr">pipeline</span>: [ { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-number">1</span> } } ] });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-unwind"><a href="#aggregate_Aggregate-unwind">Aggregate.prototype.unwind()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fields
<span class="method-type">&laquo;String|Object|Array[String]|Array[Object]&raquo;</span> the field(s) to unwind, either as field names or as <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/unwind/#document-operand-with-options">objects with options</a>. If passing a string, prefixing the field name with &#39;$&#39; is optional. If passing an object, <code>path</code> must start with &#39;$&#39;.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>Appends new custom $unwind operator(s) to this aggregate pipeline.</p>
<p>Note that the <code>$unwind</code> operator requires the path name to start with &#39;$&#39;.
Mongoose will prepend &#39;$&#39; if the specified field doesn&#39;t start &#39;$&#39;.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>aggregate.<span class="hljs-title function_">unwind</span>(<span class="hljs-string">&quot;tags&quot;</span>);
aggregate.<span class="hljs-title function_">unwind</span>(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);
aggregate.<span class="hljs-title function_">unwind</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;$tags&#x27;</span>, <span class="hljs-attr">preserveNullAndEmptyArrays</span>: <span class="hljs-literal">true</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregate_Aggregate-[Symbol.asyncIterator]"><a href="#aggregate_Aggregate-[Symbol.asyncIterator]">Aggregate.prototype[Symbol.asyncIterator]()</a></h3><div><p>Returns an asyncIterator for use with <a href="https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js"><code>for/await/of</code> loops</a>
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> agg = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">25</span> } } }]);
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> agg) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}
</code></pre>
<p>Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the <a href="https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187"><code>--harmony_async_iteration</code> flag</a>.</p>
<p><strong>Note:</strong> This function is not set if <code>Symbol.asyncIterator</code> is undefined. If
<code>Symbol.asyncIterator</code> is undefined, that means your Node.js version does not
support async iterators.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/cursor/AggregationCursor.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="AggregationCursor"><a href="#AggregationCursor">AggregationCursor</a></h2></div><ul><li><a href="#aggregationcursor_AggregationCursor">AggregationCursor()</a></li><li><a href="#aggregationcursor_AggregationCursor-addCursorFlag">AggregationCursor.prototype.addCursorFlag()</a></li><li><a href="#aggregationcursor_AggregationCursor-close">AggregationCursor.prototype.close()</a></li><li><a href="#aggregationcursor_AggregationCursor-eachAsync">AggregationCursor.prototype.eachAsync()</a></li><li><a href="#aggregationcursor_AggregationCursor-map">AggregationCursor.prototype.map()</a></li><li><a href="#aggregationcursor_AggregationCursor-next">AggregationCursor.prototype.next()</a></li><li><a href="#aggregationcursor_AggregationCursor-[Symbol.asyncIterator]">AggregationCursor.prototype[Symbol.asyncIterator]()</a></li></ul><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor"><a href="#aggregationcursor_AggregationCursor">AggregationCursor()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">agg
<span class="method-type">&laquo;Aggregate&raquo;</span> </li></ul><div><p>An AggregationCursor is a concurrency primitive for processing aggregation
results one document at a time. It is analogous to QueryCursor.</p>
<p>An AggregationCursor fulfills the Node.js streams3 API,
in addition to several other mechanisms for loading documents from MongoDB
one at a time.</p>
<p>Creating an AggregationCursor executes the model&#39;s pre aggregate hooks,
but <strong>not</strong> the model&#39;s post aggregate hooks.</p>
<p>Unless you&#39;re an advanced user, do <strong>not</strong> instantiate this class directly.
Use <a href="/docs/api/aggregate.html#aggregate_Aggregate-cursor"><code>Aggregate#cursor()</code></a> instead.</p>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-addCursorFlag"><a href="#aggregationcursor_AggregationCursor-addCursorFlag">AggregationCursor.prototype.addCursorFlag()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">flag
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">value
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;AggregationCursor&raquo;</span> this</li></ul><div><p>Adds a <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/AggregationCursor.html#addCursorFlag">cursor flag</a>.
Useful for setting the <code>noCursorTimeout</code> and <code>tailable</code> flags.</p>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-close"><a href="#aggregationcursor_AggregationCursor-close">AggregationCursor.prototype.close()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Marks this cursor as closed. Will stop streaming and subsequent calls to
<code>next()</code> will error.</p>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-eachAsync"><a href="#aggregationcursor_AggregationCursor-eachAsync">AggregationCursor.prototype.eachAsync()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.parallel]
<span class="method-type">&laquo;Number&raquo;</span> the number of promises to execute in parallel. Defaults to 1.</p>
</li></ul><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> executed when all docs have been processed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Execute <code>fn</code> for every document in the cursor. If <code>fn</code> returns a promise,
will wait for the promise to resolve before iterating on to the next one.
Returns a promise that resolves when done.</p>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-map"><a href="#aggregationcursor_AggregationCursor-map">AggregationCursor.prototype.map()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;AggregationCursor&raquo;</span> </li></ul><div><p>Registers a transform function which subsequently maps documents retrieved
via the streams interface or <code>.next()</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Map documents returned by `data` events</span>
<span class="hljs-title class_">Thing</span>.
  <span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
   doc.<span class="hljs-property">foo</span> = <span class="hljs-string">&quot;bar&quot;</span>;
   <span class="hljs-keyword">return</span> doc;
  })
  <span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">doc</span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">foo</span>); });

<span class="hljs-comment">// Or map documents returned by `.next()`</span>
<span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Thing</span>.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-regexp">/^hello/</span> }).
  <span class="hljs-title function_">cursor</span>().
  <span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
    doc.<span class="hljs-property">foo</span> = <span class="hljs-string">&quot;bar&quot;</span>;
    <span class="hljs-keyword">return</span> doc;
  });
cursor.<span class="hljs-title function_">next</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">foo</span>);
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-next"><a href="#aggregationcursor_AggregationCursor-next">AggregationCursor.prototype.next()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Get the next document from this cursor. Will return <code>null</code> when there are
no documents left.</p>
</div><hr class="separate-api-elements"><h3 id="aggregationcursor_AggregationCursor-[Symbol.asyncIterator]"><a href="#aggregationcursor_AggregationCursor-[Symbol.asyncIterator]">AggregationCursor.prototype[Symbol.asyncIterator]()</a></h3><div><p>Returns an asyncIterator for use with <a href="https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js"><code>for/await/of</code> loops</a>
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Async iterator without explicitly calling `cursor()`. Mongoose still</span>
<span class="hljs-comment">// creates an AggregationCursor instance internally.</span>
<span class="hljs-keyword">const</span> agg = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">25</span> } } }]);
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> agg) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// You can also use an AggregationCursor instance for async iteration</span>
<span class="hljs-keyword">const</span> cursor = <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">aggregate</span>([{ <span class="hljs-attr">$match</span>: { <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gte</span>: <span class="hljs-number">25</span> } } }]).<span class="hljs-title function_">cursor</span>();
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> doc <span class="hljs-keyword">of</span> cursor) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doc.<span class="hljs-property">name</span>);
}
</code></pre>
<p>Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the <a href="https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187"><code>--harmony_async_iteration</code> flag</a>.</p>
<p><strong>Note:</strong> This function is not set if <code>Symbol.asyncIterator</code> is undefined. If
<code>Symbol.asyncIterator</code> is undefined, that means your Node.js version does not
support async iterators.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schematype.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Schematype"><a href="#Schematype">Schematype</a></h2></div><ul><li><a href="#schematype_SchemaType">SchemaType()</a></li><li><a href="#schematype_SchemaType-cast">SchemaType.cast()</a></li><li><a href="#schematype_SchemaType-checkRequired">SchemaType.checkRequired()</a></li><li><a href="#schematype_SchemaType-get">SchemaType.get()</a></li><li><a href="#schematype_SchemaType-cast">SchemaType.prototype.cast()</a></li><li><a href="#schematype_SchemaType-castFunction">SchemaType.prototype.castFunction()</a></li><li><a href="#schematype_SchemaType-default">SchemaType.prototype.default()</a></li><li><a href="#schematype_SchemaType-doValidate">SchemaType.prototype.doValidate()</a></li><li><a href="#schematype_SchemaType-get">SchemaType.prototype.get()</a></li><li><a href="#schematype_SchemaType-immutable">SchemaType.prototype.immutable()</a></li><li><a href="#schematype_SchemaType-index">SchemaType.prototype.index()</a></li><li><a href="#schematype_SchemaType-isRequired">SchemaType.prototype.isRequired</a></li><li><a href="#schematype_SchemaType-path">SchemaType.prototype.path</a></li><li><a href="#schematype_SchemaType-ref">SchemaType.prototype.ref()</a></li><li><a href="#schematype_SchemaType-required">SchemaType.prototype.required()</a></li><li><a href="#schematype_SchemaType-select">SchemaType.prototype.select()</a></li><li><a href="#schematype_SchemaType-set">SchemaType.prototype.set()</a></li><li><a href="#schematype_SchemaType-sparse">SchemaType.prototype.sparse()</a></li><li><a href="#schematype_SchemaType-text">SchemaType.prototype.text()</a></li><li><a href="#schematype_SchemaType-transform">SchemaType.prototype.transform()</a></li><li><a href="#schematype_SchemaType-unique">SchemaType.prototype.unique()</a></li><li><a href="#schematype_SchemaType-validate">SchemaType.prototype.validate()</a></li><li><a href="#schematype_SchemaType-validators">SchemaType.prototype.validators</a></li><li><a href="#schematype_SchemaType-set">SchemaType.set()</a></li></ul><hr class="separate-api-elements"><h3 id="schematype_SchemaType"><a href="#schematype_SchemaType">SchemaType()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;SchemaTypeOptions&raquo;</span> See <a href="/docs/api/schematypeoptions.html">SchemaTypeOptions docs</a></p>
</li><li class="param">[instance]
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>SchemaType constructor. Do <strong>not</strong> instantiate <code>SchemaType</code> directly.
Mongoose converts your schema paths into SchemaTypes automatically.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">SchemaType</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-cast"><a href="#schematype_SchemaType-cast">SchemaType.cast()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">caster
<span class="method-type">&laquo;Function|false&raquo;</span> Function that casts arbitrary values to this type, or throws an error if casting failed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Get/set the function used to cast arbitrary values to this type.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Disallow `null` for numbers, and don&#x27;t try to cast any values to</span>
<span class="hljs-comment">// numbers, so even strings like &#x27;123&#x27; will cause a CastError.</span>
mongoose.<span class="hljs-property">Number</span>.<span class="hljs-title function_">cast</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  assert.<span class="hljs-title function_">ok</span>(v === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">&#x27;number&#x27;</span>);
  <span class="hljs-keyword">return</span> v;
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-checkRequired"><a href="#schematype_SchemaType-checkRequired">SchemaType.checkRequired()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[fn]
<span class="method-type">&laquo;Function&raquo;</span> If set, will overwrite the current set function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> The input <code>fn</code> or the already set function</li></ul><div><p>Set &amp; Get the <code>checkRequired</code> function
Override the function the required validator uses to check whether a value
passes the <code>required</code> check. Override this on the individual SchemaType.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Use this to allow empty strings to pass the `required` validator</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">String</span>.<span class="hljs-title function_">checkRequired</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">&#x27;string&#x27;</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-get"><a href="#schematype_SchemaType-get">SchemaType.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">getter
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;this&raquo;</span> </li></ul><div><p>Attaches a getter for all instances of this schema type.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make all numbers round down</span>
mongoose.<span class="hljs-property">Number</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(v); });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-cast"><a href="#schematype_SchemaType-cast">SchemaType.prototype.cast()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Object&raquo;</span> value to cast</p>
</li><li class="param">doc
<span class="method-type">&laquo;Document&raquo;</span> document that triggers the casting</p>
</li><li class="param">init
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>The function that Mongoose calls to cast arbitrary values to this SchemaType.</p>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-castFunction"><a href="#schematype_SchemaType-castFunction">SchemaType.prototype.castFunction()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">caster
<span class="method-type">&laquo;Function|false&raquo;</span> Function that casts arbitrary values to this type, or throws an error if casting failed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Get/set the function used to cast arbitrary values to this particular schematype instance.
Overrides <code>SchemaType.cast()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Disallow `null` for numbers, and don&#x27;t try to cast any values to</span>
<span class="hljs-comment">// numbers, so even strings like &#x27;123&#x27; will cause a CastError.</span>
<span class="hljs-keyword">const</span> number = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Number</span>(<span class="hljs-string">&#x27;mypath&#x27;</span>, {});
number.<span class="hljs-title function_">cast</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  assert.<span class="hljs-title function_">ok</span>(v === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">&#x27;number&#x27;</span>);
  <span class="hljs-keyword">return</span> v;
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-default"><a href="#schematype_SchemaType-default">SchemaType.prototype.default()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Function|any&raquo;</span> The default value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any,undefined,void&raquo;</span> Returns the set default value.</li></ul><div><p>Sets a default value for this SchemaType.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">n</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">10</span> })
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;M&#x27;</span>, schema)
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m.<span class="hljs-property">n</span>) <span class="hljs-comment">// 10</span>
</code></pre>
<p>Defaults can be either <code>functions</code> which return the value to use as the default or the literal value itself. Either way, the value will be cast based on its schema type before being set during document creation.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// values are cast:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">aNumber</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">4.815162342</span> }})
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;M&#x27;</span>, schema)
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m.<span class="hljs-property">aNumber</span>) <span class="hljs-comment">// 4.815162342</span>

<span class="hljs-comment">// default unique objects for Mixed types:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">mixed</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Mixed</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;mixed&#x27;</span>).<span class="hljs-title function_">default</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> {};
});

<span class="hljs-comment">// if we don&#x27;t use a function to return object literals for Mixed defaults,</span>
<span class="hljs-comment">// each document will receive a reference to the same object literal creating</span>
<span class="hljs-comment">// a &quot;shared&quot; object instance:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">mixed</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Mixed</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;mixed&#x27;</span>).<span class="hljs-title function_">default</span>({});
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;M&#x27;</span>, schema);
<span class="hljs-keyword">const</span> m1 = <span class="hljs-keyword">new</span> M;
m1.<span class="hljs-property">mixed</span>.<span class="hljs-property">added</span> = <span class="hljs-number">1</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m1.<span class="hljs-property">mixed</span>); <span class="hljs-comment">// { added: 1 }</span>
<span class="hljs-keyword">const</span> m2 = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m2.<span class="hljs-property">mixed</span>); <span class="hljs-comment">// { added: 1 }</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-doValidate"><a href="#schematype_SchemaType-doValidate">SchemaType.prototype.doValidate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> </li><li class="param">callback
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param">scope
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.path]
<span class="method-type">&laquo;String&raquo;</span> </li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> If no validators, returns the output from calling <code>fn</code>, otherwise no return</li></ul><div><p>Performs a validation of <code>value</code> using the validators declared for this SchemaType.</p>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-get"><a href="#schematype_SchemaType-get">SchemaType.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds a getter to this schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">dob</span> (val) {
  <span class="hljs-keyword">if</span> (!val) <span class="hljs-keyword">return</span> val;
  <span class="hljs-keyword">return</span> (val.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;/&quot;</span> + val.<span class="hljs-title function_">getDate</span>() + <span class="hljs-string">&quot;/&quot;</span> + val.<span class="hljs-title function_">getFullYear</span>();
}

<span class="hljs-comment">// defining within the schema</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">get</span>: dob })

<span class="hljs-comment">// or by retreiving its SchemaType</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: <span class="hljs-title class_">Date</span> })
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;born&#x27;</span>).<span class="hljs-title function_">get</span>(dob)
</code></pre>
<p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p>
<p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user. You can do so by defining a getter in the following way:</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">obfuscate</span> (cc) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;****-****-****-&#x27;</span> + cc.<span class="hljs-title function_">slice</span>(cc.<span class="hljs-property">length</span>-<span class="hljs-number">4</span>, cc.<span class="hljs-property">length</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AccountSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">creditCardNumber</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">get</span>: obfuscate }
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Account</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Account&#x27;</span>, <span class="hljs-title class_">AccountSchema</span>);

<span class="hljs-title class_">Account</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, found</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(found.<span class="hljs-property">creditCardNumber</span>); <span class="hljs-comment">// &#x27;****-****-****-1234&#x27;</span>
});
</code></pre>
<p>Getters are also passed a second argument, the schematype on which the getter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">inspector</span> (val, priorValue, schematype) {
  <span class="hljs-keyword">if</span> (schematype.<span class="hljs-property">options</span>.<span class="hljs-property">required</span>) {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">&#x27; is required&#x27;</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">&#x27; is not&#x27;</span>;
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirusSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">get</span>: inspector },
  <span class="hljs-attr">taxonomy</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">get</span>: inspector }
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Virus</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Virus&#x27;</span>, <span class="hljs-title class_">VirusSchema</span>);

<span class="hljs-title class_">Virus</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, virus</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(virus.<span class="hljs-property">name</span>);     <span class="hljs-comment">// name is required</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(virus.<span class="hljs-property">taxonomy</span>); <span class="hljs-comment">// taxonomy is not</span>
})
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-immutable"><a href="#schematype_SchemaType-immutable">SchemaType.prototype.immutable()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Defines this path as immutable. Mongoose prevents you from changing
immutable paths unless the parent document has <a href="/docs/api/document.html#document_Document-isNew"><code>isNew: true</code></a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">immutable</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> });
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>();

doc.<span class="hljs-property">isNew</span>; <span class="hljs-comment">// false</span>
doc.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;new name&#x27;</span>;
doc.<span class="hljs-property">name</span>; <span class="hljs-comment">// &#x27;test&#x27;, because `name` is immutable</span>
</code></pre>
<p>Mongoose also prevents changing immutable properties using <code>updateOne()</code>
and <code>updateMany()</code> based on <a href="/docs/guide.html#strict">strict mode</a>.</p>
<h4 id="example-1">
      <a href="#example-1">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Mongoose will strip out the `name` update, because `name` is immutable</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test2&#x27;</span> }, <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">1</span> } });

<span class="hljs-comment">// If `strict` is set to &#x27;throw&#x27;, Mongoose will throw an error if you</span>
<span class="hljs-comment">// update `name`</span>
<span class="hljs-keyword">const</span> err = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test2&#x27;</span> }, { <span class="hljs-attr">strict</span>: <span class="hljs-string">&#x27;throw&#x27;</span> }).
  <span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> err);
err.<span class="hljs-property">name</span>; <span class="hljs-comment">// StrictModeError</span>

<span class="hljs-comment">// If `strict` is `false`, Mongoose allows updating `name` even though</span>
<span class="hljs-comment">// the property is immutable.</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test2&#x27;</span> }, { <span class="hljs-attr">strict</span>: <span class="hljs-literal">false</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-index"><a href="#schematype_SchemaType-index">SchemaType.prototype.index()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object|Boolean|String|Number&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares the index options for this schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">index</span>: -<span class="hljs-number">1</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: <span class="hljs-string">&#x27;hashed&#x27;</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: <span class="hljs-string">&#x27;2d&#x27;</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;2dsphere&#x27;</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> }})
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">date</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">index</span>: { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">expires</span>: <span class="hljs-string">&#x27;1d&#x27;</span> }})
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;my.path&#x27;</span>).<span class="hljs-title function_">index</span>(<span class="hljs-literal">true</span>);
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;my.date&#x27;</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">expires</span>: <span class="hljs-number">60</span> });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;my.path&#x27;</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><em>Indexes are created <a href="https://www.mongodb.com/docs/manual/core/index-creation/#index-creation-background">in the background</a>
by default. If <code>background</code> is set to <code>false</code>, MongoDB will not execute any
read/write operations you send until the index build.
Specify <code>background: false</code> to override Mongoose&#39;s default.</em></p>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-isRequired"><a href="#schematype_SchemaType-isRequired">SchemaType.prototype.isRequired</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>True if this SchemaType has a required validator. False otherwise.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">isRequired</span>; <span class="hljs-comment">// true</span>

schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).required(<span class="hljs-literal">false</span>);
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">isRequired</span>; <span class="hljs-comment">// false</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-path"><a href="#schematype_SchemaType-path">SchemaType.prototype.path</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The path to this SchemaType in a Schema.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">path</span>; <span class="hljs-comment">// &#x27;name&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-ref"><a href="#schematype_SchemaType-ref">SchemaType.prototype.ref()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">ref
<span class="method-type">&laquo;String|Model|Function&raquo;</span> either a model name, a <a href="https://mongoosejs.com/docs/models.html">Model</a>, or a function that returns a model name or model.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Set the model that this path refers to. This is the option that <a href="https://mongoosejs.com/docs/populate.html">populate</a>
looks at to determine the foreign collection it should query.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, userSchema);

<span class="hljs-keyword">const</span> postSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">user</span>: mongoose.<span class="hljs-property">ObjectId</span> });
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;user&#x27;</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;User&#x27;</span>); <span class="hljs-comment">// Can set ref to a model name</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;user&#x27;</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-title class_">User</span>); <span class="hljs-comment">// Or a model class</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;user&#x27;</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">&#x27;User&#x27;</span>); <span class="hljs-comment">// Or a function that returns the model name</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;user&#x27;</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">User</span>); <span class="hljs-comment">// Or a function that returns the model class</span>

<span class="hljs-comment">// Or you can just declare the `ref` inline in your schema</span>
<span class="hljs-keyword">const</span> postSchema2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-title class_">User</span> }
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-required"><a href="#schematype_SchemaType-required">SchemaType.prototype.required()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">required
<span class="method-type">&laquo;Boolean|Function|Object&raquo;</span> enable/disable the validator, or function that returns required boolean, or options object</p>
</li><ul style="margin-top: 0.5em"><li>[options.isRequired]
<span class="method-type">&laquo;Boolean|Function&raquo;</span> enable/disable the validator, or function that returns required boolean</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.ErrorConstructor]
<span class="method-type">&laquo;Function&raquo;</span> custom error constructor. The constructor receives 1 parameter, an object containing the validator properties.</p>
</li></ul><li class="param">[message]
<span class="method-type">&laquo;String&raquo;</span> optional custom error message</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds a required validator to this SchemaType. The validator gets added
to the front of this SchemaType&#39;s validators array using <code>unshift()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// or with custom error message</span>

<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">required</span>: <span class="hljs-string">&#x27;{PATH} is required!&#x27;</span> })

<span class="hljs-comment">// or with a function</span>

<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">userId</span>: <span class="hljs-title class_">ObjectId</span>,
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> != <span class="hljs-literal">null</span>; }
  }
})

<span class="hljs-comment">// or with a function and a custom message</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">userId</span>: <span class="hljs-title class_">ObjectId</span>,
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: [
      <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> != <span class="hljs-literal">null</span>; },
      <span class="hljs-string">&#x27;username is required if id is specified&#x27;</span>
    ]
  }
})

<span class="hljs-comment">// or through the path API</span>

s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).required(<span class="hljs-literal">true</span>);

<span class="hljs-comment">// with custom error messaging</span>

s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).required(<span class="hljs-literal">true</span>, <span class="hljs-string">&#x27;grrr :( &#x27;</span>);

<span class="hljs-comment">// or make a path conditionally required based on a function</span>
<span class="hljs-keyword">const</span> isOver18 = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>; };
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;voterRegistrationId&#x27;</span>).required(isOver18);
</code></pre>
<p>The required validator uses the SchemaType&#39;s <code>checkRequired</code> function to
determine whether a given value satisfies the required validator. By default,
a value satisfies the required validator if <code>val != null</code> (that is, if
the value is not null nor undefined). However, most built-in mongoose schema
types override the default <code>checkRequired</code> function:</p>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-select"><a href="#schematype_SchemaType-select">SchemaType.prototype.select()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">val
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Sets default <code>select()</code> behavior for this path.</p>
<p>Set to <code>true</code> if this path should always be included in the results, <code>false</code> if it should be excluded by default. This setting can be overridden at the query level.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>T = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">x</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">select</span>: <span class="hljs-literal">true</span> }}));
T.<span class="hljs-title function_">find</span>(..); <span class="hljs-comment">// field x will always be selected ..</span>
<span class="hljs-comment">// .. unless overridden;</span>
T.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;-x&#x27;</span>).<span class="hljs-title function_">exec</span>(callback);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-set"><a href="#schematype_SchemaType-set">SchemaType.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds a setter to this schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">capitalize</span> (val) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val !== <span class="hljs-string">&#x27;string&#x27;</span>) val = <span class="hljs-string">&#x27;&#x27;</span>;
  <span class="hljs-keyword">return</span> val.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + val.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// defining within the schema</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: capitalize }});

<span class="hljs-comment">// or with the SchemaType</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> })
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">set</span>(capitalize);
</code></pre>
<p>Setters allow you to transform the data before it gets to the raw mongodb
document or query.</p>
<p>Suppose you are implementing user registration for a website. Users provide
an email and password, which gets saved to mongodb. The email is a string
that you will want to normalize to lower case, in order to avoid one email
having more than one account -- e.g., otherwise, <a href="mailto:&#97;&#118;&#101;&#110;&#x75;&#101;&#x40;&#x71;&#x2e;&#99;&#x6f;&#x6d;">&#97;&#118;&#101;&#110;&#x75;&#101;&#x40;&#x71;&#x2e;&#99;&#x6f;&#x6d;</a> can be registered for 2 accounts via <a href="mailto:&#x61;&#x76;&#101;&#110;&#117;&#x65;&#64;&#x71;&#x2e;&#x63;&#111;&#109;">&#x61;&#x76;&#101;&#110;&#117;&#x65;&#64;&#x71;&#x2e;&#x63;&#111;&#109;</a> and <a href="mailto:&#65;&#x76;&#69;&#x6e;&#85;&#101;&#64;&#81;&#46;&#67;&#x6f;&#77;">&#65;&#x76;&#69;&#x6e;&#85;&#101;&#64;&#81;&#46;&#67;&#x6f;&#77;</a>.</p>
<p>You can set up email lower case normalization easily via a Mongoose setter.</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">toLower</span>(<span class="hljs-params">v</span>) {
  <span class="hljs-keyword">return</span> v.<span class="hljs-title function_">toLowerCase</span>();
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: toLower }
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-title class_">UserSchema</span>);

<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({<span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;AVENUE@Q.COM&#x27;</span>});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">email</span>); <span class="hljs-comment">// &#x27;avenue@q.com&#x27;</span>

<span class="hljs-comment">// or</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
user.<span class="hljs-property">email</span> = <span class="hljs-string">&#x27;Avenue@Q.com&#x27;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">email</span>); <span class="hljs-comment">// &#x27;avenue@q.com&#x27;</span>
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">_id</span>: _id }, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;AVENUE@Q.COM&#x27;</span> } }); <span class="hljs-comment">// update to &#x27;avenue@q.com&#x27;</span>
</code></pre>
<p>As you can see above, setters allow you to transform the data before it
stored in MongoDB, or before executing a query.</p>
<p><em>NOTE: we could have also just used the built-in <code>lowercase: true</code> SchemaType option instead of defining our own function.</em></p>
<pre><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">lowercase</span>: <span class="hljs-literal">true</span> }})
</code></pre>
<p>Setters are also passed a second argument, the schematype on which the setter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<pre><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">inspector</span> (val, priorValue, schematype) {
  <span class="hljs-keyword">if</span> (schematype.<span class="hljs-property">options</span>.<span class="hljs-property">required</span>) {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">&#x27; is required&#x27;</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> val;
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirusSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">set</span>: inspector },
  <span class="hljs-attr">taxonomy</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: inspector }
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Virus</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Virus&#x27;</span>, <span class="hljs-title class_">VirusSchema</span>);
<span class="hljs-keyword">const</span> v = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Virus</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Parvoviridae&#x27;</span>, <span class="hljs-attr">taxonomy</span>: <span class="hljs-string">&#x27;Parvovirinae&#x27;</span> });

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v.<span class="hljs-property">name</span>);     <span class="hljs-comment">// name is required</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v.<span class="hljs-property">taxonomy</span>); <span class="hljs-comment">// Parvovirinae</span>
</code></pre>
<p>You can also use setters to modify other properties on the document. If
you&#39;re setting a property <code>name</code> on a document, the setter will run with
<code>this</code> as the document. Be careful, in mongoose 5 setters will also run
when querying by <code>name</code> with <code>this</code> as the query.</p>
<pre><code><span class="hljs-keyword">const</span> nameSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">keywords</span>: [<span class="hljs-title class_">String</span>] });
nameSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">set</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  <span class="hljs-comment">// Need to check if `this` is a document, because in mongoose 5</span>
  <span class="hljs-comment">// setters will also run on queries, in which case `this` will be a</span>
  <span class="hljs-comment">// mongoose query object.</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Document</span> &amp;&amp; v != <span class="hljs-literal">null</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">keywords</span> = v.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>);
  }
  <span class="hljs-keyword">return</span> v;
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-sparse"><a href="#schematype_SchemaType-sparse">SchemaType.prototype.sparse()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares a sparse index.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> } });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-text"><a href="#schematype_SchemaType-text">SchemaType.prototype.text()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares a full text index.</p>
<h3 id="example">
      <a href="#example">
        Example:
      </a>
    </h3>
<pre><code> <span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ name : { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, text : <span class="hljs-literal">true</span> } })
 s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">index</span>({ text : <span class="hljs-literal">true</span> });
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-transform"><a href="#schematype_SchemaType-transform">SchemaType.prototype.transform()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Defines a custom function for transforming this path when converting a document to JSON.</p>
<p>Mongoose calls this function with one parameter: the current <code>value</code> of the path. Mongoose
then uses the return value in the JSON output.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">date</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.<span class="hljs-title function_">getFullYear</span>() }
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2016-06-01&#x27;</span>) });
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>();

doc.<span class="hljs-property">date</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>; <span class="hljs-comment">// true</span>

doc.<span class="hljs-title function_">toJSON</span>().<span class="hljs-property">date</span>; <span class="hljs-comment">// 2016 as a number</span>
<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(doc); <span class="hljs-comment">// &#x27;{&quot;_id&quot;:...,&quot;date&quot;:2016}&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-unique"><a href="#schematype_SchemaType-unique">SchemaType.prototype.unique()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">bool
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares an unique index.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> } });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> });
</code></pre>
<p><em>NOTE: violating the constraint returns an <code>E11000</code> error from MongoDB when saving, not a Mongoose validation error.</em></p>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-validate"><a href="#schematype_SchemaType-validate">SchemaType.prototype.validate()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;RegExp|Function|Object&raquo;</span> validator function, or hash describing options</p>
</li><ul style="margin-top: 0.5em"><li>[obj.validator]
<span class="method-type">&laquo;Function&raquo;</span> validator function. If the validator function returns <code>undefined</code> or a truthy value, validation succeeds. If it returns <a href="https://masteringjs.io/tutorials/fundamentals/falsy">falsy</a> (except <code>undefined</code>) or throws an error, validation fails.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[obj.message]
<span class="method-type">&laquo;String|Function&raquo;</span> optional error message. If function, should return the error message as a string</p>
</li></ul><ul style="margin-top: 0.5em"><li>[obj.propsParameter=false]
<span class="method-type">&laquo;Boolean&raquo;</span> If true, Mongoose will pass the validator properties object (with the <code>validator</code> function, <code>message</code>, etc.) as the 2nd arg to the validator function. This is disabled by default because many validators <a href="https://github.com/chriso/validator.js#validators">rely on positional args</a>, so turning this on may cause unpredictable behavior in external validators.</p>
</li></ul><li class="param">[errorMsg]
<span class="method-type">&laquo;String|Function&raquo;</span> optional error message. If function, should return the error message as a string</p>
</li><li class="param">[type]
<span class="method-type">&laquo;String&raquo;</span> optional validator type</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds validator(s) for this document path.</p>
<p>Validators always receive the value to validate as their first argument and
must return <code>Boolean</code>. Returning <code>false</code> or throwing an error means
validation failed.</p>
<p>The error message argument is optional. If not passed, the <a href="#error_messages_MongooseError-messages">default generic error message template</a> will be used.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// make sure every value is equal to &quot;something&quot;</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validator</span> (val) {
  <span class="hljs-keyword">return</span> val === <span class="hljs-string">&#x27;something&#x27;</span>;
}
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: validator }});

<span class="hljs-comment">// with a custom error message</span>

<span class="hljs-keyword">const</span> custom = [validator, <span class="hljs-string">&#x27;Uh oh, {PATH} does not equal &quot;something&quot;.&#x27;</span>]
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: custom }});

<span class="hljs-comment">// adding many validators at a time</span>

<span class="hljs-keyword">const</span> many = [
    { <span class="hljs-attr">validator</span>: validator, <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;uh oh&#x27;</span> }
  , { <span class="hljs-attr">validator</span>: anotherValidator, <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;failed&#x27;</span> }
]
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: many }});

<span class="hljs-comment">// or utilizing SchemaType methods directly:</span>

<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;string&#x27;</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">validate</span>(validator, <span class="hljs-string">&#x27;validation of `{PATH}` failed with value `{VALUE}`&#x27;</span>);
</code></pre>
<h4 id="error-message-templates">
      <a href="#error-message-templates">
        Error message templates:
      </a>
    </h4>
<p>From the examples above, you may have noticed that error messages support
basic templating. There are a few other template keywords besides <code>{PATH}</code>
and <code>{VALUE}</code> too. To find out more, details are available
<a href="#error_messages_MongooseError-messages">here</a>.</p>
<p>If Mongoose&#39;s built-in error message templating isn&#39;t enough, Mongoose
supports setting the <code>message</code> property to a function.</p>
<pre><code>schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) { <span class="hljs-keyword">return</span> v.<span class="hljs-property">length</span> &gt; <span class="hljs-number">5</span>; },
  <span class="hljs-comment">// `errors[&#x27;name&#x27;]` will be &quot;name must have length 5, got &#x27;foo&#x27;&quot;</span>
  <span class="hljs-attr">message</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${props.path}</span> must have length 5, got &#x27;<span class="hljs-subst">${props.value}</span>&#x27;`</span>;
  }
});
</code></pre>
<p>To bypass Mongoose&#39;s error messages and just copy the error message that
the validator throws, do this:</p>
<pre><code>schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Oops!&#x27;</span>); },
  <span class="hljs-comment">// `errors[&#x27;name&#x27;]` will be &quot;Oops!&quot;</span>
  <span class="hljs-attr">message</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) { <span class="hljs-keyword">return</span> props.<span class="hljs-property">reason</span>.<span class="hljs-property">message</span>; }
});
</code></pre>
<h4 id="asynchronous-validation">
      <a href="#asynchronous-validation">
        Asynchronous validation:
      </a>
    </h4>
<p>Mongoose supports validators that return a promise. A validator that returns
a promise is called an <em>async validator</em>. Async validators run in
parallel, and <code>validate()</code> will wait until all async validators have settled.</p>
<pre><code>schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// validation failed</span>
    });
  }
});
</code></pre>
<p>You might use asynchronous validators to retreive other documents from the database to validate against or to meet other I/O bound validation needs.</p>
<p>Validation occurs <code>pre(&#39;save&#39;)</code> or whenever you manually execute <a href="#document_Document-validate">document#validate</a>.</p>
<p>If validation fails during <code>pre(&#39;save&#39;)</code> and no callback was passed to receive the error, an <code>error</code> event will be emitted on your Models associated db <a href="#connection_Connection">connection</a>, passing the validation error object along.</p>
<pre><code><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(..);
conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, handleError);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Product</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Product&#x27;</span>, yourSchema);
<span class="hljs-keyword">const</span> dvd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(..);
dvd.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// emits error on the `conn` above</span>
</code></pre>
<p>If you want to handle these errors at the Model level, add an <code>error</code>
listener to your Model as shown below.</p>
<pre><code><span class="hljs-comment">// registering an error listener on the Model lets us handle errors more locally</span>
<span class="hljs-title class_">Product</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, handleError);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-validators"><a href="#schematype_SchemaType-validators">SchemaType.prototype.validators</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The validators that Mongoose should run to validate properties at this SchemaType&#39;s path.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">validators</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1, the `required` validator</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematype_SchemaType-set"><a href="#schematype_SchemaType-set">SchemaType.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">option
<span class="method-type">&laquo;String&raquo;</span> The name of the option you&#39;d like to set (e.g. trim, lowercase, etc...)</p>
</li><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> The value of the option you&#39;d like to set.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;void,void&raquo;</span> </li></ul><div><p>Sets a default option for this schema type.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make all strings be trimmed by default</span>
mongoose.<span class="hljs-property">SchemaTypes</span>.<span class="hljs-property">String</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;trim&#x27;</span>, <span class="hljs-literal">true</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/virtualtype.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Virtualtype"><a href="#Virtualtype">Virtualtype</a></h2></div><ul><li><a href="#virtualtype_VirtualType">VirtualType()</a></li><li><a href="#virtualtype_VirtualType-applyGetters">VirtualType.prototype.applyGetters()</a></li><li><a href="#virtualtype_VirtualType-applySetters">VirtualType.prototype.applySetters()</a></li><li><a href="#virtualtype_VirtualType-get">VirtualType.prototype.get()</a></li><li><a href="#virtualtype_VirtualType-set">VirtualType.prototype.set()</a></li></ul><hr class="separate-api-elements"><h3 id="virtualtype_VirtualType"><a href="#virtualtype_VirtualType">VirtualType()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.ref]
<span class="method-type">&laquo;String|Function&raquo;</span> if <code>ref</code> is not nullish, this becomes a <a href="/docs/populate.html#populate-virtuals">populated virtual</a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.localField]
<span class="method-type">&laquo;String|Function&raquo;</span> the local field to populate on if this is a populated virtual.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.foreignField]
<span class="method-type">&laquo;String|Function&raquo;</span> the foreign field to populate on if this is a populated virtual.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.justOne=false]
<span class="method-type">&laquo;Boolean&raquo;</span> by default, a populated virtual is an array. If you set <code>justOne</code>, the populated virtual will be a single doc or <code>null</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.getters=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if you set this to <code>true</code>, Mongoose will call any custom getters you defined on this virtual</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.count=false]
<span class="method-type">&laquo;Boolean&raquo;</span> if you set this to <code>true</code>, <code>populate()</code> will set this virtual to the number of populated documents, as opposed to the documents themselves, using <a href="/docs/api/query.html#query_Query-countDocuments"><code>Query#countDocuments()</code></a></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.match=null]
<span class="method-type">&laquo;Object|Function&raquo;</span> add an extra match condition to <code>populate()</code></p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.limit=null]
<span class="method-type">&laquo;Number&raquo;</span> add a default <code>limit</code> to the <code>populate()</code> query</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.skip=null]
<span class="method-type">&laquo;Number&raquo;</span> add a default <code>skip</code> to the <code>populate()</code> query</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.perDocumentLimit=null]
<span class="method-type">&laquo;Number&raquo;</span> For legacy reasons, <code>limit</code> with <code>populate()</code> may give incorrect results because it only executes a single query for every document being populated. If you set <code>perDocumentLimit</code>, Mongoose will ensure correct <code>limit</code> per document by executing a separate query for each document to <code>populate()</code>. For example, <code>.find().populate({ path: &#39;test&#39;, perDocumentLimit: 2 })</code> will execute 2 additional queries if <code>.find()</code> returns 2 documents.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.options=null]
<span class="method-type">&laquo;Object&raquo;</span> Additional options like <code>limit</code> and <code>lean</code>.</p>
</li></ul><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>VirtualType constructor</p>
<p>This is what mongoose uses to define virtual attributes via <code>Schema.prototype.virtual</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> fullname = schema.<span class="hljs-title function_">virtual</span>(<span class="hljs-string">&#x27;fullname&#x27;</span>);
fullname <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">VirtualType</span> <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="virtualtype_VirtualType-applyGetters"><a href="#virtualtype_VirtualType-applyGetters">VirtualType.prototype.applyGetters()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">doc
<span class="method-type">&laquo;Document&raquo;</span> The document this virtual is attached to</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> the value after applying all getters</li></ul><div><p>Applies getters to <code>value</code>.</p>
</div><hr class="separate-api-elements"><h3 id="virtualtype_VirtualType-applySetters"><a href="#virtualtype_VirtualType-applySetters">VirtualType.prototype.applySetters()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">doc
<span class="method-type">&laquo;Document&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> the value after applying all setters</li></ul><div><p>Applies setters to <code>value</code>.</p>
</div><hr class="separate-api-elements"><h3 id="virtualtype_VirtualType-get"><a href="#virtualtype_VirtualType-get">VirtualType.prototype.get()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;VirtualType&raquo;</span> this</li></ul><div><p>Adds a custom getter to this virtual.</p>
<p>Mongoose calls the getter function with the below 3 parameters.</p>
<ul>
<li><code>value</code>: the value returned by the previous getter. If there is only one getter, <code>value</code> will be <code>undefined</code>.</li>
<li><code>virtual</code>: the virtual object you called <code>.get()</code> on.</li>
<li><code>doc</code>: the document this virtual is attached to. Equivalent to <code>this</code>.</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> virtual = schema.<span class="hljs-title function_">virtual</span>(<span class="hljs-string">&#x27;fullname&#x27;</span>);
virtual.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">value, virtual, doc</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">first</span> + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">last</span>;
});
</code></pre>
</div><hr class="separate-api-elements"><h3 id="virtualtype_VirtualType-set"><a href="#virtualtype_VirtualType-set">VirtualType.prototype.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;VirtualType&raquo;</span> this</li></ul><div><p>Adds a custom setter to this virtual.</p>
<p>Mongoose calls the setter function with the below 3 parameters.</p>
<ul>
<li><code>value</code>: the value being set.</li>
<li><code>virtual</code>: the virtual object you&#39;re calling <code>.set()</code> on.</li>
<li><code>doc</code>: the document this virtual is attached to. Equivalent to <code>this</code>.</li>
</ul>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> virtual = schema.<span class="hljs-title function_">virtual</span>(<span class="hljs-string">&#x27;fullname&#x27;</span>);
virtual.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">value, virtual, doc</span>) {
  <span class="hljs-keyword">const</span> parts = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">first</span> = parts[<span class="hljs-number">0</span>];
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">last</span> = parts[<span class="hljs-number">1</span>];
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>();
<span class="hljs-comment">// Calls the setter with `value = &#x27;Jean-Luc Picard&#x27;`</span>
doc.<span class="hljs-property">fullname</span> = <span class="hljs-string">&#x27;Jean-Luc Picard&#x27;</span>;
doc.<span class="hljs-property">name</span>.<span class="hljs-property">first</span>; <span class="hljs-comment">// &#x27;Jean-Luc&#x27;</span>
doc.<span class="hljs-property">name</span>.<span class="hljs-property">last</span>; <span class="hljs-comment">// &#x27;Picard&#x27;</span>
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/error/index.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Error"><a href="#Error">Error</a></h2></div><ul><li><a href="#error_Error">Error()</a></li><li><a href="#error_Error-CastError">Error.CastError</a></li><li><a href="#error_Error-DivergentArrayError">Error.DivergentArrayError</a></li><li><a href="#error_Error-DocumentNotFoundError">Error.DocumentNotFoundError</a></li><li><a href="#error_Error-MissingSchemaError">Error.MissingSchemaError</a></li><li><a href="#error_Error-MongooseServerSelectionError">Error.MongooseServerSelectionError</a></li><li><a href="#error_Error-OverwriteModelError">Error.OverwriteModelError</a></li><li><a href="#error_Error-ParallelSaveError">Error.ParallelSaveError</a></li><li><a href="#error_Error-StrictModeError">Error.StrictModeError</a></li><li><a href="#error_Error-StrictPopulateError">Error.StrictPopulateError</a></li><li><a href="#error_Error-ValidationError">Error.ValidationError</a></li><li><a href="#error_Error-ValidatorError">Error.ValidatorError</a></li><li><a href="#error_Error-VersionError">Error.VersionError</a></li><li><a href="#error_Error-messages">Error.messages</a></li><li><a href="#error_Error-name">Error.prototype.name</a></li></ul><hr class="separate-api-elements"><h3 id="error_Error"><a href="#error_Error">Error()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">msg
<span class="method-type">&laquo;String&raquo;</span> Error message</p>
</li></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>MongooseError constructor. MongooseError is the base class for all
Mongoose-specific errors.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-title class_">Number</span> }));
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">answer</span>: <span class="hljs-string">&#x27;not a number&#x27;</span> });
<span class="hljs-keyword">const</span> err = doc.<span class="hljs-title function_">validateSync</span>();

err <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Error</span>.<span class="hljs-property">ValidationError</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="error_Error-CastError"><a href="#error_Error-CastError">Error.CastError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when mongoose failed to
cast a value.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-DivergentArrayError"><a href="#error_Error-DivergentArrayError">Error.DivergentArrayError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error will be returned if you used an array projection
and then modified the array in an unsafe way.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-DocumentNotFoundError"><a href="#error_Error-DocumentNotFoundError">Error.DocumentNotFoundError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when <code>save()</code> fails
because the underlying
document was not found. The constructor takes one parameter, the
conditions that mongoose passed to <code>update()</code> when trying to update
the document.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-MissingSchemaError"><a href="#error_Error-MissingSchemaError">Error.MissingSchemaError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Thrown when you try to access a model that has not been registered yet</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-MongooseServerSelectionError"><a href="#error_Error-MongooseServerSelectionError">Error.MongooseServerSelectionError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Thrown when the MongoDB Node driver can&#39;t connect to a valid server
to send an operation to.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-OverwriteModelError"><a href="#error_Error-OverwriteModelError">Error.OverwriteModelError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Thrown when a model with the given name was already registered on the connection.
See <a href="/docs/faq.html#overwrite-model-error">the FAQ about <code>OverwriteModelError</code></a>.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-ParallelSaveError"><a href="#error_Error-ParallelSaveError">Error.ParallelSaveError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when you call <code>save()</code> multiple
times on the same document in parallel. See the <a href="/docs/faq.html">FAQ</a> for more
information.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-StrictModeError"><a href="#error_Error-StrictModeError">Error.StrictModeError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Thrown when your try to pass values to model constructor that
were not specified in schema or change immutable properties when
<code>strict</code> mode is <code>&quot;throw&quot;</code></p>
</div><hr class="separate-api-elements"><h3 id="error_Error-StrictPopulateError"><a href="#error_Error-StrictPopulateError">Error.StrictPopulateError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when mongoose failed to
populate with a path that is not existing.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-ValidationError"><a href="#error_Error-ValidationError">Error.ValidationError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when <a href="/docs/validation.html">validation</a> failed.
The <code>errors</code> property contains an object whose keys are the paths that failed and whose values are
instances of CastError or ValidationError.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-ValidatorError"><a href="#error_Error-ValidatorError">Error.ValidatorError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A <code>ValidationError</code> has a hash of <code>errors</code> that contain individual
<code>ValidatorError</code> instances.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({});

<span class="hljs-comment">// Top-level error is a ValidationError, **not** a ValidatorError</span>
<span class="hljs-keyword">const</span> err = doc.<span class="hljs-title function_">validateSync</span>();
err <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Error</span>.<span class="hljs-property">ValidationError</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// A ValidationError `err` has 0 or more ValidatorErrors keyed by the</span>
<span class="hljs-comment">// path in the `err.errors` property.</span>
err.<span class="hljs-property">errors</span>[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Error</span>.<span class="hljs-property">ValidatorError</span>;

err.<span class="hljs-property">errors</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-property">kind</span>; <span class="hljs-comment">// &#x27;required&#x27;</span>
err.<span class="hljs-property">errors</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-property">path</span>; <span class="hljs-comment">// &#x27;name&#x27;</span>
err.<span class="hljs-property">errors</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-property">value</span>; <span class="hljs-comment">// undefined</span>
</code></pre>
<p>Instances of <code>ValidatorError</code> have the following properties:</p>
<ul>
<li><code>kind</code>: The validator&#39;s <code>type</code>, like <code>&#39;required&#39;</code> or <code>&#39;regexp&#39;</code></li>
<li><code>path</code>: The path that failed validation</li>
<li><code>value</code>: The value that failed validation</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="error_Error-VersionError"><a href="#error_Error-VersionError">Error.VersionError</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>An instance of this error class will be returned when you call <code>save()</code> after
the document in the database was changed in a potentially unsafe way. See
the <a href="/docs/guide.html#versionKey"><code>versionKey</code> option</a> for more information.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-messages"><a href="#error_Error-messages">Error.messages</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The default built-in validator error messages.</p>
</div><hr class="separate-api-elements"><h3 id="error_Error-name"><a href="#error_Error-name">Error.prototype.name</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span></li></ul><div><p>The name of the error. The name uniquely identifies this Mongoose error. The
possible values are:</p>
<ul>
<li><code>MongooseError</code>: general Mongoose error</li>
<li><code>CastError</code>: Mongoose could not convert a value to the type defined in the schema path. May be in a <code>ValidationError</code> class&#39; <code>errors</code> property.</li>
<li><code>DisconnectedError</code>: This <a href="/docs/connections.html">connection</a> timed out in trying to reconnect to MongoDB and will not successfully reconnect to MongoDB unless you explicitly reconnect.</li>
<li><code>DivergentArrayError</code>: You attempted to <code>save()</code> an array that was modified after you loaded it with a <code>$elemMatch</code> or similar projection</li>
<li><code>MissingSchemaError</code>: You tried to access a model with <a href="mongoose.html#mongoose_Mongoose-model"><code>mongoose.model()</code></a> that was not defined</li>
<li><code>DocumentNotFoundError</code>: The document you tried to <a href="document.html#document_Document-save"><code>save()</code></a> was not found</li>
<li><code>ValidatorError</code>: error from an individual schema path&#39;s validator</li>
<li><code>ValidationError</code>: error returned from <a href="document.html#document_Document-validate"><code>validate()</code></a> or <a href="document.html#document_Document-validateSync"><code>validateSync()</code></a>. Contains zero or more <code>ValidatorError</code> instances in <code>.errors</code> property.</li>
<li><code>MissingSchemaError</code>: You called <code>mongoose.Document()</code> without a schema</li>
<li><code>ObjectExpectedError</code>: Thrown when you set a nested path to a non-object value with <a href="/docs/guide.html#strict">strict mode set</a>.</li>
<li><code>ObjectParameterError</code>: Thrown when you pass a non-object value to a function which expects an object as a paramter</li>
<li><code>OverwriteModelError</code>: Thrown when you call <a href="mongoose.html#mongoose_Mongoose-model"><code>mongoose.model()</code></a> to re-define a model that was already defined.</li>
<li><code>ParallelSaveError</code>: Thrown when you call <a href="model.html#model_Model-save"><code>save()</code></a> on a document when the same document instance is already saving.</li>
<li><code>StrictModeError</code>: Thrown when you set a path that isn&#39;t the schema and <a href="/docs/guide.html#strict">strict mode</a> is set to <code>throw</code>.</li>
<li><code>VersionError</code>: Thrown when the <a href="/docs/guide.html#versionKey">document is out of sync</a></li>
</ul>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schema/array.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaArray"><a href="#SchemaArray">SchemaArray</a></h2></div><ul><li><a href="#schemaarray_SchemaArray">SchemaArray()</a></li><li><a href="#schemaarray_SchemaArray-checkRequired">SchemaArray.checkRequired()</a></li><li><a href="#schemaarray_SchemaArray-options">SchemaArray.options</a></li><li><a href="#schemaarray_SchemaArray-checkRequired">SchemaArray.prototype.checkRequired()</a></li><li><a href="#schemaarray_SchemaArray-enum">SchemaArray.prototype.enum()</a></li><li><a href="#schemaarray_SchemaArray-schemaName">SchemaArray.schemaName</a></li><li><a href="#schemaarray_SchemaArray-set">SchemaArray.set()</a></li></ul><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray"><a href="#schemaarray_SchemaArray">SchemaArray()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">cast
<span class="method-type">&laquo;SchemaType&raquo;</span> </li><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">schemaOptions
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Array SchemaType constructor</p>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-checkRequired"><a href="#schemaarray_SchemaArray-checkRequired">SchemaArray.checkRequired()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">fn
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Override the function the required validator uses to check whether an array
passes the <code>required</code> check.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Require non-empty array to pass `required` check</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Array</span>.<span class="hljs-title function_">checkRequired</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(v) &amp;&amp; v.<span class="hljs-property">length</span>);

<span class="hljs-keyword">const</span> M = mongoose.<span class="hljs-title function_">model</span>({ <span class="hljs-attr">arr</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
<span class="hljs-keyword">new</span> <span class="hljs-title function_">M</span>({ <span class="hljs-attr">arr</span>: [] }).<span class="hljs-title function_">validateSync</span>(); <span class="hljs-comment">// `null`, validation fails!</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-options"><a href="#schemaarray_SchemaArray-options">SchemaArray.options</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Options for all arrays.</p>
<ul>
<li><code>castNonArrays</code>: <code>true</code> by default. If <code>false</code>, Mongoose will throw a CastError when a value isn&#39;t an array. If <code>true</code>, Mongoose will wrap the provided value in an array before casting.</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-checkRequired"><a href="#schemaarray_SchemaArray-checkRequired">SchemaArray.prototype.checkRequired()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> </li><li class="param">doc
<span class="method-type">&laquo;Document&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Check if the given value satisfies the <code>required</code> validator.</p>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-enum"><a href="#schemaarray_SchemaArray-enum">SchemaArray.prototype.enum()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[...args]
<span class="method-type">&laquo;String|Object&raquo;</span> enumeration values</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaArray&raquo;</span> this</li></ul><div><p>Adds an enum validator if this is an array of strings or numbers. Equivalent to
<code>SchemaString.prototype.enum()</code> or <code>SchemaNumber.prototype.enum()</code></p>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-schemaName"><a href="#schemaarray_SchemaArray-schemaName">SchemaArray.schemaName</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>This schema type&#39;s name, to defend against minifiers that mangle
function names.</p>
</div><hr class="separate-api-elements"><h3 id="schemaarray_SchemaArray-set"><a href="#schemaarray_SchemaArray-set">SchemaArray.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">option
<span class="method-type">&laquo;String&raquo;</span> The option you&#39;d like to set the value for</p>
</li><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> value for option</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;undefined,void&raquo;</span> </li></ul><div><p>Sets a default option for all Array instances.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make all Array instances have `required` of true by default.</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Array</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;required&#x27;</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">test</span>: <span class="hljs-title class_">Array</span> }));
<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ }).<span class="hljs-title function_">validateSync</span>().<span class="hljs-property">errors</span>.<span class="hljs-property">test</span>.<span class="hljs-property">message</span>; <span class="hljs-comment">// Path `test` is required.</span>
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schema/documentarray.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="DocumentArrayPath"><a href="#DocumentArrayPath">DocumentArrayPath</a></h2></div><ul><li><a href="#documentarraypath_DocumentArrayPath">DocumentArrayPath()</a></li><li><a href="#documentarraypath_DocumentArrayPath-options">DocumentArrayPath.options</a></li><li><a href="#documentarraypath_DocumentArrayPath-discriminator">DocumentArrayPath.prototype.discriminator()</a></li><li><a href="#documentarraypath_DocumentArrayPath-schemaName">DocumentArrayPath.schemaName</a></li><li><a href="#documentarraypath_DocumentArrayPath-set">DocumentArrayPath.set()</a></li></ul><hr class="separate-api-elements"><h3 id="documentarraypath_DocumentArrayPath"><a href="#documentarraypath_DocumentArrayPath">DocumentArrayPath()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">key
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> </li><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">schemaOptions
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>SubdocsArray SchemaType constructor</p>
</div><hr class="separate-api-elements"><h3 id="documentarraypath_DocumentArrayPath-options"><a href="#documentarraypath_DocumentArrayPath-options">DocumentArrayPath.options</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Options for all document arrays.</p>
<ul>
<li><code>castNonArrays</code>: <code>true</code> by default. If <code>false</code>, Mongoose will throw a CastError when a value isn&#39;t an array. If <code>true</code>, Mongoose will wrap the provided value in an array before casting.</li>
</ul>
</div><hr class="separate-api-elements"><h3 id="documentarraypath_DocumentArrayPath-discriminator"><a href="#documentarraypath_DocumentArrayPath-discriminator">DocumentArrayPath.prototype.discriminator()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> fields to add to the schema for instances of this sub-class</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object|string&raquo;</span> If string, same as <code>options.value</code>.</p>
</li><ul style="margin-top: 0.5em"><li>[options.value]
<span class="method-type">&laquo;String&raquo;</span> the string stored in the <code>discriminatorKey</code> property. If not specified, Mongoose uses the <code>name</code> parameter.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=true]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>discriminator()</code> clones the given <code>schema</code>. Set to <code>false</code> to skip cloning.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> the constructor Mongoose will use for creating instances of this discriminator model</li></ul><div><p>Adds a discriminator to this document array.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> shapeSchema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">discriminatorKey</span>: <span class="hljs-string">&#x27;kind&#x27;</span> });
<span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">shapes</span>: [shapeSchema] });

<span class="hljs-keyword">const</span> docArrayPath = parentSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;shapes&#x27;</span>);
docArrayPath.<span class="hljs-title function_">discriminator</span>(<span class="hljs-string">&#x27;Circle&#x27;</span>, <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">radius</span>: <span class="hljs-title class_">Number</span> }));
</code></pre>
</div><hr class="separate-api-elements"><h3 id="documentarraypath_DocumentArrayPath-schemaName"><a href="#documentarraypath_DocumentArrayPath-schemaName">DocumentArrayPath.schemaName</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>This schema type&#39;s name, to defend against minifiers that mangle
function names.</p>
</div><hr class="separate-api-elements"><h3 id="documentarraypath_DocumentArrayPath-set"><a href="#documentarraypath_DocumentArrayPath-set">DocumentArrayPath.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">option
<span class="method-type">&laquo;String&raquo;</span> The name of the option you&#39;d like to set (e.g. trim, lowercase, etc...)</p>
</li><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> The value of the option you&#39;d like to set.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;void,void&raquo;</span> </li></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Sets a default option for all DocumentArray instances.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make all numbers have option `min` equal to 0.</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">DocumentArray</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;_id&#x27;</span>, <span class="hljs-literal">false</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schema/SubdocumentPath.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SubdocumentPath"><a href="#SubdocumentPath">SubdocumentPath</a></h2></div><ul><li><a href="#subdocumentpath_SubdocumentPath">SubdocumentPath()</a></li><li><a href="#subdocumentpath_SubdocumentPath-discriminator">SubdocumentPath.prototype.discriminator()</a></li><li><a href="#subdocumentpath_SubdocumentPath-set">SubdocumentPath.set()</a></li></ul><hr class="separate-api-elements"><h3 id="subdocumentpath_SubdocumentPath"><a href="#subdocumentpath_SubdocumentPath">SubdocumentPath()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> </li><li class="param">path
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">options
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Single nested subdocument SchemaType constructor.</p>
</div><hr class="separate-api-elements"><h3 id="subdocumentpath_SubdocumentPath-discriminator"><a href="#subdocumentpath_SubdocumentPath-discriminator">SubdocumentPath.prototype.discriminator()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">name
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param">schema
<span class="method-type">&laquo;Schema&raquo;</span> fields to add to the schema for instances of this sub-class</p>
</li><li class="param">[options]
<span class="method-type">&laquo;Object|string&raquo;</span> If string, same as <code>options.value</code>.</p>
</li><ul style="margin-top: 0.5em"><li>[options.value]
<span class="method-type">&laquo;String&raquo;</span> the string stored in the <code>discriminatorKey</code> property. If not specified, Mongoose uses the <code>name</code> parameter.</p>
</li></ul><ul style="margin-top: 0.5em"><li>[options.clone=true]
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>discriminator()</code> clones the given <code>schema</code>. Set to <code>false</code> to skip cloning.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> the constructor Mongoose will use for creating instances of this discriminator model</li></ul><div><p>Adds a discriminator to this single nested subdocument.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> shapeSchema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">discriminatorKey</span>: <span class="hljs-string">&#x27;kind&#x27;</span> });
<span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">shape</span>: shapeSchema });

<span class="hljs-keyword">const</span> singleNestedPath = parentSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;shape&#x27;</span>);
singleNestedPath.<span class="hljs-title function_">discriminator</span>(<span class="hljs-string">&#x27;Circle&#x27;</span>, <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">radius</span>: <span class="hljs-title class_">Number</span> }));
</code></pre>
</div><hr class="separate-api-elements"><h3 id="subdocumentpath_SubdocumentPath-set"><a href="#subdocumentpath_SubdocumentPath-set">SubdocumentPath.set()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">option
<span class="method-type">&laquo;String&raquo;</span> The option you&#39;d like to set the value for</p>
</li><li class="param">value
<span class="method-type">&laquo;Any&raquo;</span> value for option</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;void,void&raquo;</span> </li></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Sets a default option for all SubdocumentPath instances.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// Make all numbers have option `min` equal to 0.</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">SubdocumentPath</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;required&#x27;</span>, <span class="hljs-literal">true</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaTypeOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaTypeOptions"><a href="#SchemaTypeOptions">SchemaTypeOptions</a></h2></div><ul><li><a href="#schematypeoptions_SchemaTypeOptions-SchemaTypeOptions">SchemaTypeOptions()</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-cast">SchemaTypeOptions.prototype.cast</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-default">SchemaTypeOptions.prototype.default</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-immutable">SchemaTypeOptions.prototype.immutable</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-index">SchemaTypeOptions.prototype.index</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-ref">SchemaTypeOptions.prototype.ref</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-ref">SchemaTypeOptions.prototype.ref</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-required">SchemaTypeOptions.prototype.required</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-select">SchemaTypeOptions.prototype.select</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-sparse">SchemaTypeOptions.prototype.sparse</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-text">SchemaTypeOptions.prototype.text</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-transform">SchemaTypeOptions.prototype.transform</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-type">SchemaTypeOptions.prototype.type</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-unique">SchemaTypeOptions.prototype.unique</a></li><li><a href="#schematypeoptions_SchemaTypeOptions-validate">SchemaTypeOptions.prototype.validate</a></li></ul><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-SchemaTypeOptions"><a href="#schematypeoptions_SchemaTypeOptions-SchemaTypeOptions">SchemaTypeOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on a schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">options</span> <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">SchemaTypeOptions</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-cast"><a href="#schematypeoptions_SchemaTypeOptions-cast">SchemaTypeOptions.prototype.cast</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span></li></ul><div><p>Allows overriding casting logic for this individual path. If a string, the
given string overwrites Mongoose&#39;s default cast error message.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">num</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">cast</span>: <span class="hljs-string">&#x27;{VALUE} is not a valid number&#x27;</span>
  }
});

<span class="hljs-comment">// Throws &#x27;CastError: &quot;bad&quot; is not a valid number&#x27;</span>
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;num&#x27;</span>).<span class="hljs-title function_">cast</span>(<span class="hljs-string">&#x27;bad&#x27;</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">&#x27;fail&#x27;</span> });
<span class="hljs-keyword">const</span> err = doc.<span class="hljs-title function_">validateSync</span>();

err.<span class="hljs-property">errors</span>[<span class="hljs-string">&#x27;num&#x27;</span>]; <span class="hljs-comment">// &#x27;CastError: &quot;fail&quot; is not a valid number&#x27;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-default"><a href="#schematypeoptions_SchemaTypeOptions-default">SchemaTypeOptions.prototype.default</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|Any&raquo;</span></li></ul><div><p>The default value for this path. If a function, Mongoose executes the function
and uses the return value as the default.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-immutable"><a href="#schematypeoptions_SchemaTypeOptions-immutable">SchemaTypeOptions.prototype.immutable</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|Boolean&raquo;</span></li></ul><div><p>If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, Mongoose will
disallow changes to this path once the document
is saved to the database for the first time. Read more about <a href="https://thecodebarbarian.com/whats-new-in-mongoose-5-6-immutable-properties.html">immutability in Mongoose here</a>.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-index"><a href="#schematypeoptions_SchemaTypeOptions-index">SchemaTypeOptions.prototype.index</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean|Number|Object&raquo;</span></li></ul><div><p>If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, Mongoose will
build an index on this path when the model is compiled.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-ref"><a href="#schematypeoptions_SchemaTypeOptions-ref">SchemaTypeOptions.prototype.ref</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|String&raquo;</span></li></ul><div><p>The model that <code>populate()</code> should use if populating this path.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-ref"><a href="#schematypeoptions_SchemaTypeOptions-ref">SchemaTypeOptions.prototype.ref</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|String&raquo;</span></li></ul><div><p>The path in the document that <code>populate()</code> should use to find the model
to use.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-required"><a href="#schematypeoptions_SchemaTypeOptions-required">SchemaTypeOptions.prototype.required</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|Boolean&raquo;</span></li></ul><div><p>If true, attach a required validator to this path, which ensures this path
cannot be set to a nullish value. If a function, Mongoose calls the
function and only checks for nullish values if the function returns a truthy value.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-select"><a href="#schematypeoptions_SchemaTypeOptions-select">SchemaTypeOptions.prototype.select</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean|Number&raquo;</span></li></ul><div><p>Whether to include or exclude this path by default when loading documents
using <code>find()</code>, <code>findOne()</code>, etc.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-sparse"><a href="#schematypeoptions_SchemaTypeOptions-sparse">SchemaTypeOptions.prototype.sparse</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean|Number&raquo;</span></li></ul><div><p>If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, Mongoose will
build a sparse index on this path.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-text"><a href="#schematypeoptions_SchemaTypeOptions-text">SchemaTypeOptions.prototype.text</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean|Number|Object&raquo;</span></li></ul><div><p>If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, Mongoose
will build a text index on this path.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-transform"><a href="#schematypeoptions_SchemaTypeOptions-transform">SchemaTypeOptions.prototype.transform</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span></li></ul><div><p>Define a transform function for this individual schema type.
Only called when calling <code>toJSON()</code> or <code>toObject()</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">myDate</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.<span class="hljs-title function_">getFullYear</span>()
  }
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, schema);

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">myDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2019/06/01&#x27;</span>) });
doc.<span class="hljs-property">myDate</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>; <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> res = doc.<span class="hljs-title function_">toObject</span>({ <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span> });
res.<span class="hljs-property">myDate</span>; <span class="hljs-comment">// 2019</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-type"><a href="#schematypeoptions_SchemaTypeOptions-type">SchemaTypeOptions.prototype.type</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|String|Object&raquo;</span></li></ul><div><p>The type to cast this path to.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-unique"><a href="#schematypeoptions_SchemaTypeOptions-unique">SchemaTypeOptions.prototype.unique</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean|Number&raquo;</span></li></ul><div><p>If <a href="https://masteringjs.io/tutorials/fundamentals/truthy">truthy</a>, Mongoose
will build a unique index on this path when the
model is compiled. <a href="/docs/validation.html#the-unique-option-is-not-a-validator">The <code>unique</code> option is <strong>not</strong> a validator</a>.</p>
</div><hr class="separate-api-elements"><h3 id="schematypeoptions_SchemaTypeOptions-validate"><a href="#schematypeoptions_SchemaTypeOptions-validate">SchemaTypeOptions.prototype.validate</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|Object&raquo;</span></li></ul><div><p>Function or object describing how to validate this schematype.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaArrayOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaArrayOptions"><a href="#SchemaArrayOptions">SchemaArrayOptions</a></h2></div><ul><li><a href="#schemaarrayoptions_SchemaArrayOptions-SchemaArrayOptions">SchemaArrayOptions()</a></li><li><a href="#schemaarrayoptions_SchemaArrayOptions-castNonArrays">SchemaArrayOptions.prototype.castNonArrays</a></li><li><a href="#schemaarrayoptions_SchemaArrayOptions-enum">SchemaArrayOptions.prototype.enum</a></li><li><a href="#schemaarrayoptions_SchemaArrayOptions-of">SchemaArrayOptions.prototype.of</a></li></ul><hr class="separate-api-elements"><h3 id="schemaarrayoptions_SchemaArrayOptions-SchemaArrayOptions"><a href="#schemaarrayoptions_SchemaArrayOptions-SchemaArrayOptions">SchemaArrayOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on an Array schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">tags</span>: [<span class="hljs-title class_">String</span>] });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;tags&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaArrayOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemaarrayoptions_SchemaArrayOptions-castNonArrays"><a href="#schemaarrayoptions_SchemaArrayOptions-castNonArrays">SchemaArrayOptions.prototype.castNonArrays</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span></li></ul><div><p>If set to <code>false</code>, will always deactivate casting non-array values to arrays.
If set to <code>true</code>, will cast non-array values to arrays if <code>init</code> and <code>SchemaArray.options.castNonArrays</code> are also <code>true</code></p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">x1</span>: { <span class="hljs-attr">castNonArrays</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>] } }));
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>({ <span class="hljs-attr">x1</span>: <span class="hljs-string">&quot;some non-array value&quot;</span> });
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">validate</span>(); <span class="hljs-comment">// Errors with &quot;CastError&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemaarrayoptions_SchemaArrayOptions-enum"><a href="#schemaarrayoptions_SchemaArrayOptions-enum">SchemaArrayOptions.prototype.enum</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span></li></ul><div><p>If this is an array of strings, an array of allowed values for this path.
Throws an error if this array isn&#39;t an array of strings.</p>
</div><hr class="separate-api-elements"><h3 id="schemaarrayoptions_SchemaArrayOptions-of"><a href="#schemaarrayoptions_SchemaArrayOptions-of">SchemaArrayOptions.prototype.of</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Function|String&raquo;</span></li></ul><div><p>If set, specifies the type of this array&#39;s values. Equivalent to setting
<code>type</code> to an array whose first element is <code>of</code>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-comment">// `arr` is an array of numbers.</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">arr</span>: [<span class="hljs-title class_">Number</span>] });
<span class="hljs-comment">// Equivalent way to define `arr` as an array of numbers</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">arr</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>, <span class="hljs-attr">of</span>: <span class="hljs-title class_">Number</span> } });
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaBufferOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaBufferOptions"><a href="#SchemaBufferOptions">SchemaBufferOptions</a></h2></div><ul><li><a href="#schemabufferoptions_SchemaBufferOptions-SchemaBufferOptions">SchemaBufferOptions()</a></li><li><a href="#schemabufferoptions_SchemaBufferOptions-subtype">SchemaBufferOptions.prototype.subtype</a></li></ul><hr class="separate-api-elements"><h3 id="schemabufferoptions_SchemaBufferOptions-SchemaBufferOptions"><a href="#schemabufferoptions_SchemaBufferOptions-SchemaBufferOptions">SchemaBufferOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on a Buffer schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">bitmap</span>: <span class="hljs-title class_">Buffer</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;bitmap&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaBufferOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemabufferoptions_SchemaBufferOptions-subtype"><a href="#schemabufferoptions_SchemaBufferOptions-subtype">SchemaBufferOptions.prototype.subtype</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span></li></ul><div><p>Set the default subtype for this buffer.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaDateOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaDateOptions"><a href="#SchemaDateOptions">SchemaDateOptions</a></h2></div><ul><li><a href="#schemadateoptions_SchemaDateOptions-SchemaDateOptions">SchemaDateOptions()</a></li><li><a href="#schemadateoptions_SchemaDateOptions-expires">SchemaDateOptions.prototype.expires</a></li><li><a href="#schemadateoptions_SchemaDateOptions-max">SchemaDateOptions.prototype.max</a></li><li><a href="#schemadateoptions_SchemaDateOptions-min">SchemaDateOptions.prototype.min</a></li></ul><hr class="separate-api-elements"><h3 id="schemadateoptions_SchemaDateOptions-SchemaDateOptions"><a href="#schemadateoptions_SchemaDateOptions-SchemaDateOptions">SchemaDateOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on a Date schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">startedAt</span>: <span class="hljs-title class_">Date</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;startedAt&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaDateOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemadateoptions_SchemaDateOptions-expires"><a href="#schemadateoptions_SchemaDateOptions-expires">SchemaDateOptions.prototype.expires</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Date&raquo;</span></li></ul><div><p>If set, Mongoose creates a TTL index on this path.</p>
<p>mongo TTL index <code>expireAfterSeconds</code> value will take &#39;expires&#39; value expressed in seconds.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-string">&quot;expireAt&quot;</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>,  <span class="hljs-attr">expires</span>: <span class="hljs-number">11</span> } });
<span class="hljs-comment">// if &#x27;expireAt&#x27; is set, then document expires at expireAt + 11 seconds</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemadateoptions_SchemaDateOptions-max"><a href="#schemadateoptions_SchemaDateOptions-max">SchemaDateOptions.prototype.max</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Date&raquo;</span></li></ul><div><p>If set, Mongoose adds a validator that checks that this path is before the
given <code>max</code>.</p>
</div><hr class="separate-api-elements"><h3 id="schemadateoptions_SchemaDateOptions-min"><a href="#schemadateoptions_SchemaDateOptions-min">SchemaDateOptions.prototype.min</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Date&raquo;</span></li></ul><div><p>If set, Mongoose adds a validator that checks that this path is after the
given <code>min</code>.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaNumberOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaNumberOptions"><a href="#SchemaNumberOptions">SchemaNumberOptions</a></h2></div><ul><li><a href="#schemanumberoptions_SchemaNumberOptions-SchemaNumberOptions">SchemaNumberOptions()</a></li><li><a href="#schemanumberoptions_SchemaNumberOptions-enum">SchemaNumberOptions.prototype.enum</a></li><li><a href="#schemanumberoptions_SchemaNumberOptions-max">SchemaNumberOptions.prototype.max</a></li><li><a href="#schemanumberoptions_SchemaNumberOptions-min">SchemaNumberOptions.prototype.min</a></li><li><a href="#schemanumberoptions_SchemaNumberOptions-populate">SchemaNumberOptions.prototype.populate</a></li></ul><hr class="separate-api-elements"><h3 id="schemanumberoptions_SchemaNumberOptions-SchemaNumberOptions"><a href="#schemanumberoptions_SchemaNumberOptions-SchemaNumberOptions">SchemaNumberOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on a Number schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title class_">Number</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;count&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaNumberOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemanumberoptions_SchemaNumberOptions-enum"><a href="#schemanumberoptions_SchemaNumberOptions-enum">SchemaNumberOptions.prototype.enum</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span></li></ul><div><p>If set, Mongoose adds a validator that checks that this path is strictly
equal to one of the given values.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">favoritePrime</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">enum</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>]
  }
});
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;favoritePrime&#x27;</span>).<span class="hljs-property">options</span>.<span class="hljs-property">enum</span>; <span class="hljs-comment">// [3, 5, 7]</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemanumberoptions_SchemaNumberOptions-max"><a href="#schemanumberoptions_SchemaNumberOptions-max">SchemaNumberOptions.prototype.max</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span></li></ul><div><p>If set, Mongoose adds a validator that checks that this path is less than the
given <code>max</code>.</p>
</div><hr class="separate-api-elements"><h3 id="schemanumberoptions_SchemaNumberOptions-min"><a href="#schemanumberoptions_SchemaNumberOptions-min">SchemaNumberOptions.prototype.min</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span></li></ul><div><p>If set, Mongoose adds a validator that checks that this path is at least the
given <code>min</code>.</p>
</div><hr class="separate-api-elements"><h3 id="schemanumberoptions_SchemaNumberOptions-populate"><a href="#schemanumberoptions_SchemaNumberOptions-populate">SchemaNumberOptions.prototype.populate</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span></li></ul><div><p>Sets default <a href="/docs/populate.html#query-conditions">populate options</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">child</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">ref</span>: <span class="hljs-string">&#x27;Child&#x27;</span>,
    <span class="hljs-attr">populate</span>: { <span class="hljs-attr">select</span>: <span class="hljs-string">&#x27;name&#x27;</span> }
  }
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Parent</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Parent&#x27;</span>, schema);

<span class="hljs-comment">// Automatically adds `.select(&#x27;name&#x27;)`</span>
<span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;child&#x27;</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaObjectIdOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaObjectIdOptions"><a href="#SchemaObjectIdOptions">SchemaObjectIdOptions</a></h2></div><ul><li><a href="#schemaobjectidoptions_SchemaObjectIdOptions-SchemaObjectIdOptions">SchemaObjectIdOptions()</a></li><li><a href="#schemaobjectidoptions_SchemaObjectIdOptions-auto">SchemaObjectIdOptions.prototype.auto</a></li><li><a href="#schemaobjectidoptions_SchemaObjectIdOptions-populate">SchemaObjectIdOptions.prototype.populate</a></li></ul><hr class="separate-api-elements"><h3 id="schemaobjectidoptions_SchemaObjectIdOptions-SchemaObjectIdOptions"><a href="#schemaobjectidoptions_SchemaObjectIdOptions-SchemaObjectIdOptions">SchemaObjectIdOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on an ObjectId schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">testId</span>: mongoose.<span class="hljs-property">ObjectId</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;testId&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaObjectIdOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemaobjectidoptions_SchemaObjectIdOptions-auto"><a href="#schemaobjectidoptions_SchemaObjectIdOptions-auto">SchemaObjectIdOptions.prototype.auto</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span></li></ul><div><p>If truthy, uses Mongoose&#39;s default built-in ObjectId path.</p>
</div><hr class="separate-api-elements"><h3 id="schemaobjectidoptions_SchemaObjectIdOptions-populate"><a href="#schemaobjectidoptions_SchemaObjectIdOptions-populate">SchemaObjectIdOptions.prototype.populate</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span></li></ul><div><p>Sets default <a href="/docs/populate.html#query-conditions">populate options</a>.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">child</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ObjectId&#x27;</span>,
    <span class="hljs-attr">ref</span>: <span class="hljs-string">&#x27;Child&#x27;</span>,
    <span class="hljs-attr">populate</span>: { <span class="hljs-attr">select</span>: <span class="hljs-string">&#x27;name&#x27;</span> }
  }
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Parent</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Parent&#x27;</span>, schema);

<span class="hljs-comment">// Automatically adds `.select(&#x27;name&#x27;)`</span>
<span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;child&#x27;</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/options/SchemaStringOptions.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="SchemaStringOptions"><a href="#SchemaStringOptions">SchemaStringOptions</a></h2></div><ul><li><a href="#schemastringoptions_SchemaStringOptions-SchemaStringOptions">SchemaStringOptions()</a></li><li><a href="#schemastringoptions_SchemaStringOptions-enum">SchemaStringOptions.prototype.enum</a></li><li><a href="#schemastringoptions_SchemaStringOptions-lowercase">SchemaStringOptions.prototype.lowercase</a></li><li><a href="#schemastringoptions_SchemaStringOptions-match">SchemaStringOptions.prototype.match</a></li><li><a href="#schemastringoptions_SchemaStringOptions-maxLength">SchemaStringOptions.prototype.maxLength</a></li><li><a href="#schemastringoptions_SchemaStringOptions-minLength">SchemaStringOptions.prototype.minLength</a></li><li><a href="#schemastringoptions_SchemaStringOptions-populate">SchemaStringOptions.prototype.populate</a></li><li><a href="#schemastringoptions_SchemaStringOptions-trim">SchemaStringOptions.prototype.trim</a></li><li><a href="#schemastringoptions_SchemaStringOptions-uppercase">SchemaStringOptions.prototype.uppercase</a></li></ul><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-SchemaStringOptions"><a href="#schemastringoptions_SchemaStringOptions-SchemaStringOptions">SchemaStringOptions()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;constructor&raquo;</span></li></ul><div><p>The options defined on a string schematype.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">&#x27;name&#x27;</span>).<span class="hljs-property">options</span>; <span class="hljs-comment">// SchemaStringOptions instance</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-enum"><a href="#schemastringoptions_SchemaStringOptions-enum">SchemaStringOptions.prototype.enum</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span></li></ul><div><p>Array of allowed values for this path</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-lowercase"><a href="#schemastringoptions_SchemaStringOptions-lowercase">SchemaStringOptions.prototype.lowercase</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span></li></ul><div><p>If truthy, Mongoose will add a custom setter that lowercases this string
using JavaScript&#39;s built-in <code>String#toLowerCase()</code>.</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-match"><a href="#schemastringoptions_SchemaStringOptions-match">SchemaStringOptions.prototype.match</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;RegExp&raquo;</span></li></ul><div><p>Attach a validator that succeeds if the data string matches the given regular
expression, and fails otherwise.</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-maxLength"><a href="#schemastringoptions_SchemaStringOptions-maxLength">SchemaStringOptions.prototype.maxLength</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span></li></ul><div><p>If set, Mongoose will add a custom validator that ensures the given
string&#39;s <code>length</code> is at most the given number.</p>
<p>Mongoose supports two different spellings for this option: <code>maxLength</code> and <code>maxlength</code>.
<code>maxLength</code> is the recommended way to specify this option, but Mongoose also supports
<code>maxlength</code> (lowercase &quot;l&quot;).</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-minLength"><a href="#schemastringoptions_SchemaStringOptions-minLength">SchemaStringOptions.prototype.minLength</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span></li></ul><div><p>If set, Mongoose will add a custom validator that ensures the given
string&#39;s <code>length</code> is at least the given number.</p>
<p>Mongoose supports two different spellings for this option: <code>minLength</code> and <code>minlength</code>.
<code>minLength</code> is the recommended way to specify this option, but Mongoose also supports
<code>minlength</code> (lowercase &quot;l&quot;).</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-populate"><a href="#schemastringoptions_SchemaStringOptions-populate">SchemaStringOptions.prototype.populate</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span></li></ul><div><p>Sets default <a href="/docs/populate.html#query-conditions">populate options</a>.</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-trim"><a href="#schemastringoptions_SchemaStringOptions-trim">SchemaStringOptions.prototype.trim</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span></li></ul><div><p>If truthy, Mongoose will add a custom setter that removes leading and trailing
whitespace using <a href="https://masteringjs.io/tutorials/fundamentals/trim-string">JavaScript&#39;s built-in <code>String#trim()</code></a>.</p>
</div><hr class="separate-api-elements"><h3 id="schemastringoptions_SchemaStringOptions-uppercase"><a href="#schemastringoptions_SchemaStringOptions-uppercase">SchemaStringOptions.prototype.uppercase</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span></li></ul><div><p>If truthy, Mongoose will add a custom setter that uppercases this string
using JavaScript&#39;s built-in <a href="https://masteringjs.io/tutorials/fundamentals/uppercase"><code>String#toUpperCase()</code></a>.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/DocumentArray/methods/index.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="MongooseDocumentArray"><a href="#MongooseDocumentArray">MongooseDocumentArray</a></h2></div><ul><li><a href="#mongoosedocumentarray_MongooseDocumentArray-create">MongooseDocumentArray.prototype.create()</a></li><li><a href="#mongoosedocumentarray_MongooseDocumentArray-id">MongooseDocumentArray.prototype.id()</a></li><li><a href="#mongoosedocumentarray_MongooseDocumentArray-inspect">MongooseDocumentArray.prototype.inspect()</a></li><li><a href="#mongoosedocumentarray_MongooseDocumentArray-pull">MongooseDocumentArray.prototype.pull()</a></li><li><a href="#mongoosedocumentarray_MongooseDocumentArray-push">MongooseDocumentArray.prototype.push()</a></li><li><a href="#mongoosedocumentarray_MongooseDocumentArray-toObject">MongooseDocumentArray.prototype.toObject()</a></li></ul><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-create"><a href="#mongoosedocumentarray_MongooseDocumentArray-create">MongooseDocumentArray.prototype.create()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">obj
<span class="method-type">&laquo;Object&raquo;</span> the value to cast to this arrays SubDocument schema</p>
</li></ul><div><p>Creates a subdocument casted to this schema.</p>
<p>This is the same subdocument constructor used for casting.</p>
</div><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-id"><a href="#mongoosedocumentarray_MongooseDocumentArray-id">MongooseDocumentArray.prototype.id()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">id
<span class="method-type">&laquo;ObjectId|String|Number|Buffer&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;EmbeddedDocument,null&raquo;</span> the subdocument or null if not found.</li></ul><div><p>Searches array items for the first document with a matching _id.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> embeddedDoc = m.<span class="hljs-property">array</span>.<span class="hljs-title function_">id</span>(some_id);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-inspect"><a href="#mongoosedocumentarray_MongooseDocumentArray-inspect">MongooseDocumentArray.prototype.inspect()</a></h3><div><p>Helper for console.log</p>
</div><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-pull"><a href="#mongoosedocumentarray_MongooseDocumentArray-pull">MongooseDocumentArray.prototype.pull()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[...args]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Pulls items from the array atomically.</p>
</div><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-push"><a href="#mongoosedocumentarray_MongooseDocumentArray-push">MongooseDocumentArray.prototype.push()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[...args]
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/push"><code>Array#push</code></a> with proper change tracking.</p>
</div><hr class="separate-api-elements"><h3 id="mongoosedocumentarray_MongooseDocumentArray-toObject"><a href="#mongoosedocumentarray_MongooseDocumentArray-toObject">MongooseDocumentArray.prototype.toObject()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> optional options to pass to each documents <code>toObject</code> method call during conversion</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> </li></ul><div><p>Returns a native js Array of plain js objects</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><em>Each sub-document is converted to a plain object by calling its <code>#toObject</code> method.</em></p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/subdocument.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Subdocument"><a href="#Subdocument">Subdocument</a></h2></div><ul><li><a href="#subdocument_Subdocument-$parent">Subdocument.prototype.$parent()</a></li><li><a href="#subdocument_Subdocument-inspect">Subdocument.prototype.inspect()</a></li><li><a href="#subdocument_Subdocument-ownerDocument">Subdocument.prototype.ownerDocument()</a></li><li><a href="#subdocument_Subdocument-parent">Subdocument.prototype.parent()</a></li><li><a href="#subdocument_Subdocument-remove">Subdocument.prototype.remove()</a></li></ul><hr class="separate-api-elements"><h3 id="subdocument_Subdocument-$parent"><a href="#subdocument_Subdocument-$parent">Subdocument.prototype.$parent()</a></h3><div><p>Returns this sub-documents parent document.</p>
</div><hr class="separate-api-elements"><h3 id="subdocument_Subdocument-inspect"><a href="#subdocument_Subdocument-inspect">Subdocument.prototype.inspect()</a></h3><div><p>Helper for console.log</p>
</div><hr class="separate-api-elements"><h3 id="subdocument_Subdocument-ownerDocument"><a href="#subdocument_Subdocument-ownerDocument">Subdocument.prototype.ownerDocument()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Document&raquo;</span> </li></ul><div><p>Returns the top level document of this sub-document.</p>
</div><hr class="separate-api-elements"><h3 id="subdocument_Subdocument-parent"><a href="#subdocument_Subdocument-parent">Subdocument.prototype.parent()</a></h3><div><p>Returns this sub-documents parent document.</p>
</div><hr class="separate-api-elements"><h3 id="subdocument_Subdocument-remove"><a href="#subdocument_Subdocument-remove">Subdocument.prototype.remove()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param">[callback]
<span class="method-type">&laquo;Function&raquo;</span> optional callback for compatibility with Document.prototype.remove</p>
</li></ul><div><p>Null-out this subdoc</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/ArraySubdocument.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="ArraySubdocument"><a href="#ArraySubdocument">ArraySubdocument</a></h2></div><ul><li><a href="#arraysubdocument_ArraySubdocument-$parent">ArraySubdocument.prototype.$parent()</a></li><li><a href="#arraysubdocument_ArraySubdocument-parentArray">ArraySubdocument.prototype.parentArray()</a></li></ul><hr class="separate-api-elements"><h3 id="arraysubdocument_ArraySubdocument-$parent"><a href="#arraysubdocument_ArraySubdocument-$parent">ArraySubdocument.prototype.$parent()</a></h3><div><p>Returns this sub-documents parent document.</p>
</div><hr class="separate-api-elements"><h3 id="arraysubdocument_ArraySubdocument-parentArray"><a href="#arraysubdocument_ArraySubdocument-parentArray">ArraySubdocument.prototype.parentArray()</a></h3><div><p>Returns this subdocument&#39;s parent array.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">docArr</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }]
}));
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>({ <span class="hljs-attr">docArr</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test subdoc&#x27;</span> }] });

doc.<span class="hljs-property">docArr</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">parentArray</span>() === doc.<span class="hljs-property">docArr</span>; <span class="hljs-comment">// true</span>
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/buffer.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Buffer"><a href="#Buffer">Buffer</a></h2></div><ul><li><a href="#mongoosebuffer.mixin_MongooseBuffer.mixin-copy">MongooseBuffer.mixin.copy()</a></li><li><a href="#mongoosebuffer_MongooseBuffer-equals">MongooseBuffer.mixin.equals()</a></li><li><a href="#mongoosebuffer_MongooseBuffer-subtype">MongooseBuffer.mixin.subtype()</a></li><li><a href="#mongoosebuffer_MongooseBuffer-toBSON">MongooseBuffer.mixin.toBSON()</a></li><li><a href="#mongoosebuffer_MongooseBuffer-toObject">MongooseBuffer.mixin.toObject()</a></li><li><a href="#mongoosebuffer.mixin_MongooseBuffer.mixin-write">MongooseBuffer.mixin.write()</a></li></ul><hr class="separate-api-elements"><h3 id="mongoosebuffer.mixin_MongooseBuffer.mixin-copy"><a href="#mongoosebuffer.mixin_MongooseBuffer.mixin-copy">MongooseBuffer.mixin.copy()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">target
<span class="method-type">&laquo;Buffer&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Number&raquo;</span> The number of bytes copied.</li></ul><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Copies the buffer.</p>
<h4 id="note">
      <a href="#note">
        Note:
      </a>
    </h4>
<p><code>Buffer#copy</code> does not mark <code>target</code> as modified so you must copy from a <code>MongooseBuffer</code> for it to work as expected. This is a work around since <code>copy</code> modifies the target, not this.</p>
</div><hr class="separate-api-elements"><h3 id="mongoosebuffer_MongooseBuffer-equals"><a href="#mongoosebuffer_MongooseBuffer-equals">MongooseBuffer.mixin.equals()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">other
<span class="method-type">&laquo;Buffer&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if this buffer is equals to <code>other</code> buffer</p>
</div><hr class="separate-api-elements"><h3 id="mongoosebuffer_MongooseBuffer-subtype"><a href="#mongoosebuffer_MongooseBuffer-subtype">MongooseBuffer.mixin.subtype()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">subtype
<span class="method-type">&laquo;Hex&raquo;</span> </li></ul><div><p>Sets the subtype option and marks the buffer modified.</p>
<h4 id="subtypes">
      <a href="#subtypes">
        SubTypes:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> bson = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bson&#x27;</span>)
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_DEFAULT</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_FUNCTION</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_BYTE_ARRAY</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_UUID</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_MD5</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_USER_DEFINED</span>

doc.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">subtype</span>(bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_UUID</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoosebuffer_MongooseBuffer-toBSON"><a href="#mongoosebuffer_MongooseBuffer-toBSON">MongooseBuffer.mixin.toBSON()</a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Binary&raquo;</span> </li></ul><div><p>Converts this buffer for storage in MongoDB, including subtype</p>
</div><hr class="separate-api-elements"><h3 id="mongoosebuffer_MongooseBuffer-toObject"><a href="#mongoosebuffer_MongooseBuffer-toObject">MongooseBuffer.mixin.toObject()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[subtype]
<span class="method-type">&laquo;Hex&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Binary&raquo;</span> </li></ul><div><p>Converts this buffer to its Binary type representation.</p>
<h4 id="subtypes">
      <a href="#subtypes">
        SubTypes:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> bson = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bson&#x27;</span>)
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_DEFAULT</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_FUNCTION</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_BYTE_ARRAY</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_UUID</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_MD5</span>
bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_USER_DEFINED</span>
doc.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">toObject</span>(bson.<span class="hljs-property">BSON_BINARY_SUBTYPE_USER_DEFINED</span>);
</code></pre>
</div><hr class="separate-api-elements"><h3 id="mongoosebuffer.mixin_MongooseBuffer.mixin-write"><a href="#mongoosebuffer.mixin_MongooseBuffer.mixin-write">MongooseBuffer.mixin.write()</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Writes the buffer.</p>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/decimal128.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Decimal128"><a href="#Decimal128">Decimal128</a></h2></div><ul><li><a href="#decimal128_Decimal128">Decimal128()</a></li></ul><hr class="separate-api-elements"><h3 id="decimal128_Decimal128"><a href="#decimal128_Decimal128">Decimal128()</a></h3><div><p>Decimal128 type constructor</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code><span class="hljs-keyword">const</span> id = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-property">Types</span>.<span class="hljs-title class_">Decimal128</span>(<span class="hljs-string">&#x27;3.1415&#x27;</span>);
</code></pre>
</div><hr class="separate-api"><div class="item-header-wrap"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/types/map.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h2 class="item-header" id="Map"><a href="#Map">Map</a></h2></div><ul><li><a href="#mongoosemap_MongooseMap-$isMongooseMap">MongooseMap.prototype.$isMongooseMap</a></li><li><a href="#map_Map-clear">MongooseMap.prototype.clear()</a></li><li><a href="#map_Map-delete">MongooseMap.prototype.delete()</a></li><li><a href="#map_Map-get">MongooseMap.prototype.get()</a></li><li><a href="#map_Map-set">MongooseMap.prototype.set()</a></li><li><a href="#map_Map-toBSON">MongooseMap.prototype.toBSON()</a></li><li><a href="#map_Map-toJSON">MongooseMap.prototype.toJSON()</a></li></ul><hr class="separate-api-elements"><h3 id="mongoosemap_MongooseMap-$isMongooseMap"><a href="#mongoosemap_MongooseMap-$isMongooseMap">MongooseMap.prototype.$isMongooseMap</a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Set to <code>true</code> for all Mongoose map instances</p>
</div><hr class="separate-api-elements"><h3 id="map_Map-clear"><a href="#map_Map-clear">MongooseMap.prototype.clear()</a></h3><div><p>Overwrites native Map&#39;s <code>clear()</code> function to support change tracking.</p>
</div><hr class="separate-api-elements"><h3 id="map_Map-delete"><a href="#map_Map-delete">MongooseMap.prototype.delete()</a></h3><div><p>Overwrites native Map&#39;s <code>delete()</code> function to support change tracking.</p>
</div><hr class="separate-api-elements"><h3 id="map_Map-get"><a href="#map_Map-get">MongooseMap.prototype.get()</a></h3><div><p>Overwrites native Map&#39;s <code>get()</code> function to support Mongoose getters.</p>
</div><hr class="separate-api-elements"><h3 id="map_Map-set"><a href="#map_Map-set">MongooseMap.prototype.set()</a></h3><div><p>Overwrites native Map&#39;s <code>set()</code> function to support setters, <code>populate()</code>,
and change tracking. Note that Mongoose maps <em>only</em> support strings and
ObjectIds as keys.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-number">42</span>); <span class="hljs-comment">// works</span>
doc.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">obj</span>: <span class="hljs-number">42</span> }, <span class="hljs-number">42</span>); <span class="hljs-comment">// Throws &quot;Mongoose maps only support string keys&quot;</span>
</code></pre>
</div><hr class="separate-api-elements"><h3 id="map_Map-toBSON"><a href="#map_Map-toBSON">MongooseMap.prototype.toBSON()</a></h3><div><p>Converts this map to a native JavaScript Map so the MongoDB driver can serialize it.</p>
</div><hr class="separate-api-elements"><h3 id="map_Map-toJSON"><a href="#map_Map-toJSON">MongooseMap.prototype.toJSON()</a></h3><h5>Parameters</h5><ul class="params"><li class="param">[options]
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li>[options.flattenMaps=false]
<span class="method-type">&laquo;Boolean&raquo;</span> set to <code>true</code> to convert the map to a POJO rather than a native JavaScript map</p>
</li></ul></ul><div><p>Converts this map to a native JavaScript Map for <code>JSON.stringify()</code>. Set
the <code>flattenMaps</code> option to convert this map to a POJO instead.</p>
<h4 id="example">
      <a href="#example">
        Example:
      </a>
    </h4>
<pre><code>doc.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">toJSON</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Map</span>; <span class="hljs-comment">// true</span>
doc.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">toJSON</span>({ <span class="hljs-attr">flattenMaps</span>: <span class="hljs-literal">true</span> }) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Map</span>; <span class="hljs-comment">// false</span>
</code></pre>
</div></div></div><div id="jobs"><div class="job-listing"><a href="/docs/6.x/docs/jobs.html#61f0b0402d893554bc3a247f"><div class="company-logo"><img src="https://assets.localizecdn.com/uploads/1689251999716.png"></div><div class="description"><div class="company">Localize</div><div class="title">Full Stack Engineer</div><div class="location">Anywhere</div></div></a></div><div class="button jobs-view-more"><a href="/docs/6.x/docs/jobs.html">View more jobs!</a></div></div><script type="text/javascript" src="/docs/6.x/docs/js/navbar-search.js"></script><script type="text/javascript" src="/docs/6.x/docs/js/mobile-navbar-toggle.js"></script></div></body></html>