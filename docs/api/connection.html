<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose v8.16.5: Connection</title><link rel="apple-touch-icon" sizes="57x57" href="/docs/images/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/docs/images/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/docs/images/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/docs/images/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/docs/images/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/docs/images/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/docs/images/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/docs/images/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/docs/images/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/docs/images/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/docs/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/docs/images/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/docs/images/favicon/favicon-16x16.png"><link rel="manifest" href="/docs/images/favicon/manifest.json"><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel="stylesheet" href="/docs/css/github.css"><link rel="stylesheet" href="/docs/css/mongoose5.css"><link rel="stylesheet" href="/docs/css/carbonads.css"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/docs/images/favicon/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/docs/css/api.css"><script src="/docs/js/api-bold-current-nav.js"></script><script src="/docs/js/convert-old-anchorid.js"></script><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"></head><body><div id="layout"><div id="mobile-menu"><a class="menu-link" id="menuLink" href="#menu"><svg width="100%" height="100%" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></a><div id="mobile-logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div></div><div id="menu"><nav class="pure-menu"><div class="pure-menu-heading" id="logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div><ul class="pure-menu-list" id="navbar"><li class="pure-menu-horizontal pure-menu-item pure-menu-has-children pure-menu-allow-hover version"><a class="pure-menu-link" href="/docs/index.html">Version 8.16.5</a><ul class="pure-menu-children"><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/7.x/index.html">Version 7.8.7</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/index.html">Version 6.13.8</a></li></ul></li><li class="pure-menu-item search"><input id="search-input-nav" type="text" placeholder="Search"><button id="search-button-nav"><img src="/docs/images/search.svg"></button></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/index.html">Quick Start</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/guides.html">Guides</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/guide.html">Schemas</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/schematypes.html">SchemaTypes</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/connections.html">Connections</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/models.html">Models</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/documents.html">Documents</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/subdocs.html">Subdocuments</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/queries.html">Queries</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/validation.html">Validation</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/middleware.html">Middleware</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/populate.html">Populate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/discriminators.html">Discriminators</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/plugins.html">Plugins</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/timestamps.html">Timestamps</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/transactions.html">Transactions</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/typescript.html">TypeScript</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">API</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">Mongoose</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/schema.html">Schema</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link selected" href="/docs/api/connection.html">Connection</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/document.html">Document</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/model.html">Model</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/query.html">Query</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/aggregate.html">Aggregate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/schematype.html">SchemaType</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/virtualtype.html">VirtualType</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/migrating_to_8.html">Migration Guide</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/compatibility.html">Version Compatibility</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/version-support.html">Version Support</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/faq.html">FAQ</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/further_reading.html">Further Reading</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/enterprise.html">For Enterprise</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/sponsors.html" >Sponsors</a></li></ul><div class="cpc-ad"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIL27I&placement=mongoosejscom" id="_carbonads_js"></script></div></nav></div><div class="container"><div id="content"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/connection.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h1>Connection</h1><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"><div id="native-direct"></div><script>(function() {
if (typeof _bsa !== 'undefined' && _bsa) {
_bsa.init('custom', 'CK7DT53U', 'placement:mongoosejscom',
{
target: '#native-direct',
template: `
<div class="native-inline">
<a rel="sponsored noopener" target="_blank" href="##statlink##" title="##company## — ##tagline##"><span class="sponsor">Sponsor</span> ##company## — ##description##</a>
</div>
</a>
`
}
);
}
})();</script><div class="api-nav"><div class="api-nav-content"><div class="nav-item" id="nav-Mongoose"><div class="nav-item-title"><a href="mongoose.html">Mongoose</a></div></div><div class="nav-item" id="nav-Schema"><div class="nav-item-title"><a href="schema.html">Schema</a></div></div><div class="nav-item" id="nav-Connection"><div class="nav-item-title" style="font-weight: bold"><a href="connection.html">Connection</a></div><ul class="nav-item-sub"><li><a href="#Connection()"><code>Connection()</code></a></li><li><a href="#Connection.prototype.aggregate()"><code>Connection.prototype.aggregate()</code></a></li><li><a href="#Connection.prototype.asPromise()"><code>Connection.prototype.asPromise()</code></a></li><li><a href="#Connection.prototype.bulkWrite()"><code>Connection.prototype.bulkWrite()</code></a></li><li><a href="#Connection.prototype.client"><code>Connection.prototype.client</code></a></li><li><a href="#Connection.prototype.close()"><code>Connection.prototype.close()</code></a></li><li><a href="#Connection.prototype.collection()"><code>Connection.prototype.collection()</code></a></li><li><a href="#Connection.prototype.collections"><code>Connection.prototype.collections</code></a></li><li><a href="#Connection.prototype.config"><code>Connection.prototype.config</code></a></li><li><a href="#Connection.prototype.createCollection()"><code>Connection.prototype.createCollection()</code></a></li><li><a href="#Connection.prototype.createCollections()"><code>Connection.prototype.createCollections()</code></a></li><li><a href="#Connection.prototype.db"><code>Connection.prototype.db</code></a></li><li><a href="#Connection.prototype.deleteModel()"><code>Connection.prototype.deleteModel()</code></a></li><li><a href="#Connection.prototype.destroy()"><code>Connection.prototype.destroy()</code></a></li><li><a href="#Connection.prototype.dropCollection()"><code>Connection.prototype.dropCollection()</code></a></li><li><a href="#Connection.prototype.dropDatabase()"><code>Connection.prototype.dropDatabase()</code></a></li><li><a href="#Connection.prototype.get()"><code>Connection.prototype.get()</code></a></li><li><a href="#Connection.prototype.getClient()"><code>Connection.prototype.getClient()</code></a></li><li><a href="#Connection.prototype.host"><code>Connection.prototype.host</code></a></li><li><a href="#Connection.prototype.id"><code>Connection.prototype.id</code></a></li><li><a href="#Connection.prototype.listCollections()"><code>Connection.prototype.listCollections()</code></a></li><li><a href="#Connection.prototype.listDatabases()"><code>Connection.prototype.listDatabases()</code></a></li><li><a href="#Connection.prototype.model()"><code>Connection.prototype.model()</code></a></li><li><a href="#Connection.prototype.modelNames()"><code>Connection.prototype.modelNames()</code></a></li><li><a href="#Connection.prototype.models"><code>Connection.prototype.models</code></a></li><li><a href="#Connection.prototype.name"><code>Connection.prototype.name</code></a></li><li><a href="#Connection.prototype.on()"><code>Connection.prototype.on()</code></a></li><li><a href="#Connection.prototype.once()"><code>Connection.prototype.once()</code></a></li><li><a href="#Connection.prototype.openUri()"><code>Connection.prototype.openUri()</code></a></li><li><a href="#Connection.prototype.pass"><code>Connection.prototype.pass</code></a></li><li><a href="#Connection.prototype.plugin()"><code>Connection.prototype.plugin()</code></a></li><li><a href="#Connection.prototype.plugins"><code>Connection.prototype.plugins</code></a></li><li><a href="#Connection.prototype.port"><code>Connection.prototype.port</code></a></li><li><a href="#Connection.prototype.readyState"><code>Connection.prototype.readyState</code></a></li><li><a href="#Connection.prototype.removeDb()"><code>Connection.prototype.removeDb()</code></a></li><li><a href="#Connection.prototype.set()"><code>Connection.prototype.set()</code></a></li><li><a href="#Connection.prototype.setClient()"><code>Connection.prototype.setClient()</code></a></li><li><a href="#Connection.prototype.startSession()"><code>Connection.prototype.startSession()</code></a></li><li><a href="#Connection.prototype.syncIndexes()"><code>Connection.prototype.syncIndexes()</code></a></li><li><a href="#Connection.prototype.transaction()"><code>Connection.prototype.transaction()</code></a></li><li><a href="#Connection.prototype.useDb()"><code>Connection.prototype.useDb()</code></a></li><li><a href="#Connection.prototype.user"><code>Connection.prototype.user</code></a></li><li><a href="#Connection.prototype.watch()"><code>Connection.prototype.watch()</code></a></li><li><a href="#Connection.prototype.withSession()"><code>Connection.prototype.withSession()</code></a></li></ul></div><div class="nav-item" id="nav-Document"><div class="nav-item-title"><a href="document.html">Document</a></div></div><div class="nav-item" id="nav-Model"><div class="nav-item-title"><a href="model.html">Model</a></div></div><div class="nav-item" id="nav-Query"><div class="nav-item-title"><a href="query.html">Query</a></div></div><div class="nav-item" id="nav-QueryCursor"><div class="nav-item-title"><a href="querycursor.html">QueryCursor</a></div></div><div class="nav-item" id="nav-Aggregate"><div class="nav-item-title"><a href="aggregate.html">Aggregate</a></div></div><div class="nav-item" id="nav-AggregationCursor"><div class="nav-item-title"><a href="aggregationcursor.html">AggregationCursor</a></div></div><div class="nav-item" id="nav-SchemaType"><div class="nav-item-title"><a href="schematype.html">SchemaType</a></div></div><div class="nav-item" id="nav-VirtualType"><div class="nav-item-title"><a href="virtualtype.html">VirtualType</a></div></div><div class="nav-item" id="nav-Error"><div class="nav-item-title"><a href="error.html">Error</a></div></div><div class="nav-item" id="nav-SchemaArray"><div class="nav-item-title"><a href="schemaarray.html">SchemaArray</a></div></div><div class="nav-item" id="nav-SchemaDocumentArray"><div class="nav-item-title"><a href="schemadocumentarray.html">SchemaDocumentArray</a></div></div><div class="nav-item" id="nav-SchemaSubdocument"><div class="nav-item-title"><a href="schemasubdocument.html">SchemaSubdocument</a></div></div><div class="nav-item" id="nav-SchemaBoolean"><div class="nav-item-title"><a href="schemaboolean.html">SchemaBoolean</a></div></div><div class="nav-item" id="nav-SchemaBuffer"><div class="nav-item-title"><a href="schemabuffer.html">SchemaBuffer</a></div></div><div class="nav-item" id="nav-SchemaNumber"><div class="nav-item-title"><a href="schemanumber.html">SchemaNumber</a></div></div><div class="nav-item" id="nav-SchemaObjectId"><div class="nav-item-title"><a href="schemaobjectid.html">SchemaObjectId</a></div></div><div class="nav-item" id="nav-SchemaString"><div class="nav-item-title"><a href="schemastring.html">SchemaString</a></div></div><div class="nav-item" id="nav-DocumentArray"><div class="nav-item-title"><a href="documentarray.html">DocumentArray</a></div></div><div class="nav-item" id="nav-Subdocument"><div class="nav-item-title"><a href="subdocument.html">Subdocument</a></div></div><div class="nav-item" id="nav-ArraySubdocument"><div class="nav-item-title"><a href="arraysubdocument.html">ArraySubdocument</a></div></div><div class="nav-item" id="nav-Buffer"><div class="nav-item-title"><a href="buffer.html">Buffer</a></div></div><div class="nav-item" id="nav-Decimal128"><div class="nav-item-title"><a href="decimal128.html">Decimal128</a></div></div><div class="nav-item" id="nav-Map"><div class="nav-item-title"><a href="map.html">Map</a></div></div><div class="nav-item" id="nav-Array"><div class="nav-item-title"><a href="array.html">Array</a></div></div></div></div><div class="api-content"><ul><li><a href="#Connection()"><code>Connection()</code></a></li><li><a href="#Connection.prototype.aggregate()"><code>Connection.prototype.aggregate()</code></a></li><li><a href="#Connection.prototype.asPromise()"><code>Connection.prototype.asPromise()</code></a></li><li><a href="#Connection.prototype.bulkWrite()"><code>Connection.prototype.bulkWrite()</code></a></li><li><a href="#Connection.prototype.client"><code>Connection.prototype.client</code></a></li><li><a href="#Connection.prototype.close()"><code>Connection.prototype.close()</code></a></li><li><a href="#Connection.prototype.collection()"><code>Connection.prototype.collection()</code></a></li><li><a href="#Connection.prototype.collections"><code>Connection.prototype.collections</code></a></li><li><a href="#Connection.prototype.config"><code>Connection.prototype.config</code></a></li><li><a href="#Connection.prototype.createCollection()"><code>Connection.prototype.createCollection()</code></a></li><li><a href="#Connection.prototype.createCollections()"><code>Connection.prototype.createCollections()</code></a></li><li><a href="#Connection.prototype.db"><code>Connection.prototype.db</code></a></li><li><a href="#Connection.prototype.deleteModel()"><code>Connection.prototype.deleteModel()</code></a></li><li><a href="#Connection.prototype.destroy()"><code>Connection.prototype.destroy()</code></a></li><li><a href="#Connection.prototype.dropCollection()"><code>Connection.prototype.dropCollection()</code></a></li><li><a href="#Connection.prototype.dropDatabase()"><code>Connection.prototype.dropDatabase()</code></a></li><li><a href="#Connection.prototype.get()"><code>Connection.prototype.get()</code></a></li><li><a href="#Connection.prototype.getClient()"><code>Connection.prototype.getClient()</code></a></li><li><a href="#Connection.prototype.host"><code>Connection.prototype.host</code></a></li><li><a href="#Connection.prototype.id"><code>Connection.prototype.id</code></a></li><li><a href="#Connection.prototype.listCollections()"><code>Connection.prototype.listCollections()</code></a></li><li><a href="#Connection.prototype.listDatabases()"><code>Connection.prototype.listDatabases()</code></a></li><li><a href="#Connection.prototype.model()"><code>Connection.prototype.model()</code></a></li><li><a href="#Connection.prototype.modelNames()"><code>Connection.prototype.modelNames()</code></a></li><li><a href="#Connection.prototype.models"><code>Connection.prototype.models</code></a></li><li><a href="#Connection.prototype.name"><code>Connection.prototype.name</code></a></li><li><a href="#Connection.prototype.on()"><code>Connection.prototype.on()</code></a></li><li><a href="#Connection.prototype.once()"><code>Connection.prototype.once()</code></a></li><li><a href="#Connection.prototype.openUri()"><code>Connection.prototype.openUri()</code></a></li><li><a href="#Connection.prototype.pass"><code>Connection.prototype.pass</code></a></li><li><a href="#Connection.prototype.plugin()"><code>Connection.prototype.plugin()</code></a></li><li><a href="#Connection.prototype.plugins"><code>Connection.prototype.plugins</code></a></li><li><a href="#Connection.prototype.port"><code>Connection.prototype.port</code></a></li><li><a href="#Connection.prototype.readyState"><code>Connection.prototype.readyState</code></a></li><li><a href="#Connection.prototype.removeDb()"><code>Connection.prototype.removeDb()</code></a></li><li><a href="#Connection.prototype.set()"><code>Connection.prototype.set()</code></a></li><li><a href="#Connection.prototype.setClient()"><code>Connection.prototype.setClient()</code></a></li><li><a href="#Connection.prototype.startSession()"><code>Connection.prototype.startSession()</code></a></li><li><a href="#Connection.prototype.syncIndexes()"><code>Connection.prototype.syncIndexes()</code></a></li><li><a href="#Connection.prototype.transaction()"><code>Connection.prototype.transaction()</code></a></li><li><a href="#Connection.prototype.useDb()"><code>Connection.prototype.useDb()</code></a></li><li><a href="#Connection.prototype.user"><code>Connection.prototype.user</code></a></li><li><a href="#Connection.prototype.watch()"><code>Connection.prototype.watch()</code></a></li><li><a href="#Connection.prototype.withSession()"><code>Connection.prototype.withSession()</code></a></li></ul><hr class="separate-api-elements"><h3 id="Connection()"><a href="#Connection()"><code>Connection()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>base</code>
<span class="method-type">&laquo;Mongoose&raquo;</span> a mongoose instance</p>
</li></ul><h5>Inherits:</h5><ul><li><span class="method-type"><a href="https://nodejs.org/api/events.html#class-eventemitter">&laquo;NodeJS EventEmitter&raquo;</a></span></li></ul><div><p>Connection constructor</p>
<p>For practical reasons, a Connection equals a Db.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.aggregate()"><a href="#Connection.prototype.aggregate()"><code>Connection.prototype.aggregate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>pipeline</code>
<span class="method-type">&laquo;Array&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.cursor=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, make the Aggregate resolve to a Mongoose AggregationCursor rather than an array</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Aggregate&raquo;</span> Aggregation wrapper</li></ul><div><p>Runs a <a href="https://www.mongodb.com/docs/manual/reference/method/db.aggregate/">db-level aggregate()</a> on this connection&#39;s underlying <code>db</code></p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.asPromise()"><a href="#Connection.prototype.asPromise()"><code>Connection.prototype.asPromise()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Returns a promise that resolves when this connection
successfully connects to MongoDB, or rejects if this connection failed
to connect.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>).
  <span class="hljs-title function_">asPromise</span>();
conn.<span class="hljs-property">readyState</span>; <span class="hljs-comment">// 1, means Mongoose is connected</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.bulkWrite()"><a href="#Connection.prototype.bulkWrite()"><code>Connection.prototype.bulkWrite()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>ops</code>
<span class="method-type">&laquo;Array&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.ordered]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If false, perform unordered operations. If true, perform ordered operations.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session]</code>
<span class="method-type">&laquo;Session&raquo;</span> The session to use for the operation.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/bulkWrite/#mongodb-dbcommand-dbcmd.bulkWrite">MongoDB</a></span></li></ul><div><p><em>Requires MongoDB Server 8.0 or greater</em>. Executes bulk write operations across multiple models in a single operation.
You must specify the <code>model</code> for each operation: Mongoose will use <code>model</code> for casting and validation, as well as
determining which collection to apply the operation to.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">bulkWrite</span>([
  { <span class="hljs-attr">model</span>: <span class="hljs-title class_">Test</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;insertOne&#x27;</span>, <span class="hljs-attr">document</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test1&#x27;</span> } }, <span class="hljs-comment">// Can specify model as a Model class...</span>
  { <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;insertOne&#x27;</span>, <span class="hljs-attr">document</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test2&#x27;</span> } } <span class="hljs-comment">// or as a model name</span>
], { <span class="hljs-attr">ordered</span>: <span class="hljs-literal">false</span> });</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.client"><a href="#Connection.prototype.client"><code>Connection.prototype.client</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The MongoClient instance this connection uses to talk to MongoDB. Mongoose automatically sets this property
when the connection is opened.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.close()"><a href="#Connection.prototype.close()"><code>Connection.prototype.close()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[force]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> optional</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Closes the connection</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.collection()"><a href="#Connection.prototype.collection()"><code>Connection.prototype.collection()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>name</code>
<span class="method-type">&laquo;String&raquo;</span> of the collection</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> optional collection options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Collection&raquo;</span> collection instance</li></ul><div><p>Retrieves a raw collection instance, creating it if not cached.
This method returns a thin wrapper around a [MongoDB Node.js driver collection](<a href="https://mongodb.github.io/node-mongodb-native/Next/classes/Collection.html">MongoDB Node.js driver collection</a>).
Using a Collection bypasses Mongoose middleware, validation, and casting,
letting you use <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB Node.js driver</a> functionality directly.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.collections"><a href="#Connection.prototype.collections"><code>Connection.prototype.collections</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A hash of the collections associated with this connection</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.config"><a href="#Connection.prototype.config"><code>Connection.prototype.config</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A hash of the global options that are associated with this connection</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.createCollection()"><a href="#Connection.prototype.createCollection()"><code>Connection.prototype.createCollection()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>collection</code>
<span class="method-type">&laquo;string&raquo;</span> The collection to create</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> see <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createCollection">MongoDB driver docs</a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Helper for <code>createCollection()</code>. Will explicitly create the given collection
with specified options. Used to create <a href="https://www.mongodb.com/docs/manual/core/capped-collections/">capped collections</a>
and <a href="https://www.mongodb.com/docs/manual/core/views/">views</a> from mongoose.</p>
<p>Options are passed down without modification to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#createCollection">MongoDB driver&#39;s <code>createCollection()</code> function</a></p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.createCollections()"><a href="#Connection.prototype.createCollections()"><code>Connection.prototype.createCollections()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>continueOnError</code>
<span class="method-type">&laquo;Boolean&raquo;</span> When true, will continue to create collections and create a new error class for the collections that errored.</p>
</li></ul><div><p>Calls <code>createCollection()</code> on a models in a series.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.db"><a href="#Connection.prototype.db"><code>Connection.prototype.db</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The mongodb.Db instance, set when the connection is opened</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.deleteModel()"><a href="#Connection.prototype.deleteModel()"><code>Connection.prototype.deleteModel()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>name</code>
<span class="method-type">&laquo;String|RegExp&raquo;</span> if string, the name of the model to remove. If regexp, removes all models whose name matches the regexp.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Removes the model named <code>name</code> from this connection, if it exists. You can
use this function to clean up any models you created in your tests to
prevent OverwriteModelErrors.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// Model object</span>
conn.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-string">&#x27;User&#x27;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>)); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// Usually useful in a Mocha `afterEach()` hook</span>
<span class="hljs-title function_">afterEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  conn.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-regexp">/.+/</span>); <span class="hljs-comment">// Delete every model</span>
});</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.destroy()"><a href="#Connection.prototype.destroy()"><code>Connection.prototype.destroy()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[force]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Destroy the connection. Similar to <a href="#Connection.prototype.close()"><code>.close</code></a>,
but also removes the connection from Mongoose&#39;s <code>connections</code> list and prevents the
connection from ever being re-opened.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.dropCollection()"><a href="#Connection.prototype.dropCollection()"><code>Connection.prototype.dropCollection()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>collection</code>
<span class="method-type">&laquo;string&raquo;</span> The collection to delete</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Helper for <code>dropCollection()</code>. Will delete the given collection, including
all documents and indexes.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.dropDatabase()"><a href="#Connection.prototype.dropDatabase()"><code>Connection.prototype.dropDatabase()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Helper for <code>dropDatabase()</code>. Deletes the given database, including all
collections, documents, and indexes.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
<span class="hljs-comment">// Deletes the entire &#x27;mydb&#x27; database</span>
<span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">dropDatabase</span>();</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.get()"><a href="#Connection.prototype.get()"><code>Connection.prototype.get()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>key</code>
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Gets the value of the option <code>key</code>. Equivalent to <code>conn.options[key]</code></p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">conn.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">// returns the &#x27;test&#x27; value</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.getClient()"><a href="#Connection.prototype.getClient()"><code>Connection.prototype.getClient()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;MongoClient&raquo;</span> </li></ul><div><p>Returns the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html">MongoDB driver <code>MongoClient</code></a> instance
that this connection uses to talk to MongoDB.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>).
  <span class="hljs-title function_">asPromise</span>();

conn.<span class="hljs-title function_">getClient</span>(); <span class="hljs-comment">// MongoClient { ... }</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.host"><a href="#Connection.prototype.host"><code>Connection.prototype.host</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The host name portion of the URI. If multiple hosts, such as a replica set,
this will contain the first host name in the URI</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">host</span>; <span class="hljs-comment">// &quot;127.0.0.1&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.id"><a href="#Connection.prototype.id"><code>Connection.prototype.id</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A number identifier for this connection. Used for debugging when
you have <a href="/docs/connections.html#multiple_connections">multiple connections</a>.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-comment">// The default connection has `id = 0`</span>
mongoose.<span class="hljs-property">connection</span>.<span class="hljs-property">id</span>; <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// If you create a new connection, Mongoose increments id</span>
<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>();
conn.<span class="hljs-property">id</span>; <span class="hljs-comment">// 1</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.listCollections()"><a href="#Connection.prototype.listCollections()"><code>Connection.prototype.listCollections()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;Array[Collection]&gt;&raquo;</span> </li></ul><div><p>Helper for MongoDB Node driver&#39;s <code>listCollections()</code>.
Returns an array of collection objects.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.listDatabases()"><a href="#Connection.prototype.listDatabases()"><code>Connection.prototype.listDatabases()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;[object Object]&gt;&raquo;</span> </li></ul><div><p>Helper for MongoDB Node driver&#39;s <code>listDatabases()</code>.
Returns an object with a <code>databases</code> property that contains an
array of database objects.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> { databases } = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">listDatabases</span>();
databases; <span class="hljs-comment">// [{ name: &#x27;mongoose_test&#x27;, sizeOnDisk: 0, empty: false }]</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.model()"><a href="#Connection.prototype.model()"><code>Connection.prototype.model()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>name</code>
<span class="method-type">&laquo;String|Function&raquo;</span> the model name or class extending Model</p>
</li><li class="param"><code>[schema]</code>
<span class="method-type">&laquo;Schema&raquo;</span> a schema. necessary when defining a model</p>
</li><li class="param"><code>[collection]</code>
<span class="method-type">&laquo;String&raquo;</span> name of mongodb collection (optional) if not given it will be induced from model name</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.overwriteModels=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, overwrite existing models with the same name to avoid <code>OverwriteModelError</code></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Model&raquo;</span> The compiled model</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/mongoose.html#Mongoose.prototype.model()">Mongoose#model</a></span></li></ul><div><p>Defines or retrieves a model.</p>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);
<span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(..);
db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Venue&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Ticket</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Ticket&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Venue</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Venue&#x27;</span>);</code></pre><p><em>When no <code>collection</code> argument is passed, Mongoose produces a collection name by passing the model <code>name</code> to the <code>utils.toCollectionName</code> method. This method pluralizes the name. If you don&#39;t like this behavior, either pass a collection name or set your schemas collection name option.</em></p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">collection</span>: <span class="hljs-string">&#x27;actor&#x27;</span> });

<span class="hljs-comment">// or</span>

schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;collection&#x27;</span>, <span class="hljs-string">&#x27;actor&#x27;</span>);

<span class="hljs-comment">// or</span>

<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">&#x27;actor&#x27;</span>
<span class="hljs-keyword">const</span> M = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Actor&#x27;</span>, schema, collectionName)</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.modelNames()"><a href="#Connection.prototype.modelNames()"><code>Connection.prototype.modelNames()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array[String]&raquo;</span> </li></ul><div><p>Returns an array of model names created on this connection.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.models"><a href="#Connection.prototype.models"><code>Connection.prototype.models</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>A <a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a> containing
a map from model names to models. Contains all models that have been
added to this connection using <a href="#Connection.prototype.model()"><code>Connection#model()</code></a>.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Test</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, mongoose.<span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(conn.<span class="hljs-property">models</span>).<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>
conn.<span class="hljs-property">models</span>.<span class="hljs-property">Test</span> === <span class="hljs-title class_">Test</span>; <span class="hljs-comment">// true</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.name"><a href="#Connection.prototype.name"><code>Connection.prototype.name</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The name of the database this connection points to.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">name</span>; <span class="hljs-comment">// &quot;mydb&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.on()"><a href="#Connection.prototype.on()"><code>Connection.prototype.on()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>event</code>
<span class="method-type">&laquo;String&raquo;</span> The event to listen on</p>
</li><li class="param"><code>callback</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="#Connection.prototype.readyState">Connection#readyState</a></span></li></ul><div><p>Listen to events in the Connection</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.once()"><a href="#Connection.prototype.once()"><code>Connection.prototype.once()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>event</code>
<span class="method-type">&laquo;String&raquo;</span> The event to listen on</p>
</li><li class="param"><code>callback</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="#Connection.prototype.readyState">Connection#readyState</a></span></li></ul><div><p>Listen to a event once in the Connection</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.openUri()"><a href="#Connection.prototype.openUri()"><code>Connection.prototype.openUri()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>uri</code>
<span class="method-type">&laquo;String&raquo;</span> The URI to connect with.</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> Passed on to <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#connect-1"><code>MongoClient.connect</code></a></p>
</li><ul style="margin-top: 0.5em"><li><code>[options.bufferCommands=true]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose specific option. Set to false to <a href="/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.bufferTimeoutMS=10000]</code>
<span class="method-type">&laquo;Number&raquo;</span> Mongoose specific option. If <code>bufferCommands</code> is true, Mongoose will throw an error after <code>bufferTimeoutMS</code> if the operation is still buffered.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.dbName]</code>
<span class="method-type">&laquo;String&raquo;</span> The name of the database we want to use. If not provided, use database name from connection string.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.user]</code>
<span class="method-type">&laquo;String&raquo;</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.pass]</code>
<span class="method-type">&laquo;String&raquo;</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.maxPoolSize=100]</code>
<span class="method-type">&laquo;Number&raquo;</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.minPoolSize=0]</code>
<span class="method-type">&laquo;Number&raquo;</span> The minimum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.serverSelectionTimeoutMS]</code>
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver will try to find a server to send any given operation to, and keep retrying for <code>serverSelectionTimeoutMS</code> milliseconds before erroring out. If not set, the MongoDB driver defaults to using <code>30000</code> (30 seconds).</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.heartbeatFrequencyMS]</code>
<span class="method-type">&laquo;Number&raquo;</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver sends a heartbeat every <code>heartbeatFrequencyMS</code> to check on the status of the connection. A heartbeat is subject to <code>serverSelectionTimeoutMS</code>, so the MongoDB driver will retry failed heartbeats for up to 30 seconds by default. Mongoose only emits a <code>&#39;disconnected&#39;</code> event after a heartbeat has failed, so you may want to decrease this setting to reduce the time between when your server goes down and when Mongoose emits <code>&#39;disconnected&#39;</code>. We recommend you do <strong>not</strong> set this setting below 1000, too many heartbeats can lead to performance degradation.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.autoIndex=true]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.promiseLibrary]</code>
<span class="method-type">&laquo;Class&raquo;</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver&#39;s promise library</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.socketTimeoutMS=0]</code>
<span class="method-type">&laquo;Number&raquo;</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. A socket may be inactive because of either no activity or a long-running operation. <code>socketTimeoutMS</code> defaults to 0, which means Node.js will not time out the socket due to inactivity. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.family=0]</code>
<span class="method-type">&laquo;Number&raquo;</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js&#39; <code>dns.lookup()</code></a> function. May be either <code>0, </code>4<code>, or </code>6<code>. </code>4<code>means use IPv4 only,</code>6<code>means use IPv6 only,</code>0` means try both.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.autoCreate=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Set to <code>true</code> to make Mongoose automatically call <code>createCollection()</code> on every model created on this connection.</p>
</li></ul></ul><div><p>Opens the connection with a URI using <code>MongoClient.connect()</code>.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.pass"><a href="#Connection.prototype.pass"><code>Connection.prototype.pass</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The password specified in the URI</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://val:psw@127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">pass</span>; <span class="hljs-comment">// &quot;psw&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.plugin()"><a href="#Connection.prototype.plugin()"><code>Connection.prototype.plugin()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> plugin callback</p>
</li><li class="param"><code>[opts]</code>
<span class="method-type">&laquo;Object&raquo;</span> optional options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/plugins.html">plugins</a></span></li></ul><div><p>Declares a plugin executed on all schemas you pass to <code>conn.model()</code></p>
<p>Equivalent to calling <code>.plugin(fn)</code> on each schema you create.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
db.<span class="hljs-title function_">plugin</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Applied&#x27;</span>));
db.<span class="hljs-property">plugins</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>

db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({})); <span class="hljs-comment">// Prints &quot;Applied&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.plugins"><a href="#Connection.prototype.plugins"><code>Connection.prototype.plugins</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The plugins that will be applied to all models created on this connection.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>);
db.<span class="hljs-title function_">plugin</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Applied&#x27;</span>));
db.<span class="hljs-property">plugins</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1</span>

db.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Test&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({})); <span class="hljs-comment">// Prints &quot;Applied&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.port"><a href="#Connection.prototype.port"><code>Connection.prototype.port</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The port portion of the URI. If multiple hosts, such as a replica set,
this will contain the port from the first host name in the URI.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">port</span>; <span class="hljs-comment">// 27017</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.readyState"><a href="#Connection.prototype.readyState"><code>Connection.prototype.readyState</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>Connection ready state</p>
<ul>
<li>0 = disconnected</li>
<li>1 = connected</li>
<li>2 = connecting</li>
<li>3 = disconnecting</li>
</ul>
<p>Each state change emits its associated event name.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connected&#x27;</span>, callback);
conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;disconnected&#x27;</span>, callback);</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.removeDb()"><a href="#Connection.prototype.removeDb()"><code>Connection.prototype.removeDb()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>name</code>
<span class="method-type">&laquo;String&raquo;</span> The database name</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Removes the database connection with the given name created with with <code>useDb()</code>.</p>
<p>Throws an error if the database connection was not found.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-comment">// Connect to `initialdb` first</span>
<span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/initialdb&#x27;</span>).<span class="hljs-title function_">asPromise</span>();

<span class="hljs-comment">// Creates an un-cached connection to `mydb`</span>
<span class="hljs-keyword">const</span> db = conn.<span class="hljs-title function_">useDb</span>(<span class="hljs-string">&#x27;mydb&#x27;</span>);

<span class="hljs-comment">// Closes `db`, and removes `db` from `conn.relatedDbs` and `conn.otherDbs`</span>
<span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">removeDb</span>(<span class="hljs-string">&#x27;mydb&#x27;</span>);</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.set()"><a href="#Connection.prototype.set()"><code>Connection.prototype.set()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>key</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Any&raquo;</span> </li></ul><div><p>Sets the value of the option <code>key</code>. Equivalent to <code>conn.options[key] = val</code></p>
<p>Supported options include:</p>
<ul>
<li><code>maxTimeMS</code>: Set <a href="/docs/api/query.html#Query.prototype.maxTimeMS()"><code>maxTimeMS</code></a> for all queries on this connection.</li>
<li>&#39;debug&#39;: If <code>true</code>, prints the operations mongoose sends to MongoDB to the console. If a writable stream is passed, it will log to that stream, without colorization. If a callback function is passed, it will receive the collection name, the method name, then all arugments passed to the method. For example, if you wanted to replicate the default logging, you could output from the callback <code>Mongoose: ${collectionName}.${methodName}(${methodArgs.join(&#39;, &#39;)})</code>.</li>
</ul>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">conn.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;foo&#x27;</span>);
conn.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">// &#x27;foo&#x27;</span>
conn.<span class="hljs-property">options</span>.<span class="hljs-property">test</span>; <span class="hljs-comment">// &#x27;foo&#x27;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.setClient()"><a href="#Connection.prototype.setClient()"><code>Connection.prototype.setClient()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>client</code>
<span class="method-type">&laquo;MongClient&raquo;</span> The Client to set to be used.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> this</li></ul><div><p>Set the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html">MongoDB driver <code>MongoClient</code></a> instance
that this connection uses to talk to MongoDB. This is useful if you already have a MongoClient instance, and want to
reuse it.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> mongodb.<span class="hljs-property">MongoClient</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/test&#x27;</span>);

<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>().<span class="hljs-title function_">setClient</span>(client);

conn.<span class="hljs-title function_">getClient</span>(); <span class="hljs-comment">// MongoClient { ... }</span>
conn.<span class="hljs-property">readyState</span>; <span class="hljs-comment">// 1, means &#x27;CONNECTED&#x27;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.startSession()"><a href="#Connection.prototype.startSession()"><code>Connection.prototype.startSession()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#startSession">mongodb driver options</a></p>
</li><ul style="margin-top: 0.5em"><li><code>[options.causalConsistency=true]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> set to false to disable causal consistency</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;ClientSession&gt;&raquo;</span> promise that resolves to a MongoDB driver <code>ClientSession</code></li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Starts a <a href="https://www.mongodb.com/docs/manual/release-notes/3.6/#client-sessions">MongoDB session</a>
for benefits like causal consistency, <a href="https://www.mongodb.com/docs/manual/core/retryable-writes/">retryable writes</a>,
and <a href="https://thecodebarbarian.com/a-node-js-perspective-on-mongodb-4-transactions.html">transactions</a>.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">startSession</span>();
<span class="hljs-keyword">let</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session });
<span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">deleteOne</span>();
<span class="hljs-comment">// `doc` will always be null, even if reading from a replica set</span>
<span class="hljs-comment">// secondary. Without causal consistency, it is possible to</span>
<span class="hljs-comment">// get a doc back from the below query if the query reads from a</span>
<span class="hljs-comment">// secondary that is experiencing replication lag.</span>
doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ned Stark&#x27;</span> }, <span class="hljs-literal">null</span>, { session, <span class="hljs-attr">readPreference</span>: <span class="hljs-string">&#x27;secondary&#x27;</span> });</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.syncIndexes()"><a href="#Connection.prototype.syncIndexes()"><code>Connection.prototype.syncIndexes()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.continueOnError]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> <code>false</code> by default. If set to <code>true</code>, mongoose will not throw an error if one model syncing failed, and will return an object where the keys are the names of the models, and the values are the results/errors for each model.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;Object&gt;&raquo;</span> Returns a Promise, when the Promise resolves the value is a list of the dropped indexes.</li></ul><div><p>Syncs all the indexes for the models registered with this connection.</p>
  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.transaction()"><a href="#Connection.prototype.transaction()"><code>Connection.prototype.transaction()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> Function to execute in a transaction</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;[object Object]&raquo;</span> Optional settings for the transaction</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&lt;Any&gt;&raquo;</span> promise that is fulfilled if Mongoose successfully committed the transaction, or rejects if the transaction was aborted or if Mongoose failed to commit the transaction. If fulfilled, the promise resolves to a MongoDB command result.</li></ul><div><p><em>Requires MongoDB &gt;= 3.6.0.</em> Executes the wrapped async function
in a transaction. Mongoose will commit the transaction if the
async function executes successfully and attempt to retry if
there was a retriable error.</p>
<p>Calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/ClientSession.html#withTransaction"><code>session.withTransaction()</code></a>,
but also handles resetting Mongoose document state as shown below.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Will Riker&#x27;</span> });
<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">transaction</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setRank</span>(<span class="hljs-params">session</span>) {
  doc.<span class="hljs-property">rank</span> = <span class="hljs-string">&#x27;Captain&#x27;</span>;
  <span class="hljs-keyword">await</span> doc.<span class="hljs-title function_">save</span>({ session });
  doc.<span class="hljs-property">isNew</span>; <span class="hljs-comment">// false</span>

  <span class="hljs-comment">// Throw an error to abort the transaction</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Oops!&#x27;</span>);
},{ <span class="hljs-attr">readPreference</span>: <span class="hljs-string">&#x27;primary&#x27;</span> }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {});

<span class="hljs-comment">// true, `transaction()` reset the document&#x27;s state because the</span>
<span class="hljs-comment">// transaction was aborted.</span>
doc.<span class="hljs-property">isNew</span>;</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.useDb()"><a href="#Connection.prototype.useDb()"><code>Connection.prototype.useDb()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>name</code>
<span class="method-type">&laquo;String&raquo;</span> The database name</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.useCache=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, cache results so calling <code>useDb()</code> multiple times with the same name only creates 1 connection object.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.noListener=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, the connection object will not make the db listen to events on the original connection. See <a href="https://github.com/Automattic/mongoose/issues/9961">issue #9961</a>.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Connection&raquo;</span> New Connection Object</li></ul><div><p>Switches to a different database using the same <a href="/docs/api/connectionshtml#connection_pools">connection pool</a>.</p>
<p>Returns a new connection object, with the new db.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-comment">// Connect to `initialdb` first</span>
<span class="hljs-keyword">const</span> conn = <span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/initialdb&#x27;</span>).<span class="hljs-title function_">asPromise</span>();

<span class="hljs-comment">// Creates an un-cached connection to `mydb`</span>
<span class="hljs-keyword">const</span> db = conn.<span class="hljs-title function_">useDb</span>(<span class="hljs-string">&#x27;mydb&#x27;</span>);
<span class="hljs-comment">// Creates a cached connection to `mydb2`. All calls to `conn.useDb(&#x27;mydb2&#x27;, { useCache: true })` will return the same</span>
<span class="hljs-comment">// connection instance as opposed to creating a new connection instance</span>
<span class="hljs-keyword">const</span> db2 = conn.<span class="hljs-title function_">useDb</span>(<span class="hljs-string">&#x27;mydb2&#x27;</span>, { <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span> });</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.user"><a href="#Connection.prototype.user"><code>Connection.prototype.user</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The username specified in the URI</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript">mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">&#x27;mongodb://val:psw@127.0.0.1:27017/mydb&#x27;</span>).<span class="hljs-property">user</span>; <span class="hljs-comment">// &quot;val&quot;</span></code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.watch()"><a href="#Connection.prototype.watch()"><code>Connection.prototype.watch()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[pipeline]</code>
<span class="method-type">&laquo;Array&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> passed without changes to <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Db.html#watch">the MongoDB driver&#39;s <code>Db#watch()</code> function</a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;ChangeStream&raquo;</span> mongoose-specific change stream wrapper, inherits from EventEmitter</li></ul><div><p>Watches the entire underlying database for changes. Similar to
<a href="/docs/api/model.html#Model.watch()"><code>Model.watch()</code></a>.</p>
<p>This function does <strong>not</strong> trigger any middleware. In particular, it
does <strong>not</strong> trigger aggregate middleware.</p>
<p>The ChangeStream object is an event emitter that emits the following events:</p>
<ul>
<li>&#39;change&#39;: A change occurred, see below example</li>
<li>&#39;error&#39;: An unrecoverable error occurred. In particular, change streams currently error out if they lose connection to the replica set primary. Follow <a href="https://github.com/Automattic/mongoose/issues/6799">this GitHub issue</a> for updates.</li>
<li>&#39;end&#39;: Emitted if the underlying stream is closed</li>
<li>&#39;close&#39;: Emitted if the underlying stream is closed</li>
</ul>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;User&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));

<span class="hljs-keyword">const</span> changeStream = conn.<span class="hljs-title function_">watch</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));

<span class="hljs-comment">// Triggers a &#x27;change&#x27; event on the change stream.</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test&#x27;</span> });</code></pre>  </div><hr class="separate-api-elements"><h3 id="Connection.prototype.withSession()"><a href="#Connection.prototype.withSession()"><code>Connection.prototype.withSession()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>executor</code>
<span class="method-type">&laquo;Function&raquo;</span> called with 1 argument: a <code>ClientSession</code> instance</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> resolves to the return value of the executor function</li></ul><div><p>A convenience wrapper for <code>connection.client.withSession()</code>.</p>
<h4 id="example">
        <a href="#example">
          Example:
        </a>
      </h4>
<pre><code lang="javascript"><span class="hljs-keyword">await</span> conn.<span class="hljs-title function_">withSession</span>(<span class="hljs-keyword">async</span> session =&gt; {
  <span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">TestModel</span>.<span class="hljs-title function_">findOne</span>().<span class="hljs-title function_">session</span>(session);
});</code></pre>  </div></div></div></div><div id="jobs"><div class="job-listing"><a href="/docs/jobs.html#61f0b0402d893554bc3a247f"><div class="company-logo"><img src="https://assets.localizecdn.com/uploads/1689251999716.png"></div><div class="description"><div class="company">Localize</div><div class="title">Full Stack Engineer</div><div class="location">Anywhere</div></div></a></div><div class="button jobs-view-more"><a href="/docs/jobs.html">View more jobs!</a></div></div><script type="text/javascript" src="/docs/js/navbar-search.js"></script><script type="text/javascript" src="/docs/js/mobile-navbar-toggle.js"></script></div></body></html>