<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose v8.3.1: Query</title><link rel="apple-touch-icon" sizes="57x57" href="/docs/images/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/docs/images/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/docs/images/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/docs/images/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/docs/images/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/docs/images/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/docs/images/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/docs/images/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/docs/images/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/docs/images/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/docs/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/docs/images/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/docs/images/favicon/favicon-16x16.png"><link rel="manifest" href="/docs/images/favicon/manifest.json"><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel="stylesheet" href="/docs/css/github.css"><link rel="stylesheet" href="/docs/css/mongoose5.css"><link rel="stylesheet" href="/docs/css/carbonads.css"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/docs/images/favicon/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/docs/css/api.css"><script src="/docs/js/api-bold-current-nav.js"></script><script src="/docs/js/convert-old-anchorid.js"></script><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"></head><body><div id="layout"><div id="mobile-menu"><a class="menu-link" id="menuLink" href="#menu"><svg width="100%" height="100%" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></a><div id="mobile-logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div></div><div id="menu"><nav class="pure-menu"><div class="pure-menu-heading" id="logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div><ul class="pure-menu-list" id="navbar"><li class="pure-menu-horizontal pure-menu-item pure-menu-has-children pure-menu-allow-hover version"><a class="pure-menu-link" href="/docs/index.html">Version 8.3.1</a><ul class="pure-menu-children"><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/7.x/index.html">Version 7.6.10</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/index.html">Version 6.12.7</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/5.x/index.html">Version 5.13.22</a></li></ul></li><li class="pure-menu-item search"><input id="search-input-nav" type="text" placeholder="Search"><button id="search-button-nav"><img src="/docs/images/search.svg"></button></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/index.html">Quick Start</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/guides.html">Guides</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/guide.html">Schemas</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/schematypes.html">SchemaTypes</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/connections.html">Connections</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/models.html">Models</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/documents.html">Documents</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/subdocs.html">Subdocuments</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/queries.html">Queries</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/validation.html">Validation</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/middleware.html">Middleware</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/populate.html">Populate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/discriminators.html">Discriminators</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/plugins.html">Plugins</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/timestamps.html">Timestamps</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/transactions.html">Transactions</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/typescript.html">TypeScript</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">API</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">Mongoose</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/schema.html">Schema</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/connection.html">Connection</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/document.html">Document</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/model.html">Model</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link selected" href="/docs/api/query.html">Query</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/aggregate.html">Aggregate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/schematype.html">SchemaType</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/virtualtype.html">VirtualType</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/migrating_to_8.html">Migration Guide</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/compatibility.html">Version Compatibility</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/version-support.html">Version Support</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/faq.html">FAQ</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/further_reading.html">Further Reading</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/enterprise.html">For Enterprise</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/sponsors.html" >Sponsors</a></li></ul><div class="cpc-ad"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIL27I&placement=mongoosejscom" id="_carbonads_js"></script></div></nav></div><div class="container"><div id="content"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/query.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h1>Query</h1><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"><div id="native-direct"></div><script>(function() {
if (typeof _bsa !== 'undefined' && _bsa) {
_bsa.init('custom', 'CK7DT53U', 'placement:mongoosejscom',
{
target: '#native-direct',
template: `
<div class="native-inline">
<a rel="sponsored noopener" target="_blank" href="##statlink##" title="##company## — ##tagline##"><span class="sponsor">Sponsor</span> ##company## — ##description##</a>
</div>
</a>
`
}
);
}
})();</script><div class="api-nav"><div class="api-nav-content"><div class="nav-item" id="nav-Mongoose"><div class="nav-item-title"><a href="mongoose.html">Mongoose</a></div></div><div class="nav-item" id="nav-Schema"><div class="nav-item-title"><a href="schema.html">Schema</a></div></div><div class="nav-item" id="nav-Connection"><div class="nav-item-title"><a href="connection.html">Connection</a></div></div><div class="nav-item" id="nav-Document"><div class="nav-item-title"><a href="document.html">Document</a></div></div><div class="nav-item" id="nav-Model"><div class="nav-item-title"><a href="model.html">Model</a></div></div><div class="nav-item" id="nav-Query"><div class="nav-item-title" style="font-weight: bold"><a href="query.html">Query</a></div><ul class="nav-item-sub"><li><a href="#Query()"><code>Query()</code></a></li><li><a href="#Query.prototype.$where()"><code>Query.prototype.$where()</code></a></li><li><a href="#Query.prototype.all()"><code>Query.prototype.all()</code></a></li><li><a href="#Query.prototype.allowDiskUse()"><code>Query.prototype.allowDiskUse()</code></a></li><li><a href="#Query.prototype.and()"><code>Query.prototype.and()</code></a></li><li><a href="#Query.prototype.batchSize()"><code>Query.prototype.batchSize()</code></a></li><li><a href="#Query.prototype.box()"><code>Query.prototype.box()</code></a></li><li><a href="#Query.prototype.cast()"><code>Query.prototype.cast()</code></a></li><li><a href="#Query.prototype.catch()"><code>Query.prototype.catch()</code></a></li><li><a href="#Query.prototype.center()"><code>Query.prototype.center()</code></a></li><li><a href="#Query.prototype.centerSphere()"><code>Query.prototype.centerSphere()</code></a></li><li><a href="#Query.prototype.circle()"><code>Query.prototype.circle()</code></a></li><li><a href="#Query.prototype.clone()"><code>Query.prototype.clone()</code></a></li><li><a href="#Query.prototype.collation()"><code>Query.prototype.collation()</code></a></li><li><a href="#Query.prototype.comment()"><code>Query.prototype.comment()</code></a></li><li><a href="#Query.prototype.countDocuments()"><code>Query.prototype.countDocuments()</code></a></li><li><a href="#Query.prototype.cursor()"><code>Query.prototype.cursor()</code></a></li><li><a href="#Query.prototype.deleteMany()"><code>Query.prototype.deleteMany()</code></a></li><li><a href="#Query.prototype.deleteOne()"><code>Query.prototype.deleteOne()</code></a></li><li><a href="#Query.prototype.distinct()"><code>Query.prototype.distinct()</code></a></li><li><a href="#Query.prototype.elemMatch()"><code>Query.prototype.elemMatch()</code></a></li><li><a href="#Query.prototype.equals()"><code>Query.prototype.equals()</code></a></li><li><a href="#Query.prototype.error()"><code>Query.prototype.error()</code></a></li><li><a href="#Query.prototype.estimatedDocumentCount()"><code>Query.prototype.estimatedDocumentCount()</code></a></li><li><a href="#Query.prototype.exec()"><code>Query.prototype.exec()</code></a></li><li><a href="#Query.prototype.exists()"><code>Query.prototype.exists()</code></a></li><li><a href="#Query.prototype.explain()"><code>Query.prototype.explain()</code></a></li><li><a href="#Query.prototype.finally()"><code>Query.prototype.finally()</code></a></li><li><a href="#Query.prototype.find()"><code>Query.prototype.find()</code></a></li><li><a href="#Query.prototype.findOne()"><code>Query.prototype.findOne()</code></a></li><li><a href="#Query.prototype.findOneAndDelete()"><code>Query.prototype.findOneAndDelete()</code></a></li><li><a href="#Query.prototype.findOneAndReplace()"><code>Query.prototype.findOneAndReplace()</code></a></li><li><a href="#Query.prototype.findOneAndUpdate()"><code>Query.prototype.findOneAndUpdate()</code></a></li><li><a href="#Query.prototype.geometry()"><code>Query.prototype.geometry()</code></a></li><li><a href="#Query.prototype.get()"><code>Query.prototype.get()</code></a></li><li><a href="#Query.prototype.getFilter()"><code>Query.prototype.getFilter()</code></a></li><li><a href="#Query.prototype.getOptions()"><code>Query.prototype.getOptions()</code></a></li><li><a href="#Query.prototype.getPopulatedPaths()"><code>Query.prototype.getPopulatedPaths()</code></a></li><li><a href="#Query.prototype.getQuery()"><code>Query.prototype.getQuery()</code></a></li><li><a href="#Query.prototype.getUpdate()"><code>Query.prototype.getUpdate()</code></a></li><li><a href="#Query.prototype.gt()"><code>Query.prototype.gt()</code></a></li><li><a href="#Query.prototype.gte()"><code>Query.prototype.gte()</code></a></li><li><a href="#Query.prototype.hint()"><code>Query.prototype.hint()</code></a></li><li><a href="#Query.prototype.in()"><code>Query.prototype.in()</code></a></li><li><a href="#Query.prototype.intersects()"><code>Query.prototype.intersects()</code></a></li><li><a href="#Query.prototype.isPathSelectedInclusive()"><code>Query.prototype.isPathSelectedInclusive()</code></a></li><li><a href="#Query.prototype.j()"><code>Query.prototype.j()</code></a></li><li><a href="#Query.prototype.lean()"><code>Query.prototype.lean()</code></a></li><li><a href="#Query.prototype.limit()"><code>Query.prototype.limit()</code></a></li><li><a href="#Query.prototype.lt()"><code>Query.prototype.lt()</code></a></li><li><a href="#Query.prototype.lte()"><code>Query.prototype.lte()</code></a></li><li><a href="#Query.prototype.maxDistance()"><code>Query.prototype.maxDistance()</code></a></li><li><a href="#Query.prototype.maxTimeMS()"><code>Query.prototype.maxTimeMS()</code></a></li><li><a href="#Query.prototype.merge()"><code>Query.prototype.merge()</code></a></li><li><a href="#Query.prototype.mod()"><code>Query.prototype.mod()</code></a></li><li><a href="#Query.prototype.model"><code>Query.prototype.model</code></a></li><li><a href="#Query.prototype.mongooseOptions()"><code>Query.prototype.mongooseOptions()</code></a></li><li><a href="#Query.prototype.ne()"><code>Query.prototype.ne()</code></a></li><li><a href="#Query.prototype.near()"><code>Query.prototype.near()</code></a></li><li><a href="#Query.prototype.nearSphere()"><code>Query.prototype.nearSphere()</code></a></li><li><a href="#Query.prototype.nin()"><code>Query.prototype.nin()</code></a></li><li><a href="#Query.prototype.nor()"><code>Query.prototype.nor()</code></a></li><li><a href="#Query.prototype.or()"><code>Query.prototype.or()</code></a></li><li><a href="#Query.prototype.orFail()"><code>Query.prototype.orFail()</code></a></li><li><a href="#Query.prototype.polygon()"><code>Query.prototype.polygon()</code></a></li><li><a href="#Query.prototype.populate()"><code>Query.prototype.populate()</code></a></li><li><a href="#Query.prototype.post()"><code>Query.prototype.post()</code></a></li><li><a href="#Query.prototype.pre()"><code>Query.prototype.pre()</code></a></li><li><a href="#Query.prototype.projection()"><code>Query.prototype.projection()</code></a></li><li><a href="#Query.prototype.read()"><code>Query.prototype.read()</code></a></li><li><a href="#Query.prototype.readConcern()"><code>Query.prototype.readConcern()</code></a></li><li><a href="#Query.prototype.regex()"><code>Query.prototype.regex()</code></a></li><li><a href="#Query.prototype.replaceOne()"><code>Query.prototype.replaceOne()</code></a></li><li><a href="#Query.prototype.select()"><code>Query.prototype.select()</code></a></li><li><a href="#Query.prototype.selected()"><code>Query.prototype.selected()</code></a></li><li><a href="#Query.prototype.selectedExclusively()"><code>Query.prototype.selectedExclusively()</code></a></li><li><a href="#Query.prototype.selectedInclusively()"><code>Query.prototype.selectedInclusively()</code></a></li><li><a href="#Query.prototype.session()"><code>Query.prototype.session()</code></a></li><li><a href="#Query.prototype.set()"><code>Query.prototype.set()</code></a></li><li><a href="#Query.prototype.setOptions()"><code>Query.prototype.setOptions()</code></a></li><li><a href="#Query.prototype.setQuery()"><code>Query.prototype.setQuery()</code></a></li><li><a href="#Query.prototype.setUpdate()"><code>Query.prototype.setUpdate()</code></a></li><li><a href="#Query.prototype.size()"><code>Query.prototype.size()</code></a></li><li><a href="#Query.prototype.skip()"><code>Query.prototype.skip()</code></a></li><li><a href="#Query.prototype.slice()"><code>Query.prototype.slice()</code></a></li><li><a href="#Query.prototype.sort()"><code>Query.prototype.sort()</code></a></li><li><a href="#Query.prototype.tailable()"><code>Query.prototype.tailable()</code></a></li><li><a href="#Query.prototype.then()"><code>Query.prototype.then()</code></a></li><li><a href="#Query.prototype.toConstructor()"><code>Query.prototype.toConstructor()</code></a></li><li><a href="#Query.prototype.transform()"><code>Query.prototype.transform()</code></a></li><li><a href="#Query.prototype.updateMany()"><code>Query.prototype.updateMany()</code></a></li><li><a href="#Query.prototype.updateOne()"><code>Query.prototype.updateOne()</code></a></li><li><a href="#Query.prototype.w()"><code>Query.prototype.w()</code></a></li><li><a href="#Query.prototype.where()"><code>Query.prototype.where()</code></a></li><li><a href="#Query.prototype.within()"><code>Query.prototype.within()</code></a></li><li><a href="#Query.prototype.writeConcern()"><code>Query.prototype.writeConcern()</code></a></li><li><a href="#Query.prototype.wtimeout()"><code>Query.prototype.wtimeout()</code></a></li><li><a href="#Query.prototype[Symbol.asyncIterator]()"><code>Query.prototype[Symbol.asyncIterator]()</code></a></li><li><a href="#Query.prototype[Symbol.toStringTag]()"><code>Query.prototype[Symbol.toStringTag]()</code></a></li><li><a href="#Query.use$geoWithin"><code>Query.use$geoWithin</code></a></li></ul></div><div class="nav-item" id="nav-QueryCursor"><div class="nav-item-title"><a href="querycursor.html">QueryCursor</a></div></div><div class="nav-item" id="nav-Aggregate"><div class="nav-item-title"><a href="aggregate.html">Aggregate</a></div></div><div class="nav-item" id="nav-AggregationCursor"><div class="nav-item-title"><a href="aggregationcursor.html">AggregationCursor</a></div></div><div class="nav-item" id="nav-SchemaType"><div class="nav-item-title"><a href="schematype.html">SchemaType</a></div></div><div class="nav-item" id="nav-VirtualType"><div class="nav-item-title"><a href="virtualtype.html">VirtualType</a></div></div><div class="nav-item" id="nav-Error"><div class="nav-item-title"><a href="error.html">Error</a></div></div><div class="nav-item" id="nav-SchemaArray"><div class="nav-item-title"><a href="schemaarray.html">SchemaArray</a></div></div><div class="nav-item" id="nav-SchemaDocumentArray"><div class="nav-item-title"><a href="schemadocumentarray.html">SchemaDocumentArray</a></div></div><div class="nav-item" id="nav-SchemaSubdocument"><div class="nav-item-title"><a href="schemasubdocument.html">SchemaSubdocument</a></div></div><div class="nav-item" id="nav-SchemaBoolean"><div class="nav-item-title"><a href="schemaboolean.html">SchemaBoolean</a></div></div><div class="nav-item" id="nav-SchemaBuffer"><div class="nav-item-title"><a href="schemabuffer.html">SchemaBuffer</a></div></div><div class="nav-item" id="nav-SchemaNumber"><div class="nav-item-title"><a href="schemanumber.html">SchemaNumber</a></div></div><div class="nav-item" id="nav-SchemaObjectId"><div class="nav-item-title"><a href="schemaobjectid.html">SchemaObjectId</a></div></div><div class="nav-item" id="nav-SchemaString"><div class="nav-item-title"><a href="schemastring.html">SchemaString</a></div></div><div class="nav-item" id="nav-DocumentArray"><div class="nav-item-title"><a href="documentarray.html">DocumentArray</a></div></div><div class="nav-item" id="nav-Subdocument"><div class="nav-item-title"><a href="subdocument.html">Subdocument</a></div></div><div class="nav-item" id="nav-ArraySubdocument"><div class="nav-item-title"><a href="arraysubdocument.html">ArraySubdocument</a></div></div><div class="nav-item" id="nav-Buffer"><div class="nav-item-title"><a href="buffer.html">Buffer</a></div></div><div class="nav-item" id="nav-Decimal128"><div class="nav-item-title"><a href="decimal128.html">Decimal128</a></div></div><div class="nav-item" id="nav-Map"><div class="nav-item-title"><a href="map.html">Map</a></div></div><div class="nav-item" id="nav-Array"><div class="nav-item-title"><a href="array.html">Array</a></div></div></div></div><div class="api-content"><ul><li><a href="#Query()"><code>Query()</code></a></li><li><a href="#Query.prototype.$where()"><code>Query.prototype.$where()</code></a></li><li><a href="#Query.prototype.all()"><code>Query.prototype.all()</code></a></li><li><a href="#Query.prototype.allowDiskUse()"><code>Query.prototype.allowDiskUse()</code></a></li><li><a href="#Query.prototype.and()"><code>Query.prototype.and()</code></a></li><li><a href="#Query.prototype.batchSize()"><code>Query.prototype.batchSize()</code></a></li><li><a href="#Query.prototype.box()"><code>Query.prototype.box()</code></a></li><li><a href="#Query.prototype.cast()"><code>Query.prototype.cast()</code></a></li><li><a href="#Query.prototype.catch()"><code>Query.prototype.catch()</code></a></li><li><a href="#Query.prototype.center()"><code>Query.prototype.center()</code></a></li><li><a href="#Query.prototype.centerSphere()"><code>Query.prototype.centerSphere()</code></a></li><li><a href="#Query.prototype.circle()"><code>Query.prototype.circle()</code></a></li><li><a href="#Query.prototype.clone()"><code>Query.prototype.clone()</code></a></li><li><a href="#Query.prototype.collation()"><code>Query.prototype.collation()</code></a></li><li><a href="#Query.prototype.comment()"><code>Query.prototype.comment()</code></a></li><li><a href="#Query.prototype.countDocuments()"><code>Query.prototype.countDocuments()</code></a></li><li><a href="#Query.prototype.cursor()"><code>Query.prototype.cursor()</code></a></li><li><a href="#Query.prototype.deleteMany()"><code>Query.prototype.deleteMany()</code></a></li><li><a href="#Query.prototype.deleteOne()"><code>Query.prototype.deleteOne()</code></a></li><li><a href="#Query.prototype.distinct()"><code>Query.prototype.distinct()</code></a></li><li><a href="#Query.prototype.elemMatch()"><code>Query.prototype.elemMatch()</code></a></li><li><a href="#Query.prototype.equals()"><code>Query.prototype.equals()</code></a></li><li><a href="#Query.prototype.error()"><code>Query.prototype.error()</code></a></li><li><a href="#Query.prototype.estimatedDocumentCount()"><code>Query.prototype.estimatedDocumentCount()</code></a></li><li><a href="#Query.prototype.exec()"><code>Query.prototype.exec()</code></a></li><li><a href="#Query.prototype.exists()"><code>Query.prototype.exists()</code></a></li><li><a href="#Query.prototype.explain()"><code>Query.prototype.explain()</code></a></li><li><a href="#Query.prototype.finally()"><code>Query.prototype.finally()</code></a></li><li><a href="#Query.prototype.find()"><code>Query.prototype.find()</code></a></li><li><a href="#Query.prototype.findOne()"><code>Query.prototype.findOne()</code></a></li><li><a href="#Query.prototype.findOneAndDelete()"><code>Query.prototype.findOneAndDelete()</code></a></li><li><a href="#Query.prototype.findOneAndReplace()"><code>Query.prototype.findOneAndReplace()</code></a></li><li><a href="#Query.prototype.findOneAndUpdate()"><code>Query.prototype.findOneAndUpdate()</code></a></li><li><a href="#Query.prototype.geometry()"><code>Query.prototype.geometry()</code></a></li><li><a href="#Query.prototype.get()"><code>Query.prototype.get()</code></a></li><li><a href="#Query.prototype.getFilter()"><code>Query.prototype.getFilter()</code></a></li><li><a href="#Query.prototype.getOptions()"><code>Query.prototype.getOptions()</code></a></li><li><a href="#Query.prototype.getPopulatedPaths()"><code>Query.prototype.getPopulatedPaths()</code></a></li><li><a href="#Query.prototype.getQuery()"><code>Query.prototype.getQuery()</code></a></li><li><a href="#Query.prototype.getUpdate()"><code>Query.prototype.getUpdate()</code></a></li><li><a href="#Query.prototype.gt()"><code>Query.prototype.gt()</code></a></li><li><a href="#Query.prototype.gte()"><code>Query.prototype.gte()</code></a></li><li><a href="#Query.prototype.hint()"><code>Query.prototype.hint()</code></a></li><li><a href="#Query.prototype.in()"><code>Query.prototype.in()</code></a></li><li><a href="#Query.prototype.intersects()"><code>Query.prototype.intersects()</code></a></li><li><a href="#Query.prototype.isPathSelectedInclusive()"><code>Query.prototype.isPathSelectedInclusive()</code></a></li><li><a href="#Query.prototype.j()"><code>Query.prototype.j()</code></a></li><li><a href="#Query.prototype.lean()"><code>Query.prototype.lean()</code></a></li><li><a href="#Query.prototype.limit()"><code>Query.prototype.limit()</code></a></li><li><a href="#Query.prototype.lt()"><code>Query.prototype.lt()</code></a></li><li><a href="#Query.prototype.lte()"><code>Query.prototype.lte()</code></a></li><li><a href="#Query.prototype.maxDistance()"><code>Query.prototype.maxDistance()</code></a></li><li><a href="#Query.prototype.maxTimeMS()"><code>Query.prototype.maxTimeMS()</code></a></li><li><a href="#Query.prototype.merge()"><code>Query.prototype.merge()</code></a></li><li><a href="#Query.prototype.mod()"><code>Query.prototype.mod()</code></a></li><li><a href="#Query.prototype.model"><code>Query.prototype.model</code></a></li><li><a href="#Query.prototype.mongooseOptions()"><code>Query.prototype.mongooseOptions()</code></a></li><li><a href="#Query.prototype.ne()"><code>Query.prototype.ne()</code></a></li><li><a href="#Query.prototype.near()"><code>Query.prototype.near()</code></a></li><li><a href="#Query.prototype.nearSphere()"><code>Query.prototype.nearSphere()</code></a></li><li><a href="#Query.prototype.nin()"><code>Query.prototype.nin()</code></a></li><li><a href="#Query.prototype.nor()"><code>Query.prototype.nor()</code></a></li><li><a href="#Query.prototype.or()"><code>Query.prototype.or()</code></a></li><li><a href="#Query.prototype.orFail()"><code>Query.prototype.orFail()</code></a></li><li><a href="#Query.prototype.polygon()"><code>Query.prototype.polygon()</code></a></li><li><a href="#Query.prototype.populate()"><code>Query.prototype.populate()</code></a></li><li><a href="#Query.prototype.post()"><code>Query.prototype.post()</code></a></li><li><a href="#Query.prototype.pre()"><code>Query.prototype.pre()</code></a></li><li><a href="#Query.prototype.projection()"><code>Query.prototype.projection()</code></a></li><li><a href="#Query.prototype.read()"><code>Query.prototype.read()</code></a></li><li><a href="#Query.prototype.readConcern()"><code>Query.prototype.readConcern()</code></a></li><li><a href="#Query.prototype.regex()"><code>Query.prototype.regex()</code></a></li><li><a href="#Query.prototype.replaceOne()"><code>Query.prototype.replaceOne()</code></a></li><li><a href="#Query.prototype.select()"><code>Query.prototype.select()</code></a></li><li><a href="#Query.prototype.selected()"><code>Query.prototype.selected()</code></a></li><li><a href="#Query.prototype.selectedExclusively()"><code>Query.prototype.selectedExclusively()</code></a></li><li><a href="#Query.prototype.selectedInclusively()"><code>Query.prototype.selectedInclusively()</code></a></li><li><a href="#Query.prototype.session()"><code>Query.prototype.session()</code></a></li><li><a href="#Query.prototype.set()"><code>Query.prototype.set()</code></a></li><li><a href="#Query.prototype.setOptions()"><code>Query.prototype.setOptions()</code></a></li><li><a href="#Query.prototype.setQuery()"><code>Query.prototype.setQuery()</code></a></li><li><a href="#Query.prototype.setUpdate()"><code>Query.prototype.setUpdate()</code></a></li><li><a href="#Query.prototype.size()"><code>Query.prototype.size()</code></a></li><li><a href="#Query.prototype.skip()"><code>Query.prototype.skip()</code></a></li><li><a href="#Query.prototype.slice()"><code>Query.prototype.slice()</code></a></li><li><a href="#Query.prototype.sort()"><code>Query.prototype.sort()</code></a></li><li><a href="#Query.prototype.tailable()"><code>Query.prototype.tailable()</code></a></li><li><a href="#Query.prototype.then()"><code>Query.prototype.then()</code></a></li><li><a href="#Query.prototype.toConstructor()"><code>Query.prototype.toConstructor()</code></a></li><li><a href="#Query.prototype.transform()"><code>Query.prototype.transform()</code></a></li><li><a href="#Query.prototype.updateMany()"><code>Query.prototype.updateMany()</code></a></li><li><a href="#Query.prototype.updateOne()"><code>Query.prototype.updateOne()</code></a></li><li><a href="#Query.prototype.w()"><code>Query.prototype.w()</code></a></li><li><a href="#Query.prototype.where()"><code>Query.prototype.where()</code></a></li><li><a href="#Query.prototype.within()"><code>Query.prototype.within()</code></a></li><li><a href="#Query.prototype.writeConcern()"><code>Query.prototype.writeConcern()</code></a></li><li><a href="#Query.prototype.wtimeout()"><code>Query.prototype.wtimeout()</code></a></li><li><a href="#Query.prototype[Symbol.asyncIterator]()"><code>Query.prototype[Symbol.asyncIterator]()</code></a></li><li><a href="#Query.prototype[Symbol.toStringTag]()"><code>Query.prototype[Symbol.toStringTag]()</code></a></li><li><a href="#Query.use$geoWithin"><code>Query.use$geoWithin</code></a></li></ul><hr class="separate-api-elements"><h3 id="Query()"><a href="#Query()"><code>Query()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[model]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[conditions]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[collection]</code>
<span class="method-type">&laquo;Object&raquo;</span> Mongoose collection</p>
</li></ul><div><p>Query constructor used for building queries. You do not need
to instantiate a <code>Query</code> directly. Instead use Model functions like
<a href="/docs/api/model.html#Model.find()"><code>Model.find()</code></a>.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = MyModel.find(); // `query` is an instance of `Query`
query.setOptions({ lean : true });
query.collection(MyModel.collection);
query.where(&#39;age&#39;).gte(21).exec(callback);

// You can instantiate a query directly. There is no need to do
// this unless you&#39;re an advanced user with a very good reason to.
const query = new mongoose.Query();
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.$where()"><a href="#Query.prototype.$where()"><code>Query.prototype.$where()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>js</code>
<span class="method-type">&laquo;String|Function&raquo;</span> javascript string or function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/where/">$where</a></span></li></ul><div><p>Specifies a javascript function or expression to pass to MongoDBs query system.</p>
<h4 id="example">Example:</h4>
<pre><code>query.$where(&#39;this.comments.length === 10 || this.name.length === 5&#39;)

// or

query.$where(function () {
  return this.comments.length === 10 || this.name.length === 5;
})
</code></pre>
<h4 id="note">Note:</h4>
<p>Only use <code>$where</code> when you have a condition that cannot be met using other MongoDB operators like <code>$lt</code>.
<strong>Be sure to read about all of <a href="https://www.mongodb.com/docs/manual/reference/operator/where/">its caveats</a> before using.</strong></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.all()"><a href="#Query.prototype.all()"><code>Query.prototype.all()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/all/">$all</a></span></li></ul><div><p>Specifies an <code>$all</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">Example:</h4>
<pre><code>MyModel.find().where(&#39;pets&#39;).all([&#39;dog&#39;, &#39;cat&#39;, &#39;ferret&#39;]);
// Equivalent:
MyModel.find().all(&#39;pets&#39;, [&#39;dog&#39;, &#39;cat&#39;, &#39;ferret&#39;]);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.allowDiskUse()"><a href="#Query.prototype.allowDiskUse()"><code>Query.prototype.allowDiskUse()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[v]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Enable/disable <code>allowDiskUse</code>. If called with 0 arguments, sets <code>allowDiskUse: true</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.allowDiskUse/"><code>allowDiskUse</code> option</a>,
which allows the MongoDB server to use more than 100 MB for this query&#39;s <code>sort()</code>. This option can
let you work around <code>QueryExceededMemoryLimitNoDiskUseAllowed</code> errors from the MongoDB server.</p>
<p>Note that this option requires MongoDB server &gt;= 4.4. Setting this option is a no-op for MongoDB 4.2
and earlier.</p>
<p>Calling <code>query.allowDiskUse(v)</code> is equivalent to <code>query.setOptions({ allowDiskUse: v })</code></p>
<h4 id="example">Example:</h4>
<pre><code>await query.find().sort({ name: 1 }).allowDiskUse(true);
// Equivalent:
await query.find().sort({ name: 1 }).allowDiskUse();
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.and()"><a href="#Query.prototype.and()"><code>Query.prototype.and()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>array</code>
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/and/">$and</a></span></li></ul><div><p>Specifies arguments for a <code>$and</code> condition.</p>
<h4 id="example">Example:</h4>
<pre><code>query.and([{ color: &#39;green&#39; }, { status: &#39;ok&#39; }])
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.batchSize()"><a href="#Query.prototype.batchSize()"><code>Query.prototype.batchSize()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.batchSize/">batchSize</a></span></li></ul><div><p>Specifies the batchSize option.</p>
<h4 id="example">Example:</h4>
<pre><code>query.batchSize(100)
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.box()"><a href="#Query.prototype.box()"><code>Query.prototype.box()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val1</code>
<span class="method-type">&laquo;Object|Array&lt;Number&gt;&raquo;</span> Lower Left Coordinates OR a object of lower-left(ll) and upper-right(ur) Coordinates</p>
</li><li class="param"><code>[val2]</code>
<span class="method-type">&laquo;Array&lt;Number&gt;&raquo;</span> Upper Right Coordinates</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/box/">$box</a></span></li><li><span class="method-type"><a href="#Query.prototype.within()">within() Query#within</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li></ul><div><p>Specifies a <code>$box</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>const lowerLeft = [40.73083, -73.99756]
const upperRight= [40.741404,  -73.988135]

query.where(&#39;loc&#39;).within().box(lowerLeft, upperRight)
query.box({ ll : lowerLeft, ur : upperRight })
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.cast()"><a href="#Query.prototype.cast()"><code>Query.prototype.cast()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[model]</code>
<span class="method-type">&laquo;Model&raquo;</span> the model to cast to. If not set, defaults to <code>this.model</code></p>
</li><li class="param"><code>[obj]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> </li></ul><div><p>Casts this query to the schema of <code>model</code></p>
<h4 id="note">Note:</h4>
<p>If <code>obj</code> is present, it is cast instead of this query.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.catch()"><a href="#Query.prototype.catch()"><code>Query.prototype.catch()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[reject]</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with either the doc(s) or rejected with the error.
Like <code>.then()</code>, but only takes a rejection handler.</p>
<p>More about <a href="https://masteringjs.io/tutorials/fundamentals/catch">Promise <code>catch()</code> in JavaScript</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.center()"><a href="#Query.prototype.center()"><code>Query.prototype.center()</code></a></h3><span class="deprecated">~DEPRECATED~</span><div><p><em>DEPRECATED</em> Alias for <a href="#Query.prototype.circle()">circle</a></p>
<p><strong>Deprecated.</strong> Use <a href="#Query.prototype.circle()">circle</a> instead.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.centerSphere()"><a href="#Query.prototype.centerSphere()"><code>Query.prototype.centerSphere()</code></a></h3><span class="deprecated">~DEPRECATED~</span><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/centerSphere/">$centerSphere</a></span></li></ul><div><p><em>DEPRECATED</em> Specifies a <code>$centerSphere</code> condition</p>
<p><strong>Deprecated.</strong> Use <a href="#Query.prototype.circle()">circle</a> instead.</p>
<h4 id="example">Example:</h4>
<pre><code>const area = { center: [50, 50], radius: 10 };
query.where(&#39;loc&#39;).within().centerSphere(area);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.circle()"><a href="#Query.prototype.circle()"><code>Query.prototype.circle()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>area</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/center/">$center</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/centerSphere/">$centerSphere</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geoWithin/">$geoWithin</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li></ul><div><p>Specifies a <code>$center</code> or <code>$centerSphere</code> condition.</p>
<h4 id="example">Example:</h4>
<pre><code>const area = { center: [50, 50], radius: 10, unique: true }
query.where(&#39;loc&#39;).within().circle(area)
// alternatively
query.circle(&#39;loc&#39;, area);

// spherical calculations
const area = { center: [50, 50], radius: 10, unique: true, spherical: true }
query.where(&#39;loc&#39;).within().circle(area)
// alternatively
query.circle(&#39;loc&#39;, area);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.clone()"><a href="#Query.prototype.clone()"><code>Query.prototype.clone()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> copy</li></ul><div><p>Make a copy of this query so you can re-execute it.</p>
<h4 id="example">Example:</h4>
<pre><code>const q = Book.findOne({ title: &#39;Casino Royale&#39; });
await q.exec();
await q.exec(); // Throws an error because you can&#39;t execute a query twice

await q.clone().exec(); // Works
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.collation()"><a href="#Query.prototype.collation()"><code>Query.prototype.collation()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>value</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.collation/#cursor.collation">MongoDB docs</a></span></li></ul><div><p>Adds a collation to this op (MongoDB 3.4 and up)</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.comment()"><a href="#Query.prototype.comment()"><code>Query.prototype.comment()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/comment/">comment</a></span></li></ul><div><p>Specifies the <code>comment</code> option.</p>
<h4 id="example">Example:</h4>
<pre><code>query.comment(&#39;login query&#39;)
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.countDocuments()"><a href="#Query.prototype.countDocuments()"><code>Query.prototype.countDocuments()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> mongodb selector</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments">countDocuments</a></span></li></ul><div><p>Specifies this query as a <code>countDocuments()</code> query. Behaves like <code>count()</code>,
except it always does a full collection scan when passed an empty filter <code>{}</code>.</p>
<p>There are also minor differences in how <code>countDocuments()</code> handles
<a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments"><code>$where</code> and a couple geospatial operators</a>.
versus <code>count()</code>.</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>countDocuments()</code></li>
</ul>
<h4 id="example">Example:</h4>
<pre><code>const countQuery = model.where({ &#39;color&#39;: &#39;black&#39; }).countDocuments();

query.countDocuments({ color: &#39;black&#39; }).count().exec();

await query.countDocuments({ color: &#39;black&#39; });

query.where(&#39;color&#39;, &#39;black&#39;).countDocuments().exec();
</code></pre>
<p>The <code>countDocuments()</code> function is similar to <code>count()</code>, but there are a
<a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments">few operators that <code>countDocuments()</code> does not support</a>.
Below are the operators that <code>count()</code> supports but <code>countDocuments()</code> does not,
and the suggested replacement:</p>
<ul>
<li><code>$where</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/expr/"><code>$expr</code></a></li>
<li><code>$near</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/center/#op._S_center"><code>$center</code></a></li>
<li><code>$nearSphere</code>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/geoWithin/"><code>$geoWithin</code></a> with <a href="https://www.mongodb.com/docs/manual/reference/operator/query/centerSphere/#op._S_centerSphere"><code>$centerSphere</code></a></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.cursor()"><a href="#Query.prototype.cursor()"><code>Query.prototype.cursor()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;QueryCursor&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/querycursor.html">QueryCursor</a></span></li></ul><div><p>Returns a wrapper around a <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/FindCursor.html">mongodb driver cursor</a>.
A QueryCursor exposes a Streams3 interface, as well as a <code>.next()</code> function.</p>
<p>The <code>.cursor()</code> function triggers pre find hooks, but <strong>not</strong> post find hooks.</p>
<h4 id="example">Example:</h4>
<pre><code>// There are 2 ways to use a cursor. First, as a stream:
Thing.
  find({ name: /^hello/ }).
  cursor().
  on(&#39;data&#39;, function(doc) { console.log(doc); }).
  on(&#39;end&#39;, function() { console.log(&#39;Done!&#39;); });

// Or you can use `.next()` to manually get the next doc in the stream.
// `.next()` returns a promise, so you can use promises or callbacks.
const cursor = Thing.find({ name: /^hello/ }).cursor();
cursor.next(function(error, doc) {
  console.log(doc);
});

// Because `.next()` returns a promise, you can use co
// to easily iterate through all documents without loading them
// all into memory.
const cursor = Thing.find({ name: /^hello/ }).cursor();
for (let doc = await cursor.next(); doc != null; doc = await cursor.next()) {
  console.log(doc);
}
</code></pre>
<h4 id="valid-options">Valid options</h4>
<ul>
<li><code>transform</code>: optional function which accepts a mongoose document. The return value of the function will be emitted on <code>data</code> and returned by <code>.next()</code>.</li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.deleteMany()"><a href="#Query.prototype.deleteMany()"><code>Query.prototype.deleteMany()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object|Query&raquo;</span> mongodb selector</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="#Query.prototype.setOptions()"><code>Query.prototype.setOptions()</code></a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/DeleteResult.html">DeleteResult</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteMany">deleteMany</a></span></li></ul><div><p>Declare and/or execute this query as a <code>deleteMany()</code> operation. Works like
remove, except it deletes <em>every</em> document that matches <code>filter</code> in the
collection, regardless of the value of <code>single</code>.</p>
<p>This function triggers <code>deleteMany</code> middleware.</p>
<h4 id="example">Example:</h4>
<pre><code>await Character.deleteMany({ name: /Stark/, age: { $gte: 18 } });
</code></pre>
<p>This function calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteMany"><code>Collection#deleteMany()</code> function</a>.
The returned <a href="/docs/queries.html">promise</a> resolves to an
object that contains 3 properties:</p>
<ul>
<li><code>ok</code>: <code>1</code> if no errors occurred</li>
<li><code>deletedCount</code>: the number of documents deleted</li>
<li><code>n</code>: the number of documents deleted. Equal to <code>deletedCount</code>.</li>
</ul>
<h4 id="example-1">Example:</h4>
<pre><code>const res = await Character.deleteMany({ name: /Stark/, age: { $gte: 18 } });
// `0` if no docs matched the filter, number of docs deleted otherwise
res.deletedCount;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.deleteOne()"><a href="#Query.prototype.deleteOne()"><code>Query.prototype.deleteOne()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object|Query&raquo;</span> mongodb selector</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> optional see <a href="#Query.prototype.setOptions()"><code>Query.prototype.setOptions()</code></a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/DeleteResult.html">DeleteResult</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteOne">deleteOne</a></span></li></ul><div><p>Declare and/or execute this query as a <code>deleteOne()</code> operation. Works like
remove, except it deletes at most one document regardless of the <code>single</code>
option.</p>
<p>This function triggers <code>deleteOne</code> middleware.</p>
<h4 id="example">Example:</h4>
<pre><code>await Character.deleteOne({ name: &#39;Eddard Stark&#39; });
</code></pre>
<p>This function calls the MongoDB driver&#39;s <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteOne"><code>Collection#deleteOne()</code> function</a>.
The returned <a href="/docs/queries.html">promise</a> resolves to an
object that contains 3 properties:</p>
<ul>
<li><code>ok</code>: <code>1</code> if no errors occurred</li>
<li><code>deletedCount</code>: the number of documents deleted</li>
<li><code>n</code>: the number of documents deleted. Equal to <code>deletedCount</code>.</li>
</ul>
<h4 id="example-1">Example:</h4>
<pre><code>const res = await Character.deleteOne({ name: &#39;Eddard Stark&#39; });
// `1` if MongoDB deleted a doc, `0` if no docs matched the filter `{ name: ... }`
res.deletedCount;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.distinct()"><a href="#Query.prototype.distinct()"><code>Query.prototype.distinct()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[field]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object|Query&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.distinct/">distinct</a></span></li></ul><div><p>Declares or executes a distinct() operation.</p>
<p>This function does not trigger any middleware.</p>
<h4 id="example">Example:</h4>
<pre><code>distinct(field, conditions)
distinct(field)
distinct()
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.elemMatch()"><a href="#Query.prototype.elemMatch()"><code>Query.prototype.elemMatch()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;String|Object|Function&raquo;</span> </li><li class="param"><code>filter</code>
<span class="method-type">&laquo;Object|Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/elemMatch/">$elemMatch</a></span></li></ul><div><p>Specifies an <code>$elemMatch</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>query.elemMatch(&#39;comment&#39;, { author: &#39;autobot&#39;, votes: {$gte: 5}})

query.where(&#39;comment&#39;).elemMatch({ author: &#39;autobot&#39;, votes: {$gte: 5}})

query.elemMatch(&#39;comment&#39;, function (elem) {
  elem.where(&#39;author&#39;).equals(&#39;autobot&#39;);
  elem.where(&#39;votes&#39;).gte(5);
})

query.where(&#39;comment&#39;).elemMatch(function (elem) {
  elem.where({ author: &#39;autobot&#39; });
  elem.where(&#39;votes&#39;).gte(5);
})
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.equals()"><a href="#Query.prototype.equals()"><code>Query.prototype.equals()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies the complementary comparison value for paths specified with <code>where()</code></p>
<h4 id="example">Example:</h4>
<pre><code>User.where(&#39;age&#39;).equals(49);

// is the same as

User.where(&#39;age&#39;, 49);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.error()"><a href="#Query.prototype.error()"><code>Query.prototype.error()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>err</code>
<span class="method-type">&laquo;Error|null&raquo;</span> if set, <code>exec()</code> will fail fast before sending the query to MongoDB</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Gets/sets the error flag on this query. If this flag is not null or
undefined, the <code>exec()</code> promise will reject without executing.</p>
<h4 id="example">Example:</h4>
<pre><code>Query().error(); // Get current error value
Query().error(null); // Unset the current error
Query().error(new Error(&#39;test&#39;)); // `exec()` will resolve with test
Schema.pre(&#39;find&#39;, function() {
  if (!this.getQuery().userId) {
    this.error(new Error(&#39;Not allowed to query without setting userId&#39;));
  }
});
</code></pre>
<p>Note that query casting runs <strong>after</strong> hooks, so cast errors will override
custom errors.</p>
<h4 id="example-1">Example:</h4>
<pre><code>const TestSchema = new Schema({ num: Number });
const TestModel = db.model(&#39;Test&#39;, TestSchema);
TestModel.find({ num: &#39;not a number&#39; }).error(new Error(&#39;woops&#39;)).exec(function(error) {
  // `error` will be a cast error because `num` failed to cast
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.estimatedDocumentCount()"><a href="#Query.prototype.estimatedDocumentCount()"><code>Query.prototype.estimatedDocumentCount()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> passed transparently to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/EstimatedDocumentCountOptions.html">MongoDB driver</a></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#estimatedDocumentCount">estimatedDocumentCount</a></span></li></ul><div><p>Specifies this query as a <code>estimatedDocumentCount()</code> query. Faster than
using <code>countDocuments()</code> for large collections because
<code>estimatedDocumentCount()</code> uses collection metadata rather than scanning
the entire collection.</p>
<p><code>estimatedDocumentCount()</code> does <strong>not</strong> accept a filter. <code>Model.find({ foo: bar }).estimatedDocumentCount()</code>
is equivalent to <code>Model.find().estimatedDocumentCount()</code></p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>estimatedDocumentCount()</code></li>
</ul>
<h4 id="example">Example:</h4>
<pre><code>await Model.find().estimatedDocumentCount();
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.exec()"><a href="#Query.prototype.exec()"><code>Query.prototype.exec()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[operation]</code>
<span class="method-type">&laquo;String|Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query</p>
<h4 id="example">Example:</h4>
<pre><code>const promise = query.exec();
const promise = query.exec(&#39;update&#39;);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.exists()"><a href="#Query.prototype.exists()"><code>Query.prototype.exists()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/exists/">$exists</a></span></li></ul><div><p>Specifies an <code>$exists</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>// { name: { $exists: true }}
Thing.where(&#39;name&#39;).exists()
Thing.where(&#39;name&#39;).exists(true)
Thing.find().exists(&#39;name&#39;)

// { name: { $exists: false }}
Thing.where(&#39;name&#39;).exists(false);
Thing.find().exists(&#39;name&#39;, false);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.explain()"><a href="#Query.prototype.explain()"><code>Query.prototype.explain()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[verbose]</code>
<span class="method-type">&laquo;String&raquo;</span> The verbosity mode. Either &#39;queryPlanner&#39;, &#39;executionStats&#39;, or &#39;allPlansExecution&#39;. The default is &#39;queryPlanner&#39;</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.explain/"><code>explain</code> option</a>,
which makes this query return detailed execution stats instead of the actual
query result. This method is useful for determining what index your queries
use.</p>
<p>Calling <code>query.explain(v)</code> is equivalent to <code>query.setOptions({ explain: v })</code></p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
const res = await query.find({ a: 1 }).explain(&#39;queryPlanner&#39;);
console.log(res);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.finally()"><a href="#Query.prototype.finally()"><code>Query.prototype.finally()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[onFinally]</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with <code>.finally()</code> chained.</p>
<p>More about <a href="https://thecodebarbarian.com/using-promise-finally-in-node-js.html">Promise <code>finally()</code> in JavaScript</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.find()"><a href="#Query.prototype.find()"><code>Query.prototype.find()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object|ObjectId&raquo;</span> mongodb filter. If not specified, returns all documents.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Find all documents that match <code>selector</code>. The result will be an array of documents.</p>
<p>If there are too many documents in the result to fit in memory, use
<a href="#Query.prototype.cursor()"><code>Query.prototype.cursor()</code></a></p>
<h4 id="example">Example:</h4>
<pre><code>const arr = await Movie.find({ year: { $gte: 1980, $lte: 1989 } });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.findOne()"><a href="#Query.prototype.findOne()"><code>Query.prototype.findOne()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> mongodb selector</p>
</li><li class="param"><code>[projection]</code>
<span class="method-type">&laquo;Object&raquo;</span> optional fields to return</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> see <a href="#Query.prototype.setOptions()"><code>setOptions()</code></a></p>
</li><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOne/">findOne</a></span></li><li><span class="method-type"><a href="#Query.prototype.select()">Query.select</a></span></li></ul><div><p>Declares the query a findOne operation. When executed, the first found document is passed to the callback.</p>
<p>The result of the query is a single document, or <code>null</code> if no document was found.</p>
<ul>
<li><em>Note:</em> <code>conditions</code> is optional, and if <code>conditions</code> is null or undefined,
mongoose will send an empty <code>findOne</code> command to MongoDB, which will return
an arbitrary document. If you&#39;re querying by <code>_id</code>, use <code>Model.findById()</code>
instead.</li>
</ul>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOne()</code></li>
</ul>
<h4 id="example">Example:</h4>
<pre><code>const query = Kitten.where({ color: &#39;white&#39; });
const kitten = await query.findOne();
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.findOneAndDelete()"><a href="#Query.prototype.findOneAndDelete()"><code>Query.prototype.findOneAndDelete()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.includeResultMetadata]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the full <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">ModifyResult from the MongoDB driver</a> rather than just the document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session=null]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/findAndModify/">findAndModify command</a></span></li></ul><div><p>Issues a MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndDelete/">findOneAndDelete</a> command.</p>
<p>Finds a matching document, removes it, and returns the found document (if any).</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndDelete()</code></li>
</ul>
<h4 id="available-options">Available options</h4>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
</ul>
<h4 id="callback-signature">Callback Signature</h4>
<pre><code>function(error, doc) {
  // error: any errors that occurred
  // doc: the document before updates are applied if `new: false`, or after updates if `new = true`
}
</code></pre>
<h4 id="example">Example:</h4>
<pre><code>A.where().findOneAndDelete(conditions, options)  // return Query
A.where().findOneAndDelete(conditions) // returns Query
A.where().findOneAndDelete()           // returns Query
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.findOneAndReplace()"><a href="#Query.prototype.findOneAndReplace()"><code>Query.prototype.findOneAndReplace()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[replacement]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.includeResultMetadata]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the full <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">ModifyResult from the MongoDB driver</a> rather than just the document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session=null]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.new=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>findOneAndUpdate()</code> returns the document as it was <strong>before</strong> <code>update</code> was applied. If you set <code>new: true</code>, <code>findOneAndUpdate()</code> will instead give you the object after <code>update</code> was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.lean]</code>
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="#Query.prototype.lean()"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session=null]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.timestamps=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.returnOriginal=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> An alias for the <code>new</code> option. <code>returnOriginal: false</code> is equivalent to <code>new: true</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Issues a MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndReplace/">findOneAndReplace</a> command.</p>
<p>Finds a matching document, removes it, and returns the found document (if any).</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndReplace()</code></li>
</ul>
<h4 id="available-options">Available options</h4>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>includeResultMetadata</code>: if true, returns the full <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">ModifyResult from the MongoDB driver</a> rather than just the document</li>
</ul>
<h4 id="callback-signature">Callback Signature</h4>
<pre><code>function(error, doc) {
  // error: any errors that occurred
  // doc: the document before updates are applied if `new: false`, or after updates if `new = true`
}
</code></pre>
<h4 id="example">Example:</h4>
<pre><code>A.where().findOneAndReplace(filter, replacement, options); // return Query
A.where().findOneAndReplace(filter); // returns Query
A.where().findOneAndReplace(); // returns Query
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.findOneAndUpdate()"><a href="#Query.prototype.findOneAndUpdate()"><code>Query.prototype.findOneAndUpdate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object|Query&raquo;</span> </li><li class="param"><code>[doc]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.includeResultMetadata]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, returns the full <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">ModifyResult from the MongoDB driver</a> rather than just the document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session=null]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.multipleCastError]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.new=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> By default, <code>findOneAndUpdate()</code> returns the document as it was <strong>before</strong> <code>update</code> was applied. If you set <code>new: true</code>, <code>findOneAndUpdate()</code> will instead give you the object after <code>update</code> was applied.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.lean]</code>
<span class="method-type">&laquo;Object&raquo;</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="#Query.prototype.lean()"><code>Query.lean()</code></a> and <a href="/docs/tutorials/lean.html">the Mongoose lean tutorial</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.session=null]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> The session associated with this query. See <a href="/docs/transactions.html">transactions docs</a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.timestamps=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.returnOriginal=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> An alias for the <code>new</code> option. <code>returnOriginal: false</code> is equivalent to <code>new: true</code>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.overwriteDiscriminatorKey=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose removes discriminator key updates from <code>update</code> by default, set <code>overwriteDiscriminatorKey</code> to <code>true</code> to allow updating the discriminator key</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/tutorials/findoneandupdate.html">Tutorial</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/findAndModify/">findAndModify command</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html">ModifyResult</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#findOneAndUpdate">findOneAndUpdate</a></span></li></ul><div><p>Issues a mongodb <code>findOneAndUpdate()</code> command.</p>
<p>Finds a matching document, updates it according to the <code>update</code> arg, passing any <code>options</code>, and returns the found
document (if any).</p>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>findOneAndUpdate()</code></li>
</ul>
<h4 id="available-options">Available options</h4>
<ul>
<li><code>new</code>: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)</li>
<li><code>upsert</code>: bool - creates the object if it doesn&#39;t exist. defaults to false.</li>
<li><code>fields</code>: {Object|String} - Field selection. Equivalent to <code>.select(fields).findOneAndUpdate()</code></li>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>runValidators</code>: if true, runs <a href="/docs/validation.html#update-validators">update validators</a> on this command. Update validators validate the update operation against the model&#39;s schema.</li>
<li><code>setDefaultsOnInsert</code>: <code>true</code> by default. If <code>setDefaultsOnInsert</code> and <code>upsert</code> are true, mongoose will apply the <a href="/docs/defaults.html">defaults</a> specified in the model&#39;s schema if a new document is created.</li>
</ul>
<h4 id="example">Example:</h4>
<pre><code>query.findOneAndUpdate(conditions, update, options)  // returns Query
query.findOneAndUpdate(conditions, update)           // returns Query
query.findOneAndUpdate(update)                       // returns Query
query.findOneAndUpdate()                             // returns Query
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.geometry()"><a href="#Query.prototype.geometry()"><code>Query.prototype.geometry()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>object</code>
<span class="method-type">&laquo;Object&raquo;</span> Must contain a <code>type</code> property which is a String and a <code>coordinates</code> property which is an Array. See the examples.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geometry/">$geometry</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/release-notes/2.4/#geospatial-support-enhancements">Geospatial Support Enhancements</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li></ul><div><p>Specifies a <code>$geometry</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>const polyA = [[[ 10, 20 ], [ 10, 40 ], [ 30, 40 ], [ 30, 20 ]]]
query.where(&#39;loc&#39;).within().geometry({ type: &#39;Polygon&#39;, coordinates: polyA })

// or
const polyB = [[ 0, 0 ], [ 1, 1 ]]
query.where(&#39;loc&#39;).within().geometry({ type: &#39;LineString&#39;, coordinates: polyB })

// or
const polyC = [ 0, 0 ]
query.where(&#39;loc&#39;).within().geometry({ type: &#39;Point&#39;, coordinates: polyC })

// or
query.where(&#39;loc&#39;).intersects().geometry({ type: &#39;Point&#39;, coordinates: polyC })
</code></pre>
<p>The argument is assigned to the most recent path passed to <code>where()</code>.</p>
<h4 id="note">Note:</h4>
<p><code>geometry()</code> <strong>must</strong> come after either <code>intersects()</code> or <code>within()</code>.</p>
<p>The <code>object</code> argument must contain <code>type</code> and <code>coordinates</code> properties.</p>
<ul>
<li>type {String}</li>
<li>coordinates {Array}</li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.get()"><a href="#Query.prototype.get()"><code>Query.prototype.get()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/value pairs to get</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>For update operations, returns the value of a path in the update&#39;s <code>$set</code>.
Useful for writing getters/setters that can work with both update operations
and <code>save()</code>.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = Model.updateOne({}, { $set: { name: &#39;Jean-Luc Picard&#39; } });
query.get(&#39;name&#39;); // &#39;Jean-Luc Picard&#39;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.getFilter()"><a href="#Query.prototype.getFilter()"><code>Query.prototype.getFilter()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current query filter</li></ul><div><p>Returns the current query filter (also known as conditions) as a <a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a>.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.find({ a: 1 }).where(&#39;b&#39;).gt(2);
query.getFilter(); // { a: 1, b: { $gt: 2 } }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.getOptions()"><a href="#Query.prototype.getOptions()"><code>Query.prototype.getOptions()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the options</li></ul><div><p>Gets query options.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.limit(10);
query.setOptions({ maxTimeMS: 1000 });
query.getOptions(); // { limit: 10, maxTimeMS: 1000 }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.getPopulatedPaths()"><a href="#Query.prototype.getPopulatedPaths()"><code>Query.prototype.getPopulatedPaths()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Array&raquo;</span> an array of strings representing populated paths</li></ul><div><p>Gets a list of paths to be populated by this query</p>
<h4 id="example">Example:</h4>
<pre><code> bookSchema.pre(&#39;findOne&#39;, function() {
   let keys = this.getPopulatedPaths(); // [&#39;author&#39;]
 });
 ...
 Book.findOne({}).populate(&#39;author&#39;);
</code></pre>
<h4 id="example-1">Example:</h4>
<pre><code> // Deep populate
 const q = L1.find().populate({
   path: &#39;level2&#39;,
   populate: { path: &#39;level3&#39; }
 });
 q.getPopulatedPaths(); // [&#39;level2&#39;, &#39;level2.level3&#39;]
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.getQuery()"><a href="#Query.prototype.getQuery()"><code>Query.prototype.getQuery()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current query filter</li></ul><div><p>Returns the current query filter. Equivalent to <code>getFilter()</code>.</p>
<p>You should use <code>getFilter()</code> instead of <code>getQuery()</code> where possible. <code>getQuery()</code>
will likely be deprecated in a future release.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.find({ a: 1 }).where(&#39;b&#39;).gt(2);
query.getQuery(); // { a: 1, b: { $gt: 2 } }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.getUpdate()"><a href="#Query.prototype.getUpdate()"><code>Query.prototype.getUpdate()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> current update operations</li></ul><div><p>Returns the current update operations as a JSON object.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.updateOne({}, { $set: { a: 5 } });
query.getUpdate(); // { $set: { a: 5 } }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.gt()"><a href="#Query.prototype.gt()"><code>Query.prototype.gt()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/gt/">$gt</a></span></li></ul><div><p>Specifies a <code>$gt</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">Example:</h4>
<pre><code>Thing.find().where(&#39;age&#39;).gt(21);

// or
Thing.find().gt(&#39;age&#39;, 21);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.gte()"><a href="#Query.prototype.gte()"><code>Query.prototype.gte()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/gte/">$gte</a></span></li></ul><div><p>Specifies a <code>$gte</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.hint()"><a href="#Query.prototype.hint()"><code>Query.prototype.hint()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Object&raquo;</span> a hint object</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/hint/">$hint</a></span></li></ul><div><p>Sets query hints.</p>
<h4 id="example">Example:</h4>
<pre><code>query.hint({ indexA: 1, indexB: -1 });
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.in()"><a href="#Query.prototype.in()"><code>Query.prototype.in()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/in/">$in</a></span></li></ul><div><p>Specifies an <code>$in</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.intersects()"><a href="#Query.prototype.intersects()"><code>Query.prototype.intersects()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[arg]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geometry/">$geometry</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geoIntersects/">geoIntersects</a></span></li></ul><div><p>Declares an intersects query for <code>geometry()</code>.</p>
<h4 id="example">Example:</h4>
<pre><code>query.where(&#39;path&#39;).intersects().geometry({
  type: &#39;LineString&#39;,
  coordinates: [[180.0, 11.0], [180, 9.0]]
});

query.where(&#39;path&#39;).intersects({
  type: &#39;LineString&#39;,
  coordinates: [[180.0, 11.0], [180, 9.0]]
});
</code></pre>
<h4 id="note">Note:</h4>
<p><strong>MUST</strong> be used after <code>where()</code>.</p>
<h4 id="note-1">Note:</h4>
<p>In Mongoose 3.7, <code>intersects</code> changed from a getter to a function. If you need the old syntax, use <a href="https://github.com/ebensing/mongoose-within">this</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.isPathSelectedInclusive()"><a href="#Query.prototype.isPathSelectedInclusive()"><code>Query.prototype.isPathSelectedInclusive()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;String&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Wrapper function to call isPathSelectedInclusive on a query.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.j()"><a href="#Query.prototype.j()"><code>Query.prototype.j()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/write-concern/#j-option">mongodb</a></span></li></ul><div><p>Requests acknowledgement that this operation has been persisted to MongoDB&#39;s
on-disk journal.
This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.j</code> option</a></p>
<h4 id="example">Example:</h4>
<pre><code>await mongoose.model(&#39;Person&#39;).deleteOne({ name: &#39;Ned Stark&#39; }).j(true);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.lean()"><a href="#Query.prototype.lean()"><code>Query.prototype.lean()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean|Object&raquo;</span> defaults to true</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the lean option.</p>
<p>Documents returned from queries with the <code>lean</code> option enabled are plain
javascript objects, not <a href="/docs/api/document.html">Mongoose Documents</a>. They have no
<code>save</code> method, getters/setters, virtuals, or other Mongoose features.</p>
<h4 id="example">Example:</h4>
<pre><code>new Query().lean() // true
new Query().lean(true)
new Query().lean(false)

const docs = await Model.find().lean();
docs[0] instanceof mongoose.Document; // false
</code></pre>
<p><a href="/docs/tutorials/lean.html">Lean is great for high-performance, read-only cases</a>,
especially when combined
with <a href="/docs/queries.html#streaming">cursors</a>.</p>
<p>If you need virtuals, getters/setters, or defaults with <code>lean()</code>, you need
to use a plugin. See:</p>
<ul>
<li><a href="https://plugins.mongoosejs.io/plugins/lean-virtuals">mongoose-lean-virtuals</a></li>
<li><a href="https://plugins.mongoosejs.io/plugins/lean-getters">mongoose-lean-getters</a></li>
<li><a href="https://www.npmjs.com/package/mongoose-lean-defaults">mongoose-lean-defaults</a></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.limit()"><a href="#Query.prototype.limit()"><code>Query.prototype.limit()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><div><p>Specifies the maximum number of documents the query will return.</p>
<h4 id="example">Example:</h4>
<pre><code>query.limit(20);
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.lt()"><a href="#Query.prototype.lt()"><code>Query.prototype.lt()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/lt/">$lt</a></span></li></ul><div><p>Specifies a <code>$lt</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.lte()"><a href="#Query.prototype.lte()"><code>Query.prototype.lte()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/lte/">$lte</a></span></li></ul><div><p>Specifies a <code>$lte</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.maxDistance()"><a href="#Query.prototype.maxDistance()"><code>Query.prototype.maxDistance()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/maxDistance/">$maxDistance</a></span></li></ul><div><p>Specifies a <code>maxDistance</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.maxTimeMS()"><a href="#Query.prototype.maxTimeMS()"><code>Query.prototype.maxTimeMS()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[ms]</code>
<span class="method-type">&laquo;Number&raquo;</span> The number of milliseconds</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.maxTimeMS/">maxTimeMS</a>
option. This will tell the MongoDB server to abort if the query or write op
has been running for more than <code>ms</code> milliseconds.</p>
<p>Calling <code>query.maxTimeMS(v)</code> is equivalent to <code>query.setOptions({ maxTimeMS: v })</code></p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
// Throws an error &#39;operation exceeded time limit&#39; as long as there&#39;s
// &gt;= 1 doc in the queried collection
const res = await query.find({ $where: &#39;sleep(1000) || true&#39; }).maxTimeMS(100);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.merge()"><a href="#Query.prototype.merge()"><code>Query.prototype.merge()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>source</code>
<span class="method-type">&laquo;Query|Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Merges another Query or conditions object into this one.</p>
<p>When a Query is passed, conditions, field selection and options are merged.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.mod()"><a href="#Query.prototype.mod()"><code>Query.prototype.mod()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Array&raquo;</span> must be of length 2, first element is <code>divisor</code>, 2nd element is <code>remainder</code>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/mod/">$mod</a></span></li></ul><div><p>Specifies a <code>$mod</code> condition, filters documents for documents whose
<code>path</code> property is a number that is equal to <code>remainder</code> modulo <code>divisor</code>.</p>
<h4 id="example">Example:</h4>
<pre><code>// All find products whose inventory is odd
Product.find().mod(&#39;inventory&#39;, [2, 1]);
Product.find().where(&#39;inventory&#39;).mod([2, 1]);
// This syntax is a little strange, but supported.
Product.find().where(&#39;inventory&#39;).mod(2, 1);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.model"><a href="#Query.prototype.model"><code>Query.prototype.model</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The model this query is associated with.</p>
<h4 id="example">Example:</h4>
<pre><code>const q = MyModel.find();
q.model === MyModel; // true
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.mongooseOptions()"><a href="#Query.prototype.mongooseOptions()"><code>Query.prototype.mongooseOptions()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>options</code>
<span class="method-type">&laquo;Object&raquo;</span> if specified, overwrites the current options</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the options</li></ul><div><p>Getter/setter around the current mongoose-specific options for this query
Below are the current Mongoose-specific options.</p>
<ul>
<li><code>populate</code>: an array representing what paths will be populated. Should have one entry for each call to <a href="#Query.prototype.populate()"><code>Query.prototype.populate()</code></a></li>
<li><code>lean</code>: if truthy, Mongoose will not <a href="/docs/api/model.html#Model.hydrate()">hydrate</a> any documents that are returned from this query. See <a href="#Query.prototype.lean()"><code>Query.prototype.lean()</code></a> for more information.</li>
<li><code>strict</code>: controls how Mongoose handles keys that aren&#39;t in the schema for updates. This option is <code>true</code> by default, which means Mongoose will silently strip any paths in the update that aren&#39;t in the schema. See the <a href="/docs/guide.html#strict"><code>strict</code> mode docs</a> for more information.</li>
<li><code>strictQuery</code>: controls how Mongoose handles keys that aren&#39;t in the schema for the query <code>filter</code>. This option is <code>false</code> by default, which means Mongoose will allow <code>Model.find({ foo: &#39;bar&#39; })</code> even if <code>foo</code> is not in the schema. See the <a href="/docs/guide.html#strictQuery"><code>strictQuery</code> docs</a> for more information.</li>
<li><code>nearSphere</code>: use <code>$nearSphere</code> instead of <code>near()</code>. See the <a href="#Query.prototype.nearSphere()"><code>Query.prototype.nearSphere()</code> docs</a></li>
</ul>
<p>Mongoose maintains a separate object for internal options because
Mongoose sends <code>Query.prototype.options</code> to the MongoDB server, and the
above options are not relevant for the MongoDB server.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.ne()"><a href="#Query.prototype.ne()"><code>Query.prototype.ne()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;any&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/ne/">$ne</a></span></li></ul><div><p>Specifies a <code>$ne</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.near()"><a href="#Query.prototype.near()"><code>Query.prototype.near()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/near/">$near</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/nearSphere/">$nearSphere</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/maxDistance/">$maxDistance</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li></ul><div><p>Specifies a <code>$near</code> or <code>$nearSphere</code> condition</p>
<p>These operators return documents sorted by distance.</p>
<h4 id="example">Example:</h4>
<pre><code>query.where(&#39;loc&#39;).near({ center: [10, 10] });
query.where(&#39;loc&#39;).near({ center: [10, 10], maxDistance: 5 });
query.where(&#39;loc&#39;).near({ center: [10, 10], maxDistance: 5, spherical: true });
query.near(&#39;loc&#39;, { center: [10, 10], maxDistance: 5 });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.nearSphere()"><a href="#Query.prototype.nearSphere()"><code>Query.prototype.nearSphere()</code></a></h3><span class="deprecated">~DEPRECATED~</span><h5>See:</h5><ul><li><span class="method-type"><a href="#Query.prototype.near()">near()</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/near/">$near</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/nearSphere/">$nearSphere</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/maxDistance/">$maxDistance</a></span></li></ul><div><p><em>DEPRECATED</em> Specifies a <code>$nearSphere</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>query.where(&#39;loc&#39;).nearSphere({ center: [10, 10], maxDistance: 5 });
</code></pre>
<p><strong>Deprecated.</strong> Use <code>query.near()</code> instead with the <code>spherical</code> option set to <code>true</code>.</p>
<h4 id="example-1">Example:</h4>
<pre><code>query.where(&#39;loc&#39;).near({ center: [10, 10], spherical: true });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.nin()"><a href="#Query.prototype.nin()"><code>Query.prototype.nin()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Array&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/nin/">$nin</a></span></li></ul><div><p>Specifies an <code>$nin</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.nor()"><a href="#Query.prototype.nor()"><code>Query.prototype.nor()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>array</code>
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/nor/">$nor</a></span></li></ul><div><p>Specifies arguments for a <code>$nor</code> condition.</p>
<h4 id="example">Example:</h4>
<pre><code>query.nor([{ color: &#39;green&#39; }, { status: &#39;ok&#39; }]);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.or()"><a href="#Query.prototype.or()"><code>Query.prototype.or()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>array</code>
<span class="method-type">&laquo;Array&raquo;</span> array of conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/or/">$or</a></span></li></ul><div><p>Specifies arguments for an <code>$or</code> condition.</p>
<h4 id="example">Example:</h4>
<pre><code>query.or([{ color: &#39;red&#39; }, { status: &#39;emergency&#39; }]);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.orFail()"><a href="#Query.prototype.orFail()"><code>Query.prototype.orFail()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[err]</code>
<span class="method-type">&laquo;Function|Error&raquo;</span> optional error to throw if no docs match <code>filter</code>. If not specified, <code>orFail()</code> will throw a <code>DocumentNotFoundError</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Make this query throw an error if no documents match the given <code>filter</code>.
This is handy for integrating with async/await, because <code>orFail()</code> saves you
an extra <code>if</code> statement to check if no document was found.</p>
<h4 id="example">Example:</h4>
<pre><code>// Throws if no doc returned
await Model.findOne({ foo: &#39;bar&#39; }).orFail();

// Throws if no document was updated. Note that `orFail()` will still
// throw if the only document that matches is `{ foo: &#39;bar&#39;, name: &#39;test&#39; }`,
// because `orFail()` will throw if no document was _updated_, not
// if no document was _found_.
await Model.updateOne({ foo: &#39;bar&#39; }, { name: &#39;test&#39; }).orFail();

// Throws &quot;No docs found!&quot; error if no docs match `{ foo: &#39;bar&#39; }`
await Model.find({ foo: &#39;bar&#39; }).orFail(new Error(&#39;No docs found!&#39;));

// Throws &quot;Not found&quot; error if no document was found
await Model.findOneAndUpdate({ foo: &#39;bar&#39; }, { name: &#39;test&#39; }).
  orFail(() =&gt; Error(&#39;Not found&#39;));
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.polygon()"><a href="#Query.prototype.polygon()"><code>Query.prototype.polygon()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String|Array&raquo;</span> </li><li class="param"><code>[...coordinatePairs]</code>
<span class="method-type">&laquo;Array|Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/polygon/">$polygon</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/core/geospatial-indexes/">MongoDB Geospatial Indexing</a></span></li></ul><div><p>Specifies a <code>$polygon</code> condition</p>
<h4 id="example">Example:</h4>
<pre><code>query.where(&#39;loc&#39;).within().polygon([10, 20], [13, 25], [7, 15]);
query.polygon(&#39;loc&#39;, [10, 20], [13, 25], [7, 15]);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.populate()"><a href="#Query.prototype.populate()"><code>Query.prototype.populate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> either the path(s) to populate or an object specifying all parameters</p>
</li><li class="param"><code>[select]</code>
<span class="method-type">&laquo;Object|String&raquo;</span> Field selection for the population query</p>
</li><li class="param"><code>[model]</code>
<span class="method-type">&laquo;Model&raquo;</span> The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema&#39;s <code>ref</code> field.</p>
</li><li class="param"><code>[match]</code>
<span class="method-type">&laquo;Object&raquo;</span> Conditions for the population query</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> Options for the population query (sort, etc)</p>
</li><ul style="margin-top: 0.5em"><li><code>[options.path=null]</code>
<span class="method-type">&laquo;String&raquo;</span> The path to populate.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.retainNullValues=false]</code>
<span class="method-type">&laquo;boolean&raquo;</span> by default, Mongoose removes null and undefined values from populated arrays. Use this option to make <code>populate()</code> retain <code>null</code> and <code>undefined</code> array entries.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.getters=false]</code>
<span class="method-type">&laquo;boolean&raquo;</span> if true, Mongoose will call any getters defined on the <code>localField</code>. By default, Mongoose gets the raw value of <code>localField</code>. For example, you would need to set this option to <code>true</code> if you wanted to <a href="/docs/schematypes.html#schematype-options">add a <code>lowercase</code> getter to your <code>localField</code></a>.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.clone=false]</code>
<span class="method-type">&laquo;boolean&raquo;</span> When you do <code>BlogPost.find().populate(&#39;author&#39;)</code>, blog posts with the same author will share 1 copy of an <code>author</code> doc. Enable this option to make Mongoose clone populated docs before assigning them.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.match=null]</code>
<span class="method-type">&laquo;Object|Function&raquo;</span> Add an additional filter to the populate query. Can be a filter object containing <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/">MongoDB query syntax</a>, or a function that returns a filter object.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.transform=null]</code>
<span class="method-type">&laquo;Function&raquo;</span> Function that Mongoose will call on every populated document that allows you to transform the populated document.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.options=null]</code>
<span class="method-type">&laquo;Object&raquo;</span> Additional options like <code>limit</code> and <code>lean</code>.</p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/populate.html">population</a></span></li><li><span class="method-type"><a href="#Query.prototype.select()">Query#select</a></span></li><li><span class="method-type"><a href="/docs/api/model.html#Model.populate()">Model.populate</a></span></li></ul><div><p>Specifies paths which should be populated with other documents.</p>
<h4 id="example">Example:</h4>
<pre><code>let book = await Book.findOne().populate(&#39;authors&#39;);
book.title; // &#39;Node.js in Action&#39;
book.authors[0].name; // &#39;TJ Holowaychuk&#39;
book.authors[1].name; // &#39;Nathan Rajlich&#39;

let books = await Book.find().populate({
  path: &#39;authors&#39;,
  // `match` and `sort` apply to the Author model,
  // not the Book model. These options do not affect
  // which documents are in `books`, just the order and
  // contents of each book document&#39;s `authors`.
  match: { name: new RegExp(&#39;.*h.*&#39;, &#39;i&#39;) },
  sort: { name: -1 }
});
books[0].title; // &#39;Node.js in Action&#39;
// Each book&#39;s `authors` are sorted by name, descending.
books[0].authors[0].name; // &#39;TJ Holowaychuk&#39;
books[0].authors[1].name; // &#39;Marc Harter&#39;

books[1].title; // &#39;Professional AngularJS&#39;
// Empty array, no authors&#39; name has the letter &#39;h&#39;
books[1].authors; // []
</code></pre>
<p>Paths are populated after the query executes and a response is received. A
separate query is then executed for each path specified for population. After
a response for each query has also been returned, the results are passed to
the callback.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.post()"><a href="#Query.prototype.post()"><code>Query.prototype.post()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Add post <a href="/docs/middleware.html">middleware</a> to this query instance. Doesn&#39;t affect
other queries.</p>
<h4 id="example">Example:</h4>
<pre><code>const q1 = Question.find({ answer: 42 });
q1.post(function middleware() {
  console.log(this.getFilter());
});
await q1.exec(); // Prints &quot;{ answer: 42 }&quot;

// Doesn&#39;t print anything, because `middleware()` is only
// registered on `q1`.
await Question.find({ answer: 42 });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.pre()"><a href="#Query.prototype.pre()"><code>Query.prototype.pre()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Add pre <a href="/docs/middleware.html">middleware</a> to this query instance. Doesn&#39;t affect
other queries.</p>
<h4 id="example">Example:</h4>
<pre><code>const q1 = Question.find({ answer: 42 });
q1.pre(function middleware() {
  console.log(this.getFilter());
});
await q1.exec(); // Prints &quot;{ answer: 42 }&quot;

// Doesn&#39;t print anything, because `middleware()` is only
// registered on `q1`.
await Question.find({ answer: 42 });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.projection()"><a href="#Query.prototype.projection()"><code>Query.prototype.projection()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>arg</code>
<span class="method-type">&laquo;Object|null&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Object&raquo;</span> the current projection</li></ul><div><p>Get/set the current projection (AKA fields). Pass <code>null</code> to remove the
current projection.</p>
<p>Unlike <code>projection()</code>, the <code>select()</code> function modifies the current
projection in place. This function overwrites the existing projection.</p>
<h4 id="example">Example:</h4>
<pre><code>const q = Model.find();
q.projection(); // null

q.select(&#39;a b&#39;);
q.projection(); // { a: 1, b: 1 }

q.projection({ c: 1 });
q.projection(); // { c: 1 }

q.projection(null);
q.projection(); // null
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.read()"><a href="#Query.prototype.read()"><code>Query.prototype.read()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>mode</code>
<span class="method-type">&laquo;String&raquo;</span> one of the listed preference options or aliases</p>
</li><li class="param"><code>[tags]</code>
<span class="method-type">&laquo;Array&raquo;</span> optional tags for this query</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/applications/replication/#read-preference">mongodb</a></span></li></ul><div><p>Determines the MongoDB nodes from which to read.</p>
<h4 id="preferences">Preferences:</h4>
<pre><code>primary - (default) Read from primary only. Operations will produce an error if primary is unavailable. Cannot be combined with tags.
secondary            Read from secondary if available, otherwise error.
primaryPreferred     Read from primary if available, otherwise a secondary.
secondaryPreferred   Read from a secondary if available, otherwise read from the primary.
nearest              All operations read from among the nearest candidates, but unlike other modes, this option will include both the primary and all secondaries in the random selection.
</code></pre>
<p>Aliases</p>
<pre><code>p   primary
pp  primaryPreferred
s   secondary
sp  secondaryPreferred
n   nearest
</code></pre>
<h4 id="example">Example:</h4>
<pre><code>new Query().read(&#39;primary&#39;)
new Query().read(&#39;p&#39;)  // same as primary

new Query().read(&#39;primaryPreferred&#39;)
new Query().read(&#39;pp&#39;) // same as primaryPreferred

new Query().read(&#39;secondary&#39;)
new Query().read(&#39;s&#39;)  // same as secondary

new Query().read(&#39;secondaryPreferred&#39;)
new Query().read(&#39;sp&#39;) // same as secondaryPreferred

new Query().read(&#39;nearest&#39;)
new Query().read(&#39;n&#39;)  // same as nearest

// read from secondaries with matching tags
new Query().read(&#39;s&#39;, [{ dc:&#39;sf&#39;, s: 1 },{ dc:&#39;ma&#39;, s: 2 }])
</code></pre>
<p>Read more about how to use read preferences <a href="https://www.mongodb.com/docs/manual/applications/replication/#read-preference">here</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.readConcern()"><a href="#Query.prototype.readConcern()"><code>Query.prototype.readConcern()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>level</code>
<span class="method-type">&laquo;String&raquo;</span> one of the listed read concern level or their aliases</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/read-concern/">mongodb</a></span></li></ul><div><p>Sets the readConcern option for the query.</p>
<h4 id="example">Example:</h4>
<pre><code>new Query().readConcern(&#39;local&#39;)
new Query().readConcern(&#39;l&#39;)  // same as local

new Query().readConcern(&#39;available&#39;)
new Query().readConcern(&#39;a&#39;)  // same as available

new Query().readConcern(&#39;majority&#39;)
new Query().readConcern(&#39;m&#39;)  // same as majority

new Query().readConcern(&#39;linearizable&#39;)
new Query().readConcern(&#39;lz&#39;) // same as linearizable

new Query().readConcern(&#39;snapshot&#39;)
new Query().readConcern(&#39;s&#39;)  // same as snapshot
</code></pre>
<h4 id="read-concern-level">Read Concern Level:</h4>
<pre><code>local         MongoDB 3.2+ The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back).
available     MongoDB 3.6+ The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back).
majority      MongoDB 3.2+ The query returns the data that has been acknowledged by a majority of the replica set members. The documents returned by the read operation are durable, even in the event of failure.
linearizable  MongoDB 3.4+ The query returns data that reflects all successful majority-acknowledged writes that completed prior to the start of the read operation. The query may wait for concurrently executing writes to propagate to a majority of replica set members before returning results.
snapshot      MongoDB 4.0+ Only available for operations within multi-document transactions. Upon transaction commit with write concern &quot;majority&quot;, the transaction operations are guaranteed to have read from a snapshot of majority-committed data.
</code></pre>
<p>Aliases</p>
<pre><code>l   local
a   available
m   majority
lz  linearizable
s   snapshot
</code></pre>
<p>Read more about how to use read concern <a href="https://www.mongodb.com/docs/manual/reference/read-concern/">here</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.regex()"><a href="#Query.prototype.regex()"><code>Query.prototype.regex()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;String|RegExp&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/regex/">$regex</a></span></li></ul><div><p>Specifies a <code>$regex</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.replaceOne()"><a href="#Query.prototype.replaceOne()"><code>Query.prototype.replaceOne()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[doc]</code>
<span class="method-type">&laquo;Object&raquo;</span> the update command</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.multipleCastError]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.upsert=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.writeConcern=null]</code>
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.timestamps=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul><li class="param"><code>[callback]</code>
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/model.html#Model.update()">Model.update</a></span></li><li><span class="method-type"><a href="/docs/queries.html">Query docs</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">update</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html">UpdateResult</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output">MongoDB docs</a></span></li></ul><div><p>Declare and/or execute this query as a replaceOne() operation.
MongoDB will replace the existing document and will not accept any <a href="https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern">atomic operators</a> (<code>$set</code>, etc.)</p>
<p><strong>Note</strong> replaceOne will <em>not</em> fire update middleware. Use <code>pre(&#39;replaceOne&#39;)</code>
and <code>post(&#39;replaceOne&#39;)</code> instead.</p>
<h4 id="example">Example:</h4>
<pre><code>const res = await Person.replaceOne({ _id: 24601 }, { name: &#39;Jean Valjean&#39; });
res.acknowledged; // Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.
res.matchedCount; // Number of documents that matched the filter
res.modifiedCount; // Number of documents that were modified
res.upsertedCount; // Number of documents that were upserted
res.upsertedId; // Identifier of the inserted document (if an upsert took place)
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>replaceOne()</code></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.select()"><a href="#Query.prototype.select()"><code>Query.prototype.select()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>arg</code>
<span class="method-type">&laquo;Object|String|Array[String]&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/schematype.html">SchemaType</a></span></li></ul><div><p>Specifies which document fields to include or exclude (also known as the query &quot;projection&quot;)</p>
<p>When using string syntax, prefixing a path with <code>-</code> will flag that path as excluded. When a path does not have the <code>-</code> prefix, it is included. Lastly, if a path is prefixed with <code>+</code>, it forces inclusion of the path, which is useful for paths excluded at the <a href="/docs/api/schematype.html#SchemaType.prototype.select()">schema level</a>.</p>
<p>A projection <em>must</em> be either inclusive or exclusive. In other words, you must
either list the fields to include (which excludes all others), or list the fields
to exclude (which implies all other fields are included). The <a href="https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/#suppress-id-field"><code>_id</code> field is the only exception because MongoDB includes it by default</a>.</p>
<h4 id="example">Example:</h4>
<pre><code>// include a and b, exclude other fields
query.select(&#39;a b&#39;);
// Equivalent syntaxes:
query.select([&#39;a&#39;, &#39;b&#39;]);
query.select({ a: 1, b: 1 });

// exclude c and d, include other fields
query.select(&#39;-c -d&#39;);

// Use `+` to override schema-level `select: false` without making the
// projection inclusive.
const schema = new Schema({
  foo: { type: String, select: false },
  bar: String
});
// ...
query.select(&#39;+foo&#39;); // Override foo&#39;s `select: false` without excluding `bar`

// or you may use object notation, useful when
// you have keys already prefixed with a &quot;-&quot;
query.select({ a: 1, b: 1 });
query.select({ c: 0, d: 0 });

Additional calls to select can override the previous selection:
query.select({ a: 1, b: 1 }).select({ b: 0 }); // selection is now { a: 1 }
query.select({ a: 0, b: 0 }).select({ b: 1 }); // selection is now { a: 0 }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.selected()"><a href="#Query.prototype.selected()"><code>Query.prototype.selected()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if field selection has been made.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.selectedExclusively()"><a href="#Query.prototype.selectedExclusively()"><code>Query.prototype.selectedExclusively()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if exclusive field selection has been made.</p>
<pre><code>query.selectedExclusively(); // false
query.select(&#39;-name&#39;);
query.selectedExclusively(); // true
query.selectedInclusively(); // false
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.selectedInclusively()"><a href="#Query.prototype.selectedInclusively()"><code>Query.prototype.selectedInclusively()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>Determines if inclusive field selection has been made.</p>
<pre><code>query.selectedInclusively(); // false
query.select(&#39;name&#39;);
query.selectedInclusively(); // true
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.session()"><a href="#Query.prototype.session()"><code>Query.prototype.session()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[session]</code>
<span class="method-type">&laquo;ClientSession&raquo;</span> from <code>await conn.startSession()</code></p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/connection.html#Connection.prototype.startSession()">Connection.prototype.startSession()</a></span></li><li><span class="method-type"><a href="/docs/api/mongoose.html#Mongoose.prototype.startSession()">mongoose.startSession()</a></span></li></ul><div><p>Sets the <a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">MongoDB session</a>
associated with this query. Sessions are how you mark a query as part of a
<a href="/docs/transactions.html">transaction</a>.</p>
<p>Calling <code>session(null)</code> removes the session from this query.</p>
<h4 id="example">Example:</h4>
<pre><code>const s = await mongoose.startSession();
await mongoose.model(&#39;Person&#39;).findOne({ name: &#39;Axl Rose&#39; }).session(s);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.set()"><a href="#Query.prototype.set()"><code>Query.prototype.set()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;String|Object&raquo;</span> path or object of key/value pairs to set</p>
</li><li class="param"><code>[val]</code>
<span class="method-type">&laquo;Any&raquo;</span> the value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Adds a <code>$set</code> to this query&#39;s update without changing the operation.
This is useful for query middleware so you can add an update regardless
of whether you use <code>updateOne()</code>, <code>updateMany()</code>, <code>findOneAndUpdate()</code>, etc.</p>
<h4 id="example">Example:</h4>
<pre><code>// Updates `{ $set: { updatedAt: new Date() } }`
new Query().updateOne({}, {}).set(&#39;updatedAt&#39;, new Date());
new Query().updateMany({}, {}).set({ updatedAt: new Date() });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.setOptions()"><a href="#Query.prototype.setOptions()"><code>Query.prototype.setOptions()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>options</code>
<span class="method-type">&laquo;Object&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Sets query options. Some options only make sense for certain operations.</p>
<h4 id="options">Options:</h4>
<p>The following options are only for <code>find()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/core/tailable-cursors/">tailable</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.limit/">limit</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/">skip</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.allowDiskUse/">allowDiskUse</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.batchSize/">batchSize</a></li>
<li><a href="https://www.mongodb.com/docs/manual/applications/replication/#read-preference">readPreference</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.hint/">hint</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.comment/">comment</a></li>
</ul>
<p>The following options are only for write operations: <code>updateOne()</code>, <code>updateMany()</code>, <code>replaceOne()</code>, <code>findOneAndUpdate()</code>, and <code>findByIdAndUpdate()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">upsert</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">writeConcern</a></li>
<li><a href="/docs/guide.html#timestamps">timestamps</a>: If <code>timestamps</code> is set in the schema, set this option to <code>false</code> to skip timestamps for that particular update. Has no effect if <code>timestamps</code> is not enabled in the schema options.</li>
<li>overwriteDiscriminatorKey: allow setting the discriminator key in the update. Will use the correct discriminator schema if the update changes the discriminator key.</li>
</ul>
<p>The following options are only for <code>find()</code>, <code>findOne()</code>, <code>findById()</code>, <code>findOneAndUpdate()</code>, <code>findOneAndReplace()</code>, <code>findOneAndDelete()</code>, and <code>findByIdAndUpdate()</code>:</p>
<ul>
<li><a href="#Query.prototype.lean()">lean</a></li>
<li><a href="/docs/populate.html">populate</a></li>
<li><a href="#Query.prototype.projection()">projection</a></li>
<li>sanitizeProjection</li>
<li>useBigInt64</li>
</ul>
<p>The following options are only for all operations <strong>except</strong> <code>updateOne()</code>, <code>updateMany()</code>, <code>deleteOne()</code>, and <code>deleteMany()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/reference/operator/meta/maxTimeMS/">maxTimeMS</a></li>
</ul>
<p>The following options are for <code>find()</code>, <code>findOne()</code>, <code>findOneAndUpdate()</code>, <code>findOneAndDelete()</code>, <code>updateOne()</code>, and <code>deleteOne()</code>:</p>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/">sort</a></li>
</ul>
<p>The following options are for <code>findOneAndUpdate()</code> and <code>findOneAndDelete()</code></p>
<ul>
<li>includeResultMetadata</li>
</ul>
<p>The following options are for all operations:</p>
<ul>
<li><a href="/docs/guide.html#strict">strict</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/collation/">collation</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/server-sessions/">session</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.explain/">explain</a></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.setQuery()"><a href="#Query.prototype.setQuery()"><code>Query.prototype.setQuery()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>new</code>
<span class="method-type">&laquo;Object&raquo;</span> query conditions</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;undefined,void&raquo;</span> </li></ul><div><p>Sets the query conditions to the provided JSON object.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.find({ a: 1 })
query.setQuery({ a: 2 });
query.getQuery(); // { a: 2 }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.setUpdate()"><a href="#Query.prototype.setUpdate()"><code>Query.prototype.setUpdate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>new</code>
<span class="method-type">&laquo;Object&raquo;</span> update operation</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;undefined,void&raquo;</span> </li></ul><div><p>Sets the current update operation to new value.</p>
<h4 id="example">Example:</h4>
<pre><code>const query = new Query();
query.updateOne({}, { $set: { a: 5 } });
query.setUpdate({ $set: { b: 6 } });
query.getUpdate(); // { $set: { b: 6 } }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.size()"><a href="#Query.prototype.size()"><code>Query.prototype.size()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/size/">$size</a></span></li></ul><div><p>Specifies a <code>$size</code> query condition.</p>
<p>When called with one argument, the most recent path passed to <code>where()</code> is used.</p>
<h4 id="example">Example:</h4>
<pre><code>const docs = await MyModel.where(&#39;tags&#39;).size(0).exec();
assert(Array.isArray(docs));
console.log(&#39;documents with 0 tags&#39;, docs);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.skip()"><a href="#Query.prototype.skip()"><code>Query.prototype.skip()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Number&raquo;</span> </li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/">cursor.skip</a></span></li></ul><div><p>Specifies the number of documents to skip.</p>
<h4 id="example">Example:</h4>
<pre><code>query.skip(100).limit(20);
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.slice()"><a href="#Query.prototype.slice()"><code>Query.prototype.slice()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>val</code>
<span class="method-type">&laquo;Number|Array&raquo;</span> number of elements to slice or array with number of elements to skip and number of elements to slice</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/#projection">mongodb</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/projection/slice/#prj._S_slice">$slice</a></span></li></ul><div><p>Specifies a <code>$slice</code> projection for an array.</p>
<h4 id="example">Example:</h4>
<pre><code>query.slice(&#39;comments&#39;, 5); // Returns the first 5 comments
query.slice(&#39;comments&#39;, -5); // Returns the last 5 comments
query.slice(&#39;comments&#39;, [10, 5]); // Returns the first 5 comments after the 10-th
query.where(&#39;comments&#39;).slice(5); // Returns the first 5 comments
query.where(&#39;comments&#39;).slice([-10, 5]); // Returns the first 5 comments after the 10-th to last
</code></pre>
<p><strong>Note:</strong> If the absolute value of the number of elements to be sliced is greater than the number of elements in the array, all array elements will be returned.</p>
<pre><code> // Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 query.slice(&#39;arr&#39;, 20); // Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 query.slice(&#39;arr&#39;, -20); // Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</code></pre>
<p><strong>Note:</strong> If the number of elements to skip is positive and greater than the number of elements in the array, an empty array will be returned.</p>
<pre><code> // Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 query.slice(&#39;arr&#39;, [20, 5]); // Returns []
</code></pre>
<p><strong>Note:</strong> If the number of elements to skip is negative and its absolute value is greater than the number of elements in the array, the starting position is the start of the array.</p>
<pre><code> // Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
 query.slice(&#39;arr&#39;, [-20, 5]); // Returns [1, 2, 3, 4, 5]
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.sort()"><a href="#Query.prototype.sort()"><code>Query.prototype.sort()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>arg</code>
<span class="method-type">&laquo;Object|String|Array&lt;Array&lt;string|number&gt;&gt;&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.override=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, replace existing sort options with <code>arg</code></p>
</li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/">cursor.sort</a></span></li></ul><div><p>Sets the sort order</p>
<p>If an object is passed, values allowed are <code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>.</p>
<p>If a string is passed, it must be a space delimited list of path names. The
sort order of each path is ascending unless the path name is prefixed with <code>-</code>
which will be treated as descending.</p>
<h4 id="example">Example:</h4>
<pre><code>// sort by &quot;field&quot; ascending and &quot;test&quot; descending
query.sort({ field: &#39;asc&#39;, test: -1 });

// equivalent
query.sort(&#39;field -test&#39;);

// also possible is to use a array with array key-value pairs
query.sort([[&#39;field&#39;, &#39;asc&#39;]]);
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.tailable()"><a href="#Query.prototype.tailable()"><code>Query.prototype.tailable()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean&raquo;</span> defaults to true</p>
</li><li class="param"><code>[opts]</code>
<span class="method-type">&laquo;Object&raquo;</span> options to set</p>
</li><ul style="margin-top: 0.5em"><li><code>[opts.awaitData]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> false by default. Set to true to keep the cursor open even if there&#39;s no data.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[opts.maxAwaitTimeMS]</code>
<span class="method-type">&laquo;Number&raquo;</span> the maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query. Requires <code>tailable</code> and <code>awaitData</code> to be true</p>
</li></ul></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/tutorial/create-tailable-cursor/">tailable</a></span></li></ul><div><p>Sets the tailable option (for use with capped collections).</p>
<h4 id="example">Example:</h4>
<pre><code>query.tailable(); // true
query.tailable(true);
query.tailable(false);

// Set both `tailable` and `awaitData` options
query.tailable({ awaitData: true });
</code></pre>
<h4 id="note">Note:</h4>
<p>Cannot be used with <code>distinct()</code></p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.then()"><a href="#Query.prototype.then()"><code>Query.prototype.then()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[resolve]</code>
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param"><code>[reject]</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Promise&raquo;</span> </li></ul><div><p>Executes the query returning a <code>Promise</code> which will be
resolved with either the doc(s) or rejected with the error.</p>
<p>More about <a href="https://masteringjs.io/tutorials/fundamentals/then"><code>then()</code> in JavaScript</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.toConstructor()"><a href="#Query.prototype.toConstructor()"><code>Query.prototype.toConstructor()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> subclass-of-Query</li></ul><div><p>Converts this query to a customized, reusable query constructor with all arguments and options retained.</p>
<h4 id="example">Example:</h4>
<pre><code>// Create a query for adventure movies and read from the primary
// node in the replica-set unless it is down, in which case we&#39;ll
// read from a secondary node.
const query = Movie.find({ tags: &#39;adventure&#39; }).read(&#39;primaryPreferred&#39;);

// create a custom Query constructor based off these settings
const Adventure = query.toConstructor();

// further narrow down our query results while still using the previous settings
await Adventure().where({ name: /^Life/ }).exec();

// since Adventure is a stand-alone constructor we can also add our own
// helper methods and getters without impacting global queries
Adventure.prototype.startsWith = function (prefix) {
  this.where({ name: new RegExp(&#39;^&#39; + prefix) })
  return this;
}
Object.defineProperty(Adventure.prototype, &#39;highlyRated&#39;, {
  get: function () {
    this.where({ rating: { $gt: 4.5 }});
    return this;
  }
})
await Adventure().highlyRated.startsWith(&#39;Life&#39;).exec();
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.transform()"><a href="#Query.prototype.transform()"><code>Query.prototype.transform()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> function to run to transform the query result</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Runs a function <code>fn</code> and treats the return value of <code>fn</code> as the new value
for the query to resolve to.</p>
<p>Any functions you pass to <code>transform()</code> will run <strong>after</strong> any post hooks.</p>
<h4 id="example">Example:</h4>
<pre><code>const res = await MyModel.findOne().transform(res =&gt; {
  // Sets a `loadedAt` property on the doc that tells you the time the
  // document was loaded.
  return res == null ?
    res :
    Object.assign(res, { loadedAt: new Date() });
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.updateMany()"><a href="#Query.prototype.updateMany()"><code>Query.prototype.updateMany()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[update]</code>
<span class="method-type">&laquo;Object|Array&raquo;</span> the update command. If array, this update will be treated as an update pipeline and not casted.</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.multipleCastError]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.upsert=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.writeConcern=null]</code>
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.timestamps=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.overwriteDiscriminatorKey=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose removes discriminator key updates from <code>update</code> by default, set <code>overwriteDiscriminatorKey</code> to <code>true</code> to allow updating the discriminator key</p>
</li></ul><li class="param"><code>[callback]</code>
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/model.html#Model.update()">Model.update</a></span></li><li><span class="method-type"><a href="/docs/queries.html">Query docs</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">update</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html">UpdateResult</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output">MongoDB docs</a></span></li></ul><div><p>Declare and/or execute this query as an updateMany() operation.
MongoDB will update <em>all</em> documents that match <code>filter</code> (as opposed to just the first one).</p>
<p><strong>Note</strong> updateMany will <em>not</em> fire update middleware. Use <code>pre(&#39;updateMany&#39;)</code>
and <code>post(&#39;updateMany&#39;)</code> instead.</p>
<h4 id="example">Example:</h4>
<pre><code>const res = await Person.updateMany({ name: /Stark$/ }, { isDeleted: true });
res.n; // Number of documents matched
res.nModified; // Number of documents modified
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateMany()</code></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.updateOne()"><a href="#Query.prototype.updateOne()"><code>Query.prototype.updateOne()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[filter]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[update]</code>
<span class="method-type">&laquo;Object|Array&raquo;</span> the update command. If array, this update will be treated as an update pipeline and not casted.</p>
</li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.multipleCastError]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.strict]</code>
<span class="method-type">&laquo;Boolean|String&raquo;</span> overwrites the schema&#39;s <a href="/docs/guide.html#strict">strict mode option</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.upsert=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> if true, and no documents found, insert a new document</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.writeConcern=null]</code>
<span class="method-type">&laquo;Object&raquo;</span> sets the <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">write concern</a> for replica sets. Overrides the <a href="/docs/guide.html#writeConcern">schema-level write concern</a></p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.timestamps=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>false</code> and <a href="/docs/guide.html#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.translateAliases=null]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If set to <code>true</code>, translates any schema-defined aliases in <code>filter</code>, <code>projection</code>, <code>update</code>, and <code>distinct</code>. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.overwriteDiscriminatorKey=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> Mongoose removes discriminator key updates from <code>update</code> by default, set <code>overwriteDiscriminatorKey</code> to <code>true</code> to allow updating the discriminator key</p>
</li></ul><li class="param"><code>[callback]</code>
<span class="method-type">&laquo;Function&raquo;</span> params are (error, writeOpResult)</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/model.html#Model.update()">Model.update</a></span></li><li><span class="method-type"><a href="/docs/queries.html">Query docs</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">update</a></span></li><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html">UpdateResult</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output">MongoDB docs</a></span></li></ul><div><p>Declare and/or execute this query as an updateOne() operation.
MongoDB will update <em>only</em> the first document that matches <code>filter</code>.</p>
<ul>
<li>Use <code>replaceOne()</code> if you want to overwrite an entire document rather than using <a href="https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern">atomic operators</a> like <code>$set</code>.</li>
</ul>
<p><strong>Note</strong> updateOne will <em>not</em> fire update middleware. Use <code>pre(&#39;updateOne&#39;)</code>
and <code>post(&#39;updateOne&#39;)</code> instead.</p>
<h4 id="example">Example:</h4>
<pre><code>const res = await Person.updateOne({ name: &#39;Jean-Luc Picard&#39; }, { ship: &#39;USS Enterprise&#39; });
res.acknowledged; // Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.
res.matchedCount; // Number of documents that matched the filter
res.modifiedCount; // Number of documents that were modified
res.upsertedCount; // Number of documents that were upserted
res.upsertedId; // Identifier of the inserted document (if an upsert took place)
</code></pre>
<p>This function triggers the following middleware.</p>
<ul>
<li><code>updateOne()</code></li>
</ul>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.w()"><a href="#Query.prototype.w()"><code>Query.prototype.w()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;String|number&raquo;</span> 0 for fire-and-forget, 1 for acknowledged by one server, &#39;majority&#39; for majority of the replica set, or <a href="https://www.mongodb.com/docs/manual/reference/write-concern/#w-option">any of the more advanced options</a>.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/write-concern/#w-option">mongodb</a></span></li></ul><div><p>Sets the specified number of <code>mongod</code> servers, or tag set of <code>mongod</code> servers,
that must acknowledge this write before this write is considered successful.
This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.w</code> option</a></p>
<h4 id="example">Example:</h4>
<pre><code>// The &#39;majority&#39; option means the `deleteOne()` promise won&#39;t resolve
// until the `deleteOne()` has propagated to the majority of the replica set
await mongoose.model(&#39;Person&#39;).
  deleteOne({ name: &#39;Ned Stark&#39; }).
  w(&#39;majority&#39;);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.where()"><a href="#Query.prototype.where()"><code>Query.prototype.where()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[path]</code>
<span class="method-type">&laquo;String|Object&raquo;</span> </li><li class="param"><code>[val]</code>
<span class="method-type">&laquo;any&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><div><p>Specifies a <code>path</code> for use with chaining.</p>
<h4 id="example">Example:</h4>
<pre><code>// instead of writing:
User.find({age: {$gte: 21, $lte: 65}});

// we can instead write:
User.where(&#39;age&#39;).gte(21).lte(65);

// passing query conditions is permitted
User.find().where({ name: &#39;vonderful&#39; })

// chaining
User
.where(&#39;age&#39;).gte(21).lte(65)
.where(&#39;name&#39;, /^vonderful/i)
.where(&#39;friends&#39;).slice(10)
.exec()
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.within()"><a href="#Query.prototype.within()"><code>Query.prototype.within()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/polygon/">$polygon</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/box/">$box</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geometry/">$geometry</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/center/">$center</a></span></li><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/centerSphere/">$centerSphere</a></span></li></ul><div><p>Defines a <code>$within</code> or <code>$geoWithin</code> argument for geo-spatial queries.</p>
<h4 id="example">Example:</h4>
<pre><code>query.where(path).within().box()
query.where(path).within().circle()
query.where(path).within().geometry()

query.where(&#39;loc&#39;).within({ center: [50,50], radius: 10, unique: true, spherical: true });
query.where(&#39;loc&#39;).within({ box: [[40.73, -73.9], [40.7, -73.988]] });
query.where(&#39;loc&#39;).within({ polygon: [[],[],[],[]] });

query.where(&#39;loc&#39;).within([], [], []) // polygon
query.where(&#39;loc&#39;).within([], []) // box
query.where(&#39;loc&#39;).within({ type: &#39;LineString&#39;, coordinates: [...] }); // geometry
</code></pre>
<p><strong>MUST</strong> be used after <code>where()</code>.</p>
<h4 id="note">Note:</h4>
<p>As of Mongoose 3.7, <code>$geoWithin</code> is always used for queries. To change this behavior, see <a href="#Query.prototype.use$geoWithin">Query.use$geoWithin</a>.</p>
<h4 id="note-1">Note:</h4>
<p>In Mongoose 3.7, <code>within</code> changed from a getter to a function. If you need the old syntax, use <a href="https://github.com/ebensing/mongoose-within">this</a>.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.writeConcern()"><a href="#Query.prototype.writeConcern()"><code>Query.prototype.writeConcern()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>writeConcern</code>
<span class="method-type">&laquo;Object&raquo;</span> the write concern value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/WriteConcernSettings.html">WriteConcernSettings</a></span></li></ul><div><p>Sets the 3 write concern parameters for this query:</p>
<ul>
<li><code>w</code>: Sets the specified number of <code>mongod</code> servers, or tag set of <code>mongod</code> servers, that must acknowledge this write before this write is considered successful.</li>
<li><code>j</code>: Boolean, set to <code>true</code> to request acknowledgement that this operation has been persisted to MongoDB&#39;s on-disk journal.</li>
<li><code>wtimeout</code>: If <a href="#Query.prototype.w()"><code>w &gt; 1</code></a>, the maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is <code>0</code>, which means no timeout.</li>
</ul>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern</code> option</a></p>
<h4 id="example">Example:</h4>
<pre><code>// The &#39;majority&#39; option means the `deleteOne()` promise won&#39;t resolve
// until the `deleteOne()` has propagated to the majority of the replica set
await mongoose.model(&#39;Person&#39;).
  deleteOne({ name: &#39;Ned Stark&#39; }).
  writeConcern({ w: &#39;majority&#39; });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype.wtimeout()"><a href="#Query.prototype.wtimeout()"><code>Query.prototype.wtimeout()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>ms</code>
<span class="method-type">&laquo;number&raquo;</span> number of milliseconds to wait</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Query&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout">mongodb</a></span></li></ul><div><p>If <a href="#Query.prototype.w()"><code>w &gt; 1</code></a>, the maximum amount of time to
wait for this write to propagate through the replica set before this
operation fails. The default is <code>0</code>, which means no timeout.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndReplace()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the schema&#39;s <a href="/docs/guide.html#writeConcern"><code>writeConcern.wtimeout</code> option</a></p>
<h4 id="example">Example:</h4>
<pre><code>// The `deleteOne()` promise won&#39;t resolve until this `deleteOne()` has
// propagated to at least `w = 2` members of the replica set. If it takes
// longer than 1 second, this `deleteOne()` will fail.
await mongoose.model(&#39;Person&#39;).
  deleteOne({ name: &#39;Ned Stark&#39; }).
  w(2).
  wtimeout(1000);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype[Symbol.asyncIterator]()"><a href="#Query.prototype[Symbol.asyncIterator]()"><code>Query.prototype[Symbol.asyncIterator]()</code></a></h3><div><p>Returns an asyncIterator for use with <a href="https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js"><code>for/await/of</code> loops</a>
This function <em>only</em> works for <code>find()</code> queries.
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.</p>
<h4 id="example">Example:</h4>
<pre><code>for await (const doc of Model.aggregate([{ $sort: { name: 1 } }])) {
  console.log(doc.name);
}
</code></pre>
<p>Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the <a href="https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187"><code>--harmony_async_iteration</code> flag</a>.</p>
<p><strong>Note:</strong> This function is not if <code>Symbol.asyncIterator</code> is undefined. If
<code>Symbol.asyncIterator</code> is undefined, that means your Node.js version does not
support async iterators.</p>
  </div><hr class="separate-api-elements"><h3 id="Query.prototype[Symbol.toStringTag]()"><a href="#Query.prototype[Symbol.toStringTag]()"><code>Query.prototype[Symbol.toStringTag]()</code></a></h3><h5>Returns:</h5><ul><li><span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>Returns a string representation of this query.</p>
<p>More about <a href="https://masteringjs.io/tutorials/fundamentals/tostring"><code>toString()</code> in JavaScript</a>.</p>
<h4 id="example">Example:</h4>
<pre><code>const q = Model.find();
console.log(q); // Prints &quot;Query { find }&quot;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="Query.use$geoWithin"><a href="#Query.use$geoWithin"><code>Query.use$geoWithin</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="https://www.mongodb.com/docs/manual/reference/operator/geoWithin/">geoWithin</a></span></li></ul><div><p>Flag to opt out of using <code>$geoWithin</code>.</p>
<pre><code class="language-javascript">mongoose.Query.use$geoWithin = false;
</code></pre>
<p>MongoDB 2.4 deprecated the use of <code>$within</code>, replacing it with <code>$geoWithin</code>. Mongoose uses <code>$geoWithin</code> by default (which is 100% backward compatible with <code>$within</code>). If you are running an older version of MongoDB, set this flag to <code>false</code> so your <code>within()</code> queries continue to work.</p>
  </div></div></div></div><div id="jobs"><div class="job-listing"><a href="/docs/jobs.html#61f0b0402d893554bc3a247f"><div class="company-logo"><img src="https://assets.localizecdn.com/uploads/1689251999716.png"></div><div class="description"><div class="company">Localize</div><div class="title">Full Stack Engineer</div><div class="location">Anywhere</div></div></a></div><div class="button jobs-view-more"><a href="/docs/jobs.html">View more jobs!</a></div></div><script type="text/javascript" src="/docs/js/navbar-search.js"></script><script type="text/javascript" src="/docs/js/mobile-navbar-toggle.js"></script></div></body></html>