<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose Connecting to MongoDB v4.1.1</title><link href="http://fonts.googleapis.com/css?family=Anonymous+Pro:400,700|Droid+Sans+Mono|Open+Sans:400,700|Linden+Hill|Quattrocento:400,700|News+Cycle:400,700|Antic+Slab|Cabin+Condensed:400,700" rel="stylesheet" type="text/css"><link href="css/default.css" rel="stylesheet" type="text/css"><link href="css/guide.css" rel="stylesheet" type="text/css"></head><body><a id="forkbanner" href="http://github.com/Automattic/mongoose"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a><div id="links"><div id="header"><h1><a href="../index.html"><div class="mongoose">Mongoose</div></a></h1></div><ul><li class="home"><a href="../index.html">home</a></li><li class="faq"><a href="./faq.html">FAQ</a></li><li class="plugins"><a href="http://plugins.mongoosejs.com">plugins</a></li><li class="changelog"><a href="http://github.com/Automattic/mongoose/tree/master/History.md">change log</a></li><li class="support"><a href="../index.html#support">support</a></li><li class="fork"><a href="http://github.com/Automattic/mongoose">fork</a></li><li class="guide"><a href="./guide.html">guide</a><ul><li class="double"><a href="./guide.html">schemas</a><ul><li class="schematypes"><a href="./schematypes.html"><span>schema</span>types</a></li></ul></li><li><a href="./models.html">models</a></li><li class="double"><a href="./documents.html">documents</a><ul><li class="subdocs"><a href="./subdocs.html">sub docs</a></li></ul></li><li><a href="./queries.html">queries</a></li><li><a href="./validation.html">validation</a></li><li><a href="./middleware.html">middleware</a></li><li><a href="./populate.html">population</a></li><li><a href="./connections.html">connections</a></li><li><a href="./plugins.html">plugins</a></li><li><a href="https://github.com/Automattic/mongoose/blob/master/CONTRIBUTING.md">contributing</a></li><li><a href="./harmony.html">ES6 integration</a></li><li><a href="./browser.html">schemas in the browser</a></li><li><a href="https://github.com/Automattic/mongoose/wiki/3.6-Release-Notes">3.6 release notes</a></li><li><a href="https://github.com/Automattic/mongoose/wiki/3.8-Release-Notes">3.8 release notes</a></li><li><a href="https://github.com/Automattic/mongoose/wiki/4.0-Release-Notes">4.0 release notes</a></li></ul></li><li class="api"><a href="./api.html">API docs</a></li><li class="quickstart"><a href="./index.html">quick start</a></li><li class="contrib"><a href="http://github.com/Automattic/mongoose/contributors">contributors</a></li><li class="prior"><a href="./prior.html">prior releases</a></li></ul></div><div id="content"><div class="module"><gcse:search></gcse:search><h2>Connections</h2><p>We may connect to MongoDB by utilizing the <code>mongoose.connect()</code> method.</p><pre><code class="javascript">mongoose.connect(<span class="string">'mongodb://localhost/myapp'</span>);
</code></pre><p>This is the minimum needed to connect the <code>myapp</code> database running locally on the default port (27017). If the local connection fails then try using 127.0.0.1 instead of localhost. Sometimes issues may arise when the local hostname has been changed.</p>

<p>We may also specify several more parameters in the <code>uri</code> depending on your environment:</p><pre><code class="javascript">mongoose.connect(<span class="string">'mongodb://username:password@host:port/database?options...'</span>);
</code></pre><p>See the <a href="http://docs.mongodb.org/manual/reference/connection-string/">mongodb connection string spec</a> for more detail.</p><h3 id="options">Options</h3><p>The <code>connect</code> method also accepts an <code>options</code> object which will be passed on to the underlying driver. All options included here take precedence over options passed in the connection string.</p><pre><code class="javascript">mongoose.connect(uri, options);
</code></pre><p>The following option keys are available:</p>

<pre><code> db      - passed to the connection db instance
 server  - passed to the connection server instance(s)
 replset - passed to the connection ReplSet instance
 user    - username for authentication (if not specified in uri)
 pass    - password for authentication (if not specified in uri)
 auth    - options for authentication
 mongos  - passed to the [underlying driver&#39;s mongos options](http://mongodb.github.io/node-mongodb-native/2.0/api/Mongos.html)</code></pre>

<p>Example:</p><pre><code class="javascript"><span class="keyword">var</span> options = {
  db: { native_parser: <span class="literal">true</span> },
  server: { poolSize: <span class="number">5</span> },
  replset: { rs_name: <span class="string">'myReplicaSetName'</span> },
  user: <span class="string">'myUserName'</span>,
  pass: <span class="string">'myPassword'</span>
}
mongoose.connect(uri, options);</code></pre><p><strong>Note:</strong>
The server option <code>auto_reconnect</code> is defaulted to true which <em>can</em> be overridden.
The db option <code>forceServerObjectId</code> is set to false which <em>cannot</em> be overridden.</p>

<p>See the <a href="https://github.com/mongodb/node-mongodb-native">driver</a> for more information about available options.</p><h4 id="keepAlive">A note about keepAlive</h4><div class="important"><p>For long running applictions it is often prudent to enable <code>keepAlive</code>. Without it, after some period of time you may start to see <code>&quot;connection closed&quot;</code> errors for what seems like no reason. If so, after <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">reading this</a>, you may decide to enable <code>keepAlive</code>:</p></div><pre><code class="javascript">options.server.socketOptions = options.replset.socketOptions = { keepAlive: <span class="number">1</span> };
mongoose.connect(uri, options);
</code></pre><h3 id="replicaset_connections">ReplicaSet Connections</h3><p>The same method is used to connect to a replica set but instead of passing a single <code>uri</code> we pass a comma delimited list of <code>uri</code>s.</p><pre><code class="javascript">mongoose.connect(<span class="string">'mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]'</span> [, options]);
</code></pre><h3 id="mongos_connections">Multi-mongos support</h3><p>High availability over multiple <code>mongos</code> instances is also supported. Pass a connection string for your <code>mongos</code> instances and set the <code>mongos</code> option to true:</p><pre><code class="javascript">mongoose.connect(<span class="string">'mongodb://mongosA:27501,mongosB:27501'</span>, { mongos: <span class="literal">true</span> }, cb);
</code></pre><h3 id="multiple_connections">Multiple connections</h3><p>So far we&#39;ve seen how to connect to MongoDB using Mongoose&#39;s default connection. At times we may need multiple connections open to Mongo, each with different read/write settings, or maybe just to different databases for example. In these cases we can utilize <code>mongoose.createConnection()</code> which accepts all the arguments already discussed and returns a fresh connection for you.</p><pre><code class="javascript"><span class="keyword">var</span> conn = mongoose.createConnection(<span class="string">'mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]'</span>, options);
</code></pre><p>This <a href="./api.html#connection_Connection">connection</a> object can then be used for creating and retrieving <a href="./api.html#model_Model">models</a> that are scoped only to this specific connection.</p><h3 id="connection_pools">Connection pools</h3><p>Each <code>connection</code>, whether created with <code>mongoose.connect</code> or <code>mongoose.createConnection</code> are all backed by an internal configurable connection pool defaulting to a size of 5. Adjust the pool size using your connection options:</p><pre><code class="javascript"><span class="comment">// single server</span>
<span class="keyword">var</span> uri = <span class="string">'mongodb://localhost/test'</span>;
mongoose.createConnection(uri, { server: { poolSize: <span class="number">4</span> }});

<span class="comment">// for a replica set</span>
mongoose.createConnection(uri, { replset: { poolSize: <span class="number">4</span> }});

<span class="comment">// passing the option in the URI works with single or replica sets</span>
<span class="keyword">var</span> uri = <span class="string">'mongodb://localhost/test?poolSize=4'</span>;
mongoose.createConnection(uri);
</code></pre><h3 id="next">Next Up</h3><p>Now that we&#39;ve covered <code>connections</code>, let&#39;s take a look at how we can break pieces of our functionality out into reusable and shareable <a href="/docs/plugins.html">plugins</a>.</p></div></div><script>document.body.className = 'load';</script><script>;(function() {
  var cx = '012173159455227967368:uvscsuqjovs';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();</script><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-1122274-9']);
_gaq.push(['_trackPageview', location.pathname + location.search + location.hash]);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>