<html>
  <head>
    <title>Mongoose ORM</title>
    <style>
      body {
        background: url('/images/bg.png');
        padding: 0 30px 30px;
        margin-top: 0;
      }

      #wrap {
        background: url('/images/pattern.png') no-repeat -134px -211px;
        min-height: 600px;
        padding-top: 30px;
      }

      #page {
        width: 850px;
        margin: auto;
        position: relative;
      }

      #footer {
        font: 13px Helvetica;
        padding-top: 5px;
        border-top: 1px solid #000;
      }

      #content {
        color: #272727;
        font: 14px Courier;
      }

      #content h1, #content h2, #content h3 {
        text-shadow: 0 1px 0 #fff;
      }

      pre {
        background: rgba(255,255,255,.8);
        border: 1px solid #c6c6c6;
        padding: 10px;
        border-radius: 3px
      }

      code {
        background: rgba(255,255,255,.8);
        border: 1px solid #c6c6c6;
        color: #333;
        border-radius: 3px
      }

      pre code {
        border: 0 none;
      }

      form {
        position: absolute;
        right: 0;
        top: 0;
        color: #666;
        font: bold 12px Helvetica;
        text-shadow: 0 1px 0 #fff;
      }

      form img {
        margin-right: 5px
      }

      #google-members-count {
        vertical-align: top;
        line-height: 32px;
      }

      h1 a {
        background: url('/images/logo.png');
        width: 404px;
        height: 47px;
        margin-bottom: 40px;
        text-indent: -500em;
        display: block;
      }

      a {
        color: #2a758a;
        text-shadow: 0 1px 0 #fff;
        text-decoration: none;
      } 

      a:hover {
        opacity: 0.8;
      }

      #menu {
        border-top: 1px solid #1e1e1e;
        border-bottom: 1px solid #e0e0e0;
        margin-top: 10px;
        font: bold 14px Helvetica;
        background: rgba(255,255,255,.2);
      }

      #menu ul {
        margin: 0;
        border-top: 1px solid #e0e0de;
        padding: 13px 0;
        border-bottom: 1px solid #1e1e1e;
        text-align: center;
      }

      #menu ul li {
        list-style-type: none;
        display: inline;
        padding-right: 10px;
      }
    </style>

    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1122274-9']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      
      function getMembers(data){
        if (!(data && data.query && data.query.results && data.query.results.p)) return;
        var members = document.createElement('span');
        members.id = 'google-members-count';
        members.innerHTML = '('+ data.query.results.p +' members)';
        document.getElementsByTagName('FORM')[0].insertBefore(members, document.getElementById('google-subscribe-input'));
      };

      window.onload = function(){
        // lame jsonp
        var script = document.createElement('script');
        script.src = "http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22http%3A%2F%2Fgroups.google.com%2Fgroup%2Fmongoose-orm%2Fabout%22%20and%20xpath%3D'%2F%2Fdiv%5B%40class%3D%5C'maincontbox%5C'%5D%2Ftable%2Ftr%5B1%5D%2Ftd%2Fp%5B1%5D'%0A&format=json&callback=getMembers";
        document.head.appendChild(script);
      };
    </script>
  </head>
  <body>
    <div id="wrap">
      <div id="page">
        <h1><a href="/">Mongoose</a></h1>

        <form action="http://groups.google.com/group/mongoose-orm/boxsubscribe">
         <a href="http://groups.google.com/group/mongoose-orm" id="google-subscribe-link"><img src="/images/groups.png" border="0"></a>
         <span id="google-members-count">&nbsp;</span>
         <div id="google-subscribe-input">
           Email: <input type="text" name="email" id="google-subscribe-email">
           <input type="submit" name="go" value="Subscribe">
         </div>
        </form>

        <div id="menu">
          <ul>
            <li><a href="/docs/model-definition.html">Model Definition</a></li>
            <li><a href="/docs/embedded-documents.html">Embedded documents</a></li>
            <li><a href="/docs/finding-documents.html">Finding documents</a></li>
            <li><a href="/docs/middleware.html">Middleware</a></li>
            <li><a href="/docs/defaults.html">Defaults</a></li>
            <li><a href="/docs/indexes.html">Indexes</a></li>
            <li><a href="/docs/validation.html">Validation</a></li>
            <li><a href="/docs/virtuals.html">Virtuals</a></li>
            <li><a href="/docs/getters-setters.html">Getters / Setters</a></li>
            <li><a href="/docs/api.html">API</a></li>
          </ul>
        </div>

        <div id="content">
          <h1>Getters and Setters</h1>

<p>Getters and setters help you change how you get and set the attributes defined by the keys and values in the underlying raw document.</p>

<h2>Setters</h2>

<p>Setters allow you to transform the mongoose document&#39;s data before it gets to the raw mongodb document and is set as a value on an actual key.</p>

<p>Suppose you are implementing user registration for a website. User provide an email and password, which gets saved to mongodb. The email is a string that you will want to normalize to lower case, in order to avoid one email having more than one account -- e.g., otherwise, avenue@q.com can be registered for 2 accounts via avenue@q.com and AvEnUe@Q.CoM.</p>

<p>You can set up email lower case normalization easily via a Mongoose setter. Note in the following snippet that setters (and also getters) are defined in the <code>Schema</code>:</p>

<pre><code>function toLower (v) {
  return v.toLowerCase();
}

var UserSchema = new Schema({
  email: { type: String, set: toLower } 
});

var User = mongoose.model(&#39;User&#39;, UserSchema);
var user = new User({email: &#39;AVENUE@Q.COM&#39;});

console.log(user.email); // &#39;avenue@q.com&#39;</code></pre>

<p>As you can see above, setters allow you to transform the data before it gets to the raw mongodb document and is set as a value on an actual key.</p>

<h2>Getters</h2>

<p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p>

<p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user.  You can do so by defining a getter in the following way (again, notice that getters are defined in the <code>Schema</code>):</p>

<pre><code>function obfuscate (cc) {
  return &#39;****-****-****-&#39; + cc.slice(cc.length-4, cc.length);
}

var AccountSchema = new Schema({
  creditCardNumber: { type: String, get: obfuscate }
});

var Account = mongoose.model(&#39;Account&#39;, AccountSchema);

Account.findById( someId, function (err, found) {
  console.log(found.creditCardNumber); // &#39;****-****-****-1234&#39;
});</code></pre>

<h2>Summary</h2>

<p>Setters are intended to modify the underlying raw data. Getters are intended to transform (but not modify at the raw data level) the underlying raw data into something that the user expects to see. They are both defined in the <code>Schema</code> definition.</p>
        </div>

        <div id="footer">
          Mongoose by <a href="http://learnboost.com">gradebook</a> <a href="http://github.com/learnboost">LearnBoost Labs</a>. Released under the MIT license - Copyright <a href="http://learnboost.com">LearnBoost 2011</a>
        </div>
      </div>
    </div>
  </body>
</html>
